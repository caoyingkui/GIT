{
    "id": "SOLR-5614",
    "title": "Boost documents using \"map\" and \"query\" functions",
    "details": {
        "affect_versions": "4.6",
        "status": "Resolved",
        "fix_versions": [],
        "components": [],
        "type": "Bug",
        "priority": "Major",
        "labels": "",
        "resolution": "Invalid"
    },
    "description": "We want to boost documents that contain specific search terms in its fields. \n\nWe tried the following simplified query : \nhttp://localhost:8983/solr/collection1/select?q=ipod belkin&wt=xml&debugQuery=true&q.op=AND&defType=edismax&bf=map(query($qq),0,0,0,100.0)&qq=\n{!edismax}\npower\n\nAnd we get the following error : \norg.apache.solr.search.SyntaxError: Infinite Recursion detected parsing query 'power'\n\nAnd the stacktrace :\n\nERROR - 2014-01-06 18:27:02.275; org.apache.solr.common.SolrException; org.apache.solr.common.SolrException: org.apache.solr.search.SyntaxError: Infinite Recursion detected parsing query 'power'\n        at org.apache.solr.handler.component.QueryComponent.prepare(QueryComponent.java:171)\n        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:194)\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135)\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1859)\n        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:710)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:413)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:197)\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1419)\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:455)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:557)\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1075)\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:384)\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1009)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n        at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:255)\n        at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154)\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)\n        at org.eclipse.jetty.server.Server.handle(Server.java:368)\n        at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:489)\n        at org.eclipse.jetty.server.BlockingHttpConnection.handleRequest(BlockingHttpConnection.java:53)\n        at org.eclipse.jetty.server.AbstractHttpConnection.headerComplete(AbstractHttpConnection.java:942)\n        at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.headerComplete(AbstractHttpConnection.java:1004)\n        at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:640)\n        at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:235)\n        at org.eclipse.jetty.server.BlockingHttpConnection.handle(BlockingHttpConnection.java:72)\n        at org.eclipse.jetty.server.bio.SocketConnector$ConnectorEndPoint.run(SocketConnector.java:264)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543)\n        at java.lang.Thread.run(Thread.java:722)\nCaused by: org.apache.solr.search.SyntaxError: Infinite Recursion detected parsing query 'power'\n        at org.apache.solr.search.QParser.checkRecurse(QParser.java:178)\n        at org.apache.solr.search.QParser.subQuery(QParser.java:200)\n        at org.apache.solr.search.ExtendedDismaxQParser.getBoostFunctions(ExtendedDismaxQParser.java:437)\n        at org.apache.solr.search.ExtendedDismaxQParser.parse(ExtendedDismaxQParser.java:175)\n        at org.apache.solr.search.QParser.getQuery(QParser.java:142)\n        at org.apache.solr.search.FunctionQParser.parseNestedQuery(FunctionQParser.java:236)\n        at org.apache.solr.search.ValueSourceParser$19.parse(ValueSourceParser.java:270)\n        at org.apache.solr.search.FunctionQParser.parseValueSource(FunctionQParser.java:352)\n        at org.apache.solr.search.FunctionQParser.parseValueSource(FunctionQParser.java:223)\n        at org.apache.solr.search.ValueSourceParser$13.parse(ValueSourceParser.java:198)\n        at org.apache.solr.search.FunctionQParser.parseValueSource(FunctionQParser.java:352)\n        at org.apache.solr.search.FunctionQParser.parse(FunctionQParser.java:68)\n        at org.apache.solr.search.QParser.getQuery(QParser.java:142)\n        at org.apache.solr.search.ExtendedDismaxQParser.getBoostFunctions(ExtendedDismaxQParser.java:437)\n        at org.apache.solr.search.ExtendedDismaxQParser.parse(ExtendedDismaxQParser.java:175)\n        at org.apache.solr.search.QParser.getQuery(QParser.java:142)\n        at org.apache.solr.search.FunctionQParser.parseNestedQuery(FunctionQParser.java:236)\n        at org.apache.solr.search.ValueSourceParser$19.parse(ValueSourceParser.java:270)\n        at org.apache.solr.search.FunctionQParser.parseValueSource(FunctionQParser.java:352)\n        at org.apache.solr.search.FunctionQParser.parseValueSource(FunctionQParser.java:223)\n        at org.apache.solr.search.ValueSourceParser$13.parse(ValueSourceParser.java:198)\n        at org.apache.solr.search.FunctionQParser.parseValueSource(FunctionQParser.java:352)\n        at org.apache.solr.search.FunctionQParser.parse(FunctionQParser.java:68)\n        at org.apache.solr.search.QParser.getQuery(QParser.java:142)\n        at org.apache.solr.search.ExtendedDismaxQParser.getBoostFunctions(ExtendedDismaxQParser.java:437)\n        at org.apache.solr.search.ExtendedDismaxQParser.parse(ExtendedDismaxQParser.java:175)\n        at org.apache.solr.search.QParser.getQuery(QParser.java:142)\n...",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "author": "Hoss Man",
            "id": "comment-13864476",
            "date": "2014-01-07T18:10:19+0000",
            "content": "please don't file a bug just because you've been waiting 24 hours for an answer to a question on the solr-user mailing list - sometimes it takes longer then that for people to answer.\n\nhttps://mail-archives.apache.org/mod_mbox/lucene-solr-user/201312.mbox/%3C52C17579.30600@kelkoo.com%3E "
        },
        {
            "author": "Anca Kopetz",
            "id": "comment-13865278",
            "date": "2014-01-08T10:21:24+0000",
            "content": "Hi,\nSorry for that, I really thought it was a bug. Thanks a lot for your answer.\n "
        }
    ]
}