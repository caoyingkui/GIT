{
    "id": "SOLR-6918",
    "title": "No need to log exceptions (as warn) generated when creating MBean stats if the core is shutting down",
    "details": {
        "components": [
            "JMX"
        ],
        "type": "Improvement",
        "labels": "",
        "fix_versions": [
            "5.0",
            "6.0"
        ],
        "affect_versions": "None",
        "status": "Closed",
        "resolution": "Fixed",
        "priority": "Minor"
    },
    "description": "I'm seeing tons of this warning when distributed SolrCloud tests are shutting down ... \n\nI don't think we should log a WARN message if the exception is AlreadyClosedException since the core is closing\n\n   [junit4]   2> 31971 T37 oasc.JmxMonitoredMap$SolrDynamicMBean.getMBeanInfo WARN Could not getStatistics on info bean org.apache.solr.handler.ReplicationHandler org.apache.solr.common.SolrException: openNewSearcher called on closed core\n   [junit4]   2>     at org.apache.solr.core.SolrCore.openNewSearcher(SolrCore.java:1498)\n   [junit4]   2>     at org.apache.solr.core.SolrCore.getSearcher(SolrCore.java:1736)\n   [junit4]   2>     at org.apache.solr.core.SolrCore.getSearcher(SolrCore.java:1481)\n   [junit4]   2>     at org.apache.solr.core.SolrCore.getSearcher(SolrCore.java:1416)\n   [junit4]   2>     at org.apache.solr.handler.ReplicationHandler.getIndexVersion(ReplicationHandler.java:558)\n   [junit4]   2>     at org.apache.solr.handler.ReplicationHandler.getStatistics(ReplicationHandler.java:575)\n   [junit4]   2>     at org.apache.solr.core.JmxMonitoredMap$SolrDynamicMBean.getMBeanInfo(JmxMonitoredMap.java:257)\n   [junit4]   2>     at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getClassName(DefaultMBeanServerInterceptor.java:1804)\n   [junit4]   2>     at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.safeGetClassName(DefaultMBeanServerInterceptor.java:1595)\n   [junit4]   2>     at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.objectInstancesFromFilteredNamedObjects(DefaultMBeanServerInterceptor.java:1556)\n   [junit4]   2>     at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.queryMBeansImpl(DefaultMBeanServerInterceptor.java:513)\n   [junit4]   2>     at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.queryNames(DefaultMBeanServerInterceptor.java:526)\n   [junit4]   2>     at com.sun.jmx.mbeanserver.JmxMBeanServer.queryNames(JmxMBeanServer.java:619)\n   [junit4]   2>     at org.apache.solr.core.JmxMonitoredMap.clear(JmxMonitoredMap.java:120)\n   [junit4]   2>     at org.apache.solr.core.SolrCore.close(SolrCore.java:1161)\n   [junit4]   2>     at org.apache.solr.core.CoreContainer.unload(CoreContainer.java:691)\n   [junit4]   2>     at org.apache.solr.handler.admin.CoreAdminHandler.handleUnloadAction(CoreAdminHandler.java:676)\n   [junit4]   2>     at org.apache.solr.handler.admin.CoreAdminHandler.handleRequestInternal(CoreAdminHandler.java:209)\n   [junit4]   2>     at org.apache.solr.handler.admin.CoreAdminHandler.handleRequestBody(CoreAdminHandler.java:188)\n   [junit4]   2>     at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:144)\n   [junit4]   2>     at org.apache.solr.servlet.SolrDispatchFilter.handleAdminRequest(SolrDispatchFilter.java:738)\n   [junit4]   2>     at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:254)\n   [junit4]   2>     at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:201)",
    "attachments": {
        "SOLR-6918.patch": "https://issues.apache.org/jira/secure/attachment/12690420/SOLR-6918.patch"
    },
    "issue_links": {},
    "comments": [
        {
            "date": "2015-01-06T21:36:28+0000",
            "author": "Timothy Potter",
            "content": "Simple patch to avoid logging a WARN if the cause of the exception is that the Lucene index is already closed (core is shutting down). I opted for this approach instead of logging the WARN without the stacktrace since you still get a flood of these when cores are going down (and might cause people concern). ",
            "id": "comment-14266818"
        },
        {
            "date": "2015-01-06T21:40:12+0000",
            "author": "Shalin Shekhar Mangar",
            "content": "Yeah, that's my fault. This started with SOLR-2927 where we close the searcher before JMX is closed. For some strange reason, closing the jmx registry needs to access the value and hence this error. ",
            "id": "comment-14266822"
        },
        {
            "date": "2015-01-06T22:01:45+0000",
            "author": "Timothy Potter",
            "content": "Oops! previous patch missed a case where a SolrException is generated by the ReplicationHandler instead of an AlreadyClosedException ... updated patch fixes that too ",
            "id": "comment-14266847"
        },
        {
            "date": "2015-01-06T22:03:34+0000",
            "author": "Timothy Potter",
            "content": "yeah, the JMX MBeanServer has to call getMBeanInfo to satisfy the query for coreHashCode (for queryNames) ...  ",
            "id": "comment-14266852"
        },
        {
            "date": "2015-01-07T17:35:21+0000",
            "author": "ASF subversion and git services",
            "content": "Commit 1650123 from Timothy Potter in branch 'dev/trunk'\n[ https://svn.apache.org/r1650123 ]\n\nSOLR-6918: No need to log exceptions (as warn) generated when creating MBean stats if core is shutting down ",
            "id": "comment-14267921"
        },
        {
            "date": "2015-01-07T17:39:39+0000",
            "author": "ASF subversion and git services",
            "content": "Commit 1650124 from Timothy Potter in branch 'dev/branches/branch_5x'\n[ https://svn.apache.org/r1650124 ]\n\nSOLR-6918: No need to log exceptions (as warn) generated when creating MBean stats if core is shutting down ",
            "id": "comment-14267929"
        },
        {
            "date": "2015-02-23T05:02:18+0000",
            "author": "Anshum Gupta",
            "content": "Bulk close after 5.0 release. ",
            "id": "comment-14332859"
        }
    ]
}