{
    "id": "SOLR-9213",
    "title": "Join does not work on multiValued fields  / single field",
    "details": {
        "components": [],
        "type": "Bug",
        "labels": "",
        "fix_versions": [],
        "affect_versions": "5.4.1",
        "status": "Open",
        "resolution": "Unresolved",
        "priority": "Major"
    },
    "description": "> I have having issues with \n{!join}. If the core have multiValued field and\n> the inner join does not have a multiValued field it does not find the\n> ones...\n>\n> Solr 5.3.1... <luceneMatchVersion>5.3.1</luceneMatchVersion>\n>\n> Example.\n>\n> PS1226 is in practicing_specialties_codes in providersearch core. This\n> field is multiValued.\n>\n> in the autosuggest core there is NOT a field for PS1226 in there. This\n> field is called prac_spec_code and is single values.\n>\n>\n>\n> http://localhost:8983/solr/providersearch/select?q=*%3A*&wt=json&indent=true&fq=practicing_specialties_codes:PS1226&fl=practicing_specialties_codes\n>\n> I get:\n>\n>\n>    - docs:\n>    [\n>       -\n>       {\n>          - practicing_specialties_codes:\n>          [\n>             - \"PS1010\",\n>             - \"PS282\",\n>             - \"PS1226\"\n>             ]\n>          }\n>       ]\n>\n>\n>\n> In autosuggest there is nothing:\n>\n>\n> http://localhost:8983/solr/autosuggest/select?q=*%3A*&wt=json&indent=true&fq=prac_spec_code:PS1226&fl=prac_spec_code\n>\n> Nothing.\n>\n> Then a join should find what is in providersearch but missing in\n> autosuggest.\n>\n>\n> http://localhost:8983/solr/providersearch/select?debugQuery=true&wt=json&q=*:*&rows=10&fq=practicing_specialties_codes:PS1226&fl=practicing_specialties_codes&fq=NOT%20%7B!join%20from=prac_spec_code%20to=practicing_specialties_codes%20fromIndex=autosuggest%7Dauto_type:PRACSPEC>\n>\n> or\n>\n>\n> http://hgsolr2sl1:8983/solr/providersearch/select?debugQuery=true&wt=json&q=*:*&rows=10&fl=practicing_specialties_codes&fq=NOT%20{!join%20from=prac_spec_code%20to=practicing_specialties_codes%20fromIndex=autosuggest}auto_type:PRACSPEC\" class=\"external-link\" rel=\"nofollow\">http://localhost:8983/solr/providersearch/select?debugQuery=true&wt=json&q=*:*&rows=10&fq=practicing_specialties_codes:PS1226&fl=practicing_specialties_codes&fq=NOT%20{!join%20from=prac_spec_code%20to=practicing_specialties_codes%20fromIndex=autosuggest}auto_type:PRACSPEC\n> <http://localhost:8983/solr/providersearch/select?debugQuery=true&wt=json&q=*:*&rows=10&fq=practicing_specialties_codes:PS1226&fl=practicing_specialties_codes&fq=NOT%20%7B!join%20from=prac_spec_code%20to=practicing_specialties_codes%20fromIndex=autosuggest%7Dauto_type:PRACSPEC>\n>\n> or\n>\n>\n> http://hgsolr2sl1:8983/solr/providersearch/select?debugQuery=true&wt=json&q=*:*&rows=10&fl=practicing_specialties_codes&fq=NOT%20{!join%20from=prac_spec_code%20to=practicing_specialties_codes%20fromIndex=autosuggest}auto_type:PRACSPEC\n> <http://hgsolr2sl1:8983/solr/providersearch/select?debugQuery=true&wt=json&q=*:*&rows=10&fl=practicing_specialties_codes&fq=NOT%20%7B!join%20from=prac_spec_code%20to=practicing_specialties_codes%20fromIndex=autosuggest%7Dauto_type:PRACSPEC>\n>\n> or\n>\n>\n> http://hgsolr2sl1:8983/solr/providersearch/select?debugQuery=true&wt=json&q=*:*&rows=10&fl=practicing_specialties_codes&fq=NOT%20{!join%20from=prac_spec_code%20to=practicing_specialties_codes%20fromIndex=autosuggest}*:*\n> <http://hgsolr2sl1:8983/solr/providersearch/select?debugQuery=true&wt=json&q=*:*&rows=10&fl=practicing_specialties_codes&fq=NOT%20%7B!join%20from=prac_spec_code%20to=practicing_specialties_codes%20fromIndex=autosuggest%7D*:*>\n>\n> I also tried : AND NOT {!join}\n>\n> I get 0 results. This seems to be a bug.\n>\n> {\n>\n>    - responseHeader:\n>    {\n>       - status: 0,\n>       - QTime: 178,\n>       - params:\n>       {\n>          - q: \":\",\n>          - fl: \"practicing_specialties_codes\",\n>          - fq: \"NOT \n{!join from=prac_spec_code\n>          to=practicing_specialties_codes fromIndex=autosuggest}:\",\n>          - rows: \"10\",\n>          - wt: \"json\",\n>          - debugQuery: \"true\"\n>          }\n>       },\n>    - response:\n>    {\n>       - numFound: 0,\n>       - start: 0,\n>       - docs: [ ]\n>       },\n>    - debug:\n>    {\n>       - rawquerystring: \":\",\n>       - querystring: \":\",\n>       - parsedquery: \"MatchAllDocsQuery(:)\",\n>       - parsedquery_toString: \":\",\n>       - explain: { },\n>       - QParser: \"LuceneQParser\",\n>       - filter_queries:\n>       [\n>          - \"NOT {!join from=prac_spec_code>          to=practicing_specialties_codes fromIndex=autosuggest}\n:\"\n>          ],\n>       - parsed_filter_queries:\n>       [\n>          - \"-JoinQuery(\n{!join from=prac_spec_code\n>          to=practicing_specialties_codes fromIndex=autosuggest}\n:)\"\n>          ],\n>       - timing:\n>       {\n>          - time: 177,\n>          - prepare:\n>          {\n>             - time: 0,\n>             - query:\n>             \n{\n>                - time: 0\n>                }\n,\n>             - facet:\n>             \n{\n>                - time: 0\n>                }\n,\n>             - facet_module:\n>             \n{\n>                - time: 0\n>                }\n,\n>             - mlt:\n>             \n{\n>                - time: 0\n>                }\n,\n>             - highlight:\n>             \n{\n>                - time: 0\n>                }\n,\n>             - stats:\n>             \n{\n>                - time: 0\n>                }\n,\n>             - expand:\n>             \n{\n>                - time: 0\n>                }\n,\n>             - debug:\n>             \n{\n>                - time: 0\n>                }\n>             },\n>          - process:\n>          {\n>             - time: 177,\n>             - query:\n>             \n{\n>                - time: 177\n>                }\n,\n>             - facet:\n>             \n{\n>                - time: 0\n>                }\n,\n>             - facet_module:\n>             \n{\n>                - time: 0\n>                }\n,\n>             - mlt:\n>             \n{\n>                - time: 0\n>                }\n,\n>             - highlight:\n>             \n{\n>                - time: 0\n>                }\n,\n>             - stats:\n>             \n{\n>                - time: 0\n>                }\n,\n>             - expand:\n>             \n{\n>                - time: 0\n>                }\n,\n>             - debug:\n>             \n{\n>                - time: 0\n>                }\n>             }\n>          }\n>       }\n>\n> }",
    "attachments": {},
    "issue_links": {},
    "comments": []
}