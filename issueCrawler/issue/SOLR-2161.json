{
    "id": "SOLR-2161",
    "title": "BasicDistributedZkTest.testDistribSearch test failure",
    "details": {
        "affect_versions": "4.0-ALPHA",
        "status": "Closed",
        "fix_versions": [
            "4.0-ALPHA"
        ],
        "components": [
            "Build"
        ],
        "type": "Bug",
        "priority": "Major",
        "labels": "",
        "resolution": "Fixed"
    },
    "description": "BasicDistributedZkTest.testDistribSearch failed in Hudson.\n\nHere is the stacktrace:\n\n    [junit] Testsuite: org.apache.solr.cloud.BasicDistributedZkTest\n    [junit] Testcase: testDistribSearch(org.apache.solr.cloud.BasicDistributedZkTest):\tCaused an ERROR\n    [junit] Error executing query\n    [junit] org.apache.solr.client.solrj.SolrServerException: Error executing query\n    [junit] \tat org.apache.solr.client.solrj.request.QueryRequest.process(QueryRequest.java:95)\n    [junit] \tat org.apache.solr.client.solrj.SolrServer.query(SolrServer.java:119)\n    [junit] \tat org.apache.solr.BaseDistributedSearchTestCase.queryServer(BaseDistributedSearchTestCase.java:290)\n    [junit] \tat org.apache.solr.cloud.BasicDistributedZkTest.queryServer(BasicDistributedZkTest.java:256)\n    [junit] \tat org.apache.solr.BaseDistributedSearchTestCase.query(BaseDistributedSearchTestCase.java:305)\n    [junit] \tat org.apache.solr.cloud.BasicDistributedZkTest.doTest(BasicDistributedZkTest.java:227)\n    [junit] \tat org.apache.solr.BaseDistributedSearchTestCase.testDistribSearch(BaseDistributedSearchTestCase.java:562)\n    [junit] \tat org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:795)\n    [junit] \tat org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:768)\n    [junit] Caused by: org.apache.solr.common.SolrException: org.apache.solr.client.solrj.SolrServerException: org.apache.commons.httpclient.NoHttpResponseException: The server 127.0.0.1 failed to respond  org.apache.solr.common.SolrException: org.apache.solr.client.solrj.SolrServerException: org.apache.commons.httpclient.NoHttpResponseException: The server 127.0.0.1 failed to respond \tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:318) \tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:131) \tat org.apache.solr.core.SolrCore.execute(SolrCore.java:1325) \tat org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:337) \tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:240) \tat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157) \tat org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:388) \tat org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:182) \tat org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:765) \tat org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152) \tat org.mortbay.jetty.Server.handle(Server.java:326) \tat org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:542) \tat org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:923) \tat org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:547) \tat org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:212) \tat org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:404) \tat org.mortbay.io.nio.SelectChannelEndPoint.run(SelectChannelEndPoint.java:409) \tat org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:582) Caused by: org.apache.solr.client.solrj.SolrServerException: org.apache.commons.httpclient.NoHttpResponseException: The server 127.0.0.1 failed to respond \tat org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.request(CommonsHttpSolrServer.java:483) \tat org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.reque\n    [junit] \n    [junit] org.apache.solr.client.solrj.SolrServerException: org.apache.commons.httpclient.NoHttpResponseException: The server 127.0.0.1 failed to respond  org.apache.solr.common.SolrException: org.apache.solr.client.solrj.SolrServerException: org.apache.commons.httpclient.NoHttpResponseException: The server 127.0.0.1 failed to respond \tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:318) \tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:131) \tat org.apache.solr.core.SolrCore.execute(SolrCore.java:1325) \tat org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:337) \tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:240) \tat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157) \tat org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:388) \tat org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:182) \tat org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:765) \tat org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152) \tat org.mortbay.jetty.Server.handle(Server.java:326) \tat org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:542) \tat org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:923) \tat org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:547) \tat org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:212) \tat org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:404) \tat org.mortbay.io.nio.SelectChannelEndPoint.run(SelectChannelEndPoint.java:409) \tat org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:582) Caused by: org.apache.solr.client.solrj.SolrServerException: org.apache.commons.httpclient.NoHttpResponseException: The server 127.0.0.1 failed to respond \tat org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.request(CommonsHttpSolrServer.java:483) \tat org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.reque\n    [junit] \n    [junit] request: http://localhost:57159/solr/select?q=*:*&rows=100&shards=shard3,shard4,shard5,shard6&distrib=true&wt=javabin&version=2\n    [junit] \tat org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.request(CommonsHttpSolrServer.java:435)\n    [junit] \tat org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.request(CommonsHttpSolrServer.java:244)\n    [junit] \tat org.apache.solr.client.solrj.request.QueryRequest.process(QueryRequest.java:89)\n    [junit] \n    [junit] \n    [junit] Tests run: 1, Failures: 0, Errors: 1, Time elapsed: 249.281 sec\n    [junit] \n    [junit] ------------- Standard Output ---------------\n    [junit] NOTE: reproduce with: ant test -Dtestcase=BasicDistributedZkTest -Dtestmethod=testDistribSearch -Dtests.seed=7581155515203828654:-2786059863405912356\n    [junit] NOTE: test params are: codec=MockSep, locale=es_GT, timezone=America/Shiprock\n    [junit] ------------- ---------------- ---------------\n    [junit] ------------- Standard Error -----------------\n    [junit] 14/10/2010 02:48:15 PM org.apache.solr.common.SolrException log\n    [junit] GRAVE: org.apache.solr.common.SolrException: org.apache.solr.client.solrj.SolrServerException: org.apache.commons.httpclient.NoHttpResponseException: The server 127.0.0.1 failed to respond\n    [junit] \tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:318)\n    [junit] \tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:131)\n    [junit] \tat org.apache.solr.core.SolrCore.execute(SolrCore.java:1325)\n    [junit] \tat org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:337)\n    [junit] \tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:240)\n    [junit] \tat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)\n    [junit] \tat org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:388)\n    [junit] \tat org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:182)\n    [junit] \tat org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:765)\n    [junit] \tat org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152)\n    [junit] \tat org.mortbay.jetty.Server.handle(Server.java:326)\n    [junit] \tat org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:542)\n    [junit] \tat org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:923)\n    [junit] \tat org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:547)\n    [junit] \tat org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:212)\n    [junit] \tat org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:404)\n    [junit] \tat org.mortbay.io.nio.SelectChannelEndPoint.run(SelectChannelEndPoint.java:409)\n    [junit] \tat org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:582)\n    [junit] Caused by: org.apache.solr.client.solrj.SolrServerException: org.apache.commons.httpclient.NoHttpResponseException: The server 127.0.0.1 failed to respond\n    [junit] \tat org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.request(CommonsHttpSolrServer.java:483)\n    [junit] \tat org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.request(CommonsHttpSolrServer.java:244)\n    [junit] \tat org.apache.solr.handler.component.HttpCommComponent$1.call(SearchHandler.java:511)\n    [junit] \tat org.apache.solr.handler.component.HttpCommComponent$1.call(SearchHandler.java:478)\n    [junit] \tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\n    [junit] \tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\n    [junit] \tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n    [junit] \tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\n    [junit] \tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\n    [junit] \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n    [junit] \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n    [junit] \tat java.lang.Thread.run(Thread.java:636)\n    [junit] Caused by: org.apache.commons.httpclient.NoHttpResponseException: The server 127.0.0.1 failed to respond\n    [junit] \tat org.apache.commons.httpclient.HttpMethodBase.readStatusLine(HttpMethodBase.java:1976)\n    [junit] \tat org.apache.commons.httpclient.HttpMethodBase.readResponse(HttpMethodBase.java:1735)\n    [junit] \tat org.apache.commons.httpclient.HttpMethodBase.execute(HttpMethodBase.java:1098)\n    [junit] \tat org.apache.commons.httpclient.HttpMethodDirector.executeWithRetry(HttpMethodDirector.java:398)\n    [junit] \tat org.apache.commons.httpclient.HttpMethodDirector.executeMethod(HttpMethodDirector.java:171)\n    [junit] \tat org.apache.commons.httpclient.HttpClient.executeMethod(HttpClient.java:397)\n    [junit] \tat org.apache.commons.httpclient.HttpClient.executeMethod(HttpClient.java:323)\n    [junit] \tat org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.request(CommonsHttpSolrServer.java:427)\n    [junit] \t... 11 more\n    [junit] \n    [junit] ------------- ---------------- ---------------\n    [junit] TEST org.apache.solr.cloud.BasicDistributedZkTest FAILED",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "author": "Dawid Weiss",
            "id": "comment-13254416",
            "date": "2012-04-15T19:34:21+0000",
            "content": "This test fails very frequently. The most recent failure here:\nhttps://builds.apache.org/job/Lucene-Solr-tests-only-trunk-java7/2235/\n\nI am putting it in a @AwaitsFix group. "
        },
        {
            "author": "Saurabh",
            "id": "comment-13280384",
            "date": "2012-05-21T19:12:58+0000",
            "content": "We are also seeing same exception randomly, any leads? "
        },
        {
            "author": "Yonik Seeley",
            "id": "comment-13281707",
            "date": "2012-05-23T16:30:02+0000",
            "content": "I checked in some changes that should fix the most common failures we were seeing due to the recovery threads not being stopped. "
        },
        {
            "author": "Dawid Weiss",
            "id": "comment-13281815",
            "date": "2012-05-23T19:15:20+0000",
            "content": "Thanks Yonik! "
        }
    ]
}