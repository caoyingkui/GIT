{
    "id": "SOLR-12060",
    "title": "Sor suggest component failure",
    "details": {
        "labels": "",
        "priority": "Major",
        "components": [
            "Suggester"
        ],
        "type": "Bug",
        "fix_versions": [],
        "affect_versions": "7.2.1",
        "resolution": "Unresolved",
        "status": "Reopened"
    },
    "description": "I am trying to use Solr suggest component but it is crashes. It was working initially but suddenly stopped working correctly. I don't know what is the problem.\n\nHere is a code:\n\nrequest:\u00a0\n\nhttp://localhost:8983/solr/numberplate/suggest?suggest=true&suggest.build=true&suggest.dictionary=analyzedSuggestion\n\nresponse:\n\n{\n\"responseHeader\": {\n\"zkConnected\": true,\n\"status\": 500,\n\"QTime\": 73\n},\n\"command\": \"build\",\n\"error\": {\n\"trace\": \"java.lang.NullPointerException\\r\\n\\tat org.apache.solr.handler.component.QueryComponent.unmarshalSortValues(QueryComponent.java:1034)\\r\\n\\tat org.apache.solr.handler.component.QueryComponent.mergeIds(QueryComponent.java:885)\\r\\n\\tat org.apache.solr.handler.component.QueryComponent.handleRegularResponses(QueryComponent.java:585)\\r\\n\\tat org.apache.solr.handler.component.QueryComponent.handleResponses(QueryComponent.java:564)\\r\\n\\tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:423)\\r\\n\\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:177)\\r\\n\\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:2503)\\r\\n\\tat org.apache.solr.servlet.HttpSolrCall.execute(HttpSolrCall.java:710)\\r\\n\\tat org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:516)\\r\\n\\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:382)\\r\\n\\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:326)\\r\\n\\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1751)\\r\\n\\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:582)\\r\\n\\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)\\r\\n\\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:548)\\r\\n\\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:226)\\r\\n\\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1180)\\r\\n\\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:512)\\r\\n\\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\\r\\n\\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1112)\\r\\n\\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\\r\\n\\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213)\\r\\n\\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:119)\\r\\n\\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)\\r\\n\\tat org.eclipse.jetty.rewrite.handler.RewriteHandler.handle(RewriteHandler.java:335)\\r\\n\\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)\\r\\n\\tat org.eclipse.jetty.server.Server.handle(Server.java:534)\\r\\n\\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:320)\\r\\n\\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:251)\\r\\n\\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:283)\\r\\n\\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:108)\\r\\n\\tat org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)\\r\\n\\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.executeProduceConsume(ExecuteProduceConsume.java:303)\\r\\n\\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:148)\\r\\n\\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:136)\\r\\n\\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:671)\\r\\n\\tat org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:589)\\r\\n\\tat java.lang.Thread.run(Thread.java:748)\\r\\n\",\n\"code\": 500\n}\n}\n\nHere is config (part from solrconfig.xml) file:\n\n// <searchComponent name=\"suggest\" class=\"solr.SuggestComponent\">\n    <lst name=\"suggester\">\n    <str name=\"name\">analyzedSuggestion</str>\n    <str name=\"lookupImpl\">AnalyzingLookupFactory</str>\n    <str name=\"dictionaryImpl\">DocumentDictionaryFactory</str> \n    <str name=\"field\">CountryOfRegistration</str>\n    <str name=\"weightField\">0</str>\n    <str name=\"suggestAnalyzerFieldType\">string</str>\n    <str name=\"buildOnStartup\">false</str> \n    </lst>\n</searchComponent>\n\n<requestHandler name=\"/suggest\" class=\"solr.SearchHandler\" startup=\"lazy\">\n    <lst name=\"defaults\">\n      <str name=\"suggest\">true</str>\n      <str name=\"suggest.count\">10</str>\n    </lst>\n    <arr name=\"first-components\">\n       <str>suggest</str>\n    </arr> \n</requestHandler>\n\n\nHere is\u00a0 part managed-schema file:\n\n<field name=\"CountryOfRegistration\" type=\"string\" indexed=\"true\" stored=\"true\"/>\n  <field name=\"FirstName\" type=\"string\" indexed=\"true\" stored=\"true\"/>\n  <field name=\"LastName\" type=\"string\" indexed=\"true\" stored=\"true\"/>\n  <field name=\"Number\" type=\"string\" indexed=\"true\" stored=\"true\"/>\n  <field name=\"Organization\" type=\"string\" indexed=\"true\" stored=\"true\"/>\n  <field name=\"_root_\" type=\"string\" docValues=\"false\" indexed=\"true\" stored=\"false\"/>\n  <field name=\"_text_\" type=\"text_general\" multiValued=\"true\" indexed=\"true\" stored=\"false\"/>\n  <field name=\"_version_\" type=\"plong\" indexed=\"false\" stored=\"false\"/>\n  <field name=\"id\" type=\"string\" multiValued=\"false\" indexed=\"true\" required=\"true\" stored=\"true\"/>\n\n\nI don't know what is wrong but I can not say from this exception what is wrong.\n\nCan you help to fix it?\u00a0\n\n\u00a0\n\nP. S. Even if my configuration is incorrect it is not very informative message. It is actually not a message it is just a stack trace. I can not fix this issue based on this stack trace so I will spend much time investigating what is wrong. Maybe you can add more informative message what is going wrong?",
    "attachments": {
        "solrconfig.xml": "https://issues.apache.org/jira/secure/attachment/12913173/solrconfig.xml",
        "managed-schema": "https://issues.apache.org/jira/secure/attachment/12913172/managed-schema"
    },
    "issue_links": {},
    "comments": [
        {
            "date": "2018-03-06T14:56:57+0000",
            "content": "I see you've raised this question on the user's list at solr-user@lucene.apache.org. That's the appropriate venue unless it's determined that there is actually a code problem rather than a usage issue. \n\nIf it's determined that this really is a code issue in Solr and not a configuration/usage problem, we can raise a new JIRA or reopen this one. ",
            "author": "Erick Erickson",
            "id": "comment-16387899"
        },
        {
            "date": "2018-03-07T10:17:20+0000",
            "content": "Hi Erick Erickson\u00a0 thanks for reply. As for me it is also a code issue because it is not informative message how can I resolve configuration issue. I think it is need to be at least some message what is wrong because it can send a lot of time investigating what is wrong and how to fix it.\u00a0\n\nI think that more informative message should be shown rather just \"Null Pointer exception\".\n\nWhat do you think?\u00a0\u00a0 ",
            "author": "Alexey Ponomarenko",
            "id": "comment-16389359"
        },
        {
            "date": "2018-03-07T13:30:48+0000",
            "content": "Even if my configuration is incorrect it is not very informative message. It is actually not a message it is just a stack trace. I can not fix this issue based on this stack trace so I will spend much time investigating what is wrong. Maybe you can add more informative message what is going wrong?\u00a0 ",
            "author": "Alexey Ponomarenko",
            "id": "comment-16389550"
        }
    ]
}