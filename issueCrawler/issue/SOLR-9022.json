{
    "id": "SOLR-9022",
    "title": "solr unable to handle/parse images when they are embedded in office docs(like word,xls,etc)",
    "details": {
        "components": [
            "SolrJ"
        ],
        "type": "Bug",
        "labels": "",
        "fix_versions": [],
        "affect_versions": "5.4.1",
        "status": "Resolved",
        "resolution": "Not A Problem",
        "priority": "Major"
    },
    "description": "As we are trying to index multiple files, the solr throws below exception whenever it encounters embedded images with other docs.\n\nThe issues arises as embedded images files are read with MIME type of binary(attachment_mimetype=[application/octet-stream])  though the attached files are type png/txt etc.\n\nFull stack trace for this issue\n\n2016-04-20 16:55:13,311 INFO [Thread-52] org.apache.hadoop.mapreduce.v2.app.rm.RMContainerAllocator: Added attempt_1460872551948_58233_m_000116_1 to list of failed maps\n2016-04-20 16:55:13,329 INFO [IPC Server handler 18 on 39376] org.apache.hadoop.mapred.TaskAttemptListenerImpl: Progress of TaskAttempt attempt_1460872551948_58233_m_000159_0 is : 0.0\n2016-04-20 16:55:13,342 ERROR [IPC Server handler 20 on 39376] org.apache.hadoop.mapred.TaskAttemptListenerImpl: Task: attempt_1460872551948_58233_m_000159_0 - exited : org.kitesdk.morphline.api.MorphlineRuntimeException: org.kitesdk.morphline.api.MorphlineRuntimeException: tryRules command found no successful rule for record: {_attachment_body=[TikaInputStream of java.io.BufferedInputStream@391f1777], _attachment_mimetype=[application/octet-stream], _attachment_name=[xl/media/image2.png], id=[185be63a-e527-4953-9a3d-ae957dc0fa51]}\n\tat org.kitesdk.morphline.base.FaultTolerance.handleException(FaultTolerance.java:73)\n\tat org.apache.solr.hadoop.morphline.MorphlineMapRunner.map(MorphlineMapRunner.java:220)\n\tat org.apache.solr.hadoop.morphline.MorphlineMapper.map(MorphlineMapper.java:86)\n\tat org.apache.solr.hadoop.morphline.MorphlineMapper.map(MorphlineMapper.java:54)\n\tat org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:145)\n\tat org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:787)\n\tat org.apache.hadoop.mapred.MapTask.run(MapTask.java:341)\n\tat org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:163)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:415)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1671)\n\tat org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:158)\nCaused by: org.kitesdk.morphline.api.MorphlineRuntimeException: tryRules command found no successful rule for record: {_attachment_body=[TikaInputStream of java.io.BufferedInputStream@391f1777], _attachment_mimetype=[application/octet-stream], _attachment_name=[xl/media/image2.png], id=[185be63a-e527-4953-9a3d-ae957dc0fa51]}\n\tat org.kitesdk.morphline.stdlib.TryRulesBuilder$TryRules.doProcess(TryRulesBuilder.java:132)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.kitesdk.morphline.base.Connector.process(Connector.java:64)\n\tat org.kitesdk.morphline.base.AbstractCommand.doProcess(AbstractCommand.java:181)\n\tat org.kitesdk.morphline.tika.DetectMimeTypeBuilder$DetectMimeType.doProcess(DetectMimeTypeBuilder.java:166)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.kitesdk.morphline.base.Connector.process(Connector.java:64)\n\tat org.kitesdk.morphline.base.AbstractCommand.doProcess(AbstractCommand.java:181)\n\tat org.kitesdk.morphline.stdlib.SeparateAttachmentsBuilder$SeparateAttachments.doProcess(SeparateAttachmentsBuilder.java:79)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.kitesdk.morphline.base.AbstractCommand.doProcess(AbstractCommand.java:181)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.kitesdk.morphline.base.AbstractCommand.doProcess(AbstractCommand.java:181)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.kitesdk.morphline.base.Connector.process(Connector.java:64)\n\tat org.kitesdk.morphline.base.AbstractCommand.doProcess(AbstractCommand.java:181)\n\tat org.kitesdk.morphline.stdlib.GenerateUUIDBuilder$GenerateUUID.doProcess(GenerateUUIDBuilder.java:98)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.kitesdk.morphline.base.Connector.process(Connector.java:64)\n\tat org.kitesdk.morphline.tika.decompress.EmbeddedExtractor.parseEmbedded(EmbeddedExtractor.java:57)\n\tat org.kitesdk.morphline.tika.decompress.UnpackBuilder$Unpack.parseEntry(UnpackBuilder.java:138)\n\tat org.kitesdk.morphline.tika.decompress.UnpackBuilder$Unpack.doProcess(UnpackBuilder.java:113)\n\tat org.kitesdk.morphline.stdio.AbstractParser.doProcess(AbstractParser.java:96)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.kitesdk.morphline.base.Connector.process(Connector.java:64)\n\tat org.kitesdk.morphline.stdlib.LogDebugBuilder$LogDebug.doProcess(LogDebugBuilder.java:58)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.kitesdk.morphline.stdlib.TryRulesBuilder$TryRules.doProcess(TryRulesBuilder.java:115)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.kitesdk.morphline.base.Connector.process(Connector.java:64)\n\tat org.kitesdk.morphline.base.AbstractCommand.doProcess(AbstractCommand.java:181)\n\tat org.kitesdk.morphline.tika.DetectMimeTypeBuilder$DetectMimeType.doProcess(DetectMimeTypeBuilder.java:166)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.kitesdk.morphline.base.Connector.process(Connector.java:64)\n\tat org.kitesdk.morphline.base.AbstractCommand.doProcess(AbstractCommand.java:181)\n\tat org.kitesdk.morphline.stdlib.SeparateAttachmentsBuilder$SeparateAttachments.doProcess(SeparateAttachmentsBuilder.java:79)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.kitesdk.morphline.base.AbstractCommand.doProcess(AbstractCommand.java:181)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.apache.solr.hadoop.morphline.MorphlineMapRunner.map(MorphlineMapRunner.java:208)\n\t... 10 more\n\n2016-04-20 16:55:13,343 INFO [IPC Server handler 20 on 39376] org.apache.hadoop.mapred.TaskAttemptListenerImpl: Diagnostics report from attempt_1460872551948_58233_m_000159_0: Error: org.kitesdk.morphline.api.MorphlineRuntimeException: org.kitesdk.morphline.api.MorphlineRuntimeException: tryRules command found no successful rule for record: {_attachment_body=[TikaInputStream of java.io.BufferedInputStream@391f1777], _attachment_mimetype=[application/octet-stream], _attachment_name=[xl/media/image2.png], id=[185be63a-e527-4953-9a3d-ae957dc0fa51]}\n\tat org.kitesdk.morphline.base.FaultTolerance.handleException(FaultTolerance.java:73)\n\tat org.apache.solr.hadoop.morphline.MorphlineMapRunner.map(MorphlineMapRunner.java:220)\n\tat org.apache.solr.hadoop.morphline.MorphlineMapper.map(MorphlineMapper.java:86)\n\tat org.apache.solr.hadoop.morphline.MorphlineMapper.map(MorphlineMapper.java:54)\n\tat org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:145)\n\tat org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:787)\n\tat org.apache.hadoop.mapred.MapTask.run(MapTask.java:341)\n\tat org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:163)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAs(Subject.java:415)\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1671)\n\tat org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:158)\nCaused by: org.kitesdk.morphline.api.MorphlineRuntimeException: tryRules command found no successful rule for record: {_attachment_body=[TikaInputStream of java.io.BufferedInputStream@391f1777], _attachment_mimetype=[application/octet-stream], _attachment_name=[xl/media/image2.png], id=[185be63a-e527-4953-9a3d-ae957dc0fa51]}\n\tat org.kitesdk.morphline.stdlib.TryRulesBuilder$TryRules.doProcess(TryRulesBuilder.java:132)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.kitesdk.morphline.base.Connector.process(Connector.java:64)\n\tat org.kitesdk.morphline.base.AbstractCommand.doProcess(AbstractCommand.java:181)\n\tat org.kitesdk.morphline.tika.DetectMimeTypeBuilder$DetectMimeType.doProcess(DetectMimeTypeBuilder.java:166)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.kitesdk.morphline.base.Connector.process(Connector.java:64)\n\tat org.kitesdk.morphline.base.AbstractCommand.doProcess(AbstractCommand.java:181)\n\tat org.kitesdk.morphline.stdlib.SeparateAttachmentsBuilder$SeparateAttachments.doProcess(SeparateAttachmentsBuilder.java:79)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.kitesdk.morphline.base.AbstractCommand.doProcess(AbstractCommand.java:181)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.kitesdk.morphline.base.AbstractCommand.doProcess(AbstractCommand.java:181)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.kitesdk.morphline.base.Connector.process(Connector.java:64)\n\tat org.kitesdk.morphline.base.AbstractCommand.doProcess(AbstractCommand.java:181)\n\tat org.kitesdk.morphline.stdlib.GenerateUUIDBuilder$GenerateUUID.doProcess(GenerateUUIDBuilder.java:98)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.kitesdk.morphline.base.Connector.process(Connector.java:64)\n\tat org.kitesdk.morphline.tika.decompress.EmbeddedExtractor.parseEmbedded(EmbeddedExtractor.java:57)\n\tat org.kitesdk.morphline.tika.decompress.UnpackBuilder$Unpack.parseEntry(UnpackBuilder.java:138)\n\tat org.kitesdk.morphline.tika.decompress.UnpackBuilder$Unpack.doProcess(UnpackBuilder.java:113)\n\tat org.kitesdk.morphline.stdio.AbstractParser.doProcess(AbstractParser.java:96)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.kitesdk.morphline.base.Connector.process(Connector.java:64)\n\tat org.kitesdk.morphline.stdlib.LogDebugBuilder$LogDebug.doProcess(LogDebugBuilder.java:58)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.kitesdk.morphline.stdlib.TryRulesBuilder$TryRules.doProcess(TryRulesBuilder.java:115)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.kitesdk.morphline.base.Connector.process(Connector.java:64)\n\tat org.kitesdk.morphline.base.AbstractCommand.doProcess(AbstractCommand.java:181)\n\tat org.kitesdk.morphline.tika.DetectMimeTypeBuilder$DetectMimeType.doProcess(DetectMimeTypeBuilder.java:166)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.kitesdk.morphline.base.Connector.process(Connector.java:64)\n\tat org.kitesdk.morphline.base.AbstractCommand.doProcess(AbstractCommand.java:181)\n\tat org.kitesdk.morphline.stdlib.SeparateAttachmentsBuilder$SeparateAttachments.doProcess(SeparateAttachmentsBuilder.java:79)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.kitesdk.morphline.base.AbstractCommand.doProcess(AbstractCommand.java:181)\n\tat org.kitesdk.morphline.base.AbstractCommand.process(AbstractCommand.java:156)\n\tat org.apache.solr.hadoop.morphline.MorphlineMapRunner.map(MorphlineMapRunner.java:208)\n\t... 10 more",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "date": "2016-04-21T02:24:49+0000",
            "author": "Erick Erickson",
            "content": "First of all, please raise this kind of question on the user's list first, we try to keep JIRAs for known code problems/improvements rather than usage questions.\n\nIn this case, this line:\n 2016-04-20 16:55:13,342 ERROR [IPC Server handler 20 on 39376] org.apache.hadoop.mapred.TaskAttemptListenerImpl: Task: attempt_1460872551948_58233_m_000159_0 - exited : org.kitesdk.morphline.api.MorphlineRuntimeException: org.kitesdk.morphline.api.MorphlineRuntimeException: tryRules command found no successful rule for record: {_attachment_body=[TikaInputStream of java.io.BufferedInputStream@391f1777], _attachment_mimetype=[application/octet-stream], _attachment_name=[xl/media/image2.png], id=[185be63a-e527-4953-9a3d-ae957dc0fa51]}\nat org.kitesdk.morphline.base.FaultTolerance.handleException(FaultTolerance.java:73)\n\nimplies that you have some \"tryRules\" in your morphline file and they do not handle the case that's being encountered when Morphlines is processing this file. IOW, the problem is your morphlines configuration, not Solr.\n\nIf that turns out not to be the case we can re-open this JIRA. ",
            "id": "comment-15251135"
        }
    ]
}