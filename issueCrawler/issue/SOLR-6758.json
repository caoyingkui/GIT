{
    "id": "SOLR-6758",
    "title": "Solr node to node communication errors w/ SSL + client auth",
    "details": {
        "components": [],
        "type": "Bug",
        "labels": "",
        "fix_versions": [],
        "affect_versions": "None",
        "status": "Resolved",
        "resolution": "Invalid",
        "priority": "Major"
    },
    "description": "Enable two solr servers SSL w/ client auth(JSSE) and then change solr.xml to use 8443 port and change zookeeper to use https instead of http. \n\nthen starting the two solr server and found these errors. Any suggestions?\n\nERROR - 2014-11-19 12:55:31.125; org.apache.solr.common.SolrException; null:org.apache.solr.common.SolrException: org.apache.solr.client.solrj.SolrServerException: IOException occured when talking to server at: https://9.12.11.9:8443/solr/collection2_shard1_replica2\n\tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:308)\n\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135)\n\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:1916)\n\tat org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:780)\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:427)\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:217)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:220)\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:122)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:171)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)\n\tat org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:950)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:116)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:408)\n\tat org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1040)\n\tat org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:607)\n\tat org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:314)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1156)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:626)\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n\tat java.lang.Thread.run(Thread.java:804)\nCaused by: org.apache.solr.client.solrj.SolrServerException: IOException occured when talking to server at: https://9.12.11.9::8443/solr/collection2_shard1_replica2\n\tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:507)\n\tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:199)\n\tat org.apache.solr.handler.component.HttpShardHandler$1.call(HttpShardHandler.java:156)\n\tat org.apache.solr.handler.component.HttpShardHandler$1.call(HttpShardHandler.java:118)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:273)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:482)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:273)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1156)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:626)\n\t... 1 more\nCaused by: javax.net.ssl.SSLHandshakeException: com.ibm.jsse2.util.j: PKIX path building failed: java.security.cert.CertPathBuilderException: PKIXCertPathBuilderImpl could not build a valid CertPath.; internal cause is: \n\tjava.security.cert.CertPathValidatorException: The certificate issued by CN=testing, L=lt, ST=mass, OU=test, O=IBM test, C=ZQ is not trusted; internal cause is: \n\tjava.security.cert.CertPathValidatorException: Certificate chaining error\n\tat com.ibm.jsse2.j.a(j.java:36)\n\tat com.ibm.jsse2.qc.a(qc.java:199)\n\tat com.ibm.jsse2.ab.a(ab.java:171)\n\tat com.ibm.jsse2.ab.a(ab.java:180)\n\tat com.ibm.jsse2.bb.a(bb.java:346)\n\tat com.ibm.jsse2.bb.a(bb.java:559)\n\tat com.ibm.jsse2.ab.r(ab.java:554)\n\tat com.ibm.jsse2.ab.a(ab.java:325)\n\tat com.ibm.jsse2.qc.a(qc.java:617)\n\tat com.ibm.jsse2.qc.h(qc.java:103)\n\tat com.ibm.jsse2.qc.a(qc.java:166)\n\tat com.ibm.jsse2.qc.startHandshake(qc.java:649)\n\tat org.apache.http.conn.ssl.SSLSocketFactory.connectSocket(SSLSocketFactory.java:533)\n\tat org.apache.http.conn.ssl.SSLSocketFactory.connectSocket(SSLSocketFactory.java:401)\n\tat org.apache.http.impl.conn.DefaultClientConnectionOperator.openConnection(DefaultClientConnectionOperator.java:178)\n\tat org.apache.http.impl.conn.ManagedClientConnectionImpl.open(ManagedClientConnectionImpl.java:304)\n\tat org.apache.http.impl.client.DefaultRequestDirector.tryConnect(DefaultRequestDirector.java:610)\n\tat org.apache.http.impl.client.DefaultRequestDirector.execute(DefaultRequestDirector.java:445)\n\tat org.apache.http.impl.client.AbstractHttpClient.doExecute(AbstractHttpClient.java:863)\n\tat org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:82)\n\tat org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:106)\n\tat org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:57)\n\tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:395)\n\t... 9 more",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "date": "2015-01-27T19:43:54+0000",
            "author": "Steve Rowe",
            "content": "The process to set this up has been simplified in Solr 5 - see the Solr Reference Guide page Enabling SSL for a description.  While Solr 5 hasn't been released yet, you can test with the latest release candidate - see this thread for download links.  Here's a direct link to the first release candidate (and most recent as of this writing - there will be at least one more RC before the final release): http://people.apache.org/~anshum/staging_area/lucene-solr-5.0.0-RC1-rev1654615/solr/solr-5.0.0.tgz ",
            "id": "comment-14294054"
        },
        {
            "date": "2015-01-29T22:05:59+0000",
            "author": "Steve Rowe",
            "content": "liuqibj, these sorts of questions should be asked on the solr-user mailing list before you create a JIRA. ",
            "id": "comment-14297790"
        }
    ]
}