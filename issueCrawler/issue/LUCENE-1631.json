{
    "id": "LUCENE-1631",
    "title": "CLONE -You cannot sort on fields that don't exist",
    "details": {
        "labels": "",
        "priority": "Major",
        "components": [
            "core/search"
        ],
        "type": "Bug",
        "fix_versions": [
            "1.9"
        ],
        "affect_versions": "2.4.1",
        "resolution": "Won't Fix",
        "status": "Closed"
    },
    "description": "I still get this error in 2.4.1 - if field does not exist in index,  there is nullPointException if it search over multiple index. In following test code, there is runtime error, here is part of test code. \n\n\n\t\tindexSingleFieldDocs(new Field[]\n{new Field(\"ds\", \"xyz\", Field.Store.YES, Field.Index.NOT_ANALYZED)\n\t\t\t\t\t\t, new Field(\"dsc\", \"hello\", Field.Store.NO, Field.Index.ANALYZED)}\n);\n\t\tindexSingleFieldDocs(new Field[]\n{new Field(\"ds\", \"def\", Field.Store.YES, Field.Index.NOT_ANALYZED)\n\t\t\t\t\t\t, new Field(\"dsc\", \"hello\", Field.Store.NO, Field.Index.ANALYZED)}\n);\n\n...\n\n\t\tQueryParser p = new QueryParser(\"dsc\", new StandardAnalyzer());\n\t\tQuery q = p.parse(\"hello\");\n\t\tHits hits = searcher.search(q,new Sort(\"ds\"));\n\n\nIf change \"ds\" to some others,  got this exception:\njava.lang.RuntimeException: field \"ds\" does not appear to be indexed\n\tat org.apache.lucene.search.ExtendedFieldCacheImpl$5.createValue(ExtendedFieldCacheImpl.java:173)\n\tat org.apache.lucene.search.FieldCacheImpl$Cache.get(FieldCacheImpl.java:71)\n\tat org.apache.lucene.search.ExtendedFieldCacheImpl.getAuto(ExtendedFieldCacheImpl.java:127)\n\tat org.apache.lucene.search.FieldSortedHitQueue.comparatorAuto(FieldSortedHitQueue.java:487)\n\tat org.apache.lucene.search.FieldSortedHitQueue$1.createValue(FieldSortedHitQueue.java:184)\n\tat org.apache.lucene.search.FieldCacheImpl$Cache.get(FieldCacheImpl.java:71)\n\tat org.apache.lucene.search.FieldSortedHitQueue.getCachedComparator(FieldSortedHitQueue.java:167)\n\tat org.apache.lucene.search.FieldSortedHitQueue.<init>(FieldSortedHitQueue.java:55)\n\tat org.apache.lucene.search.TopFieldDocCollector.<init>(TopFieldDocCollector.java:43)\n\tat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:121)\n\tat org.apache.lucene.search.Hits.getMoreDocs(Hits.java:113)\n\tat org.apache.lucene.search.Hits.<init>(Hits.java:90)\n\tat org.apache.lucene.search.Searcher.search(Searcher.java:61)\n\tat com.edgenius.test.lucene.TestLucene.testSort(TestLucene.java:207)",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "date": "2009-05-08T15:28:25+0000",
            "content": "In my real project, I am using over multiple indexes, I got this error:\n\nException in thread \"MultiSearcher thread #6\" java.lang.RuntimeException: field \"docType\" does not appear to be indexed\n\tat org.apache.lucene.search.ExtendedFieldCacheImpl$5.createValue(ExtendedFieldCacheImpl.java:173)\n\tat org.apache.lucene.search.FieldCacheImpl$Cache.get(FieldCacheImpl.java:71)\n\tat org.apache.lucene.search.ExtendedFieldCacheImpl.getAuto(ExtendedFieldCacheImpl.java:127)\n\tat org.apache.lucene.search.FieldSortedHitQueue.comparatorAuto(FieldSortedHitQueue.java:487)\n\tat org.apache.lucene.search.FieldSortedHitQueue$1.createValue(FieldSortedHitQueue.java:184)\n\tat org.apache.lucene.search.FieldCacheImpl$Cache.get(FieldCacheImpl.java:71)\n\tat org.apache.lucene.search.FieldSortedHitQueue.getCachedComparator(FieldSortedHitQueue.java:167)\n\tat org.apache.lucene.search.FieldSortedHitQueue.<init>(FieldSortedHitQueue.java:55)\n\tat org.apache.lucene.search.TopFieldDocCollector.<init>(TopFieldDocCollector.java:43)\n\tat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:121)\n\tat org.apache.lucene.search.MultiSearcherThread.run(ParallelMultiSearcher.java:250)\n2009-05-09 01:26:41,305 ERROR [SearchServiceImpl] Search failed \norg.springmodules.lucene.search.LuceneSearchException: Error during searching; nested exception is java.lang.NullPointerException\n\tat org.springmodules.lucene.search.core.DefaultLuceneSearchTemplate.search(DefaultLuceneSearchTemplate.java:292)\n\tat com.edgenius.wiki.search.service.AbstractSearchService.commonSearch(AbstractSearchService.java:84)\n\tat com.edgenius.wiki.search.service.SearchServiceImpl.search(SearchServiceImpl.java:36)\n\tat com.edgenius.wiki.gwt.server.SearchControllerImpl.search(SearchControllerImpl.java:81)\n\tat sun.reflect.GeneratedMethodAccessor136.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:585)\n\tat com.edgenius.wiki.gwt.server.handler.GWTSpringController.processCall(GWTSpringController.java:93)\n\tat com.google.gwt.user.server.rpc.RemoteServiceServlet.doPost(RemoteServiceServlet.java:86)\n\tat com.edgenius.wiki.gwt.server.handler.GWTSpringController.handleRequest(GWTSpringController.java:179)\n\tat org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter.handle(SimpleControllerHandlerAdapter.java:48)\n\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:875)\n\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:809)\n\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:571)\n\tat org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:511)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:637)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:717)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n\tat com.edgenius.core.webapp.filter.AjaxRedirectFilter.doFilterInternal(AjaxRedirectFilter.java:46)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n\tat com.edgenius.core.webapp.filter.SEFilter.doFilterInternal(SEFilter.java:63)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n\tat org.springframework.security.util.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:378)\n\tat org.springframework.security.intercept.web.FilterSecurityInterceptor.invoke(FilterSecurityInterceptor.java:109)\n\tat org.springframework.security.intercept.web.FilterSecurityInterceptor.doFilter(FilterSecurityInterceptor.java:83)\n\tat org.springframework.security.util.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:390)\n\tat org.springframework.security.ui.ExceptionTranslationFilter.doFilterHttp(ExceptionTranslationFilter.java:101)\n\tat org.springframework.security.ui.SpringSecurityFilter.doFilter(SpringSecurityFilter.java:53)\n\tat org.springframework.security.util.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:390)\n\tat org.springframework.security.providers.anonymous.AnonymousProcessingFilter.doFilterHttp(AnonymousProcessingFilter.java:105)\n\tat org.springframework.security.ui.SpringSecurityFilter.doFilter(SpringSecurityFilter.java:53)\n\tat org.springframework.security.util.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:390)\n\tat org.springframework.security.ui.rememberme.RememberMeProcessingFilter.doFilterHttp(RememberMeProcessingFilter.java:116)\n\tat org.springframework.security.ui.SpringSecurityFilter.doFilter(SpringSecurityFilter.java:53)\n\tat org.springframework.security.util.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:390)\n\tat org.springframework.security.wrapper.SecurityContextHolderAwareRequestFilter.doFilterHttp(SecurityContextHolderAwareRequestFilter.java:91)\n\tat org.springframework.security.ui.SpringSecurityFilter.doFilter(SpringSecurityFilter.java:53)\n\tat org.springframework.security.util.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:390)\n\tat org.springframework.security.ui.AbstractProcessingFilter.doFilterHttp(AbstractProcessingFilter.java:277)\n\tat org.springframework.security.ui.SpringSecurityFilter.doFilter(SpringSecurityFilter.java:53)\n\tat org.springframework.security.util.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:390)\n\tat org.springframework.security.ui.logout.LogoutFilter.doFilterHttp(LogoutFilter.java:89)\n\tat org.springframework.security.ui.SpringSecurityFilter.doFilter(SpringSecurityFilter.java:53)\n\tat org.springframework.security.util.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:390)\n\tat com.edgenius.wiki.security.acegi.CaptchaValidationProcessingFilter.doFilter(CaptchaValidationProcessingFilter.java:76)\n\tat org.springframework.security.util.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:390)\n\tat org.springframework.security.context.HttpSessionContextIntegrationFilter.doFilterHttp(HttpSessionContextIntegrationFilter.java:235)\n\tat org.springframework.security.ui.SpringSecurityFilter.doFilter(SpringSecurityFilter.java:53)\n\tat org.springframework.security.util.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:390)\n\tat org.springframework.security.util.FilterChainProxy.doFilter(FilterChainProxy.java:175)\n\tat org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:236)\n\tat org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:167)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n\tat org.springframework.orm.hibernate3.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:198)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n\tat com.edgenius.wiki.webapp.filter.InstallFilter.doFilterInternal(InstallFilter.java:49)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:286)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:845)\n\tat org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:583)\n\tat org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:447)\n\tat java.lang.Thread.run(Thread.java:613)\nCaused by: java.lang.NullPointerException\n\tat org.apache.lucene.search.MultiSearcherThread.hits(ParallelMultiSearcher.java:280)\n\tat org.apache.lucene.search.ParallelMultiSearcher.search(ParallelMultiSearcher.java:136)\n\tat org.apache.lucene.search.Hits.getMoreDocs(Hits.java:113)\n\tat org.apache.lucene.search.Hits.<init>(Hits.java:90)\n\tat org.apache.lucene.search.Searcher.search(Searcher.java:72)\n\tat org.springmodules.lucene.search.factory.SimpleLuceneSearcher.search(SimpleLuceneSearcher.java:91)\n\tat com.edgenius.wiki.search.service.AbstractSearchService$1.doWithSearcher(AbstractSearchService.java:92)\n\tat org.springmodules.lucene.search.core.DefaultLuceneSearchTemplate.search(DefaultLuceneSearchTemplate.java:288)\n\t... 76 more ",
            "author": "steve neo",
            "id": "comment-12707376"
        },
        {
            "date": "2009-05-08T15:50:48+0000",
            "content": "This is only for the AUTO sort field type (when you don't specify how to sort the field).\nIn your application, can you use the SortField constructors that take a type argument? ",
            "author": "Yonik Seeley",
            "id": "comment-12707384"
        },
        {
            "date": "2009-05-09T09:40:30+0000",
            "content": "Is this a dup of LUCENE-916? ",
            "author": "Michael McCandless",
            "id": "comment-12707644"
        },
        {
            "date": "2009-06-02T19:41:29+0000",
            "content": "We are removing SortField.AUTO in 3.0. ",
            "author": "Michael McCandless",
            "id": "comment-12715643"
        },
        {
            "date": "2009-06-02T19:49:04+0000",
            "content": "I meant to resolve as Won't Fix. ",
            "author": "Michael McCandless",
            "id": "comment-12715646"
        }
    ]
}