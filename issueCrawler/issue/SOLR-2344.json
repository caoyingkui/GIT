{
    "id": "SOLR-2344",
    "title": "JMX not reliable - MBeans deleted",
    "details": {
        "affect_versions": "None",
        "status": "Closed",
        "fix_versions": [],
        "components": [],
        "type": "Bug",
        "priority": "Major",
        "labels": "",
        "resolution": "Cannot Reproduce"
    },
    "description": "I am using JMX to monitor my replication status and am finding that my\nMBeans are disappearing.  I turned on debugging for JMX and found that\nsolr seems to be deleting the mbeans.\n\nThis appears to be a triggered event, but I am not finding any clues as to why this is happening.\n\nIs this a bug?  Some trace info is below..\n\nhere's me reading the mbean successfully:\nJan 27, 2011 5:00:02 PM ServerCommunicatorAdmin reqIncoming\nFINER: Receive a new request.\nJan 27, 2011 5:00:02 PM DefaultMBeanServerInterceptor getAttribute\nFINER: Attribute= indexReplicatedAt, obj=\nsolr/myapp-core:type=/replication,id=org.apache.solr.handler.ReplicationHandler\nJan 27, 2011 5:00:02 PM Repository retrieve\nFINER: name=solr/myapp-core:type=/replication,id=org.apache.solr.handler.ReplicationHandler\nJan 27, 2011 5:00:02 PM ServerCommunicatorAdmin reqIncoming\nFINER: Finish a request.\n\n\na little while later it removes the mbean from the PM Repository\n(whatever that is) and then re-adds it:\nFINER: Send create notification of object\nsolr/myapp-core:id=org.apache.solr.handler.component.SearchHandler,type=atlas\nJan 27, 2011 5:16:14 PM DefaultMBeanServerInterceptor sendNotification\nFINER: JMX.mbean.registered\nsolr/myapp-core:type=atlas,id=org.apache.solr.handler.component.SearchHandler\nJan 27, 2011 5:16:14 PM Repository contains\nFINER: name=solr/myapp-core:type=/replication,id=org.apache.solr.handler.ReplicationHandler\nJan 27, 2011 5:16:14 PM Repository retrieve\nFINER: name=solr/myapp-core:type=/replication,id=org.apache.solr.handler.ReplicationHandler\nJan 27, 2011 5:16:14 PM Repository remove\nFINER: name=solr/myapp-core:type=/replication,id=org.apache.solr.handler.ReplicationHandler\nJan 27, 2011 5:16:14 PM DefaultMBeanServerInterceptor unregisterMBean\nFINER: Send delete notification of object\nsolr/myapp-core:id=org.apache.solr.handler.ReplicationHandler,type=/replication\nJan 27, 2011 5:16:14 PM DefaultMBeanServerInterceptor sendNotification\nFINER: JMX.mbean.unregistered\nsolr/myapp-core:type=/replication,id=org.apache.solr.handler.ReplicationHandler\nJan 27, 2011 5:16:14 PM DefaultMBeanServerInterceptor registerMBean\nFINER: ObjectName =\nsolr/myapp-core:type=/replication,id=org.apache.solr.handler.ReplicationHandler\nJan 27, 2011 5:16:14 PM Repository addMBean\nFINER: name=solr/myapp-core:type=/replication,id=org.apache.solr.handler.ReplicationHandler\nJan 27, 2011 5:16:14 PM DefaultMBeanServerInterceptor addObject\nFINER: Send create notification of object\nsolr/myapp-core:id=org.apache.solr.handler.ReplicationHandler,type=/replication\nJan 27, 2011 5:16:14 PM DefaultMBeanServerInterceptor sendNotification\nFINER: JMX.mbean.registered\nsolr/myapp-core:type=/replication,id=org.apache.solr.handler.ReplicationHandler\n\n\nAnd after a tons of messages but still in the same second it does:\nJan 27, 2011 5:16:14 PM Repository contains\nFINER: name=solr/myapp-core:type=org.apache.solr.handler.ReplicationHandler,id=org.apache.solr.handler.ReplicationHandler\nJan 27, 2011 5:16:14 PM Repository retrieve\nFINER: name=solr/myapp-core:type=org.apache.solr.handler.ReplicationHandler,id=org.apache.solr.handler.ReplicationHandler\nJan 27, 2011 5:16:14 PM Repository removeFINER:\nname=solr/myapp-core:type=org.apache.solr.handler.ReplicationHandler,id=org.apache.solr.handler.ReplicationHandler\nJan 27, 2011 5:16:14 PM DefaultMBeanServerInterceptor unregisterMBean\nFINER: Send delete notification of object\nsolr/myapp-core:id=org.apache.solr.handler.ReplicationHandler,type=org.apache.solr.handler.ReplicationHandler\nJan 27, 2011 5:16:14 PM DefaultMBeanServerInterceptor sendNotification\nFINER: JMX.mbean.unregistered\nsolr/myapp-core:type=org.apache.solr.handler.ReplicationHandler,id=org.apache.solr.handler.ReplicationHandler\nJan 27, 2011 5:16:14 PM DefaultMBeanServerInterceptor registerMBean\nFINER: ObjectName =\nsolr/myapp-core:type=org.apache.solr.handler.ReplicationHandler,id=org.apache.solr.handler.ReplicationHandlerJan\n27, 2011 5:16:14 PM Repository addMBean\nFINER: name=solr/myapp-core:type=org.apache.solr.handler.ReplicationHandler,id=org.apache.solr.handler.ReplicationHandler\nJan 27, 2011 5:16:14 PM DefaultMBeanServerInterceptor addObjectFINER:\nSend create notification of object\nsolr/myapp-core:id=org.apache.solr.handler.ReplicationHandler,type=org.apache.solr.handler.ReplicationHandler\nJan 27, 2011 5:16:14 PM DefaultMBeanServerInterceptor\nsendNotificationFINER: JMX.mbean.registered\nsolr/myapp-core:type=org.apache.solr.handler.ReplicationHandler,id=org.apache.solr.handler.ReplicationHandler\n\n\nAnd then I don't know what this is about but it removes the bean again:\nJan 27, 2011 5:16:15 PM Repository contains\nFINER: name=solr/myapp-core:type=org.apache.solr.handler.ReplicationHandler,id=org.apache.solr.handler.ReplicationHandler\nJan 27, 2011 5:16:15 PM Repository retrieve\nFINER: name=solr/myapp-core:type=org.apache.solr.handler.ReplicationHandler,id=org.apache.solr.handler.ReplicationHandler\nJan 27, 2011 5:16:15 PM Repository remove\nFINER: name=solr/myapp-core:type=org.apache.solr.handler.ReplicationHandler,id=org.apache.solr.handler.ReplicationHandler\nJan 27, 2011 5:16:15 PM DefaultMBeanServerInterceptor unregisterMBean\nFINER: Send delete notification of object\nsolr/myapp-core:id=org.apache.solr.handler.ReplicationHandler,type=org.apache.solr.hand\nler.ReplicationHandler\nJan 27, 2011 5:16:15 PM DefaultMBeanServerInterceptor sendNotification\nFINER: JMX.mbean.unregistered\nsolr/myapp-core:type=org.apache.solr.handler.ReplicationHandler,id=org.apache.solr.handler.Replicat\nionHandler\n\n\nBut eventually I come in to read and find nothing:\nJan 27, 2011 5:20:01 PM ServerCommunicatorAdmin reqIncoming\nFINER: Receive a new request.\nJan 27, 2011 5:20:01 PM DefaultMBeanServerInterceptor getAttribute\nFINER: Attribute= indexReplicatedAt, obj=\nsolr/myapp-core:type=/replication,id=org.apache.solr.handler.ReplicationHandler\nJan 27, 2011 5:20:01 PM Repository retrieve\nFINER: name=solr/myapp-core:type=/replication,id=org.apache.solr.handler.ReplicationHandler\nJan 27, 2011 5:20:01 PM DefaultMBeanServerInterceptor getMBean\nFINER: solr/myapp-core:type=/replication,id=org.apache.solr.handler.ReplicationHandler:\nFound no object",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "author": "Alexandre Rafalovitch",
            "id": "comment-15566510",
            "date": "2016-10-11T20:33:12+0000",
            "content": "This is for old style replication? Not for SolrCloud? If yes, this case probably is no longer useful and can be closed. "
        }
    ]
}