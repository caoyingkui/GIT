{
    "id": "SOLR-4600",
    "title": "400 Bad Request status should be returned if a query parameter has the wrong datatype",
    "details": {
        "affect_versions": "4.2",
        "status": "Open",
        "fix_versions": [],
        "components": [
            "search"
        ],
        "type": "Bug",
        "priority": "Major",
        "labels": "",
        "resolution": "Unresolved"
    },
    "description": "Solr returns a 500 Server Error for the following query even though the error is really a user error - wrong datatype for the &rows parameter:\n\n\ncurl \"http://localhost:8983/solr/select/?q=*:*&rows=all\" -v\n\n\n\nThe &rows parameter of course expects an integer.\n\nSomebody should probably trap the raw number format exception and turn it into a 400 Bad Request SolrException.\n\nThe actual response:\n\n\nJack Krupansky@JackKrupansky ~ $ curl \"http://localhost:8983/solr/select/?q=*:*&rows=all\" -v\n* About to connect() to localhost port 8983 (#0)\n*   Trying 127.0.0.1...\n* connected\n* Connected to localhost (127.0.0.1) port 8983 (#0)\n> GET /solr/select/?q=*:*&rows=all HTTP/1.1\n> User-Agent: curl/7.27.0\n> Host: localhost:8983\n> Accept: */*\n>\n* additional stuff not fine /usr/src/ports/curl/curl-7.27.0-1/src/curl-7.27.0/lib/transfer.c:1037: 0 0\n* HTTP 1.1 or later with persistent connection, pipelining supported\n< HTTP/1.1 500 Server Error\n< Cache-Control: no-cache, no-store\n< Pragma: no-cache\n< Expires: Sat, 01 Jan 2000 01:00:00 GMT\n< Last-Modified: Sun, 17 Mar 2013 21:23:39 GMT\n< ETag: \"13d7a3c83fb\"\n< Content-Type: application/xml; charset=UTF-8\n< Transfer-Encoding: chunked\n<\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<response>\n<lst name=\"responseHeader\"><int name=\"status\">500</int><int name=\"QTime\">1</int><lst name=\"params\"><str name=\"q\">*:*</str><str name=\"rows\">all</str></lst></lst><lst name=\"error\"><str name=\"msg\">For input string: \"all\"</str><str name=\"trace\">java.lang.NumberFormatException: For input string: \"all\"\n        at java.lang.NumberFormatException.forInputString(Unknown Source)\n        at java.lang.Integer.parseInt(Unknown Source)\n        at java.lang.Integer.parseInt(Unknown Source)\n        at org.apache.solr.search.QParser.getSort(QParser.java:277)\n        at org.apache.solr.handler.component.QueryComponent.prepare(QueryComponent.java:123)\n        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:187)\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135)\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1797)\n        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:637)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:343)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:141)\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1307)\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:453)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:560)\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1072)\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:382)\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1006)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n        at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:255)\n        at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154)\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)\n        at org.eclipse.jetty.server.Server.handle(Server.java:365)\n        at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:485)\n        at org.eclipse.jetty.server.BlockingHttpConnection.handleRequest(BlockingHttpConnection.java:53)\n        at org.eclipse.jetty.server.AbstractHttpConnection.headerComplete(AbstractHttpConnection.java:926)\n        at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.headerComplete(AbstractHttpConnection.java:988)\n        at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:635)\n        at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:235)\n        at org.eclipse.jetty.server.BlockingHttpConnection.handle(BlockingHttpConnection.java:72)\n        at org.eclipse.jetty.server.bio.SocketConnector$ConnectorEndPoint.run(SocketConnector.java:264)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543)\n        at java.lang.Thread.run(Unknown Source)\n</str><int name=\"code\">500</int></lst>\n</response>\n* Connection #0 to host localhost left intact\n* Closing connection #0",
    "attachments": {},
    "issue_links": {},
    "comments": []
}