{
    "id": "SOLR-10028",
    "title": "SegmentsInfoRequestHandlerTest.testSegmentInfosVersion fails in master",
    "details": {
        "labels": "",
        "priority": "Minor",
        "components": [],
        "type": "Bug",
        "fix_versions": [
            "7.5",
            "master (8.0)"
        ],
        "affect_versions": "None",
        "resolution": "Fixed",
        "status": "Closed"
    },
    "description": "Failed in Jenkins: https://jenkins.thetaphi.de/job/Lucene-Solr-master-Solaris/1092/\nIt reproduces consistently in my mac also with the latest master (ca50e5b61c2d8bfb703169cea2fb0ab20fd24c6b):\n\nant test  -Dtestcase=SegmentsInfoRequestHandlerTest -Dtests.method=testSegmentInfosVersion -Dtests.seed=619B9D838D6F1E29 -Dtests.slow=true -Dtests.locale=en-AU -Dtests.timezone=America/Manaus -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1\n\n\nThere are similar failures in previous Jenkins builds since last month",
    "attachments": {
        "SOLR-10028-alternative.patch": "https://issues.apache.org/jira/secure/attachment/12935418/SOLR-10028-alternative.patch",
        "SOLR-10028.patch": "https://issues.apache.org/jira/secure/attachment/12935158/SOLR-10028.patch"
    },
    "issue_links": {},
    "comments": [
        {
            "date": "2017-02-15T13:39:54+0000",
            "content": "My Jenkins found a reproducing branch_6x seed:\n\n\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=SegmentsInfoRequestHandlerTest -Dtests.method=testSegmentInfosVersion -Dtests.seed=C5730E96C615C052 -Dtests.slow=true -Dtests.locale=ko -Dtests.timezone=America/Paramaribo -Dtests.asserts=true -Dtests.file.encoding=UTF-8\n   [junit4] ERROR   0.04s J2  | SegmentsInfoRequestHandlerTest.testSegmentInfosVersion <<<\n   [junit4]    > Throwable #1: java.lang.RuntimeException: Exception during query\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([C5730E96C615C052:3DAD9B7EBE791101]:0)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:918)\n   [junit4]    > \tat org.apache.solr.handler.admin.SegmentsInfoRequestHandlerTest.testSegmentInfosVersion(SegmentsInfoRequestHandlerTest.java:70)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n   [junit4]    > Caused by: java.lang.RuntimeException: REQUEST FAILED: xpath=2=count(//lst[@name='segments']/lst/str[@name='version'][.='6.5.0'])\n   [junit4]    > \txml response was: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n   [junit4]    > <response>\n   [junit4]    > <lst name=\"responseHeader\"><int name=\"status\">0</int><int name=\"QTime\">8</int></lst><lst name=\"segments\"><lst name=\"_0\"><str name=\"name\">_0</str><int name=\"delCount\">1</int><long name=\"sizeInBytes\">2047</long><int name=\"size\">4</int><date name=\"age\">2017-02-14T22:04:42.631Z</date><str name=\"source\">flush</str><str name=\"version\">6.5.0</str></lst><lst name=\"_1\"><str name=\"name\">_1</str><int name=\"delCount\">0</int><long name=\"sizeInBytes\">1869</long><int name=\"size\">1</int><date name=\"age\">2017-02-14T22:04:42.684Z</date><str name=\"source\">flush</str><str name=\"version\">6.5.0</str></lst><lst name=\"_2\"><str name=\"name\">_2</str><int name=\"delCount\">0</int><long name=\"sizeInBytes\">1980</long><int name=\"size\">4</int><date name=\"age\">2017-02-14T22:04:42.752Z</date><str name=\"source\">flush</str><str name=\"version\">6.5.0</str></lst><lst name=\"_3\"><str name=\"name\">_3</str><int name=\"delCount\">0</int><long name=\"sizeInBytes\">1869</long><int name=\"size\">1</int><date name=\"age\">2017-02-14T22:04:42.775Z</date><str name=\"source\">flush</str><str name=\"version\">6.5.0</str></lst></lst>\n   [junit4]    > </response>\n   [junit4]    > \trequest was:qt=/admin/segments&wt=xml\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:911)\n   [junit4]    > \t... 40 more\n[...]\n   [junit4]   2> NOTE: test params are: codec=Asserting(Lucene62), sim=RandomSimilarity(queryNorm=false,coord=crazy): {}, locale=ko, timezone=America/Paramaribo\n   [junit4]   2> NOTE: Linux 4.1.0-custom2-amd64 amd64/Oracle Corporation 1.8.0_77 (64-bit)/cpus=16,threads=1,free=190574568,total=525860864\n\n ",
            "author": "Steve Rowe",
            "id": "comment-15867849"
        },
        {
            "date": "2017-02-25T20:57:04+0000",
            "content": "My Jenkins found a reproducing master seed:\n\n\nChecking out Revision 99e8ef2304b67712d45a2393e649c5319aaac972 (refs/remotes/origin/master)\n[...]\n   [junit4]   2> 553808 ERROR (TEST-SegmentsInfoRequestHandlerTest.testSegmentInfosVersion-seed#[8EE283F9B925B4AC]) [    ] o.a.s.SolrTestCaseJ4 REQUEST FAILED: xpath=2=count(//lst[@name='segments']/lst/str[@name='version'][.='7.0.0'])\n   [junit4]   2> \txml response was: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n   [junit4]   2> <response>\n   [junit4]   2> <lst name=\"responseHeader\"><int name=\"status\">0</int><int name=\"QTime\">1</int></lst><lst name=\"segments\"><lst name=\"_0\"><str name=\"name\">_0</str><int name=\"delCount\">1</int><long name=\"sizeInBytes\">2534</long><int name=\"size\">4</int><date name=\"age\">2017-02-25T02:51:39.320Z</date><str name=\"source\">flush</str><str name=\"version\">7.0.0</str></lst><lst name=\"_1\"><str name=\"name\">_1</str><int name=\"delCount\">0</int><long name=\"sizeInBytes\">2356</long><int name=\"size\">1</int><date name=\"age\">2017-02-25T02:51:39.328Z</date><str name=\"source\">flush</str><str name=\"version\">7.0.0</str></lst><lst name=\"_2\"><str name=\"name\">_2</str><int name=\"delCount\">0</int><long name=\"sizeInBytes\">2467</long><int name=\"size\">4</int><date name=\"age\">2017-02-25T02:51:39.341Z</date><str name=\"source\">flush</str><str name=\"version\">7.0.0</str></lst><lst name=\"_3\"><str name=\"name\">_3</str><int name=\"delCount\">0</int><long name=\"sizeInBytes\">2356</long><int name=\"size\">1</int><date name=\"age\">2017-02-25T02:51:39.343Z</date><str name=\"source\">flush</str><str name=\"version\">7.0.0</str></lst></lst>\n   [junit4]   2> </response>\n   [junit4]   2> \n   [junit4]   2> \trequest was:qt=/admin/segments&wt=xml\n   [junit4]   2> 553808 ERROR (TEST-SegmentsInfoRequestHandlerTest.testSegmentInfosVersion-seed#[8EE283F9B925B4AC]) [    ] o.a.s.SolrTestCaseJ4 REQUEST FAILED: qt=/admin/segments&wt=xml:java.lang.RuntimeException: REQUEST FAILED: xpath=2=count(//lst[@name='segments']/lst/str[@name='version'][.='7.0.0'])\n   [junit4]   2> \txml response was: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n   [junit4]   2> <response>\n   [junit4]   2> <lst name=\"responseHeader\"><int name=\"status\">0</int><int name=\"QTime\">1</int></lst><lst name=\"segments\"><lst name=\"_0\"><str name=\"name\">_0</str><int name=\"delCount\">1</int><long name=\"sizeInBytes\">2534</long><int name=\"size\">4</int><date name=\"age\">2017-02-25T02:51:39.320Z</date><str name=\"source\">flush</str><str name=\"version\">7.0.0</str></lst><lst name=\"_1\"><str name=\"name\">_1</str><int name=\"delCount\">0</int><long name=\"sizeInBytes\">2356</long><int name=\"size\">1</int><date name=\"age\">2017-02-25T02:51:39.328Z</date><str name=\"source\">flush</str><str name=\"version\">7.0.0</str></lst><lst name=\"_2\"><str name=\"name\">_2</str><int name=\"delCount\">0</int><long name=\"sizeInBytes\">2467</long><int name=\"size\">4</int><date name=\"age\">2017-02-25T02:51:39.341Z</date><str name=\"source\">flush</str><str name=\"version\">7.0.0</str></lst><lst name=\"_3\"><str name=\"name\">_3</str><int name=\"delCount\">0</int><long name=\"sizeInBytes\">2356</long><int name=\"size\">1</int><date name=\"age\">2017-02-25T02:51:39.343Z</date><str name=\"source\">flush</str><str name=\"version\">7.0.0</str></lst></lst>\n   [junit4]   2> </response>\n   [junit4]   2> \n   [junit4]   2> \trequest was:qt=/admin/segments&wt=xml\n   [junit4]   2> \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:912)\n   [junit4]   2> \tat org.apache.solr.handler.admin.SegmentsInfoRequestHandlerTest.testSegmentInfosVersion(SegmentsInfoRequestHandlerTest.java:70)\n   [junit4]   2> \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n   [junit4]   2> \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n   [junit4]   2> \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n   [junit4]   2> \tat java.lang.reflect.Method.invoke(Method.java:498)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1713)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:907)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:943)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:957)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:57)\n   [junit4]   2> \tat org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:49)\n   [junit4]   2> \tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\n   [junit4]   2> \tat org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:48)\n   [junit4]   2> \tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)\n   [junit4]   2> \tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:817)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:468)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:916)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:802)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:852)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:863)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:57)\n   [junit4]   2> \tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n   [junit4]   2> \tat org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:41)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n   [junit4]   2> \tat org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)\n   [junit4]   2> \tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)\n   [junit4]   2> \tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)\n   [junit4]   2> \tat org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:54)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)\n   [junit4]   2> \tat java.lang.Thread.run(Thread.java:745)\n   [junit4]   2> \n   [junit4]   2> 553809 INFO  (TEST-SegmentsInfoRequestHandlerTest.testSegmentInfosVersion-seed#[8EE283F9B925B4AC]) [    ] o.a.s.SolrTestCaseJ4 ###Ending testSegmentInfosVersion\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=SegmentsInfoRequestHandlerTest -Dtests.method=testSegmentInfosVersion -Dtests.seed=8EE283F9B925B4AC -Dtests.slow=true -Dtests.locale=es-US -Dtests.timezone=America/Thunder_Bay -Dtests.asserts=true -Dtests.file.encoding=US-ASCII\n   [junit4] ERROR   0.02s J6  | SegmentsInfoRequestHandlerTest.testSegmentInfosVersion <<<\n   [junit4]    > Throwable #1: java.lang.RuntimeException: Exception during query\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([8EE283F9B925B4AC:763C1611C14965FF]:0)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:919)\n   [junit4]    > \tat org.apache.solr.handler.admin.SegmentsInfoRequestHandlerTest.testSegmentInfosVersion(SegmentsInfoRequestHandlerTest.java:70)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n   [junit4]    > Caused by: java.lang.RuntimeException: REQUEST FAILED: xpath=2=count(//lst[@name='segments']/lst/str[@name='version'][.='7.0.0'])\n   [junit4]    > \txml response was: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n   [junit4]    > <response>\n   [junit4]    > <lst name=\"responseHeader\"><int name=\"status\">0</int><int name=\"QTime\">1</int></lst><lst name=\"segments\"><lst name=\"_0\"><str name=\"name\">_0</str><int name=\"delCount\">1</int><long name=\"sizeInBytes\">2534</long><int name=\"size\">4</int><date name=\"age\">2017-02-25T02:51:39.320Z</date><str name=\"source\">flush</str><str name=\"version\">7.0.0</str></lst><lst name=\"_1\"><str name=\"name\">_1</str><int name=\"delCount\">0</int><long name=\"sizeInBytes\">2356</long><int name=\"size\">1</int><date name=\"age\">2017-02-25T02:51:39.328Z</date><str name=\"source\">flush</str><str name=\"version\">7.0.0</str></lst><lst name=\"_2\"><str name=\"name\">_2</str><int name=\"delCount\">0</int><long name=\"sizeInBytes\">2467</long><int name=\"size\">4</int><date name=\"age\">2017-02-25T02:51:39.341Z</date><str name=\"source\">flush</str><str name=\"version\">7.0.0</str></lst><lst name=\"_3\"><str name=\"name\">_3</str><int name=\"delCount\">0</int><long name=\"sizeInBytes\">2356</long><int name=\"size\">1</int><date name=\"age\">2017-02-25T02:51:39.343Z</date><str name=\"source\">flush</str><str name=\"version\">7.0.0</str></lst></lst>\n   [junit4]    > </response>\n   [junit4]    > \trequest was:qt=/admin/segments&wt=xml\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:912)\n   [junit4]    > \t... 40 more\n[...]\n   [junit4]   2> NOTE: test params are: codec=Asserting(Lucene70): {name=TestBloomFilteredLucenePostings(BloomFilteringPostingsFormat(Lucene50(blocksize=128))), id=TestBloomFilteredLucenePostings(BloomFilteringPostingsFormat(Lucene50(blocksize=128)))}, docValues:{}, maxPointsInLeafNode=1213, maxMBSortInHeap=7.121275708198973, sim=RandomSimilarity(queryNorm=true): {}, locale=es-US, timezone=America/Thunder_Bay\n   [junit4]   2> NOTE: Linux 4.1.0-custom2-amd64 amd64/Oracle Corporation 1.8.0_77 (64-bit)/cpus=16,threads=1,free=245347840,total=521666560\n\n ",
            "author": "Steve Rowe",
            "id": "comment-15884379"
        },
        {
            "date": "2017-08-30T14:32:56+0000",
            "content": "Another reproducing master seed from my Jenkins:\n\n\nChecking out Revision aa27148594b6f3e90754050ec55f1f286613f724 (refs/remotes/origin/master)\n[...]\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=SegmentsInfoRequestHandlerTest -Dtests.method=testSegmentInfosVersion -Dtests.seed=EC71065150E2D03F -Dtests.slow=true -Dtests.locale=be-BY -Dtests.timezone=Pacific/Chuuk -Dtests.asserts=true -Dtests.file.encoding=US-ASCII\n   [junit4] ERROR   0.01s J3  | SegmentsInfoRequestHandlerTest.testSegmentInfosVersion <<<\n   [junit4]    > Throwable #1: java.lang.RuntimeException: Exception during query\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([EC71065150E2D03F:14AF93B9288E016C]:0)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:880)\n   [junit4]    > \tat org.apache.solr.handler.admin.SegmentsInfoRequestHandlerTest.testSegmentInfosVersion(SegmentsInfoRequestHandlerTest.java:68)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n   [junit4]    > Caused by: java.lang.RuntimeException: REQUEST FAILED: xpath=2=count(//lst[@name='segments']/lst/str[@name='version'][.='8.0.0'])\n   [junit4]    > \txml response was: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n   [junit4]    > <response>\n   [junit4]    > <lst name=\"responseHeader\"><int name=\"status\">0</int><int name=\"QTime\">9</int></lst><lst name=\"segments\"><lst name=\"_0\"><str name=\"name\">_0</str><int name=\"delCount\">1</int><long name=\"sizeInBytes\">1765</long><int name=\"size\">2</int><date name=\"age\">2017-08-30T02:27:48.336Z</date><str name=\"source\">flush</str><str name=\"version\">8.0.0</str></lst><lst name=\"_1\"><str name=\"name\">_1</str><int name=\"delCount\">0</int><long name=\"sizeInBytes\">1698</long><int name=\"size\">2</int><date name=\"age\">2017-08-30T02:27:48.338Z</date><str name=\"source\">flush</str><str name=\"version\">8.0.0</str></lst><lst name=\"_2\"><str name=\"name\">_2</str><int name=\"delCount\">0</int><long name=\"sizeInBytes\">1657</long><int name=\"size\">1</int><date name=\"age\">2017-08-30T02:27:48.356Z</date><str name=\"source\">flush</str><str name=\"version\">8.0.0</str></lst><lst name=\"_3\"><str name=\"name\">_3</str><int name=\"delCount\">0</int><long name=\"sizeInBytes\">1698</long><int name=\"size\">2</int><date name=\"age\">2017-08-30T02:27:48.380Z</date><str name=\"source\">flush</str><str name=\"version\">8.0.0</str></lst><lst name=\"_4\"><str name=\"name\">_4</str><int name=\"delCount\">0</int><long name=\"sizeInBytes\">1698</long><int name=\"size\">2</int><date name=\"age\">2017-08-30T02:27:48.382Z</date><str name=\"source\">flush</str><str name=\"version\">8.0.0</str></lst><lst name=\"_5\"><str name=\"name\">_5</str><int name=\"delCount\">0</int><long name=\"sizeInBytes\">1657</long><int name=\"size\">1</int><date name=\"age\">2017-08-30T02:27:48.401Z</date><str name=\"source\">flush</str><str name=\"version\">8.0.0</str></lst></lst>\n   [junit4]    > </response>\n   [junit4]    > \trequest was:qt=/admin/segments&wt=xml\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:873)\n[...]\n   [junit4]   2> NOTE: test params are: codec=Asserting(Lucene70), sim=RandomSimilarity(queryNorm=false): {}, locale=be-BY, timezone=Pacific/Chuuk\n   [junit4]   2> NOTE: Linux 4.1.0-custom2-amd64 amd64/Oracle Corporation 1.8.0_77 (64-bit)/cpus=16,threads=1,free=128365944,total=526909440\n\n ",
            "author": "Steve Rowe",
            "id": "comment-16147320"
        },
        {
            "date": "2018-02-28T16:01:19+0000",
            "content": "Another reproducing master seed from https://jenkins.thetaphi.de/job/Lucene-Solr-master-Linux/21552/:\n\n\nChecking out Revision 1485b7a4d72f5bf4123206d59716e75fb2706374 (refs/remotes/origin/master)\n[...]\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=SegmentsInfoRequestHandlerTest -Dtests.method=testSegmentInfosVersion -Dtests.seed=13EBBD17E521ECA0 -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=ar-LY -Dtests.timezone=Asia/Shanghai -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1\n   [junit4] ERROR   0.01s J0 | SegmentsInfoRequestHandlerTest.testSegmentInfosVersion <<<\n   [junit4]    > Throwable #1: java.lang.RuntimeException: Exception during query\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([13EBBD17E521ECA0:EB3528FF9D4D3DF3]:0)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:904)\n   [junit4]    > \tat org.apache.solr.handler.admin.SegmentsInfoRequestHandlerTest.testSegmentInfosVersion(SegmentsInfoRequestHandlerTest.java:68)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:748)\n   [junit4]    > Caused by: java.lang.RuntimeException: REQUEST FAILED: xpath=2=count(//lst[@name='segments']/lst/str[@name='version'][.='8.0.0'])\n   [junit4]    > \txml response was: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n   [junit4]    > <response>\n   [junit4]    > <lst name=\"responseHeader\"><int name=\"status\">0</int><int name=\"QTime\">0</int></lst><lst name=\"segments\"><lst name=\"_0\"><str name=\"name\">_0</str><int name=\"delCount\">1</int><long name=\"sizeInBytes\">1538</long><int name=\"size\">3</int><date name=\"age\">2018-02-28T14:42:32.213Z</date><str name=\"source\">flush</str><str name=\"version\">8.0.0</str></lst><lst name=\"_1\"><str name=\"name\">_1</str><int name=\"delCount\">0</int><long name=\"sizeInBytes\">1452</long><int name=\"size\">2</int><date name=\"age\">2018-02-28T14:42:32.216Z</date><str name=\"source\">flush</str><str name=\"version\">8.0.0</str></lst><lst name=\"_2\"><str name=\"name\">_2</str><int name=\"delCount\">0</int><long name=\"sizeInBytes\">1471</long><int name=\"size\">3</int><date name=\"age\">2018-02-28T14:42:32.226Z</date><str name=\"source\">flush</str><str name=\"version\">8.0.0</str></lst><lst name=\"_3\"><str name=\"name\">_3</str><int name=\"delCount\">0</int><long name=\"sizeInBytes\">1452</long><int name=\"size\">2</int><date name=\"age\">2018-02-28T14:42:32.229Z</date><str name=\"source\">flush</str><str name=\"version\">8.0.0</str></lst></lst>\n   [junit4]    > </response>\n   [junit4]    > \trequest was:qt=/admin/segments&wt=xml\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:897)\n   [junit4]    > \t... 40 more\n[...]\n   [junit4]   2> NOTE: test params are: codec=Asserting(Lucene70): {name=PostingsFormat(name=Memory), id=PostingsFormat(name=Memory)}, docValues:{}, maxPointsInLeafNode=84, maxMBSortInHeap=7.698471144201788, sim=Asserting(org.apache.lucene.search.similarities.AssertingSimilarity@1aa475d), locale=ar-LY, timezone=Asia/Shanghai\n   [junit4]   2> NOTE: Linux 4.13.0-32-generic i386/Oracle Corporation 1.8.0_162 (32-bit)/cpus=8,threads=1,free=91685872,total=526123008\n\n ",
            "author": "Steve Rowe",
            "id": "comment-16380529"
        },
        {
            "date": "2018-06-18T22:30:41+0000",
            "content": "Reproducing branch_7x seed, from https://jenkins.thetaphi.de/job/Lucene-Solr-7.x-Linux/2131/ (not sure of git hash since the Jenkins job output has expired, but this seed fails reproducibly for me going back to commits in December 2017):\n\n\n  [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=SegmentsInfoRequestHandlerTest -Dtests.method=testSegmentInfosVersion -Dtests.seed=9D8A7AA0EE660A09 -Dtests.multiplier=3 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=es-HN -Dtests.timezone=Eire -Dtests.asserts=true -Dtests.file.encoding=US-ASCII\n  [junit4] ERROR   0.01s J0 | SegmentsInfoRequestHandlerTest.testSegmentInfosVersion <<<\n  [junit4]    > Throwable #1: java.lang.RuntimeException: Exception during query\n  [junit4]    > \tat __randomizedtesting.SeedInfo.seed([9D8A7AA0EE660A09:6554EF48960ADB5A]:0)\n  [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:917)\n  [junit4]    > \tat org.apache.solr.handler.admin.SegmentsInfoRequestHandlerTest.testSegmentInfosVersion(SegmentsInfoRequestHandlerTest.java:68)\n  [junit4]    > \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  [junit4]    > \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n  [junit4]    > \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  [junit4]    > \tat java.base/java.lang.reflect.Method.invoke(Method.java:564)\n  [junit4]    > \tat java.base/java.lang.Thread.run(Thread.java:844)\n  [junit4]    > Caused by: java.lang.RuntimeException: REQUEST FAILED: xpath=2=count(//lst[@name='segments']/lst/str[@name='version'][.='7.5.0'])\n  [junit4]    > \txml response was: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n  [junit4]    > <response>\n  [junit4]    > <lst name=\"responseHeader\"><int name=\"status\">0</int><int name=\"QTime\">0</int></lst><lst name=\"segments\"><lst name=\"_0\"><str name=\"name\">_0</str><int name=\"delCount\">1</int><long name=\"sizeInBytes\">1979</long><int name=\"size\">3</int><date name=\"age\">2018-06-15T07:43:40.696Z</date><str name=\"source\">flush</str><str name=\"version\">7.5.0</str></lst><lst name=\"_1\"><str name=\"name\">_1</str><int name=\"delCount\">0</int><long name=\"sizeInBytes\">1886</long><int name=\"size\">2</int><date name=\"age\">2018-06-15T07:43:40.726Z</date><str name=\"source\">flush</str><str name=\"version\">7.5.0</str></lst><lst name=\"_2\"><str name=\"name\">_2</str><int name=\"delCount\">0</int><long name=\"sizeInBytes\">1912</long><int name=\"size\">3</int><date name=\"age\">2018-06-15T07:43:40.766Z</date><str name=\"source\">flush</str><str name=\"version\">7.5.0</str></lst><lst name=\"_3\"><str name=\"name\">_3</str><int name=\"delCount\">0</int><long name=\"sizeInBytes\">1886</long><int name=\"size\">2</int><date name=\"age\">2018-06-15T07:43:40.772Z</date><str name=\"source\">flush</str><str name=\"version\">7.5.0</str></lst></lst>\n  [junit4]    > </response>\n  [junit4]    > \trequest was:qt=/admin/segments&wt=xml\n  [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:910)\n  [junit4]    > \t... 39 more\n[...]\n  [junit4]   2> NOTE: test params are: codec=Asserting(Lucene70): {name=FSTOrd50, id=FSTOrd50}, docValues:{}, maxPointsInLeafNode=1659, maxMBSortInHeap=7.665671164568957, sim=RandomSimilarity(queryNorm=true): {}, locale=es-HN, timezone=Eire\n  [junit4]   2> NOTE: Linux 4.13.0-41-generic amd64/Oracle Corporation 10.0.1 (64-bit)/cpus=8,threads=1,free=408649208,total=518979584\n\n ",
            "author": "Steve Rowe",
            "id": "comment-16516422"
        },
        {
            "date": "2018-08-10T17:10:25+0000",
            "content": "Reproducing seed for master branch from https://jenkins.thetaphi.de/job/Lucene-Solr-master-Linux/22635/consoleFull ( http://mail-archives.apache.org/mod_mbox/lucene-dev/201808.mbox/%3c1429107222.195.1533825604679.JavaMail.jenkins@serv1.sd-datasolutions.de%3e )\n\nant test  -Dtestcase=SegmentsInfoRequestHandlerTest -Dtests.method=testSegmentInfosVersion -Dtests.seed=2979CD498D660A0D -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=en-KN -Dtests.timezone=Europe/Sofia -Dtests.asserts=true -Dtests.file.encoding=UTF-8\n\n\n\nI wonder if this is a test bug \u2013 will attach proposed patch. ",
            "author": "Christine Poerschke",
            "id": "comment-16576590"
        },
        {
            "date": "2018-08-13T18:47:08+0000",
            "content": "I agree Christine Poerschke, this looks like a test bug. WDYT about this alternative patch, I feel it should also work and keeps the test assertions a bit tighter. ",
            "author": "Tom\u00e1s Fern\u00e1ndez L\u00f6bbe",
            "id": "comment-16578780"
        },
        {
            "date": "2018-08-20T16:58:12+0000",
            "content": "... alternative patch, I feel it should also work and keeps the test assertions a bit tighter.\n\nI like the idea of more specific assertions.\n\nIf/Since this would check that the correct amount of segments info is returned, could a further future test perhaps even be then to specifically test that the returned segment ids are correct?\n\nIf/Since testSegmentInfosData gets the\n\n+    // Lets just skip this test if number of segments is < 2\n+    Assume.assumeTrue(numSegments >= 2);\n\n\nthen could the earlier\n\n+    assertTrue(\"Unexpected number of segment in the index: \" + numSegments, \n+        numSegments > 0 && numSegments <= 2 );\n\n\nin beforeClass be skipped perhaps? ",
            "author": "Christine Poerschke",
            "id": "comment-16586213"
        },
        {
            "date": "2018-08-23T18:05:18+0000",
            "content": "If/Since this would check that the correct amount of segments info is returned, could a further future test perhaps even be then to specifically test that the returned segment ids are correct?\n+1. I'll add that\nIf/Since testSegmentInfosData gets...\nThe goal was to quickly assert that the `numSegments` calculated made sense. That said, I think the <=2 is not right. I beasted this test with my modifications but I believe I'd removed that. I'll check again and fix if necessary ",
            "author": "Tom\u00e1s Fern\u00e1ndez L\u00f6bbe",
            "id": "comment-16590616"
        },
        {
            "date": "2018-08-26T05:44:24+0000",
            "content": "I was missing a part of the fix. The problem could be the merge (decreasing the number of segments to 1) but it could also have been the flushing (having more segments than commits). I think I fixed this in my last patch by setting the MP to NoMergePolicy and setting the maxBufferedDocs and ramBufferSizeMB to high enough numbers to prevent flushing (otherwise those values are randomly set in the base test class). Also added a test for the segment names.  ",
            "author": "Tom\u00e1s Fern\u00e1ndez L\u00f6bbe",
            "id": "comment-16592809"
        },
        {
            "date": "2018-08-27T17:37:25+0000",
            "content": "Just added some trivial changes to the test. Will commit in a moment ",
            "author": "Tom\u00e1s Fern\u00e1ndez L\u00f6bbe",
            "id": "comment-16594009"
        },
        {
            "date": "2018-08-27T21:06:25+0000",
            "content": "Commit d833b4c9d316a81c8d06cfd76adedd74a4936660 in lucene-solr's branch refs/heads/master from Tomas Fernandez Lobbe\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d833b4c ]\n\nSOLR-10028: Fix and improvements to SegmentsInfoRequestHandlerTest ",
            "author": "ASF subversion and git services",
            "id": "comment-16594224"
        },
        {
            "date": "2018-08-27T21:07:03+0000",
            "content": "Commit cc110264b3edaa54f393e83334d71ec43c6944c0 in lucene-solr's branch refs/heads/branch_7x from Tomas Fernandez Lobbe\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cc11026 ]\n\nSOLR-10028: Fix and improvements to SegmentsInfoRequestHandlerTest ",
            "author": "ASF subversion and git services",
            "id": "comment-16594225"
        }
    ]
}