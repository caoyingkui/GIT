{
    "id": "SOLR-5469",
    "title": "The Analysis Page on the Solr Admin Page does not work with Custom Analyzers",
    "details": {
        "affect_versions": "4.0",
        "status": "Closed",
        "fix_versions": [],
        "components": [
            "Schema and Analysis"
        ],
        "type": "Bug",
        "priority": "Minor",
        "labels": "",
        "resolution": "Cannot Reproduce"
    },
    "description": "The Analysis Page on the Solr Admin Page does not work with Custom Analyzers. To be specific the Analyzer page does not display all of the tokens output by the custom analyzer if the tokens themselves don't have a KeywordAttribute added. It does not matter that the tokens are not keyword tokens, it is just that the Tokens need to have the KeywordAttribute (even if it evaluates to false).\n\nI'm attaching the json output of the case of a text_en field (solr.Text fieldType) and the json output of the case of a field (mapped to custom fieldType).\n\nThe json generated for the custom fieldType (using a custom analyzer) while similar in all aspects to the json generated for text_en fieldType does not have KeywordAttribute set for the tokens (which seems valid).\n\nJSON From the analysis page for the custom fieldType (custom analyzer)\n\n{\n  \"responseHeader\":\n{\n    \"status\":0,\n    \"QTime\":0}\n,\n  \"analysis\":{\n    \"field_types\":{},\n    \"field_names\":{\n      \"title\":{\n        \"index\":[\n          \"org.apache.lucene.analysis.miscellaneous.RemoveDuplicatesTokenFilter\",[\n{\n              \"text\":\"concoct\",\n              \"raw_bytes\":\"[63 6f 6e 63 6f 63 74]\",\n              \"start\":5,\n              \"end\":15,\n              \"type\":\"word\",\n              \"position\":1,\n              \"positionHistory\":[1]}\n,\n            \n{\n              \"text\":\"solut\",\n              \"raw_bytes\":\"[73 6f 6c 75 74]\",\n              \"match\":true,\n              \"start\":22,\n              \"end\":30,\n              \"type\":\"word\",\n              \"position\":4,\n              \"positionHistory\":[4]}\n,\n            \n{\n              \"text\":\"trick\",\n              \"raw_bytes\":\"[74 72 69 63 6b]\",\n              \"match\":true,\n              \"start\":31,\n              \"end\":37,\n              \"type\":\"word\",\n              \"position\":5,\n              \"positionHistory\":[5]}\n]],\n        \"query\":[\n          \"org.apache.lucene.analysis.miscellaneous.RemoveDuplicatesTokenFilter\",[\n{\n              \"text\":\"solut\",\n              \"raw_bytes\":\"[73 6f 6c 75 74]\",\n              \"start\":7,\n              \"end\":15,\n              \"type\":\"word\",\n              \"position\":2,\n              \"positionHistory\":[2]}\n,\n            \n{\n              \"text\":\"trick\",\n              \"raw_bytes\":\"[74 72 69 63 6b]\",\n              \"start\":16,\n              \"end\":22,\n              \"type\":\"word\",\n              \"position\":3,\n              \"positionHistory\":[3]}\n]]}}}}\n\nJSON from the standard field (using the solr.TextField) which uses the analyzer from the following built-in tokenizers/tokenfilters in the following order.\nsolr.HTMLStripCharFilterFactory\nsolr.WhitespaceTokenizerFactory\nsolr.StopFilterFactory\nsolr.WordDelimiterFilterFactory\nsolr.ICUFoldingFilterFactory\nsolr.EnglishPossessiveFilterFactory\nsolr.PorterStemFilterFactory\n\n{\n  \"responseHeader\":\n{\n    \"status\":0,\n    \"QTime\":47}\n,\n  \"analysis\":{\n    \"field_types\":{\n      \"text_en\":{\n        \"index\":[\n          \"org.apache.lucene.analysis.charfilter.HTMLStripCharFilter\",\"Concocting the a Solution Tricks\",\n          \"org.apache.lucene.analysis.core.WhitespaceTokenizer\",[\n{\n              \"text\":\"Concocting\",\n              \"raw_bytes\":\"[43 6f 6e 63 6f 63 74 69 6e 67]\",\n              \"start\":0,\n              \"end\":10,\n              \"position\":1,\n              \"positionHistory\":[1],\n              \"type\":\"word\"}\n,\n            \n{\n              \"text\":\"the\",\n              \"raw_bytes\":\"[74 68 65]\",\n              \"start\":11,\n              \"end\":14,\n              \"position\":2,\n              \"positionHistory\":[2],\n              \"type\":\"word\"}\n,\n            \n{\n              \"text\":\"a\",\n              \"raw_bytes\":\"[61]\",\n              \"start\":15,\n              \"end\":16,\n              \"position\":3,\n              \"positionHistory\":[3],\n              \"type\":\"word\"}\n,\n            \n{\n              \"text\":\"Solution\",\n              \"raw_bytes\":\"[53 6f 6c 75 74 69 6f 6e]\",\n              \"start\":17,\n              \"end\":25,\n              \"position\":4,\n              \"positionHistory\":[4],\n              \"type\":\"word\"}\n,\n            \n{\n              \"text\":\"Tricks\",\n              \"raw_bytes\":\"[54 72 69 63 6b 73]\",\n              \"start\":26,\n              \"end\":32,\n              \"position\":5,\n              \"positionHistory\":[5],\n              \"type\":\"word\"}\n],\n          \"org.apache.lucene.analysis.core.StopFilter\",[\n{\n              \"text\":\"Concocting\",\n              \"raw_bytes\":\"[43 6f 6e 63 6f 63 74 69 6e 67]\",\n              \"position\":1,\n              \"positionHistory\":[1,\n                1],\n              \"start\":0,\n              \"end\":10,\n              \"type\":\"word\"}\n,\n            \n{\n              \"text\":\"Solution\",\n              \"raw_bytes\":\"[53 6f 6c 75 74 69 6f 6e]\",\n              \"position\":4,\n              \"positionHistory\":[4,\n                4],\n              \"start\":17,\n              \"end\":25,\n              \"type\":\"word\"}\n,\n            \n{\n              \"text\":\"Tricks\",\n              \"raw_bytes\":\"[54 72 69 63 6b 73]\",\n              \"position\":5,\n              \"positionHistory\":[5,\n                5],\n              \"start\":26,\n              \"end\":32,\n              \"type\":\"word\"}\n],\n          \"org.apache.lucene.analysis.miscellaneous.WordDelimiterFilter\",[\n{\n              \"text\":\"Concocting\",\n              \"raw_bytes\":\"[43 6f 6e 63 6f 63 74 69 6e 67]\",\n              \"start\":0,\n              \"end\":10,\n              \"type\":\"word\",\n              \"position\":1,\n              \"positionHistory\":[1,\n                1,\n                1]}\n,\n            \n{\n              \"text\":\"Solution\",\n              \"raw_bytes\":\"[53 6f 6c 75 74 69 6f 6e]\",\n              \"start\":17,\n              \"end\":25,\n              \"type\":\"word\",\n              \"position\":4,\n              \"positionHistory\":[4,\n                4,\n                4]}\n,\n            \n{\n              \"text\":\"Tricks\",\n              \"raw_bytes\":\"[54 72 69 63 6b 73]\",\n              \"start\":26,\n              \"end\":32,\n              \"type\":\"word\",\n              \"position\":5,\n              \"positionHistory\":[5,\n                5,\n                5]}\n],\n          \"org.apache.lucene.analysis.icu.ICUFoldingFilter\",[\n{\n              \"text\":\"concocting\",\n              \"raw_bytes\":\"[63 6f 6e 63 6f 63 74 69 6e 67]\",\n              \"position\":1,\n              \"positionHistory\":[1,\n                1,\n                1,\n                1],\n              \"start\":0,\n              \"end\":10,\n              \"type\":\"word\"}\n,\n            \n{\n              \"text\":\"solution\",\n              \"raw_bytes\":\"[73 6f 6c 75 74 69 6f 6e]\",\n              \"position\":4,\n              \"positionHistory\":[4,\n                4,\n                4,\n                4],\n              \"start\":17,\n              \"end\":25,\n              \"type\":\"word\"}\n,\n            \n{\n              \"text\":\"tricks\",\n              \"raw_bytes\":\"[74 72 69 63 6b 73]\",\n              \"position\":5,\n              \"positionHistory\":[5,\n                5,\n                5,\n                5],\n              \"start\":26,\n              \"end\":32,\n              \"type\":\"word\"}\n],\n          \"org.apache.lucene.analysis.en.EnglishPossessiveFilter\",[\n{\n              \"text\":\"concocting\",\n              \"raw_bytes\":\"[63 6f 6e 63 6f 63 74 69 6e 67]\",\n              \"position\":1,\n              \"positionHistory\":[1,\n                1,\n                1,\n                1,\n                1],\n              \"start\":0,\n              \"end\":10,\n              \"type\":\"word\"}\n,\n            \n{\n              \"text\":\"solution\",\n              \"raw_bytes\":\"[73 6f 6c 75 74 69 6f 6e]\",\n              \"position\":4,\n              \"positionHistory\":[4,\n                4,\n                4,\n                4,\n                4],\n              \"start\":17,\n              \"end\":25,\n              \"type\":\"word\"}\n,\n            \n{\n              \"text\":\"tricks\",\n              \"raw_bytes\":\"[74 72 69 63 6b 73]\",\n              \"position\":5,\n              \"positionHistory\":[5,\n                5,\n                5,\n                5,\n                5],\n              \"start\":26,\n              \"end\":32,\n              \"type\":\"word\"}\n],\n          \"org.apache.lucene.analysis.en.PorterStemFilter\",[\n{\n              \"text\":\"concoct\",\n              \"raw_bytes\":\"[63 6f 6e 63 6f 63 74]\",\n              \"org.apache.lucene.analysis.tokenattributes.KeywordAttribute#keyword\":false,\n              \"position\":1,\n              \"positionHistory\":[1,\n                1,\n                1,\n                1,\n                1,\n                1],\n              \"start\":0,\n              \"end\":10,\n              \"type\":\"word\"}\n,\n            \n{\n              \"text\":\"solut\",\n              \"raw_bytes\":\"[73 6f 6c 75 74]\",\n              \"match\":true,\n              \"org.apache.lucene.analysis.tokenattributes.KeywordAttribute#keyword\":false,\n              \"position\":4,\n              \"positionHistory\":[4,\n                4,\n                4,\n                4,\n                4,\n                4],\n              \"start\":17,\n              \"end\":25,\n              \"type\":\"word\"}\n,\n            \n{\n              \"text\":\"trick\",\n              \"raw_bytes\":\"[74 72 69 63 6b]\",\n              \"match\":true,\n              \"org.apache.lucene.analysis.tokenattributes.KeywordAttribute#keyword\":false,\n              \"position\":5,\n              \"positionHistory\":[5,\n                5,\n                5,\n                5,\n                5,\n                5],\n              \"start\":26,\n              \"end\":32,\n              \"type\":\"word\"}\n]],\n        \"query\":[\n          \"org.apache.lucene.analysis.charfilter.HTMLStripCharFilter\",\"a Solution Tricks\",\n          \"org.apache.lucene.analysis.core.WhitespaceTokenizer\",[\n{\n              \"text\":\"a\",\n              \"raw_bytes\":\"[61]\",\n              \"start\":0,\n              \"end\":1,\n              \"position\":1,\n              \"positionHistory\":[1],\n              \"type\":\"word\"}\n,\n            \n{\n              \"text\":\"Solution\",\n              \"raw_bytes\":\"[53 6f 6c 75 74 69 6f 6e]\",\n              \"start\":2,\n              \"end\":10,\n              \"position\":2,\n              \"positionHistory\":[2],\n              \"type\":\"word\"}\n,\n            \n{\n              \"text\":\"Tricks\",\n              \"raw_bytes\":\"[54 72 69 63 6b 73]\",\n              \"start\":11,\n              \"end\":17,\n              \"position\":3,\n              \"positionHistory\":[3],\n              \"type\":\"word\"}\n],\n          \"org.apache.lucene.analysis.core.StopFilter\",[\n{\n              \"text\":\"Solution\",\n              \"raw_bytes\":\"[53 6f 6c 75 74 69 6f 6e]\",\n              \"position\":2,\n              \"positionHistory\":[2,\n                2],\n              \"start\":2,\n              \"end\":10,\n              \"type\":\"word\"}\n,\n            \n{\n              \"text\":\"Tricks\",\n              \"raw_bytes\":\"[54 72 69 63 6b 73]\",\n              \"position\":3,\n              \"positionHistory\":[3,\n                3],\n              \"start\":11,\n              \"end\":17,\n              \"type\":\"word\"}\n],\n          \"org.apache.lucene.analysis.miscellaneous.WordDelimiterFilter\",[\n{\n              \"text\":\"Solution\",\n              \"raw_bytes\":\"[53 6f 6c 75 74 69 6f 6e]\",\n              \"start\":2,\n              \"end\":10,\n              \"type\":\"word\",\n              \"position\":2,\n              \"positionHistory\":[2,\n                2,\n                2]}\n,\n            \n{\n              \"text\":\"Tricks\",\n              \"raw_bytes\":\"[54 72 69 63 6b 73]\",\n              \"start\":11,\n              \"end\":17,\n              \"type\":\"word\",\n              \"position\":3,\n              \"positionHistory\":[3,\n                3,\n                3]}\n],\n          \"org.apache.lucene.analysis.icu.ICUFoldingFilter\",[\n{\n              \"text\":\"solution\",\n              \"raw_bytes\":\"[73 6f 6c 75 74 69 6f 6e]\",\n              \"position\":2,\n              \"positionHistory\":[2,\n                2,\n                2,\n                2],\n              \"start\":2,\n              \"end\":10,\n              \"type\":\"word\"}\n,\n            \n{\n              \"text\":\"tricks\",\n              \"raw_bytes\":\"[74 72 69 63 6b 73]\",\n              \"position\":3,\n              \"positionHistory\":[3,\n                3,\n                3,\n                3],\n              \"start\":11,\n              \"end\":17,\n              \"type\":\"word\"}\n],\n          \"org.apache.lucene.analysis.en.EnglishPossessiveFilter\",[\n{\n              \"text\":\"solution\",\n              \"raw_bytes\":\"[73 6f 6c 75 74 69 6f 6e]\",\n              \"position\":2,\n              \"positionHistory\":[2,\n                2,\n                2,\n                2,\n                2],\n              \"start\":2,\n              \"end\":10,\n              \"type\":\"word\"}\n,\n            \n{\n              \"text\":\"tricks\",\n              \"raw_bytes\":\"[74 72 69 63 6b 73]\",\n              \"position\":3,\n              \"positionHistory\":[3,\n                3,\n                3,\n                3,\n                3],\n              \"start\":11,\n              \"end\":17,\n              \"type\":\"word\"}\n],\n          \"org.apache.lucene.analysis.en.PorterStemFilter\",[\n{\n              \"text\":\"solut\",\n              \"raw_bytes\":\"[73 6f 6c 75 74]\",\n              \"org.apache.lucene.analysis.tokenattributes.KeywordAttribute#keyword\":false,\n              \"position\":2,\n              \"positionHistory\":[2,\n                2,\n                2,\n                2,\n                2,\n                2],\n              \"start\":2,\n              \"end\":10,\n              \"type\":\"word\"}\n,\n            \n{\n              \"text\":\"trick\",\n              \"raw_bytes\":\"[74 72 69 63 6b]\",\n              \"org.apache.lucene.analysis.tokenattributes.KeywordAttribute#keyword\":false,\n              \"position\":3,\n              \"positionHistory\":[3,\n                3,\n                3,\n                3,\n                3,\n                3],\n              \"start\":11,\n              \"end\":17,\n              \"type\":\"word\"}\n]]}},\n    \"field_names\":{}}}\n\nThe latter json does show up correctly in the analysis page whereas the former doesn't show up correctly.\nEspecially if the text involved in analysis involves StopWords.",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "author": "Alexandre Rafalovitch",
            "id": "comment-14341653",
            "date": "2015-02-28T17:03:17+0000",
            "content": "Is this still relevant/reproducible with latest Solr? "
        },
        {
            "author": "Swami Rajamohan",
            "id": "comment-14341677",
            "date": "2015-02-28T17:32:57+0000",
            "content": "I haven't checked it in the latest release. We still are using Solr 4.6.1. I will check it on Solr 5 and let you know sometime later this week.\n\nThanks\nSwami "
        },
        {
            "author": "Alexandre Rafalovitch",
            "id": "comment-15557155",
            "date": "2016-10-08T04:29:56+0000",
            "content": "Can you check this against latest Solr? If the problem is still there, I will try working on it soon. "
        }
    ]
}