{
    "id": "SOLR-10050",
    "title": "SolrMetricManagerTest.testClearMetrics() failures",
    "details": {
        "labels": "",
        "priority": "Major",
        "components": [],
        "type": "Bug",
        "fix_versions": [
            "6.4.1",
            "7.0"
        ],
        "affect_versions": "None",
        "resolution": "Fixed",
        "status": "Closed"
    },
    "description": "My Jenkins found a few reproducing seeds on branch_6x:\n\n\nChecking out Revision 71a198ce309e35c8b31bf472b3d111dbaed276bf (refs/remotes/origin/branch_6x)\n[...]\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=SolrMetricManagerTest -Dtests.method=testClearMetrics -Dtests.seed=879417477ADA78A -Dtests.slow=true -Dtests.locale=hu-HU -Dtests.timezone=Etc/GMT-12 -Dtests.asserts=true -Dtests.file.encoding=UTF-8\n   [junit4] FAILURE 0.02s J7  | SolrMetricManagerTest.testClearMetrics <<<\n   [junit4]    > Throwable #1: java.lang.AssertionError: expected:<39> but was:<40>\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([879417477ADA78A:4CDBC6CB0FCA5C7A]:0)\n   [junit4]    > \tat org.apache.solr.metrics.SolrMetricManagerTest.testClearMetrics(SolrMetricManagerTest.java:148)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n[...]\n   [junit4]   2> NOTE: test params are: codec=Asserting(Lucene62): {}, docValues:{}, maxPointsInLeafNode=272, maxMBSortInHeap=5.863267302539228, sim=RandomSimilarity(queryNorm=true,coord=yes): {}, locale=hu-HU, timezone=Etc/GMT-12\n   [junit4]   2> NOTE: Linux 4.1.0-custom2-amd64 amd64/Oracle Corporation 1.8.0_77 (64-bit)/cpus=16,threads=1,free=188875912,total=532676608\n\n\n\n\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=SolrMetricManagerTest -Dtests.method=testClearMetrics -Dtests.seed=65C475A371EC81A -Dtests.slow=true -Dtests.locale=hu-HU -Dtests.timezone=Navajo -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1\n   [junit4] FAILURE 0.02s J1  | SolrMetricManagerTest.testClearMetrics <<<\n   [junit4]    > Throwable #1: java.lang.AssertionError: expected:<88> but was:<89>\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([65C475A371EC81A:42FEC0E54F7933EA]:0)\n   [junit4]    > \tat org.apache.solr.metrics.SolrMetricManagerTest.testClearMetrics(SolrMetricManagerTest.java:153)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n[...]\n   [junit4]   2> NOTE: test params are: codec=Asserting(Lucene62): {}, docValues:{}, maxPointsInLeafNode=301, maxMBSortInHeap=7.952699675565061, sim=RandomSimilarity(queryNorm=true,coord=crazy): {}, locale=hu-HU, timezone=Navajo\n   [junit4]   2> NOTE: Linux 4.1.0-custom2-amd64 amd64/Oracle Corporation 1.8.0_77 (64-bit)/cpus=16,threads=1,free=300509048,total=522190848\n\n\n\n\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=SolrMetricManagerTest -Dtests.method=testClearMetrics -Dtests.seed=B0DA54EC22D7F653 -Dtests.slow=true -Dtests.locale=sr-Latn-RS -Dtests.timezone=Brazil/DeNoronha -Dtests.asserts=true -Dtests.file.encoding=UTF-8\n   [junit4] FAILURE 0.01s J1  | SolrMetricManagerTest.testClearMetrics <<<\n   [junit4]    > Throwable #1: java.lang.AssertionError: expected:<99> but was:<100>\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([B0DA54EC22D7F653:F478D3535AB00DA3]:0)\n   [junit4]    > \tat org.apache.solr.metrics.SolrMetricManagerTest.testClearMetrics(SolrMetricManagerTest.java:153)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n[...]\n   [junit4]   2> NOTE: test params are: codec=Asserting(Lucene62), sim=RandomSimilarity(queryNorm=false,coord=no): {}, locale=sr-Latn-RS, timezone=Brazil/DeNoronha\n   [junit4]   2> NOTE: Linux 4.1.0-custom2-amd64 amd64/Oracle Corporation 1.8.0_77 (64-bit)/cpus=16,threads=1,free=94384672,total=530579456\n\n\n\n\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=SolrMetricManagerTest -Dtests.method=testClearMetrics -Dtests.seed=A6AAEEECA8D06DA2 -Dtests.slow=true -Dtests.locale=hi-IN -Dtests.timezone=Asia/Kashgar -Dtests.asserts=true -Dtests.file.encoding=UTF-8\n   [junit4] FAILURE 0.05s J11 | SolrMetricManagerTest.testClearMetrics <<<\n   [junit4]    > Throwable #1: java.lang.AssertionError: expected:<84> but was:<85>\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([A6AAEEECA8D06DA2:E2086953D0B79652]:0)\n   [junit4]    > \tat org.apache.solr.metrics.SolrMetricManagerTest.testClearMetrics(SolrMetricManagerTest.java:148)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n[...]\n   [junit4]   2> NOTE: test params are: codec=Asserting(Lucene62): {}, docValues:{}, maxPointsInLeafNode=227, maxMBSortInHeap=5.302052421974835, sim=RandomSimilarity(queryNorm=false,coord=crazy): {}, locale=hi-IN, timezone=Asia/Kashgar\n   [junit4]   2> NOTE: Linux 4.1.0-custom2-amd64 amd64/Oracle Corporation 1.8.0_77 (64-bit)/cpus=16,threads=1,free=210418072,total=530579456\n\n\n\nAnd Policeman Jenkins, on master https://jenkins.thetaphi.de/job/Lucene-Solr-master-Linux/18859/:\n\n\nChecking out Revision d9741205b5a39a5d0d4f63698adfcabe0a6a5892 (refs/remotes/origin/master)\n[...]\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=SolrIndexMetricsTest -Dtests.method=testIndexMetrics -Dtests.seed=D034F5D8C42E161F -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=fr-RE -Dtests.timezone=Etc/GMT-2 -Dtests.asserts=true -Dtests.file.encoding=UTF-8\n   [junit4] FAILURE 3.84s J1 | SolrIndexMetricsTest.testIndexMetrics <<<\n   [junit4]    > Throwable #1: java.lang.AssertionError\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([D034F5D8C42E161F:1CE4C86404A0ED24]:0)\n   [junit4]    > \tat org.apache.solr.update.SolrIndexMetricsTest.testIndexMetrics(SolrIndexMetricsTest.java:66)\n   [junit4]    > \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n   [junit4]    > \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n   [junit4]    > \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n   [junit4]    > \tat java.base/java.lang.reflect.Method.invoke(Method.java:543)\n   [junit4]    > \tat java.base/java.lang.Thread.run(Thread.java:844)\n[...]\n   [junit4]   2> NOTE: test params are: codec=SimpleText, sim=RandomSimilarity(queryNorm=true): {}, locale=fr-RE, timezone=Etc/GMT-2\n   [junit4]   2> NOTE: Linux 4.4.0-53-generic amd64/Oracle Corporation 9-ea (64-bit)/cpus=12,threads=1,free=376499248,total=526385152",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "date": "2017-01-30T12:21:02+0000",
            "content": "Commit 1eca9e232a7f2dd36b3329942ffd4bcea4e17b76 in lucene-solr's branch refs/heads/branch_6x from Andrzej Bialecki \n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1eca9e2 ]\n\nSOLR-10050 Fix SolrMetricManagerTest.testClearMetrics() failures. ",
            "author": "ASF subversion and git services",
            "id": "comment-15845119"
        },
        {
            "date": "2017-01-30T12:23:12+0000",
            "content": "Commit f73d93ac1b30d354c0a9633225470fbb7799f480 in lucene-solr's branch refs/heads/master from Andrzej Bialecki \n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f73d93a ]\n\nSOLR-10050 Fix SolrMetricManagerTest.testClearMetrics() failures. ",
            "author": "ASF subversion and git services",
            "id": "comment-15845121"
        },
        {
            "date": "2017-01-30T12:25:22+0000",
            "content": "Thanks Steve - SimpleText codec didn't use as many files as expected, and the other failures were caused by a metric prefix \"foo.bar\" partially matching auto-generated names like \"foo.bar_testing\". ",
            "author": "Andrzej Bialecki",
            "id": "comment-15845124"
        },
        {
            "date": "2017-03-03T18:37:05+0000",
            "content": "Looks like the fix on this issue didn't get backported to branch_6_4 - this branch_6_4 Policeman Jenkins failure https://jenkins.thetaphi.de/job/Lucene-Solr-6.4-Linux/127/ reproduces for me only on branch_6_4, not on branch_6x or master - (this does not warrant respin of the 6.4.2 release IMO):\n\n\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=SolrMetricManagerTest -Dtests.method=testClearMetrics -Dtests.seed=5E4DC1CB554046AD -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=fr-MA -Dtests.timezone=PST8PDT -Dtests.asserts=true -Dtests.file.encoding=UTF-8\n   [junit4] FAILURE 0.01s J1 | SolrMetricManagerTest.testClearMetrics <<<\n   [junit4]    > Throwable #1: java.lang.AssertionError: expected:<88> but was:<89>\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([5E4DC1CB554046AD:1AEF46742D27BD5D]:0)\n   [junit4]    > \tat org.apache.solr.metrics.SolrMetricManagerTest.testClearMetrics(SolrMetricManagerTest.java:141)\n   [junit4]    > \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n   [junit4]    > \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n   [junit4]    > \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n   [junit4]    > \tat java.base/java.lang.reflect.Method.invoke(Method.java:547)\n[...]\n   [junit4]   2> NOTE: test params are: codec=Asserting(Lucene62): {}, docValues:{}, maxPointsInLeafNode=136, maxMBSortInHeap=6.422318540018317, sim=RandomSimilarity(queryNorm=false,coord=crazy): {}, locale=fr-MA, timezone=PST8PDT\n   [junit4]   2> NOTE: Linux 4.4.0-53-generic i386/Oracle Corporation 9-ea (32-bit)/cpus=12,threads=1,free=129315424,total=463159296\n\n ",
            "author": "Steve Rowe",
            "id": "comment-15894825"
        }
    ]
}