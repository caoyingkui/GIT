{
    "id": "SOLR-6898",
    "title": "Delete by ID not working in solrcloud setup",
    "details": {
        "components": [],
        "type": "Bug",
        "labels": "",
        "fix_versions": [],
        "affect_versions": "4.10.2",
        "status": "Closed",
        "resolution": "Invalid",
        "priority": "Major"
    },
    "description": "Issuing delete by id commands doesn't seem to do anything. I see the messages go through, and everything is logged like it should work, but nothing is deleted. Here are the solr logs for the delete by id commands:\n\n\n272618272 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{wt=javabin&version=2} {delete=[584 (-1488860136778760192)]} 0 0\n272618275 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={wt=javabin&version=2}\n \n{delete=[591 (-1488860136781905920)]}\n 0 0\n272618283 [qtp2032251042-14] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{update.distrib=TOLEADER&distrib.from=http://10.0.4.205:8983/solr/products/&wt=javabin&version=2}\n \n{delete=[593 (-1488860136789245952)]}\n 0 1\n272618291 [qtp2032251042-14] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{update.distrib=TOLEADER&distrib.from=http://10.0.4.205:8983/solr/products/&wt=javabin&version=2}\n \n{delete=[778 (-1488860136798683136)]}\n 0 0\n272618298 [qtp2032251042-321] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{update.distrib=TOLEADER&distrib.from=http://10.0.6.228:8983/solr/products/&wt=javabin&version=2}\n \n{delete=[791 (-1488860136806023168)]}\n 0 0\n272618306 [qtp2032251042-14] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{update.distrib=TOLEADER&distrib.from=http://10.0.4.205:8983/solr/products/&wt=javabin&version=2}\n \n{delete=[1006 (-1488860136814411776)]}\n 0 0\n272618313 [qtp2032251042-321] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{update.distrib=TOLEADER&distrib.from=http://10.0.6.228:8983/solr/products/&wt=javabin&version=2}\n \n{delete=[1246 (-1488860136821751808)]}\n 0 1\n272618315 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{wt=javabin&version=2} {delete=[1334 (-1488860136823848960)]} 0 0\n272618319 [qtp2032251042-321] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={update.distrib=TOLEADER&distrib.from=http://10.0.6.228:8983/solr/products/&wt=javabin&version=2} {delete=[1449 (-1488860136828043264)]} 0 0\n272618325 [qtp2032251042-14] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={update.distrib=TOLEADER&distrib.from=http://10.0.4.205:8983/solr/products/&wt=javabin&version=2} {delete=[1491 (-1488860136834334720)]} 0 0\n272618330 [qtp2032251042-321] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={update.distrib=TOLEADER&distrib.from=http://10.0.6.228:8983/solr/products/&wt=javabin&version=2} {delete=[1895 (-1488860136839577600)]} 0 0\n272618336 [qtp2032251042-14] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={update.distrib=TOLEADER&distrib.from=http://10.0.4.205:8983/solr/products/&wt=javabin&version=2} {delete=[2016 (-1488860136845869056)]} 0 0\n272618340 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={wt=javabin&version=2}\n \n{delete=[2178 (-1488860136850063360)]}\n 0 0\n272618342 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{wt=javabin&version=2} {delete=[2179 (-1488860136852160512)]} 0 0\n272618347 [qtp2032251042-14] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={update.distrib=TOLEADER&distrib.from=http://10.0.4.205:8983/solr/products/&wt=javabin&version=2} {delete=[2220 (-1488860136857403392)]} 0 0\n272618351 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={wt=javabin&version=2}\n \n{delete=[2494 (-1488860136861597696)]}\n 0 0\n272618354 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{wt=javabin&version=2} {delete=[2638 (-1488860136864743424)]} 0 0\n272618357 [qtp2032251042-321] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={update.distrib=TOLEADER&distrib.from=http://10.0.6.228:8983/solr/products/&wt=javabin&version=2} {delete=[2647 (-1488860136867889152)]} 0 0\n272618361 [qtp2032251042-321] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={update.distrib=TOLEADER&distrib.from=http://10.0.6.228:8983/solr/products/&wt=javabin&version=2} {delete=[2831 (-1488860136872083456)]} 0 0\n272618364 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={wt=javabin&version=2}\n \n{delete=[2934 (-1488860136875229184)]}\n 0 0\n272618366 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{wt=javabin&version=2} {delete=[2942 (-1488860136877326336)]} 0 0\n272618368 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={wt=javabin&version=2}\n \n{delete=[3021 (-1488860136879423488)]}\n 0 0\n272618370 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{wt=javabin&version=2} {delete=[3063 (-1488860136881520640)]} 0 0\n272618376 [qtp2032251042-14] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={update.distrib=TOLEADER&distrib.from=http://10.0.4.205:8983/solr/products/&wt=javabin&version=2} {delete=[3099 (-1488860136887812096)]} 0 0\n272618382 [qtp2032251042-14] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={update.distrib=TOLEADER&distrib.from=http://10.0.4.205:8983/solr/products/&wt=javabin&version=2} {delete=[3114 (-1488860136894103552)]} 0 0\n272618389 [qtp2032251042-14] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={update.distrib=TOLEADER&distrib.from=http://10.0.4.205:8983/solr/products/&wt=javabin&version=2} {delete=[3116 (-1488860136901443584)]} 0 1\n272618395 [qtp2032251042-14] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={update.distrib=TOLEADER&distrib.from=http://10.0.4.205:8983/solr/products/&wt=javabin&version=2} {delete=[3131 (-1488860136907735040)]} 0 0\n272618402 [qtp2032251042-14] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={update.distrib=TOLEADER&distrib.from=http://10.0.4.205:8983/solr/products/&wt=javabin&version=2} {delete=[3171 (-1488860136915075072)]} 0 0\n272618406 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={wt=javabin&version=2}\n \n{delete=[3244 (-1488860136919269376)]}\n 0 0\n272618410 [qtp2032251042-321] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{update.distrib=TOLEADER&distrib.from=http://10.0.6.228:8983/solr/products/&wt=javabin&version=2}\n \n{delete=[3589 (-1488860136923463680)]}\n 0 0\n272618413 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{wt=javabin&version=2} {delete=[3636 (-1488860136926609408)]} 0 0\n272618415 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={wt=javabin&version=2}\n \n{delete=[3679 (-1488860136928706560)]}\n 0 0\n272618417 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{wt=javabin&version=2} {delete=[3937 (-1488860136930803712)]} 0 0\n272618419 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={wt=javabin&version=2}\n \n{delete=[3949 (-1488860136932900864)]}\n 0 0\n272618424 [qtp2032251042-14] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{update.distrib=TOLEADER&distrib.from=http://10.0.4.205:8983/solr/products/&wt=javabin&version=2}\n \n{delete=[4117 (-1488860136938143744)]}\n 0 0\n272618430 [qtp2032251042-321] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{update.distrib=TOLEADER&distrib.from=http://10.0.6.228:8983/solr/products/&wt=javabin&version=2}\n \n{delete=[4337 (-1488860136944435200)]}\n 0 0\n272618436 [qtp2032251042-14] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{update.distrib=TOLEADER&distrib.from=http://10.0.4.205:8983/solr/products/&wt=javabin&version=2}\n \n{delete=[4340 (-1488860136949678080)]}\n 0 1\n272618441 [qtp2032251042-321] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{update.distrib=TOLEADER&distrib.from=http://10.0.6.228:8983/solr/products/&wt=javabin&version=2}\n \n{delete=[4363 (-1488860136955969536)]}\n 0 0\n272618446 [qtp2032251042-14] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{update.distrib=TOLEADER&distrib.from=http://10.0.4.205:8983/solr/products/&wt=javabin&version=2}\n \n{delete=[4369 (-1488860136961212416)]}\n 0 0\n272618452 [qtp2032251042-321] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{update.distrib=TOLEADER&distrib.from=http://10.0.6.228:8983/solr/products/&wt=javabin&version=2}\n \n{delete=[4375 (-1488860136967503872)]}\n 0 0\n272618458 [qtp2032251042-14] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{update.distrib=TOLEADER&distrib.from=http://10.0.4.205:8983/solr/products/&wt=javabin&version=2}\n \n{delete=[4522 (-1488860136973795328)]}\n 0 0\n272618465 [qtp2032251042-14] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{update.distrib=TOLEADER&distrib.from=http://10.0.4.205:8983/solr/products/&wt=javabin&version=2}\n \n{delete=[4556 (-1488860136981135360)]}\n 0 0\n272618469 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{wt=javabin&version=2} {delete=[4562 (-1488860136984281088)]} 0 1\n272618472 [qtp2032251042-321] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={update.distrib=TOLEADER&distrib.from=http://10.0.6.228:8983/solr/products/&wt=javabin&version=2} {delete=[4569 (-1488860136988475392)]} 0 0\n272618478 [qtp2032251042-14] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={update.distrib=TOLEADER&distrib.from=http://10.0.4.205:8983/solr/products/&wt=javabin&version=2} {delete=[4587 (-1488860136994766848)]} 0 0\n272618482 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={wt=javabin&version=2}\n \n{delete=[4677 (-1488860136998961152)]}\n 0 0\n272618485 [qtp2032251042-321] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{update.distrib=TOLEADER&distrib.from=http://10.0.6.228:8983/solr/products/&wt=javabin&version=2}\n \n{delete=[4688 (-1488860137002106880)]}\n 0 0\n272618491 [qtp2032251042-14] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{update.distrib=TOLEADER&distrib.from=http://10.0.4.205:8983/solr/products/&wt=javabin&version=2}\n \n{delete=[4862 (-1488860137008398336)]}\n 0 0\n272618496 [qtp2032251042-321] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{update.distrib=TOLEADER&distrib.from=http://10.0.6.228:8983/solr/products/&wt=javabin&version=2}\n \n{delete=[4866 (-1488860137013641216)]}\n 0 0\n272618499 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{wt=javabin&version=2} {delete=[4944 (-1488860137016786944)]} 0 0\n272618501 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={wt=javabin&version=2}\n \n{delete=[5038 (-1488860137018884096)]}\n 0 0\n272618503 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{wt=javabin&version=2} {delete=[5066 (-1488860137020981248)]} 0 0\n272618507 [qtp2032251042-321] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={update.distrib=TOLEADER&distrib.from=http://10.0.6.228:8983/solr/products/&wt=javabin&version=2} {delete=[5118 (-1488860137025175552)]} 0 0\n272618509 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={wt=javabin&version=2}\n \n{delete=[5136 (-1488860137027272704)]}\n 0 0\n272618513 [qtp2032251042-321] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{update.distrib=TOLEADER&distrib.from=http://10.0.6.228:8983/solr/products/&wt=javabin&version=2}\n \n{delete=[5137 (-1488860137031467008)]}\n 0 0\n272618516 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{wt=javabin&version=2} {delete=[5366 (-1488860137034612736)]} 0 0\n272618518 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={wt=javabin&version=2}\n \n{delete=[5486 (-1488860137036709888)]}\n 0 0\n272618523 [qtp2032251042-14] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{update.distrib=TOLEADER&distrib.from=http://10.0.4.205:8983/solr/products/&wt=javabin&version=2}\n \n{delete=[5513 (-1488860137041952768)]}\n 0 0\n272618527 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{wt=javabin&version=2} {delete=[5946 (-1488860137046147072)]} 0 0\n272618531 [qtp2032251042-321] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={update.distrib=TOLEADER&distrib.from=http://10.0.6.228:8983/solr/products/&wt=javabin&version=2} {delete=[6347 (-1488860137050341376)]} 0 0\n272618534 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params={wt=javabin&version=2}\n \n{delete=[6389 (-1488860137053487104)]}\n 0 0\n272618539 [qtp2032251042-14] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{update.distrib=TOLEADER&distrib.from=http://10.0.4.205:8983/solr/products/&wt=javabin&version=2}\n \n{delete=[6392 (-1488860137058729984)]}\n 0 0\n272619272 [commitScheduler-13-thread-1] INFO  org.apache.solr.update.UpdateHandler  ? start commit\n{,optimize=false,openSearcher=false,waitSearcher=true,expungeDeletes=false,softCommit=true,prepareCommit=false}\n272619273 [commitScheduler-13-thread-1] INFO  org.apache.solr.core.SolrCore  ? SolrIndexSearcher has not changed - not re-opening: org.apache.solr.search.SolrIndexSearcher\n272619273 [commitScheduler-13-thread-1] INFO  org.apache.solr.update.UpdateHandler  ? end_commit_flush\n272633272 [commitScheduler-12-thread-1] INFO  org.apache.solr.update.UpdateHandler  ? start commit\n{,optimize=false,openSearcher=false,waitSearcher=true,expungeDeletes=false,softCommit=false,prepareCommit=false}\n272633273 [commitScheduler-12-thread-1] INFO  org.apache.solr.update.UpdateHandler  ? No uncommitted changes. Skipping IW.commit.\n272633273 [commitScheduler-12-thread-1] INFO  org.apache.solr.update.UpdateHandler  ? end_commit_flush\n\n\nNow, if I delete by query, everything is fine and documents are removed. Here are the logs that came out of that:\n\n272993646 [qtp2032251042-12] INFO  org.apache.solr.update.processor.LogUpdateProcessor  ? [products] webapp=/solr path=/update params=\n{wt=json}\n \n{deleteByQuery=id:584 (-1488860530367004672),deleteByQuery=id:584 (-1488860530369101824),deleteByQuery=id:593 (-148886053036\n9101825),deleteByQuery=id:778 (-1488860530370150400),deleteByQuery=id:791 (-1488860530370150401),deleteByQuery=id:1006 (-1488860530371198976),deleteByQuery=id:1246 (-1488860530371198977),deleteByQuery=id:1334 (-1488860530372247552),deleteByQuery=id:1449 (-148886053037\n2247553),deleteByQuery=id:1491 (-1488860530375393280)}\n 0 19\n\n\nThe delete by id commands were generated by the following camel route:\n\nfrom(\"direct:search:removeDeleted\")\n\t\t\t\t.routeId(\"search:removeDeleted\")\n\t\t\t\t.beanRef(\"deletedProductsFinder\", \"findDeleted\")\n\t\t\t\t.setHeader(SolrConstants.OPERATION, constant(SolrConstants.OPERATION_DELETE_BY_ID))\n\t\t\t\t.split().body()\n\t\t\t\t.recipientList(method(\"solrServerFinder\", \"getServerEndpoint\"));\n\nThe solr server list is dynamically looked up, and the findDeleted method just returns a list of Integer ids that should be deleted. \n\nThe delete by query was manually generated and run through the solr admin.",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "date": "2016-09-23T19:29:02+0000",
            "author": "Jan H\u00f8ydahl",
            "content": "Closing ancient ticket.\nQuestions like this should always be raised in the solr-user mailing list before creating a JIRA issue. If you still face problems with delete by ID, please send an email to the list. ",
            "id": "comment-15517348"
        }
    ]
}