{
    "id": "SOLR-4320",
    "title": "NPE on spellcheck.count=0 for DirectSolrSpellChecker",
    "details": {
        "affect_versions": "4.0",
        "status": "Resolved",
        "fix_versions": [],
        "components": [
            "spellchecker"
        ],
        "type": "Bug",
        "priority": "Minor",
        "labels": "",
        "resolution": "Cannot Reproduce"
    },
    "description": "An NPE occurs if the spellcheck.count=0 parameter is specified when the spellcheck component is enabled with a DirectSolrSpellChecker spellchecker and a query term that has non-zero suggestions.\n\nRepro:\n\n1. Start with Solr 4.0 example.\n\n2. Add these sample documents:\n\n\ncurl http://localhost:8983/solr/update?commit=true -H 'Content-type:application/csv' -d '\nid,name\nspel-1,aardvark abacus ball bill cat cello\nspel-2,abate accord band bell cattle check\nspel-3,adorn border clean clock'\n\n\n\n3. Perform this spellcheck request:\n\n\ncurl \"http://localhost:8983/solr/spell/?q=catl&spellcheck.count=0&indent=true\"\n\n\n\n4. See the NPE at org.apache.lucene.search.spell.DirectSpellChecker.suggestSimilar line 409.\n\nResponse:\n\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<response>\n\n<lst name=\"responseHeader\">\n  <int name=\"status\">500</int>\n  <int name=\"QTime\">45</int>\n</lst>\n<result name=\"response\" numFound=\"0\" start=\"0\">\n</result>\n<lst name=\"error\">\n  <str name=\"trace\">java.lang.NullPointerException\n        at org.apache.lucene.search.spell.DirectSpellChecker.suggestSimilar(DirectSpellChecker.java:409)\n        at org.apache.lucene.search.spell.DirectSpellChecker.suggestSimilar(DirectSpellChecker.java:355)\n        at org.apache.solr.spelling.DirectSolrSpellChecker.getSuggestions(DirectSolrSpellChecker.java:189)\n        at org.apache.solr.spelling.ConjunctionSolrSpellChecker.getSuggestions(ConjunctionSolrSpellChecker.java:120)\n        at org.apache.solr.handler.component.SpellCheckComponent.process(SpellCheckComponent.java:172)\n        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:206)\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:129)\n        at org.apache.solr.core.RequestHandlers$LazyRequestHandlerWrapper.handleRequest(RequestHandlers.java:240)\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1699)\n        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:455)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:276)\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1337)\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:484)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:119)\n        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:524)\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:233)\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1065)\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:413)\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:192)\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:999)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:117)\n        at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:250)\n        at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:149)\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:111)\n        at org.eclipse.jetty.server.Server.handle(Server.java:351)\n        at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:454)\n        at org.eclipse.jetty.server.BlockingHttpConnection.handleRequest(BlockingHttpConnection.java:47)\n        at org.eclipse.jetty.server.AbstractHttpConnection.headerComplete(AbstractHttpConnection.java:890)\n        at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.headerComplete(AbstractHttpConnection.java:944)\n        at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:634)\n        at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:230)\n        at org.eclipse.jetty.server.BlockingHttpConnection.handle(BlockingHttpConnection.java:66)\n        at org.eclipse.jetty.server.bio.SocketConnector$ConnectorEndPoint.run(SocketConnector.java:254)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:599)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:534)\n        at java.lang.Thread.run(Unknown Source)\n</str>\n  <int name=\"code\">500</int>\n</lst>\n</response>",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "author": "Cassandra Targett",
            "id": "comment-16319241",
            "date": "2018-01-09T21:49:04+0000",
            "content": "I followed the steps outlined here, and don't get an NPE or any other type of error:\n\nhttp://localhost:8983/solr/test/spell?q=catl&spellcheck.count=0\n\n\n{\n  \"responseHeader\":{\n    \"zkConnected\":true,\n    \"status\":0,\n    \"QTime\":5},\n  \"response\":{\"numFound\":0,\"start\":0,\"maxScore\":0.0,\"docs\":[]\n  },\n  \"spellcheck\":{\n    \"suggestions\":[],\n    \"correctlySpelled\":false,\n    \"collations\":[]}}\n\n\n\nResolving as Cannot Reproduce. "
        }
    ]
}