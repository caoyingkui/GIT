{
    "id": "SOLR-10812",
    "title": "V2 API Collection API Improvements",
    "details": {
        "labels": "",
        "priority": "Major",
        "components": [
            "v2 API"
        ],
        "type": "Bug",
        "fix_versions": [],
        "affect_versions": "6.5",
        "resolution": "Won't Fix",
        "status": "Closed"
    },
    "description": "Observations when I hit : http://localhost:8983/v2/c/_introspect\n\n\tCan the default be indent=on?\n\tIntrospect documentation points to the ref guide: Where should the url point to now?\n\tThe experimental warning comes up three times\n\n\n\nFor the create action:\n\n\tThe \"required\" param only says name. It should have numShards or router ?\n\tMissing \"default\" values for replicationFactor / maxShardsPerNode / createNodeSet.shuffle\n\t\"Create collections and collection aliases, backup or restore collections, and delete collections and aliases\" - Replace the first and with a comma?\n\t\"These properties define how to distribute documents across a collection's shards.\" -> \"The router properties defines how documents are distributed across shards\" ?\n\t\"The compositeId option has Solr decide how to distribute documents (with some possibilities for customization)\" -> \"The 'compositeId' router hashes the value in the uniqueKey field with the additional ability to manually direct the routing\" ?\n\t\"The implicit option requires you define your own routing strategy, and puts the balancing of documents in shards entirely in your hands.\" -> \"The indexing client needs to specify for each document which shard should a document belong to\" ?\n\t\"numShards\"/\"replicationFactor\" says \"type\" as number. Should it be integer? maxShardsPerNode says integer\n\t\"Replicas are physical copies of each shard, acting as failover for the shard.\" -> ... \"and helps distribute query load\" ?\n\tEmpty description for \"snitch\" ? Maybe we should point it to a documentation page ?\n\t\"properties\" : the properties description seems to be vague? What does \"additionalProperties\" = true mean? It wasn't clear how to use it until I went to the test cases.\n\n\n\n\n\tI tried out the \"create\" command specified \"collection.configName\" param instead of the new \"config\" param . So when I tried it I got the following error which should be made easier to understand to our users as it didn't mention anything useful:\n\n\n\n\n~/solr-6.5.0$ curl -X POST -d '{create:{name: test_api, collection.configName: gettingstarted , shards: 1 }}' http://localhost:8983/v2/c\n<html>\n<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html;charset=utf-8\"/>\n<title>Error 400 {metadata={error-class=org.apache.solr.api.ApiBag$ExceptionWithErrObject,root-error-class=org.apache.solr.api.ApiBag$ExceptionWithErrObject},errorMessages=[{create={name=test_api, collection.configName=gettingstarted, shards=1}, errorMessages=[Expected type : string but found : 1in object : 1, Unknown field &apos;collection.configName&apos; in object : {\n  &quot;name&quot;:&quot;test_api&quot;,\n  &quot;collection.configName&quot;:&quot;gettingstarted&quot;,\n  &quot;shards&quot;:1}]}],msg=Error in command payload,code=400}</title>\n</head>\n<body><h2>HTTP ERROR 400</h2>\n<p>Problem accessing /solr/____v2/c. Reason:\n<pre>    {metadata={error-class=org.apache.solr.api.ApiBag$ExceptionWithErrObject,root-error-class=org.apache.solr.api.ApiBag$ExceptionWithErrObject},errorMessages=[{create={name=test_api, collection.configName=gettingstarted, shards=1}, errorMessages=[Expected type : string but found : 1in object : 1, Unknown field &apos;collection.configName&apos; in object : {\n  &quot;name&quot;:&quot;test_api&quot;,\n  &quot;collection.configName&quot;:&quot;gettingstarted&quot;,\n  &quot;shards&quot;:1}]}],msg=Error in command payload,code=400}</pre></p>\n</body>\n</html>\n\n\n\n\n\tNow I changed it tried the following command and got an error similar to the above error.\n\n\n\n\n\tShould the \"DELETE\" and \"GET\" operations show up when you hit http://localhost:8983/v2/collections/_introspect?command=create or http://localhost:8983/v2/collections/_introspect?command=create-alias ?\n\n\n\n\n\tI tried the backup-collection command and I got an error which seems to indicate that the location param is getting escaped? Also didn't see any tests for backup-collection\n\n\n\n\n~/solr-6.5.0$ curl -X POST -d '{backup-collection:{name: backup_test, collection: gettingstarted , location: '/Users/varunthacker/solr-6.5.0' }}' http://localhost:8983/v2/c\n<html>\n<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html;charset=utf-8\"/>\n<title>Error 400 {metadata={error-class=org.apache.solr.common.SolrException,root-error-class=org.noggit.JSONParser$ParseException},msg=org.noggit.JSONParser$ParseException: Invalid comment: expected //, /*, or #: char=U,position=79 BEFORE=&apos;{name: backup_test, collection: gettingstarted , location: /U&apos; AFTER=&apos;sers/varunthacker/solr-6.5.0 }}&apos;,code=400}</title>\n</head>\n<body><h2>HTTP ERROR 400</h2>\n<p>Problem accessing /solr/____v2/c. Reason:\n<pre>    {metadata={error-class=org.apache.solr.common.SolrException,root-error-class=org.noggit.JSONParser$ParseException},msg=org.noggit.JSONParser$ParseException: Invalid comment: expected //, /*, or #: char=U,position=79 BEFORE=&apos;{name: backup_test, collection: gettingstarted , location: /U&apos; AFTER=&apos;sers/varunthacker/solr-6.5.0 }}&apos;,code=400}</pre></p>\n</body>\n</html>\n\n\n\n\n\tWe have a \"create\" collection API and then a DELETE method to delete it. Should delete-alias be similar?",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "date": "2017-06-05T14:06:10+0000",
            "content": "Introspect documentation points to the ref guide: Where should the url point to now?\n\nWhen the new Ref Guide is published online, the specs should point to it. As of this exact moment, the old location is still valid.\n\nThe experimental warning comes up three times\n\nSee SOLR-10405.\n\n\"numShards\"/\"replicationFactor\" says \"type\" as number. Should it be integer? maxShardsPerNode says integer\n\nI think there are places where types are wrong in the specs. See SOLR-10411 for another example.\n\nI tried out the \"create\" command specified \"collection.configName\" param instead of the new \"config\" param . So when I tried it I got the following error which should be made easier to understand to our users as it didn't mention anything useful\n\nSee also SOLR-10435 and SOLR-10408.\n\nAs for all the comments about wording of descriptions - a lot of that was copied from the existing Ref Guide documentation, so where that is incomplete or wrong, the property descriptions are incomplete or wrong. Things have no defaults because the docs have no defaults, etc. IMO if you think it's wrong or missing, you can fix it, but probably in both places so there isn't a confusing disconnect if someone happens to look at both the spec and the docs.\n\nAs a side note, this is kind of a huge issue that's going to be hard for someone to address all at once. I think you may want to split out the problems into more actionable categories - docs, specs, errors, actual functionality (like 1 issue for your docs problems, 1 issue for type problems, etc.) - and create other issues (maybe sub-tasks if you like) that are easier for someone to pick up. Otherwise this is likely going to sit for 3 years until someone finally realizes it's obsolete because others ended up fixing it all with newer issues that were more focused. ",
            "author": "Cassandra Targett",
            "id": "comment-16036999"
        },
        {
            "date": "2017-06-05T17:45:11+0000",
            "content": "See SOLR-10405.\n\nGreat. Thanks for pointing it out!\n\nI think there are places where types are wrong in the specs. See SOLR-10411 for another example.\n\nLooks like both were only master . So maybe I'll do my testing on master .\n\nSee also SOLR-10435 and SOLR-10408.\n\nGreat. I'll post my examples of these example there.\n\nAs for all the comments about wording of descriptions - a lot of that was copied from the existing Ref Guide documentation\n\nactually some of them weren't and my alternate suggestions were mostly from the ref guide  I'll create a separate Jira for just copy edit fixes .\n\nAs a side note, this is kind of a huge issue that's going to be hard for someone to address all at once. I\n\n+1 . That was going to be my next step . i just wanted to try out the api yesterday and post my findings in one jira and then split them in subtasks. \n\n\nOverall I'm starting to like this a lot  ",
            "author": "Varun Thacker",
            "id": "comment-16037269"
        },
        {
            "date": "2017-06-05T19:31:26+0000",
            "content": "Created sub-tasks under SOLR-10432 ",
            "author": "Varun Thacker",
            "id": "comment-16037443"
        }
    ]
}