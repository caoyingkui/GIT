{
    "id": "LUCENE-7236",
    "title": "TestSpanCollection.testOrQuery() failure: Missing term field:w3",
    "details": {
        "resolution": "Fixed",
        "affect_versions": "None",
        "components": [],
        "labels": "",
        "fix_versions": [
            "6.1"
        ],
        "priority": "Major",
        "status": "Closed",
        "type": "Bug"
    },
    "description": "ASF & my Jenkins found reproducing seeds:\n\nFrom ASF Jenkins a week ago https://builds.apache.org/job/Lucene-Solr-NightlyTests-master/985/:\n\nChecking out Revision 67f6283ce418357938fc12d82783a3504ba700d7 (refs/remotes/origin/master)\n[...]\n [junit4] Suite: org.apache.lucene.search.spans.TestSpanCollection\n  [junit4]   2> NOTE: download the large Jenkins line-docs file by running 'ant get-jenkins-line-docs' in the lucene directory.\n  [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=TestSpanCollection -Dtests.method=testOrQuery -Dtests.seed=994C4307A532054C -Dtests.multiplier=2 -Dtests.nightly=true -Dtests.slow=true -Dtests.linedocsfile=/x1/jenkins/lucene-data/enwiki.random.lines.txt -Dtests.locale=fr-CH -Dtests.timezone=America/Winnipeg -Dtests.asserts=true -Dtests.file.encoding=US-ASCII\n  [junit4] FAILURE 0.08s J0 | TestSpanCollection.testOrQuery <<<\n  [junit4]    > Throwable #1: java.lang.AssertionError: Missing term field:w3\n  [junit4]    > \tat __randomizedtesting.SeedInfo.seed([994C4307A532054C:F928083254607004]:0)\n  [junit4]    > \tat org.apache.lucene.search.spans.TestSpanCollection.checkCollectedTerms(TestSpanCollection.java:103)\n  [junit4]    > \tat org.apache.lucene.search.spans.TestSpanCollection.testOrQuery(TestSpanCollection.java:147)\n  [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n  [junit4]   2> NOTE: test params are: codec=Lucene60, sim=RandomSimilarity(queryNorm=false,coord=crazy): {field=IB SPL-DZ(0.3)}, locale=fr-CH, timezone=America/Winnipeg\n  [junit4]   2> NOTE: Linux 3.13.0-52-generic amd64/Oracle Corporation 1.8.0_74 (64-bit)/cpus=4,threads=1,free=243932576,total=456654848\n  [junit4]   2> NOTE: All tests run in this JVM: [TestSPIClassIterator, TestDocValuesIndexing, TestTragicIndexWriterDeadlock, TestTermVectorsWriter, TestBooleanQueryVisitSubscorers, TestForTooMuchCloning, TestNewestSegment, TestTermsEnum, TestTransactionRollback, TestSearcherManager, TestWeakIdentityMap, TestRecyclingByteBlockAllocator, TestNeverDelete, TestIndexWriterThreadsToSegments, TestSubScorerFreqs, TestDemoParallelLeafReader, TestQueryRescorer, TestSingleInstanceLockFactory, TestTimSorterWorstCase, TestPointValues, TestIndexWriterMaxDocs, TestPerFieldPostingsFormat, TestPagedBytes, TestParallelCompositeReader, TestPriorityQueue, TestDirectMonotonic, TestNumericRangeQuery64, TestSparseFixedBitSet, TestMmapDirectory, TestIndexWriterLockRelease, TestDeterminizeLexicon, TestHighCompressionMode, TestUTF32ToUTF8, TestLucene50CompoundFormat, TestShardSearching, TestSynonymQuery, TestConstantScoreQuery, TestCustomNorms, TestAutomatonQuery, TestFixedBitDocIdSet, TestSpansEnum, TestPerSegmentDeletes, TestReusableStringReader, TestRegexpRandom, TestEarlyTermination, TestPhraseQuery, TestIndexWriterCommit, TestSortRandom, TestTimeLimitingCollector, TestMultiFields, FuzzyTermOnShortTermsTest, TestLSBRadixSorter, TestNoDeletionPolicy, Test4GBStoredFields, TestSumDocFreq, TestMultiCollector, TestAutomaton, TestSpanCollection]\n  [junit4] Completed [192/419 (1!)] on J0 in 0.32s, 3 tests, 1 failure <<< FAILURES!\n\n\n\nFrom my Jenkins last night:\n\nChecking out Revision d914ec4a67c42466f19e46169754965a7d5af35c (refs/remotes/origin/branch_6x)\n[...]\n  [junit4] Suite: org.apache.lucene.search.spans.TestSpanCollection\n  [junit4]   2> NOTE: download the large Jenkins line-docs file by running 'ant get-jenkins-line-docs' in the lucene directory.\n  [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=TestSpanCollection -Dtests.method=testOrQuery -Dtests.seed=E0D51AE930685152 -Dtests.slow=true -Dtests.linedocsfile=/home/jenkins/lucene-data/enwiki.random.lines.txt -Dtests.locale=sq-AL -Dtests.timezone=Indian/Mauritius -Dtests.asserts=true -Dtests.file.encoding=US-ASCII\n  [junit4] FAILURE 0.01s J1 | TestSpanCollection.testOrQuery <<<\n  [junit4]    > Throwable #1: java.lang.AssertionError: Missing term field:w3\n  [junit4]    > \tat __randomizedtesting.SeedInfo.seed([E0D51AE930685152:80B151DCC13A241A]:0)\n  [junit4]    > \tat org.apache.lucene.search.spans.TestSpanCollection.checkCollectedTerms(TestSpanCollection.java:103)\n  [junit4]    > \tat org.apache.lucene.search.spans.TestSpanCollection.testOrQuery(TestSpanCollection.java:147)\n  [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n  [junit4]   2> NOTE: test params are: codec=FastCompressingStoredFields(storedFieldsFormat=CompressingStoredFieldsFormat(compressionMode=FAST, chunkSize=6915, maxDocsPerChunk=370, blockSize=1), termVectorsFormat=CompressingTermVectorsFormat(compressionMode=FAST, chunkSize=6915, blockSize=1)), sim=ClassicSimilarity, locale=sq-AL, timezone=Indian/Mauritius\n  [junit4]   2> NOTE: Linux 4.1.0-custom2-amd64 amd64/Oracle Corporation 1.8.0_77 (64-bit)/cpus=16,threads=1,free=104831872,total=325058560\n  [junit4]   2> NOTE: All tests run in this JVM: [TestFlushByRamOrCountsPolicy, TestDirectoryReader, TestSortedSetSortField, TestConjunctions, TestRollingUpdates, TestFrequencyTrackingRingBuffer, TestNGramPhraseQuery, TestNumericRangeQuery64, TestSegmentMerger, TestBagOfPositions, TestMultiThreadTermVectors, TestNumericUtils, Test2BSortedDocValuesFixedSorted, TestPagedBytes, TestDocValuesIndexing, TestAllFilesCheckIndexHeader, TestSmallFloat, TestIndexWriterOutOfFileDescriptors, TestSpanSearchEquivalence, TestTieredMergePolicy, TestSort, TestSortedSetDocValues, TestReadOnlyIndex, TestCheckIndex, TestBytesStore, TestUTF32ToUTF8, TestIndexWriterOnVMError, TestLucene50CompoundFormat, FuzzyTermOnShortTermsTest, TestStressIndexing, TestCharsRef, TestElevationComparator, TestIntsRef, TestTermVectorsReader, TestStringHelper, TestMixedDocValuesUpdates, TestDeterminizeLexicon, TestForTooMuchCloning, TestForUtil, TestQueryRescorer, TestPerFieldPostingsFormat, TestWeakIdentityMap, TestSearchAfter, TestBKD, TestIndexWriterReader, TestOmitNorms, TestFixedBitSet, TestStressNRT, TestNewestSegment, Test4GBStoredFields, TestSpanTermQuery, TestGrowableByteArrayDataOutput, TestIndexReaderClose, TestFastDecompressionMode, TestTragicIndexWriterDeadlock, TestBooleanScorer, TestCharsRefBuilder, TestPrefixQuery, TestPersistentSnapshotDeletionPolicy, TestAllFilesHaveChecksumFooter, TestParallelLeafReader, TestIndexWriterLockRelease, TestIndexableField, TestSpanOrQuery, TestSimpleExplanationsOfNonMatches, TestPayloadsOnVectors, TestFieldType, TestNumericDocValuesUpdates, TestDocumentsWriterDeleteQueue, TestSubScorerFreqs, TestUsageTrackingFilterCachingPolicy, TestCharFilter, TestToken, TestPostingsOffsets, TestLSBRadixSorter, TestHighCompressionMode, TestPositiveScoresOnlyCollector, TestIndexWriterForceMerge, TestReaderClosed, TestSpansEnum, TestNRTReaderCleanup, TestSpanCollection]\n  [junit4] Completed [181/419 (1!)] on J1 in 0.08s, 3 tests, 1 failure <<< FAILURES!",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "id": "comment-15310927",
            "author": "Alan Woodward",
            "date": "2016-06-01T19:14:28+0000",
            "content": "This is a test bug - it's assuming that index docs are in a certain order, but if you get a specific merge policy that re-orders things then that breaks everything. "
        },
        {
            "id": "comment-15310929",
            "author": "ASF subversion and git services",
            "date": "2016-06-01T19:15:30+0000",
            "content": "Commit 7de3ef35100bd0db5454272d4812e014e35d2386 in lucene-solr's branch refs/heads/master from Alan Woodward\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7de3ef3 ]\n\nLUCENE-7236: Fix test bug "
        },
        {
            "id": "comment-15310931",
            "author": "ASF subversion and git services",
            "date": "2016-06-01T19:15:56+0000",
            "content": "Commit 36ee71320ad007b7cdedef4a3a67396628604db7 in lucene-solr's branch refs/heads/branch_6x from Alan Woodward\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=36ee713 ]\n\nLUCENE-7236: Fix test bug "
        }
    ]
}