{
    "id": "SOLR-8022",
    "title": "Java 8 example/files fails in UpdateRequestProcessor due to Nashorn class cast exception",
    "details": {
        "components": [
            "examples",
            "update"
        ],
        "type": "Bug",
        "labels": "",
        "fix_versions": [],
        "affect_versions": "5.3",
        "status": "Resolved",
        "resolution": "Duplicate",
        "priority": "Major"
    },
    "description": ".jdk-8u60-linux-x64.rpm +solr-5.3.0\nwhen I start Solr and enter the following command \n\"bin/post -c files README.txt\",I get the following  errors ,but it's OK when I  change to jdk-7u71-linux-x64.rpm :\n[root@master solr-5.3.0]# bin/post -c files README.txt \n/usr/java/jdk1.8.0_60/bin/java -classpath /root/Downloads/solr-5.3.0/dist/solr-core-5.3.0.jar -Dauto=yes -Dc=files -Ddata=files org.apache.solr.util.SimplePostTool README.txt\nSimplePostTool version 5.0.0\nPosting files to [base] url http://localhost:8983/solr/files/update...\nEntering auto mode. File endings considered are xml,json,csv,pdf,doc,docx,ppt,pptx,xls,xlsx,odt,odp,ods,ott,otp,ots,rtf,htm,html,txt,log\nPOSTing file README.txt (text/plain) to [base]/extract\nSimplePostTool: WARNING: Solr returned an error #500 (Server Error) for url: http://localhost:8983/solr/files/update/extract?resource.name=%2Froot%2FDownloads%2Fsolr-5.3.0%2FREADME.txt&literal.id=%2Froot%2FDownloads%2Fsolr-5.3.0%2FREADME.txt\nSimplePostTool: WARNING: Response: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<response>\n<lst name=\"responseHeader\"><int name=\"status\">500</int><int name=\"QTime\">792</int></lst><lst name=\"error\"><str name=\"msg\">Cannot cast jdk.internal.dynalink.beans.StaticClass to java.lang.Class</str><str name=\"trace\">java.lang.ClassCastException: Cannot cast jdk.internal.dynalink.beans.StaticClass to java.lang.Class\n        at java.lang.invoke.MethodHandleImpl.newClassCastException(MethodHandleImpl.java:361)\n        at java.lang.invoke.MethodHandleImpl.castReference(MethodHandleImpl.java:356)\n        at jdk.nashorn.internal.scripts.Script$Recompilation$2$106A$^eval_.processAdd(<eval>:74)\n        at jdk.nashorn.internal.runtime.ScriptFunctionData.invoke(ScriptFunctionData.java:642)\n        at jdk.nashorn.internal.runtime.ScriptFunction.invoke(ScriptFunction.java:228)\n        at jdk.nashorn.internal.runtime.ScriptRuntime.apply(ScriptRuntime.java:393)\n        at jdk.nashorn.api.scripting.ScriptObjectMirror.callMember(ScriptObjectMirror.java:199)\n        at jdk.nashorn.api.scripting.NashornScriptEngine.invokeImpl(NashornScriptEngine.java:383)\n        at jdk.nashorn.api.scripting.NashornScriptEngine.invokeFunction(NashornScriptEngine.java:190)\n        at org.apache.solr.update.processor.StatelessScriptUpdateProcessorFactory$ScriptUpdateProcessor.invokeFunction(StatelessScriptUpdateProcessorFactory.java:424)\n        at org.apache.solr.update.processor.StatelessScriptUpdateProcessorFactory$ScriptUpdateProcessor.processAdd(StatelessScriptUpdateProcessorFactory.java:373)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.LanguageIdentifierUpdateProcessor.processAdd(LanguageIdentifierUpdateProcessor.java:207)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.AddSchemaFieldsUpdateProcessorFactory$AddSchemaFieldsUpdateProcessor.processAdd(AddSchemaFieldsUpdateProcessorFactory.java:331)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.FieldNameMutatingUpdateProcessorFactory$1.processAdd(FieldNameMutatingUpdateProcessorFactory.java:79)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.DistributedUpdateProcessor.doLocalAdd(DistributedUpdateProcessor.java:955)\n        at org.apache.solr.update.processor.DistributedUpdateProcessor.versionAdd(DistributedUpdateProcessor.java:1110)\n        at org.apache.solr.update.processor.DistributedUpdateProcessor.processAdd(DistributedUpdateProcessor.java:706)\n        at org.apache.solr.update.processor.LogUpdateProcessor.processAdd(LogUpdateProcessorFactory.java:104)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.AbstractDefaultValueUpdateProcessorFactory$DefaultValueUpdateProcessor.processAdd(AbstractDefaultValueUpdateProcessorFactory.java:94)\n        at org.apache.solr.handler.extraction.ExtractingDocumentLoader.doAdd(ExtractingDocumentLoader.java:122)\n        at org.apache.solr.handler.extraction.ExtractingDocumentLoader.addDoc(ExtractingDocumentLoader.java:127)\n        at org.apache.solr.handler.extraction.ExtractingDocumentLoader.load(ExtractingDocumentLoader.java:230)\n        at org.apache.solr.handler.ContentStreamHandlerBase.handleRequestBody(ContentStreamHandlerBase.java:74)\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:143)\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:2068)\n        at org.apache.solr.servlet.HttpSolrCall.execute(HttpSolrCall.java:669)\n        at org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:462)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:210)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:179)\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1652)\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:585)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)\n        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:577)\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:223)\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1127)\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:515)\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1061)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n        at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:215)\n        at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:110)\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:97)\n        at org.eclipse.jetty.server.Server.handle(Server.java:499)\n        at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:310)\n        at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:257)\n        at org.eclipse.jetty.io.AbstractConnection$2.run(AbstractConnection.java:540)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:635)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:555)\n        at java.lang.Thread.run(Thread.java:745)\n</str><int name=\"code\">500</int></lst>\n</response>\nSimplePostTool: WARNING: IOException while reading response: java.io.IOException: Server returned HTTP response code: 500 for URL: http://localhost:8983/solr/files/update/extract?resource.name=%2Froot%2FDownloads%2Fsolr-5.3.0%2FREADME.txt&literal.id=%2Froot%2FDownloads%2Fsolr-5.3.0%2FREADME.txt\n1 files indexed.\nCOMMITting Solr index changes to http://localhost:8983/solr/files/update...\nTime spent: 0:00:00.881",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "date": "2015-09-09T12:11:28+0000",
            "author": "Gernot Krost",
            "content": "Windows based jdk-8u60 and 8u51 don't work either. ",
            "id": "comment-14736746"
        },
        {
            "date": "2015-09-09T12:27:59+0000",
            "author": "Uwe Schindler",
            "content": "I think this is a duplicate of SOLR-7978. Erik Hatcher can you confirm this? ",
            "id": "comment-14736757"
        },
        {
            "date": "2015-09-09T12:49:07+0000",
            "author": "Erik Hatcher",
            "content": "confirmed, this is a duplicate and fixed on trunk, 5x branch, and for the upcoming 5.3.1 release.  sorry 'bout that. ",
            "id": "comment-14736785"
        }
    ]
}