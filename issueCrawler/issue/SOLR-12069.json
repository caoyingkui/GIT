{
    "id": "SOLR-12069",
    "title": "Default operator parameter q.op ignored.",
    "details": {
        "labels": "",
        "priority": "Critical",
        "components": [
            "query parsers"
        ],
        "type": "Bug",
        "fix_versions": [],
        "affect_versions": "7.2",
        "resolution": "Unresolved",
        "status": "Open"
    },
    "description": "The q.op parameter as described in the 7.2 reference for the Standard Query Parser\u00a0does not get used when executing a query.\n\nReproduce via techproducts example.\n\n\t./bin/solr -e tchproducts\n\t./bin/post -c techproducts example/exampledocs/*.xml\n\thttp \"http://localhost:8983/solr/techproducts/select?q=inStock:(true false)&q.op=AND\"\n\n\n\nThe search above is expected to return 0 results but instead matches all 21 entries.\n\nThe response header lists the q.op parameter\u00a0\n\n{\n  \"responseHeader\": {\n    \"QTime\": 3,\n    \"params\": {\n      \"debugQuery\": \"on\",\n      \"q\": \"inStock:(true false)\",\n      \"q.op\": \"AND\"\n    },\n    \"status\": 0\n  },\n  // ...\n}\n\n\n\nThe debug output is as follows:\n\ndebug\": {\n  \"QParser\": \"LuceneQParser\",\n  \"explain\": {\n      \"100-435805\": \"\\n1.5869651 = sum of:\\n  1.5869651 = weight(inStock:F in 31) [SchemaSimilarity], result of:\\n    1.5869651 = score(doc=31,freq=1.0 = termFreq=1.0\\n), product of:\\n      1.5869651 = idf, computed as log(1 + (docCount - docFreq + 0.5) / (docFreq + 0.5)) from:\\n        4.0 = docFreq\\n        21.0 = docCount\\n      1.0 = tfNorm, computed as (freq * (k1 + 1)) / (freq + k1) from:\\n        1.0 = termFreq=1.0\\n        1.2 = parameter k1\\n        0.0 = parameter b (norms omitted for field)\\n\",\n      \"6H500F0\": \"\\n0.22884157 = sum of:\\n  0.22884157 = weight(inStock:T in 2) [SchemaSimilarity], result of:\\n    0.22884157 = score(doc=2,freq=1.0 = termFreq=1.0\\n), product of:\\n      0.22884157 = idf, computed as log(1 + (docCount - docFreq + 0.5) / (docFreq + 0.5)) from:\\n        17.0 = docFreq\\n        21.0 = docCount\\n      1.0 = tfNorm, computed as (freq * (k1 + 1)) / (freq + k1) from:\\n        1.0 = termFreq=1.0\\n        1.2 = parameter k1\\n        0.0 = parameter b (norms omitted for field)\\n\",\n      \"EN7800GTX/2DHTV/256M\": \"\\n1.5869651 = sum of:\\n  1.5869651 = weight(inStock:F in 30) [SchemaSimilarity], result of:\\n    1.5869651 = score(doc=30,freq=1.0 = termFreq=1.0\\n), product of:\\n      1.5869651 = idf, computed as log(1 + (docCount - docFreq + 0.5) / (docFreq + 0.5)) from:\\n        4.0 = docFreq\\n        21.0 = docCount\\n      1.0 = tfNorm, computed as (freq * (k1 + 1)) / (freq + k1) from:\\n        1.0 = termFreq=1.0\\n        1.2 = parameter k1\\n        0.0 = parameter b (norms omitted for field)\\n\",\n      \"F8V7067-APL-KIT\": \"\\n1.5869651 = sum of:\\n  1.5869651 = weight(inStock:F in 3) [SchemaSimilarity], result of:\\n    1.5869651 = score(doc=3,freq=1.0 = termFreq=1.0\\n), product of:\\n      1.5869651 = idf, computed as log(1 + (docCount - docFreq + 0.5) / (docFreq + 0.5)) from:\\n        4.0 = docFreq\\n        21.0 = docCount\\n      1.0 = tfNorm, computed as (freq * (k1 + 1)) / (freq + k1) from:\\n        1.0 = termFreq=1.0\\n        1.2 = parameter k1\\n        0.0 = parameter b (norms omitted for field)\\n\",\n      \"GB18030TEST\": \"\\n0.22884157 = sum of:\\n  0.22884157 = weight(inStock:T in 0) [SchemaSimilarity], result of:\\n    0.22884157 = score(doc=0,freq=1.0 = termFreq=1.0\\n), product of:\\n      0.22884157 = idf, computed as log(1 + (docCount - docFreq + 0.5) / (docFreq + 0.5)) from:\\n        17.0 = docFreq\\n        21.0 = docCount\\n      1.0 = tfNorm, computed as (freq * (k1 + 1)) / (freq + k1) from:\\n        1.0 = termFreq=1.0\\n        1.2 = parameter k1\\n        0.0 = parameter b (norms omitted for field)\\n\",\n      \"IW-02\": \"\\n1.5869651 = sum of:\\n  1.5869651 = weight(inStock:F in 4) [SchemaSimilarity], result of:\\n    1.5869651 = score(doc=4,freq=1.0 = termFreq=1.0\\n), product of:\\n      1.5869651 = idf, computed as log(1 + (docCount - docFreq + 0.5) / (docFreq + 0.5)) from:\\n        4.0 = docFreq\\n        21.0 = docCount\\n      1.0 = tfNorm, computed as (freq * (k1 + 1)) / (freq + k1) from:\\n        1.0 = termFreq=1.0\\n        1.2 = parameter k1\\n        0.0 = parameter b (norms omitted for field)\\n\",\n      \"MA147LL/A\": \"\\n0.22884157 = sum of:\\n  0.22884157 = weight(inStock:T in 5) [SchemaSimilarity], result of:\\n    0.22884157 = score(doc=5,freq=1.0 = termFreq=1.0\\n), product of:\\n      0.22884157 = idf, computed as log(1 + (docCount - docFreq + 0.5) / (docFreq + 0.5)) from:\\n        17.0 = docFreq\\n        21.0 = docCount\\n      1.0 = tfNorm, computed as (freq * (k1 + 1)) / (freq + k1) from:\\n        1.0 = termFreq=1.0\\n        1.2 = parameter k1\\n        0.0 = parameter b (norms omitted for field)\\n\",\n      \"SP2514N\": \"\\n0.22884157 = sum of:\\n  0.22884157 = weight(inStock:T in 1) [SchemaSimilarity], result of:\\n    0.22884157 = score(doc=1,freq=1.0 = termFreq=1.0\\n), product of:\\n      0.22884157 = idf, computed as log(1 + (docCount - docFreq + 0.5) / (docFreq + 0.5)) from:\\n        17.0 = docFreq\\n        21.0 = docCount\\n      1.0 = tfNorm, computed as (freq * (k1 + 1)) / (freq + k1) from:\\n        1.0 = termFreq=1.0\\n        1.2 = parameter k1\\n        0.0 = parameter b (norms omitted for field)\\n\",\n      \"TWINX2048-3200PRO\": \"\\n0.22884157 = sum of:\\n  0.22884157 = weight(inStock:T in 17) [SchemaSimilarity], result of:\\n    0.22884157 = score(doc=17,freq=1.0 = termFreq=1.0\\n), product of:\\n      0.22884157 = idf, computed as log(1 + (docCount - docFreq + 0.5) / (docFreq + 0.5)) from:\\n        17.0 = docFreq\\n        21.0 = docCount\\n      1.0 = tfNorm, computed as (freq * (k1 + 1)) / (freq + k1) from:\\n        1.0 = termFreq=1.0\\n        1.2 = parameter k1\\n        0.0 = parameter b (norms omitted for field)\\n\",\n      \"VS1GB400C3\": \"\\n0.22884157 = sum of:\\n  0.22884157 = weight(inStock:T in 18) [SchemaSimilarity], result of:\\n    0.22884157 = score(doc=18,freq=1.0 = termFreq=1.0\\n), product of:\\n      0.22884157 = idf, computed as log(1 + (docCount - docFreq + 0.5) / (docFreq + 0.5)) from:\\n        17.0 = docFreq\\n        21.0 = docCount\\n      1.0 = tfNorm, computed as (freq * (k1 + 1)) / (freq + k1) from:\\n        1.0 = termFreq=1.0\\n        1.2 = parameter k1\\n        0.0 = parameter b (norms omitted for field)\\n\"\n  },\n  \"parsedquery\": \"+(+(inStock:true inStock:false))\",\n  \"parsedquery_toString\": \"+(+(inStock:T inStock:F))\",\n  \"querystring\": \"inStock:(true false)\",\n  \"rawquerystring\": \"inStock:(true false)\",\n  \"timing\": {\n     // ...",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "date": "2018-06-03T16:25:44+0000",
            "content": "Christoph Strobl\nFacing the same issue.\n\nFrom solr-7, split on whitespaces has been disabled by default(sow=false)\nIn Solr-6, sow=true by default\n\nSo, I tried passing sow=true in the request, the results were as expected i.e, in this can number of products are 0 and parsedquery_toString is +(+inStock:T +inStock:F)\n\nLooks like this issue is due to change in sow default behavior\nhttps://github.com/apache/lucene-solr/blob/master/solr/core/src/java/org/apache/solr/parser/QueryParser.java#L560 - The way the multiTerm query is handled\n\nAlso here,\nhttps://github.com/apache/lucene-solr/blob/master/solr/core/src/java/org/apache/solr/parser/SolrQueryParserBase.java#L1014 - should the operator picked from params (I didn't understand why it is always SHOULD clause) ",
            "author": "Munendra S N",
            "id": "comment-16499474"
        },
        {
            "date": "2018-06-21T15:34:20+0000",
            "content": "FYI Steve Rowe \u2013 a SOW bug ",
            "author": "David Smiley",
            "id": "comment-16519515"
        },
        {
            "date": "2018-06-21T15:50:09+0000",
            "content": "Thanks for the heads-up David Smiley I'll take a look ",
            "author": "Steve Rowe",
            "id": "comment-16519532"
        }
    ]
}