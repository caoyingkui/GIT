{
    "id": "LUCENE-5273",
    "title": "Binary artifacts in Lucene and Solr convenience binary distributions accompanying a release, including on Maven Central, should be identical across all distributions",
    "details": {
        "components": [
            "general/build"
        ],
        "fix_versions": [
            "4.6",
            "6.0"
        ],
        "affect_versions": "None",
        "priority": "Major",
        "labels": "",
        "type": "Bug",
        "resolution": "Fixed",
        "status": "Resolved"
    },
    "description": "As mentioned in various issues (e.g. LUCENE-3655, LUCENE-3885, SOLR-4766), we release multiple versions of the same artifact: binary Maven artifacts are not identical to the ones in the Lucene and Solr binary distributions, and the Lucene jars in the Solr binary distribution, including within the war, are not identical to the ones in the Lucene binary distribution.  This is bad.\n\nIt's (probably always?) not horribly bad, since the differences all appear to be caused by the build re-creating manifests and re-building jars and the Solr war from their constituents at various points in the release build process; as a result, manifest timestamp attributes, as well as archive metadata (at least constituent timestamps, maybe other things?), differ each time a jar is rebuilt.",
    "attachments": {
        "LUCENE-5273-optimized.patch": "https://issues.apache.org/jira/secure/attachment/12608145/LUCENE-5273-optimized.patch",
        "LUCENE-5273-slowdown-fixed.patch": "https://issues.apache.org/jira/secure/attachment/12608221/LUCENE-5273-slowdown-fixed.patch",
        "LUCENE-5273.patch": "https://issues.apache.org/jira/secure/attachment/12607770/LUCENE-5273.patch"
    },
    "issue_links": {},
    "comments": [
        {
            "date": "2013-10-10T08:39:59+0000",
            "content": "Patch that fixes the problem, and adds checks to smokeTestRelease.py.\n\nI had been thinking that the way to fix this problem was to somehow not rebuild manifests and jars when their constituents had not changed.  A couple efforts in this direction failed for various reasons, though.\n\nInstead, this patch causes the release building process to unpack lucene-<version>.tgz to lucene/build/lucene.tgz.unpacked, and solr-<version>.tgz to solr/build/solr.tgz.unpacked, and then pull binary artifacts from the unpacked lucene distribution when they're needed in the Solr distribution and the Solr war, and from the appropriate unpacked distribution when deploying Lucene and Solr Maven artifacts.\n\nant nightly-smoke succeeds on trunk with this patch.\n\nI backported the smokeTestRelease.py changes to the lucene_solr_4_5 branch, then ran the smoke tester against the final 4.5 RC, after first converting exceptions for non-identicality to print statements with \"Should fail:\" prepended, and I got the following output:\n\n\n  unpack solr-4.5.0.tgz...\n    verify JAR metadata/identity/no javax.* or java.* classes...\n    unpack lucene-4.5.0.tgz...\nShould fail: Artifact /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/contrib/analysis-extras/lucene-libs/lucene-analyzers-icu-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/icu/lucene-analyzers-icu-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/contrib/analysis-extras/lucene-libs/lucene-analyzers-morfologik-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/morfologik/lucene-analyzers-morfologik-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/contrib/analysis-extras/lucene-libs/lucene-analyzers-smartcn-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/smartcn/lucene-analyzers-smartcn-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/contrib/analysis-extras/lucene-libs/lucene-analyzers-stempel-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/stempel/lucene-analyzers-stempel-4.5.0.jar in Lucene binary distribution\n      **WARNING**: skipping check of /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/contrib/dataimporthandler/lib/activation-1.1.jar: it has javax.* classes\n      **WARNING**: skipping check of /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/contrib/dataimporthandler/lib/mail-1.4.1.jar: it has javax.* classes\nShould fail: Artifact /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/contrib/uima/lucene-libs/lucene-analyzers-uima-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/uima/lucene-analyzers-uima-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/dist/test-framework/lucene-libs/lucene-test-framework-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/test-framework/lucene-test-framework-4.5.0.jar in Lucene binary distribution\n    verify WAR metadata/contained JAR identity/no javax.* or java.* classes...\n    unpack lucene-4.5.0.tgz...\nShould fail: Artifact WEB-INF/lib/lucene-analyzers-common-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/common/lucene-analyzers-common-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-analyzers-kuromoji-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/kuromoji/lucene-analyzers-kuromoji-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-analyzers-phonetic-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/phonetic/lucene-analyzers-phonetic-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-codecs-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/codecs/lucene-codecs-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-core-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/core/lucene-core-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-grouping-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/grouping/lucene-grouping-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-highlighter-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/highlighter/lucene-highlighter-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-join-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/join/lucene-join-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-memory-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/memory/lucene-memory-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-misc-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/misc/lucene-misc-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-queries-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/queries/lucene-queries-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-queryparser-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/queryparser/lucene-queryparser-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-spatial-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/spatial/lucene-spatial-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-suggest-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/suggest/lucene-suggest-4.5.0.jar in Lucene binary distribution\n[...]\n  unpack solr-4.5.0.zip...\n    verify JAR metadata/identity/no javax.* or java.* classes...\n    unpack lucene-4.5.0.tgz...\nShould fail: Artifact /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/contrib/analysis-extras/lucene-libs/lucene-analyzers-icu-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/icu/lucene-analyzers-icu-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/contrib/analysis-extras/lucene-libs/lucene-analyzers-morfologik-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/morfologik/lucene-analyzers-morfologik-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/contrib/analysis-extras/lucene-libs/lucene-analyzers-smartcn-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/smartcn/lucene-analyzers-smartcn-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/contrib/analysis-extras/lucene-libs/lucene-analyzers-stempel-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/stempel/lucene-analyzers-stempel-4.5.0.jar in Lucene binary distribution\n      **WARNING**: skipping check of /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/contrib/dataimporthandler/lib/activation-1.1.jar: it has javax.* classes\n      **WARNING**: skipping check of /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/contrib/dataimporthandler/lib/mail-1.4.1.jar: it has javax.* classes\nShould fail: Artifact /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/contrib/uima/lucene-libs/lucene-analyzers-uima-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/uima/lucene-analyzers-uima-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/dist/test-framework/lucene-libs/lucene-test-framework-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/test-framework/lucene-test-framework-4.5.0.jar in Lucene binary distribution\n    verify WAR metadata/contained JAR identity/no javax.* or java.* classes...\n    unpack lucene-4.5.0.tgz...\nShould fail: Artifact WEB-INF/lib/lucene-analyzers-common-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/common/lucene-analyzers-common-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-analyzers-kuromoji-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/kuromoji/lucene-analyzers-kuromoji-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-analyzers-phonetic-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/phonetic/lucene-analyzers-phonetic-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-codecs-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/codecs/lucene-codecs-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-core-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/core/lucene-core-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-grouping-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/grouping/lucene-grouping-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-highlighter-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/highlighter/lucene-highlighter-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-join-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/join/lucene-join-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-memory-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/memory/lucene-memory-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-misc-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/misc/lucene-misc-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-queries-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/queries/lucene-queries-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-queryparser-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/queryparser/lucene-queryparser-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-spatial-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/spatial/lucene-spatial-4.5.0.jar in Lucene binary distribution\nShould fail: Artifact WEB-INF/lib/lucene-suggest-4.5.0.jar in /Users/sarowe/temp/tmpDir/unpack/solr-4.5.0/example/webapps/solr.war is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/suggest/lucene-suggest-4.5.0.jar in Lucene binary distribution\n[...]\nTest Maven artifacts for Lucene and Solr...\n[...]\n    verify that Maven artifacts are same as in the binary distribution...\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-analyzers-common/4.5.0/lucene-analyzers-common-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/common/lucene-analyzers-common-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-analyzers-icu/4.5.0/lucene-analyzers-icu-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/icu/lucene-analyzers-icu-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-analyzers-kuromoji/4.5.0/lucene-analyzers-kuromoji-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/kuromoji/lucene-analyzers-kuromoji-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-analyzers-morfologik/4.5.0/lucene-analyzers-morfologik-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/morfologik/lucene-analyzers-morfologik-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-analyzers-phonetic/4.5.0/lucene-analyzers-phonetic-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/phonetic/lucene-analyzers-phonetic-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-analyzers-smartcn/4.5.0/lucene-analyzers-smartcn-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/smartcn/lucene-analyzers-smartcn-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-analyzers-stempel/4.5.0/lucene-analyzers-stempel-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/stempel/lucene-analyzers-stempel-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-analyzers-uima/4.5.0/lucene-analyzers-uima-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/analysis/uima/lucene-analyzers-uima-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-benchmark/4.5.0/lucene-benchmark-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/benchmark/lucene-benchmark-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-classification/4.5.0/lucene-classification-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/classification/lucene-classification-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-codecs/4.5.0/lucene-codecs-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/codecs/lucene-codecs-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-core/4.5.0/lucene-core-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/core/lucene-core-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-demo/4.5.0/lucene-demo-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/demo/lucene-demo-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-facet/4.5.0/lucene-facet-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/facet/lucene-facet-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-grouping/4.5.0/lucene-grouping-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/grouping/lucene-grouping-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-highlighter/4.5.0/lucene-highlighter-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/highlighter/lucene-highlighter-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-join/4.5.0/lucene-join-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/join/lucene-join-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-memory/4.5.0/lucene-memory-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/memory/lucene-memory-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-misc/4.5.0/lucene-misc-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/misc/lucene-misc-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-queries/4.5.0/lucene-queries-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/queries/lucene-queries-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-queryparser/4.5.0/lucene-queryparser-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/queryparser/lucene-queryparser-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-replicator/4.5.0/lucene-replicator-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/replicator/lucene-replicator-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-sandbox/4.5.0/lucene-sandbox-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/sandbox/lucene-sandbox-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-spatial/4.5.0/lucene-spatial-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/spatial/lucene-spatial-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-suggest/4.5.0/lucene-suggest-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/suggest/lucene-suggest-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/lucene/lucene-test-framework/4.5.0/lucene-test-framework-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-lucene-getBinaryDistFiles/lucene-4.5.0/test-framework/lucene-test-framework-4.5.0.jar in lucene binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/solr/solr-analysis-extras/4.5.0/solr-analysis-extras-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-solr-getBinaryDistFiles/solr-4.5.0/dist/solr-analysis-extras-4.5.0.jar in solr binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/solr/solr-cell/4.5.0/solr-cell-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-solr-getBinaryDistFiles/solr-4.5.0/dist/solr-cell-4.5.0.jar in solr binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/solr/solr-clustering/4.5.0/solr-clustering-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-solr-getBinaryDistFiles/solr-4.5.0/dist/solr-clustering-4.5.0.jar in solr binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/solr/solr-core/4.5.0/solr-core-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-solr-getBinaryDistFiles/solr-4.5.0/dist/solr-core-4.5.0.jar in solr binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/solr/solr-dataimporthandler-extras/4.5.0/solr-dataimporthandler-extras-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-solr-getBinaryDistFiles/solr-4.5.0/dist/solr-dataimporthandler-extras-4.5.0.jar in solr binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/solr/solr-dataimporthandler/4.5.0/solr-dataimporthandler-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-solr-getBinaryDistFiles/solr-4.5.0/dist/solr-dataimporthandler-4.5.0.jar in solr binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/solr/solr-langid/4.5.0/solr-langid-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-solr-getBinaryDistFiles/solr-4.5.0/dist/solr-langid-4.5.0.jar in solr binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/solr/solr-solrj/4.5.0/solr-solrj-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-solr-getBinaryDistFiles/solr-4.5.0/dist/solr-solrj-4.5.0.jar in solr binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/solr/solr-test-framework/4.5.0/solr-test-framework-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-solr-getBinaryDistFiles/solr-4.5.0/dist/solr-test-framework-4.5.0.jar in solr binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/solr/solr-uima/4.5.0/solr-uima-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-solr-getBinaryDistFiles/solr-4.5.0/dist/solr-uima-4.5.0.jar in solr binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/solr/solr-velocity/4.5.0/solr-velocity-4.5.0.jar is not identical to /Users/sarowe/temp/tmpDir/unpack-solr-getBinaryDistFiles/solr-4.5.0/dist/solr-velocity-4.5.0.jar in solr binary distribution\nShould fail: Maven artifact /Users/sarowe/temp/tmpDir/maven/org/apache/solr/solr/4.5.0/solr-4.5.0.war is not identical to /Users/sarowe/temp/tmpDir/unpack-solr-getBinaryDistFiles/solr-4.5.0/dist/solr-4.5.0.war in solr binary distribution\n\n\n\nSo I think it works. ",
            "author": "Steve Rowe",
            "id": "comment-13791323"
        },
        {
            "date": "2013-10-10T08:47:33+0000",
            "content": "Just one question: Why unpack the whole lucene tgz? You can directly refer to JAR files from inside tar/zip by using zipfileset/tarfileset. So there is no need to unpack those files, just add them directly from their tar resource. I use a similar approach in forbidden, to extract stuff from IVY artifacts without copying and unzipping JAR files. ",
            "author": "Uwe Schindler",
            "id": "comment-13791329"
        },
        {
            "date": "2013-10-10T08:51:56+0000",
            "content": "Here my example from forbidden: https://code.google.com/p/forbidden-apis/source/browse/trunk/build.xml?spec=svn214&r=214#215\nIt uses <archives><zips/></archives> when zipping the artifact. The same can be done with <archives><tars/></archives>. Another way to do this (more static) is to use <tarfileset/>. <archives/> is just more flexible as it is a generic resource collection. ",
            "author": "Uwe Schindler",
            "id": "comment-13791331"
        },
        {
            "date": "2013-10-10T08:59:35+0000",
            "content": "Good idea Uwe, thanks for the pointers, I'll look at that later on today.\n\nConverting dependency paths referring to jars under lucene/build/ and solr/build/ to the corresponding files in the unpacked binary distribution took some doing... hopefully that'll also be possible with <tarfileset/>. ",
            "author": "Steve Rowe",
            "id": "comment-13791336"
        },
        {
            "date": "2013-10-10T13:12:47+0000",
            "content": "Hmm, the Maven Ant Tasks install and deploy tasks require that the source resources be files - at least, the documentation makes no mention of anything but files - so I don't think there's any way to avoid unpacking the archives. ",
            "author": "Steve Rowe",
            "id": "comment-13791464"
        },
        {
            "date": "2013-10-10T13:53:40+0000",
            "content": "strong +1, i always hated how we release different jars in different places. the current setup is just asking for trouble. ",
            "author": "Robert Muir",
            "id": "comment-13791502"
        },
        {
            "date": "2013-10-10T17:04:28+0000",
            "content": "I'll commit this as-is tomorrow if there are no objections. ",
            "author": "Steve Rowe",
            "id": "comment-13791684"
        },
        {
            "date": "2013-10-10T17:14:25+0000",
            "content": "+1 ",
            "author": "Mark Miller",
            "id": "comment-13791692"
        },
        {
            "date": "2013-10-11T16:58:37+0000",
            "content": "Commit 1531354 from Steve Rowe in branch 'dev/trunk'\n[ https://svn.apache.org/r1531354 ]\n\nLUCENE-5273: Binary artifacts in Lucene and Solr convenience binary distributions accompanying a release, including on Maven Central, should be identical across all distributions. ",
            "author": "ASF subversion and git services",
            "id": "comment-13792800"
        },
        {
            "date": "2013-10-12T07:06:06+0000",
            "content": "Commit 1531507 from Steve Rowe in branch 'dev/branches/branch_4x'\n[ https://svn.apache.org/r1531507 ]\n\nLUCENE-5273: Binary artifacts in Lucene and Solr convenience binary distributions accompanying a release, including on Maven Central, should be identical across all distributions. (merged trunk r1531354) ",
            "author": "ASF subversion and git services",
            "id": "comment-13793283"
        },
        {
            "date": "2013-10-12T07:18:11+0000",
            "content": "Mark Miller, do you want this on the 4.5 release branch?  It would produce a better set of distributions, but is maybe a little too risky, so soon after committing it?\n\nFWIW, ant nightly-smoke passed for me on both trunk and branch_4x before I committed each place, and I re-ran the 4.5RC5 test from branch_4x (converting exceptions to debug prints for the non-identicality tests and for missing stuff, to allow the script to continue e.g. when it didn't find the new expressions module), and it complained in the right places. ",
            "author": "Steve Rowe",
            "id": "comment-13793288"
        },
        {
            "date": "2013-10-12T08:30:43+0000",
            "content": "Hmm, the Maven Ant Tasks install and deploy tasks require that the source resources be files - at least, the documentation makes no mention of anything but files - so I don't think there's any way to avoid unpacking the archives.\n\nYeah, I noticed this, too.\n\nI am not sure of the overhead, but as the binary artifact also contains javadocs and those are many small files, this makes the task run slowly on windows and some filesystems. How about only extracting JAR files on the untar task? I would only add some patternset matching only **/*.jar to the untar task (see last example on http://ant.apache.org/manual/Tasks/unzip.html).\n\nI will try this out soon, just need breakfast! ",
            "author": "Uwe Schindler",
            "id": "comment-13793299"
        },
        {
            "date": "2013-10-12T09:26:38+0000",
            "content": "Here the patch. ant generate-maven-articfatcs succeeds (it would fail if some needed files were not extracted from tgz). I did not smoke, as I have only windows.\n\nIn general there is one problem with the whole approach of untaring: It seems to me that you can no longer build maven artifacts for a single module, it still builds everything and fails lately (e.g. dist-maven). So I would suggest to rename those tasks to  use \"-\" as prefix, so you can no longer call them: \"dist-maven\" is one that is affected, rename to \"-dist-maven\". We should do this in a separate issue.\n\nSteve Rowe: Should I commit this optimization? It also largely reduces disk usage! ",
            "author": "Uwe Schindler",
            "id": "comment-13793310"
        },
        {
            "date": "2013-10-12T09:43:06+0000",
            "content": "BTW: I was hoping this patch also prevent rebuilding the same javadocs over and over  We should also fix this in the future, it's horrible. While building Solr maven artifacts it rebuilds solr-core javadocs 5 or 6 times! (for each module),\n\nSteve Rowe: I am out of office, you can commit this patch and also backport if you like! ",
            "author": "Uwe Schindler",
            "id": "comment-13793315"
        },
        {
            "date": "2013-10-13T11:34:38+0000",
            "content": "I just noticed on trunk that executing \"ant example\" for solr causes lucene tgz file (and hence javadocs) to be built. So the \"example\" task takes quite a bit longer to execute:\n\ncd solr; ant example\nbranches/lucene_solr_4_5: Total time: 1 minute 33 seconds\ntrunk: Total time: 4 minutes 54 seconds ",
            "author": "Shalin Shekhar Mangar",
            "id": "comment-13793620"
        },
        {
            "date": "2013-10-13T12:26:53+0000",
            "content": "Thanks for reporting the slowdown, Shalin, I'll look into it. ",
            "author": "Steve Rowe",
            "id": "comment-13793634"
        },
        {
            "date": "2013-10-13T16:36:06+0000",
            "content": "Commit 1531711 from Steve Rowe in branch 'dev/trunk'\n[ https://svn.apache.org/r1531711 ]\n\nLUCENE-5273: Only unpack Lucene/Solr jars from binary distributions - other stuff not needed ",
            "author": "ASF subversion and git services",
            "id": "comment-13793703"
        },
        {
            "date": "2013-10-13T18:03:39+0000",
            "content": "Commit 1531724 from Steve Rowe in branch 'dev/branches/branch_4x'\n[ https://svn.apache.org/r1531724 ]\n\nLUCENE-5273: Only unpack Lucene/Solr jars/war from binary distributions - other stuff not needed (merged trunk r1531711) ",
            "author": "ASF subversion and git services",
            "id": "comment-13793732"
        },
        {
            "date": "2013-10-13T18:08:22+0000",
            "content": "\nI am not sure of the overhead, but as the binary artifact also contains javadocs and those are many small files, this makes the task run slowly on windows and some filesystems. How about only extracting JAR files on the untar task? I would only add some patternset matching only */.jar to the untar task (see last example on http://ant.apache.org/manual/Tasks/unzip.html).\n[...]\nSteve Rowe: I am out of office, you can commit this patch and also backport if you like!\n\nThanks Uwe, I committed (with one small change to the patternset name) to trunk and branch_4x.  I added the Solr war to the patternset-to-unpack on branch_4x.  ant nightly-smoke passed for me in both places. ",
            "author": "Steve Rowe",
            "id": "comment-13793734"
        },
        {
            "date": "2013-10-13T20:57:11+0000",
            "content": "Patch addressing the slowdown Shalin mentioned above: the old war-building behavior of pulling lucene-*.jar from lucene/build/*/ is restored, unless called from the create-package target, in which case they are pulled from the built/unpacked lucene-<version>.tgz.  In this way, ant example doesn't have to wait around for javadocs.\n\nHere are timings from my Macbook Pro (OS X 10.8.5) with Oracle Java 1.7.0_25 64-bit - times are minutes:seconds:\n\n\n\n\nTop-level clean?\ntrunk before any LUCENE-5273 patches committed (r1531353)\ncurrent trunk\ntrunk with this patch applied\n\n\nYes\n1:11\n4:26\n1:15\n\n\nNo\n0:37\n0:38\n0:37\n\n\n\n\n\nSo with this patch, timings are back to where they were before I committed anything for this issue.\n\nThis patch provides the additional benefit that Lucene module changes will get picked up even if ant clean is not performed first.\n\nCommitting shortly\u0010. ",
            "author": "Steve Rowe",
            "id": "comment-13793779"
        },
        {
            "date": "2013-10-13T21:03:26+0000",
            "content": "\nBTW: I was hoping this patch also prevent rebuilding the same javadocs over and over We should also fix this in the future, it's horrible. While building Solr maven artifacts it rebuilds solr-core javadocs 5 or 6 times! (for each module),\n\nI think we should open a followup issue for this? There is definitely something crazy going on here, it adds a considerable amount of time to tasks like precommit, documentation-lint, release packaging, smoke testing, etc. ",
            "author": "Robert Muir",
            "id": "comment-13793780"
        },
        {
            "date": "2013-10-13T21:04:33+0000",
            "content": "Commit 1531750 from Steve Rowe in branch 'dev/trunk'\n[ https://svn.apache.org/r1531750 ]\n\nLUCENE-5273: Fix slowdown when running 'ant example': unless called from the 'create-package' target, the 'lucene-jars-to-solr' and 'module-jars-to-solr' targets no longer depend on 'unpack-lucene-tgz', pulling lucene.jar from lucene/build// instead. ",
            "author": "ASF subversion and git services",
            "id": "comment-13793781"
        },
        {
            "date": "2013-10-13T21:05:43+0000",
            "content": "Mark Miller, do you want this on the 4.5 release branch?\n\nI'll defer to those of you deeper into the issue, but from a high level, to me it does not seem worth the gain vs the risk for 4.5.1. ",
            "author": "Mark Miller",
            "id": "comment-13793782"
        },
        {
            "date": "2013-10-13T21:15:29+0000",
            "content": "I agree with Mark: as much as I like the change, and even though I consider it a \"bug\", I think its best to be conservative and to just fix this for 4.6?  ",
            "author": "Robert Muir",
            "id": "comment-13793784"
        },
        {
            "date": "2013-10-13T22:11:59+0000",
            "content": "Commit 1531759 from Steve Rowe in branch 'dev/branches/branch_4x'\n[ https://svn.apache.org/r1531759 ]\n\nLUCENE-5273: Fix slowdown when running 'ant example': unless called from the 'create-package' target, the 'lucene-jars-to-solr' and 'module-jars-to-solr' targets no longer depend on 'unpack-lucene-tgz', pulling lucene.jar from lucene/build// instead. (merged trunk r1531750) ",
            "author": "ASF subversion and git services",
            "id": "comment-13793803"
        },
        {
            "date": "2013-10-13T22:18:05+0000",
            "content": "Slowdown fix committed to trunk and branch_4x.\n\nI won't backport any of this to the lucene_solr_4_5 branch.\n\nThanks guys! ",
            "author": "Steve Rowe",
            "id": "comment-13793808"
        }
    ]
}