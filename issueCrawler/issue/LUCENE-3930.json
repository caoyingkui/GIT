{
    "id": "LUCENE-3930",
    "title": "nuke jars from source tree and use ivy",
    "details": {
        "labels": "",
        "priority": "Blocker",
        "components": [
            "general/build"
        ],
        "type": "Task",
        "fix_versions": [
            "3.6",
            "4.0-ALPHA"
        ],
        "affect_versions": "None",
        "resolution": "Fixed",
        "status": "Closed"
    },
    "description": "As mentioned on the ML thread: \"switch jars to ivy mechanism?\".",
    "attachments": {
        "LUCENE-3930__ivy_bootstrap_target.patch": "https://issues.apache.org/jira/secure/attachment/12520499/LUCENE-3930__ivy_bootstrap_target.patch",
        "LUCENE-3930-skip-sources-javadoc.patch": "https://issues.apache.org/jira/secure/attachment/12520533/LUCENE-3930-skip-sources-javadoc.patch",
        "langdetect-1.1.jar": "https://issues.apache.org/jira/secure/attachment/12521104/langdetect-1.1.jar",
        "patch-jetty-build.patch": "https://issues.apache.org/jira/secure/attachment/12520367/patch-jetty-build.patch",
        "ant_-verbose_clean_test.out.txt": "https://issues.apache.org/jira/secure/attachment/12520356/ant_-verbose_clean_test.out.txt",
        "pom.xml": "https://issues.apache.org/jira/secure/attachment/12520869/pom.xml",
        "noggit-commons-csv.patch": "https://issues.apache.org/jira/secure/attachment/12520410/noggit-commons-csv.patch",
        "LUCENE-3930-solr-example.patch": "https://issues.apache.org/jira/secure/attachment/12520261/LUCENE-3930-solr-example.patch",
        "LUCENE-3930.patch": "https://issues.apache.org/jira/secure/attachment/12520203/LUCENE-3930.patch",
        "LUCENE-3930_includetestlibs_excludeexamplexml.patch": "https://issues.apache.org/jira/secure/attachment/12520802/LUCENE-3930_includetestlibs_excludeexamplexml.patch"
    },
    "issue_links": {},
    "comments": [
        {
            "date": "2012-03-27T22:19:34+0000",
            "content": "prototype patch for the lucene core.\n\nYou dont need to do anything special for this patch to work: 'ant test' etc works as usual (though only for lucene-core!!!)\n\ni nuked all the libs in lucene/lib/ (junit, ant, ant-junit).\n\nThese are instead dependencies of the test-framework.\n\nI have no idea what uses this maven-ant-tasks.jar thats still there, or where to fetch it from, but maybe Steve knows  ",
            "author": "Robert Muir",
            "id": "comment-13240000"
        },
        {
            "date": "2012-03-27T22:32:00+0000",
            "content": "I have no idea what uses this maven-ant-tasks.jar thats still there, or where to fetch it from, but maybe Steve knows \n\nmaven-ant-tasks.jar is used by generate-maven-artifacts / dist-maven / m2-deploy* to deploy Maven artifacts; these are used by the Jenkins Maven builds to deploy snapshots to the Apache Snapshot repository, and up through the most recent release, to create Maven release artifacts to be published on Maven central.\n\nI unpacked the .jar and found a POM under META-INF, and it says its groupId:artifactId:version coordinates are org.apache.maven:maven-ant-tasks:2.1.3, which is available from the Maven Central repository at http://repo1.maven.org/maven2/org/apache/maven/maven-ant-tasks/2.1.3/. ",
            "author": "Steve Rowe",
            "id": "comment-13240017"
        },
        {
            "date": "2012-03-27T22:38:44+0000",
            "content": "so you could simply fetch it with ivy and make it available to ant using <ivy:cachepatch pathid=\"foobar\"/> and then load the targets from the classpath in classpathref=\"foobar\".\n\nLike that:\n\n<ivy:cachepath organisation=\"emma\" module=\"emma\" revision=\"2.0.4217\" inline=\"true\" conf=\"ant\" pathid=\"emma.classpath\"/>\n<taskdef resource=\"emma_ant.properties\" classpathref=\"emma.classpath\" /> \n\n\n\nThanks! ",
            "author": "Uwe Schindler",
            "id": "comment-13240023"
        },
        {
            "date": "2012-03-27T22:41:51+0000",
            "content": "\nso you could simply fetch it with ivy and make it available to ant using <ivy:cachepatch classpathref=\"foobar\"/> and then load the targets from the classpath in ref=\"foobar\".\n\nI'm not gonna do that now: thats an optimization. Various ant tasks expect libs to be in lib/, so I want to populate lib/, not rewrite the build system.  ",
            "author": "Robert Muir",
            "id": "comment-13240024"
        },
        {
            "date": "2012-03-27T23:03:38+0000",
            "content": "I already implemented it  ",
            "author": "Uwe Schindler",
            "id": "comment-13240036"
        },
        {
            "date": "2012-03-27T23:08:57+0000",
            "content": "Here the patch with the maven-ant-tasks. It works theoretcally, but the dependent tasks dont completely work at the moment. ",
            "author": "Uwe Schindler",
            "id": "comment-13240043"
        },
        {
            "date": "2012-03-27T23:14:45+0000",
            "content": "Thanks: i will look at maven-ant-tasks. I have dependent tasks working (e.g. all of lucene+contrib+modules) currently... patch coming soon. ",
            "author": "Robert Muir",
            "id": "comment-13240049"
        },
        {
            "date": "2012-03-27T23:38:23+0000",
            "content": "updated patch:\n\n\tcore+contrib+modules work. though we need to remove jars and move to dependencies.\n\ti found the source of the maven-ant-tasks OOM that hits us in prepare-release. It hit me here too. The problem is that you should not allow the taskdef to run in dist-maven if it already ran. so the one for ivy has unless=ivy.uptodate (which sits in that uptodateAndCompiled propset). Finally i ensured the modules 'crawl' passes this around. We should fix dist-maven the same way.\n\tbogusly every contrib/module currently needs an ivy.xml (even with no dependencies). I'd like to remove this but i just havent mucked with it yet.\n\n ",
            "author": "Robert Muir",
            "id": "comment-13240061"
        },
        {
            "date": "2012-03-27T23:46:52+0000",
            "content": "I will make a heavy committing branch for this issue. I think we can solve this soon! ",
            "author": "Robert Muir",
            "id": "comment-13240064"
        },
        {
            "date": "2012-03-28T00:10:50+0000",
            "content": "Created branch: https://svn.apache.org/repos/asf/lucene/dev/branches/lucene3930 ",
            "author": "Robert Muir",
            "id": "comment-13240069"
        },
        {
            "date": "2012-03-28T00:12:57+0000",
            "content": "Great stuff Robert.  I've come into the discussion a little late but I'll help where I can.\n\n\nbogusly every contrib/module currently needs an ivy.xml (even with no dependencies). I'd like to remove this but i just havent mucked with it yet.\n\nI don't think this is so bad? It shows that the contrib/module is properly configured and that the ivy integration was 'done' when the module was created.  I think it might also help IDEs if every module is consistent. ",
            "author": "Chris Male",
            "id": "comment-13240071"
        },
        {
            "date": "2012-03-28T00:19:34+0000",
            "content": "Committed Uwe's patch for dist-maven. I also added OOM Protection (\u00a9), but its still broken\nfor the modules/analysis which recurses into all the submodules. This needs to be fixed to\nwork like contrib-crawl/modules top-level crawl. But this is nothing new and really unrelated\nto this issue... ",
            "author": "Robert Muir",
            "id": "comment-13240075"
        },
        {
            "date": "2012-03-28T00:43:27+0000",
            "content": "Should I move the notice files from lucene/lib to lucene/test-framework/lib? ",
            "author": "Chris Male",
            "id": "comment-13240080"
        },
        {
            "date": "2012-03-28T00:48:09+0000",
            "content": "they should be moved. also test-framework/lib should get an svn:ignore of *.jar ",
            "author": "Robert Muir",
            "id": "comment-13240081"
        },
        {
            "date": "2012-03-28T11:22:57+0000",
            "content": "Patch for addressing Solr's example/lib jars.\nAdds a build.xml and ivy.xml to solr/example  \n\nI haven't committed this since I'm unsure its the best way forward.  I've explored other options with ivy (through the use of confs for example) and there doesn't seem to be any other clean way. ",
            "author": "Chris Male",
            "id": "comment-13240352"
        },
        {
            "date": "2012-03-28T12:29:01+0000",
            "content": "This has a few other benefits.  We can move the other targets related to the example to example/build.xml and tie in the resolve target. ",
            "author": "Chris Male",
            "id": "comment-13240371"
        },
        {
            "date": "2012-03-28T12:44:15+0000",
            "content": "Lets defer any unnecessary refactoring (even if it has benefits) to other issues.\n\nI think we want the minimal (reasonable) patch here that works as close as possible\nto the ant build: given the incubator discussion about jars, unfortunately I think \nwe need to backport this to 3.6.\n\nSo its important to keep everything as close as possible to what it was before so that\npackaging tasks, etc work.\n\nSeeing how things got working for solr I think we may want to revert even the test-framework/lib\nand go back to lucene/lib intentionally just for this purpose: I'll look into this. ",
            "author": "Robert Muir",
            "id": "comment-13240377"
        },
        {
            "date": "2012-03-28T12:48:57+0000",
            "content": "Lets defer any unnecessary refactoring (even if it has benefits) to other issues.\n\nAbsolutely, just adding more information to chew over here. ",
            "author": "Chris Male",
            "id": "comment-13240378"
        },
        {
            "date": "2012-03-28T12:52:00+0000",
            "content": "I think the patch is fine, but it doesn't need to override ivy.retrieve.pattern, \nexample/lib is already its default. ",
            "author": "Robert Muir",
            "id": "comment-13240379"
        },
        {
            "date": "2012-03-28T12:57:06+0000",
            "content": "Patch without pattern override.  I'll pick up where I left off in the AM. ",
            "author": "Chris Male",
            "id": "comment-13240381"
        },
        {
            "date": "2012-03-28T12:59:45+0000",
            "content": "Thanks for all the help!!!!!!! ",
            "author": "Robert Muir",
            "id": "comment-13240385"
        },
        {
            "date": "2012-03-28T13:04:46+0000",
            "content": "Now we have the problematic patched jars and the renamed unreleased jars.\n\nI will start with the patched ones: these are the worst case.\nI will look to see if we can have our patch file sitting in svn,\nwe download the sources (not jar), patch with the patch file,\nand compile the thing up.\n ",
            "author": "Robert Muir",
            "id": "comment-13240387"
        },
        {
            "date": "2012-03-29T01:06:15+0000",
            "content": "FWIW.... i did a completley clean checkout of the lucene3930 (r1306662) and got the following build failure trying to run \"ant clean test\" from the top level.\n\nthe ivy bootstraping doesn't seem to play nicely with the license checker...\n\n\nhossman@bester:~/lucene/branch_lucene3930$ ant clean test\nBuildfile: build.xml\n\nclean:\n\nclean:\n\nclean:\n\nclean:\n     [echo] Building analyzers-common...\n\nclean:\n     [echo] Building analyzers-icu...\n\nclean:\n     [echo] Building analyzers-kuromoji...\n\nclean:\n     [echo] Building analyzers-morfologik...\n\nclean:\n     [echo] Building analyzers-phonetic...\n\nclean:\n     [echo] Building analyzers-smartcn...\n\nclean:\n     [echo] Building analyzers-stempel...\n\nclean:\n     [echo] Building analyzers-uima...\n\nclean:\n     [echo] Building benchmark...\n\nclean:\n     [echo] Building facet...\n\nclean:\n     [echo] Building grouping...\n\nclean:\n     [echo] Building join...\n\nclean:\n     [echo] Building queries...\n\nclean:\n     [echo] Building queryparser...\n\nclean:\n     [echo] Building spatial...\n\nclean:\n     [echo] Building suggest...\n\nclean:\n     [echo] Building solr...\n\nclean:\n\nvalidate:\n\ncompile-tools:\n\ndownload-ivy:\n    [mkdir] Created dir: /home/hossman/lucene/branch_lucene3930/lucene/ivy\n     [echo] \n     [echo]       NOTE: You do not have ivy installed, so downloading it...\n     [echo]       If you make lots of checkouts, download ivy-2.2.0.jar yourself \n     [echo]       and set ivy.jar.file to this in your ~/build.properties\n     [echo]       \n      [get] Getting: http://repo1.maven.org/maven2/org/apache/ivy/ivy/2.2.0/ivy-2.2.0.jar\n      [get] To: /home/hossman/lucene/branch_lucene3930/lucene/ivy/ivy-2.2.0.jar\n\ninstall-ivy:\n\nresolve:\n[ivy:retrieve] :: Ivy 2.2.0 - 20100923230623 :: http://ant.apache.org/ivy/ ::\n[ivy:retrieve] :: loading settings :: url = jar:file:/home/hossman/lucene/branch_lucene3930/lucene/ivy/ivy-2.2.0.jar!/org/apache/ivy/core/settings/ivysettings.xml\n\ninit:\n\ncompile-core:\n    [mkdir] Created dir: /home/hossman/lucene/branch_lucene3930/lucene/build/tools/classes/java\n    [javac] Compiling 2 source files to /home/hossman/lucene/branch_lucene3930/lucene/build/tools/classes/java\n     [copy] Copying 1 file to /home/hossman/lucene/branch_lucene3930/lucene/build/tools/classes/java\n\nvalidate:\n     [echo] License check under: /home/hossman/lucene/branch_lucene3930/lucene\n [licenses] MISSING LICENSE for the following file:\n [licenses]   /home/hossman/lucene/branch_lucene3930/lucene/ivy/ivy-2.2.0.jar\n [licenses]   Expected locations below:\n [licenses]   => /home/hossman/lucene/branch_lucene3930/lucene/ivy/ivy-LICENSE-ASL.txt\n [licenses]   => /home/hossman/lucene/branch_lucene3930/lucene/ivy/ivy-LICENSE-BSD.txt\n [licenses]   => /home/hossman/lucene/branch_lucene3930/lucene/ivy/ivy-LICENSE-BSD_LIKE.txt\n [licenses]   => /home/hossman/lucene/branch_lucene3930/lucene/ivy/ivy-LICENSE-CDDL.txt\n [licenses]   => /home/hossman/lucene/branch_lucene3930/lucene/ivy/ivy-LICENSE-CPL.txt\n [licenses]   => /home/hossman/lucene/branch_lucene3930/lucene/ivy/ivy-LICENSE-EPL.txt\n [licenses]   => /home/hossman/lucene/branch_lucene3930/lucene/ivy/ivy-LICENSE-MIT.txt\n [licenses]   => /home/hossman/lucene/branch_lucene3930/lucene/ivy/ivy-LICENSE-MPL.txt\n [licenses]   => /home/hossman/lucene/branch_lucene3930/lucene/ivy/ivy-LICENSE-PD.txt\n [licenses]   => /home/hossman/lucene/branch_lucene3930/lucene/ivy/ivy-LICENSE-SUN.txt\n [licenses]   => /home/hossman/lucene/branch_lucene3930/lucene/ivy/ivy-LICENSE-COMPOUND.txt\n [licenses]   => /home/hossman/lucene/branch_lucene3930/lucene/ivy/ivy-LICENSE-FAKE.txt\n [licenses] Scanned 1 JAR file(s) for licenses (in 0.31s.), 1 error(s).\n\nBUILD FAILED\n/home/hossman/lucene/branch_lucene3930/build.xml:42: The following error occurred while executing this line:\n/home/hossman/lucene/branch_lucene3930/lucene/build.xml:178: The following error occurred while executing this line:\n/home/hossman/lucene/branch_lucene3930/lucene/tools/custom-tasks.xml:22: License check failed. Check the logs.\n\nTotal time: 5 seconds\n\n ",
            "author": "Hoss Man",
            "id": "comment-13240864"
        },
        {
            "date": "2012-03-29T01:24:37+0000",
            "content": "Thanks hoss, I will add in a LICENSE and NOTICE for ivy. ",
            "author": "Chris Male",
            "id": "comment-13240877"
        },
        {
            "date": "2012-03-29T01:59:19+0000",
            "content": "I did a touch /home/hossman/lucene/branch_lucene3930/lucene/ivy/ivy-LICENSE-FAKE.txt to work around the license checker and this time i wound up with an OOM...\n\n\nhossman@bester:~/lucene/branch_lucene3930$ ant clean test\n....\ncommon.compile-test:\n    [mkdir] Created dir: /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/sandbox/classes/test\n    [javac] Compiling 6 source files to /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/sandbox/classes/test\n    [javac] Note: Some input files use or override a deprecated API.\n    [javac] Note: Recompile with -Xlint:deprecation for details.\n     [copy] Copied 1 empty directory to 1 empty directory under /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/sandbox/classes/test\n\ntest-contrib:\n     [echo] Building demo...\n\ndownload-ivy:\n\ninstall-ivy:\n\nresolve:\n[ivy:retrieve] :: Ivy 2.2.0 - 20100923230623 :: http://ant.apache.org/ivy/ ::\n[ivy:retrieve] :: loading settings :: url = jar:file:/home/hossman/lucene/branch_lucene3930/lucene/ivy/ivy-2.2.0.jar!/org/apache/ivy/core/settings/ivysettings.xml\njava.lang.OutOfMemoryError: PermGen space\njava.lang.OutOfMemoryError: PermGen space\n\tat java.lang.Throwable.getStackTraceElement(Native Method)\n\tat java.lang.Throwable.getOurStackTrace(Throwable.java:591)\n\tat java.lang.Throwable.printStackTrace(Throwable.java:462)\n\tat java.lang.Throwable.printStackTrace(Throwable.java:451)\n\tat org.apache.tools.ant.Main.startAnt(Main.java:230)\n\tat org.apache.tools.ant.launch.Launcher.run(Launcher.java:257)\n\tat org.apache.tools.ant.launch.Launcher.main(Launcher.java:104)\n\n\n\nrunning with \"-verbose\" to see if i can get more details on exactly where/why the OOM is happening ",
            "author": "Hoss Man",
            "id": "comment-13240912"
        },
        {
            "date": "2012-03-29T02:07:37+0000",
            "content": "here's the tail end of \"ant -verbose clean test\"...\n\n\nhossman@bester:~/lucene/branch_lucene3930$ ant -verbose clean test\n\n...\n\ncompile-test-framework:\nSkipped because property 'lucene.test.framework.compiled' set.\n\ncommon.compile-test:\n    [mkdir] Skipping /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test because it already exists.\nProperty \"run.clover\" has not been set\n    [javac] org/apache/lucene/demo/TestDemo.java omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test/org/apache/lucene/demo/TestDemo.class is up to date.\n    [javac] /home/hossman/lucene/branch_lucene3930/lucene/contrib/demo/src/test/org/apache/lucene/demo/test-files/docs/apache1.0.txt skipped - don't know how to handle it\n    [javac] /home/hossman/lucene/branch_lucene3930/lucene/contrib/demo/src/test/org/apache/lucene/demo/test-files/docs/apache1.1.txt skipped - don't know how to handle it\n    [javac] /home/hossman/lucene/branch_lucene3930/lucene/contrib/demo/src/test/org/apache/lucene/demo/test-files/docs/apache2.0.txt skipped - don't know how to handle it\n    [javac] /home/hossman/lucene/branch_lucene3930/lucene/contrib/demo/src/test/org/apache/lucene/demo/test-files/docs/cpl1.0.txt skipped - don't know how to handle it\n    [javac] /home/hossman/lucene/branch_lucene3930/lucene/contrib/demo/src/test/org/apache/lucene/demo/test-files/docs/epl1.0.txt skipped - don't know how to handle it\n    [javac] /home/hossman/lucene/branch_lucene3930/lucene/contrib/demo/src/test/org/apache/lucene/demo/test-files/docs/freebsd.txt skipped - don't know how to handle it\n    [javac] /home/hossman/lucene/branch_lucene3930/lucene/contrib/demo/src/test/org/apache/lucene/demo/test-files/docs/gpl1.0.txt skipped - don't know how to handle it\n    [javac] /home/hossman/lucene/branch_lucene3930/lucene/contrib/demo/src/test/org/apache/lucene/demo/test-files/docs/gpl2.0.txt skipped - don't know how to handle it\n    [javac] /home/hossman/lucene/branch_lucene3930/lucene/contrib/demo/src/test/org/apache/lucene/demo/test-files/docs/gpl3.0.txt skipped - don't know how to handle it\n    [javac] /home/hossman/lucene/branch_lucene3930/lucene/contrib/demo/src/test/org/apache/lucene/demo/test-files/docs/lgpl2.1.txt skipped - don't know how to handle it\n    [javac] /home/hossman/lucene/branch_lucene3930/lucene/contrib/demo/src/test/org/apache/lucene/demo/test-files/docs/lgpl3.txt skipped - don't know how to handle it\n    [javac] /home/hossman/lucene/branch_lucene3930/lucene/contrib/demo/src/test/org/apache/lucene/demo/test-files/docs/lpgl2.0.txt skipped - don't know how to handle it\n    [javac] /home/hossman/lucene/branch_lucene3930/lucene/contrib/demo/src/test/org/apache/lucene/demo/test-files/docs/mit.txt skipped - don't know how to handle it\n    [javac] /home/hossman/lucene/branch_lucene3930/lucene/contrib/demo/src/test/org/apache/lucene/demo/test-files/docs/mozilla1.1.txt skipped - don't know how to handle it\n    [javac] /home/hossman/lucene/branch_lucene3930/lucene/contrib/demo/src/test/org/apache/lucene/demo/test-files/docs/mozilla_eula_firefox3.txt skipped - don't know how to handle it\n    [javac] /home/hossman/lucene/branch_lucene3930/lucene/contrib/demo/src/test/org/apache/lucene/demo/test-files/docs/mozilla_eula_thunderbird2.txt skipped - don't know how to handle it\n     [copy] org/apache/lucene/demo/test-files/docs/apache1.0.txt omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test/org/apache/lucene/demo/test-files/docs/apache1.0.txt is up to date.\n     [copy] org/apache/lucene/demo/test-files/docs/apache1.1.txt omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test/org/apache/lucene/demo/test-files/docs/apache1.1.txt is up to date.\n     [copy] org/apache/lucene/demo/test-files/docs/apache2.0.txt omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test/org/apache/lucene/demo/test-files/docs/apache2.0.txt is up to date.\n     [copy] org/apache/lucene/demo/test-files/docs/cpl1.0.txt omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test/org/apache/lucene/demo/test-files/docs/cpl1.0.txt is up to date.\n     [copy] org/apache/lucene/demo/test-files/docs/epl1.0.txt omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test/org/apache/lucene/demo/test-files/docs/epl1.0.txt is up to date.\n     [copy] org/apache/lucene/demo/test-files/docs/freebsd.txt omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test/org/apache/lucene/demo/test-files/docs/freebsd.txt is up to date.\n     [copy] org/apache/lucene/demo/test-files/docs/gpl1.0.txt omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test/org/apache/lucene/demo/test-files/docs/gpl1.0.txt is up to date.\n     [copy] org/apache/lucene/demo/test-files/docs/gpl2.0.txt omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test/org/apache/lucene/demo/test-files/docs/gpl2.0.txt is up to date.\n     [copy] org/apache/lucene/demo/test-files/docs/gpl3.0.txt omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test/org/apache/lucene/demo/test-files/docs/gpl3.0.txt is up to date.\n     [copy] org/apache/lucene/demo/test-files/docs/lgpl2.1.txt omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test/org/apache/lucene/demo/test-files/docs/lgpl2.1.txt is up to date.\n     [copy] org/apache/lucene/demo/test-files/docs/lgpl3.txt omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test/org/apache/lucene/demo/test-files/docs/lgpl3.txt is up to date.\n     [copy] org/apache/lucene/demo/test-files/docs/lpgl2.0.txt omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test/org/apache/lucene/demo/test-files/docs/lpgl2.0.txt is up to date.\n     [copy] org/apache/lucene/demo/test-files/docs/mit.txt omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test/org/apache/lucene/demo/test-files/docs/mit.txt is up to date.\n     [copy] org/apache/lucene/demo/test-files/docs/mozilla1.1.txt omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test/org/apache/lucene/demo/test-files/docs/mozilla1.1.txt is up to date.\n     [copy] org/apache/lucene/demo/test-files/docs/mozilla_eula_firefox3.txt omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test/org/apache/lucene/demo/test-files/docs/mozilla_eula_firefox3.txt is up to date.\n     [copy] org/apache/lucene/demo/test-files/docs/mozilla_eula_thunderbird2.txt omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test/org/apache/lucene/demo/test-files/docs/mozilla_eula_thunderbird2.txt is up to date.\n     [copy]  omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test is up to date.\n     [copy] org omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test/org is up to date.\n     [copy] org/apache omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test/org/apache is up to date.\n     [copy] org/apache/lucene omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test/org/apache/lucene is up to date.\n     [copy] org/apache/lucene/demo omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test/org/apache/lucene/demo is up to date.\n     [copy] org/apache/lucene/demo/test-files omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test/org/apache/lucene/demo/test-files is up to date.\n     [copy] org/apache/lucene/demo/test-files/docs omitted as /home/hossman/lucene/branch_lucene3930/lucene/build/contrib/demo/classes/test/org/apache/lucene/demo/test-files/docs is up to date.\n  [antcall] Exiting /home/hossman/lucene/branch_lucene3930/lucene/contrib/demo/build.xml.\n\ncompile-tools:\nDetected Java version: 1.6 in: /usr/lib/jvm/java-6-sun-1.6.0.24/jre\nDetected OS: Linux\nProject base dir set to: /home/hossman/lucene/branch_lucene3930/lucene/tools\n      [ant] calling target(s) [compile-core] in build file /home/hossman/lucene/branch_lucene3930/lucene/tools/build.xml\nparsing buildfile /home/hossman/lucene/branch_lucene3930/lucene/tools/build.xml with URI = file:/home/hossman/lucene/branch_lucene3930/lucene/tools/build.xml\nProject base dir set to: /home/hossman/lucene/branch_lucene3930/lucene/tools\nImporting file /home/hossman/lucene/branch_lucene3930/lucene/common-build.xml from /home/hossman/lucene/branch_lucene3930/lucene/tools/build.xml\nparsing buildfile /home/hossman/lucene/branch_lucene3930/lucene/common-build.xml with URI = file:/home/hossman/lucene/branch_lucene3930/lucene/common-build.xml\nAlready defined in main or a previous import, ignore compile-core\nAlready defined in main or a previous import, ignore javadocs\n [property] Loading /home/hossman/lucene.build.properties\n [property] Unable to find property file: /home/hossman/lucene.build.properties\n [property] Loading /home/hossman/build.properties\n [property] Unable to find property file: /home/hossman/build.properties\n [property] Loading /home/hossman/lucene/branch_lucene3930/lucene/tools/build.properties\n [property] Unable to find property file: /home/hossman/lucene/branch_lucene3930/lucene/tools/build.properties\n [property] Loading /home/hossman/lucene/branch_lucene3930/lucene/build.properties\n [property] Unable to find property file: /home/hossman/lucene/branch_lucene3930/lucene/build.properties\nOverride ignored for property \"DSTAMP\"\nOverride ignored for property \"TSTAMP\"\n[available] Found: /home/hossman/lucene/branch_lucene3930/lucene/ivy/ivy-2.2.0.jar\nProperty \"run.clover\" has not been set\n[available] Found: javadoc/java6/package-list\nOverride ignored for property \"build.dir\"\n[available] Unable to load class com.cenqua.clover.tasks.CloverReportTask to set property clover.present\nImporting file /home/hossman/lucene/branch_lucene3930/lucene/tools/custom-tasks.xml from /home/hossman/lucene/branch_lucene3930/lucene/common-build.xml\nparsing buildfile /home/hossman/lucene/branch_lucene3930/lucene/tools/custom-tasks.xml with URI = file:/home/hossman/lucene/branch_lucene3930/lucene/tools/custom-tasks.xml\n [macrodef] creating macro  license-check-macro\nTrying to override old definition of task m2-deploy\n [macrodef] creating macro  m2-deploy\n [macrodef] creating macro  m2-deploy-with-pom-template\nTrying to override old definition of task build-manifest\n [macrodef] creating macro  build-manifest\nTrying to override old definition of task jarify\n [macrodef] creating macro  jarify\n [macrodef] creating macro  module-uptodate\n [macrodef] creating macro  compile-test-macro\nTrying to override old definition of task test-macro\n [macrodef] creating macro  test-macro\n[available] Unable to find file pom.xml to set property pom.xml.present\n [macrodef] creating macro  compile\n [macrodef] creating macro  invoke-javacc\nTrying to override old definition of task invoke-javadoc\n [macrodef] creating macro  invoke-javadoc\n [macrodef] creating macro  contrib-crawl\n [macrodef] creating macro  svn-export-source\n [macrodef] creating macro  get-svn-info\n [macrodef] creating macro  make-checksums\n [macrodef] creating macro  sign-artifacts-macro\n [macrodef] creating macro  copy-to-stage-macro\n      [ant] Entering /home/hossman/lucene/branch_lucene3930/lucene/tools/build.xml...\nBuild sequence for target(s) `compile-core' is [download-ivy, install-ivy, resolve, init, compile-core]\nComplete build sequence is [download-ivy, install-ivy, resolve, init, compile-core, compile-tools, validate, common.init, common.download-java6-javadoc-packagelist, common.install-ivy, check-analyzers-common-uptodate, common.clover.check, common.jar-core, clover.setup, junit-sequential, clover.info, clover, common.compile-core, junit-mkdir, compile-test-framework, compile-test, check-lucene-core-uptodate, common.jflex-uptodate-check, jar-core, jar-src, javadocs, install-maven-tasks, common.dist-maven, common.junit-mkdir, common.clean, check-queries-uptodate, jar-queries, javacc-uptodate-check, common.generate-test-reports, rat-sources-typedef, rat-sources, jflex-uptodate-check, common.javadocs, jar, javacc-check, jflex-check, dist-maven, default, jflex-notice, common.jar-lucene-core, common.javacc-notice, common.compile-tools, common.jar-queries, common.jar-src, common.rat-sources, compile-lucene-core, download-java6-javadoc-packagelist, common.clover.setup, common.default, junit-parallel, test, common.clover, common.junit-sequential, jar-lucene-core, common.jflex-check, clover.check, common.check-queryparser-uptodate, common.compile-test, common.jar-analyzers-common, compile, clean, common.clover.info, common.validate, common.download-ivy, check-queryparser-uptodate, common.jar-queryparser, common.check-analyzers-common-uptodate, generate-test-reports, common.javacc-uptodate-check, common.resolve, common.javacc-check, common.install-maven-tasks, common.rat-sources-typedef, jar-queryparser, common.compile-test-framework, jar-analyzers-common, common.compile-lucene-core, common.junit-parallel, common.jar, common.jflex-notice, common.check-queries-uptodate, javacc-notice, common.compile, common.check-lucene-core-uptodate, common.test, ]\n\ndownload-ivy:\nSkipped because property 'ivy.available' set.\n\ninstall-ivy:\nparsing buildfile jar:file:/home/hossman/lucene/branch_lucene3930/lucene/ivy/ivy-2.2.0.jar!/org/apache/ivy/ant/antlib.xml with URI = jar:file:/home/hossman/lucene/branch_lucene3930/lucene/ivy/ivy-2.2.0.jar!/org/apache/ivy/ant/antlib.xml\nTrying to override old definition of datatype antlib:org.apache.ivy.ant:settings\nTrying to override old definition of task antlib:org.apache.ivy.ant:configure\nTrying to override old definition of task antlib:org.apache.ivy.ant:resolve\nTrying to override old definition of task antlib:org.apache.ivy.ant:retrieve\nTrying to override old definition of task antlib:org.apache.ivy.ant:deliver\nTrying to override old definition of task antlib:org.apache.ivy.ant:publish\nTrying to override old definition of task antlib:org.apache.ivy.ant:extract\nTrying to override old definition of task antlib:org.apache.ivy.ant:cachepath\nTrying to override old definition of task antlib:org.apache.ivy.ant:cachefileset\nTrying to override old definition of task antlib:org.apache.ivy.ant:report\nTrying to override old definition of task antlib:org.apache.ivy.ant:repreport\nTrying to override old definition of task antlib:org.apache.ivy.ant:var\nTrying to override old definition of task antlib:org.apache.ivy.ant:check\nTrying to override old definition of task antlib:org.apache.ivy.ant:artifactproperty\nTrying to override old definition of task antlib:org.apache.ivy.ant:buildlist\nTrying to override old definition of task antlib:org.apache.ivy.ant:install\nTrying to override old definition of task antlib:org.apache.ivy.ant:convertpom\nTrying to override old definition of task antlib:org.apache.ivy.ant:makepom\nTrying to override old definition of task antlib:org.apache.ivy.ant:artifactreport\nTrying to override old definition of task antlib:org.apache.ivy.ant:info\nTrying to override old definition of task antlib:org.apache.ivy.ant:addpath\nTrying to override old definition of task antlib:org.apache.ivy.ant:listmodules\nTrying to override old definition of task antlib:org.apache.ivy.ant:findrevision\nTrying to override old definition of task antlib:org.apache.ivy.ant:buildnumber\nTrying to override old definition of task antlib:org.apache.ivy.ant:cleancache\n\nresolve:\n[ivy:retrieve] No ivy:settings found for the default reference 'ivy.instance'.  A default instance will be used\n[ivy:retrieve] Loading jar:file:/home/hossman/lucene/branch_lucene3930/lucene/ivy/ivy-2.2.0.jar!/org/apache/ivy/core/settings/ivy.properties\n[ivy:retrieve] searching settings file: trying /home/hossman/lucene/branch_lucene3930/lucene/tools/ivysettings.xml\n[ivy:retrieve] searching settings file: trying /home/hossman/lucene/branch_lucene3930/lucene/tools/ivyconf.xml\n[ivy:retrieve] searching settings file: trying ivysettings.xml\n[ivy:retrieve] searching settings file: trying ivyconf.xml\n[ivy:retrieve] no settings file found, using default...\n[ivy:retrieve] :: Ivy 2.2.0 - 20100923230623 :: http://ant.apache.org/ivy/ ::\n[ivy:retrieve] jakarta commons httpclient not found: using jdk url handling\n[ivy:retrieve] :: loading settings :: url = jar:file:/home/hossman/lucene/branch_lucene3930/lucene/ivy/ivy-2.2.0.jar!/org/apache/ivy/core/settings/ivysettings.xml\n[ivy:retrieve] no default ivy user dir defined: set to /home/hossman/.ivy2\n[ivy:retrieve] including url: jar:file:/home/hossman/lucene/branch_lucene3930/lucene/ivy/ivy-2.2.0.jar!/org/apache/ivy/core/settings/ivysettings-public.xml\n      [ant] Exiting /home/hossman/lucene/branch_lucene3930/lucene/tools/build.xml.\n  [antcall] Exiting /home/hossman/lucene/branch_lucene3930/lucene/contrib/demo/build.xml.\n   [subant] Exiting /home/hossman/lucene/branch_lucene3930/lucene/contrib/demo/build.xml.\n   [subant] Exiting /home/hossman/lucene/branch_lucene3930/lucene/build.xml.\njava.lang.OutOfMemoryError: PermGen space\n\tat org.apache.tools.ant.DefaultLogger.formatTime(DefaultLogger.java:323)\n\tat org.apache.tools.ant.DefaultLogger.buildFinished(DefaultLogger.java:170)\n\tat org.apache.tools.ant.Project.fireBuildFinished(Project.java:2037)\n\tat org.apache.tools.ant.Main.runBuild(Main.java:778)\n\tat org.apache.tools.ant.Main.startAnt(Main.java:217)\n\tat org.apache.tools.ant.launch.Launcher.run(Launcher.java:257)\n\tat org.apache.tools.ant.launch.Launcher.main(Launcher.java:104)\nPermGen space\n\n ",
            "author": "Hoss Man",
            "id": "comment-13240918"
        },
        {
            "date": "2012-03-29T02:33:55+0000",
            "content": "Attaching full stderr/stdout of a (differnet \"ant -verbose clean test\" run that ended with another PermGen OOM...\n\n\nhossman@bester:~/lucene/branch_lucene3930$ ant -verbose clean test 2>&1 > ant_-verbose_clean_test.out.txt\njava.lang.OutOfMemoryError: PermGen space\n\tat java.lang.ClassLoader.findBootstrapClass(Native Method)\n\tat java.lang.ClassLoader.findBootstrapClassOrNull(ClassLoader.java:927)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:298)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:296)\n\tat sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:301)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:296)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:248)\n\tat org.apache.tools.ant.DefaultLogger.formatTime(DefaultLogger.java:323)\n\tat org.apache.tools.ant.DefaultLogger.buildFinished(DefaultLogger.java:170)\n\tat org.apache.tools.ant.Project.fireBuildFinished(Project.java:2037)\n\tat org.apache.tools.ant.Main.runBuild(Main.java:778)\n\tat org.apache.tools.ant.Main.startAnt(Main.java:217)\n\tat org.apache.tools.ant.launch.Launcher.run(Launcher.java:257)\n\tat org.apache.tools.ant.launch.Launcher.main(Launcher.java:104)\nPermGen space\n\n ",
            "author": "Hoss Man",
            "id": "comment-13240935"
        },
        {
            "date": "2012-03-29T02:45:32+0000",
            "content": "Now we have the problematic patched jars and the renamed unreleased jars.\n\nFor the unreleased jars, can we just include their source in our source? This would work for commons-csv and noggit which are the only two in solr/lib.  They're both very small jars with only a handful of java files.\n\nI'm running into bigger problems with the libs in the solr contrib langid.  The langdect jar is from a revision I cannot find in its googlecode project (due to a switch from svn to git) and the jsonic jar it depends on isn't available in ivy accessible repos, only version 1.2.8 is. ",
            "author": "Chris Male",
            "id": "comment-13240938"
        },
        {
            "date": "2012-03-29T03:02:10+0000",
            "content": "as far as the PermGen OOM goes, the -verbose logs show repeated instances of \"Trying to override old definition of task antlib:org.apache.ivy.ant:...\" suggesting that rmuir's unless=\"ivy.uptodate\" isn't working the way we think it should (possibly because of the way the various build files are included in one another?)\n\nIf we can't keep the <taskdef/ from running multiple times, we might be able to force it to use the same class loader each time, per the ant docs...\nhttps://ant.apache.org/manual/Tasks/typedef.html\n\nIf you are defining tasks or types that share the same classpath with multiple taskdef or typedef tasks, the corresponding classes will be loaded by different Java ClassLoaders. Two classes with the same name loaded via different ClassLoaders are not the same class from the point of view of the Java VM, they don't share static variables and instances of these classes can't access private methods or attributes of instances defined by \"the other class\" of the same name. They don't even belong to the same Java package and can't access package private code, either.\n\nThe best way to load several tasks/types that are supposed to cooperate with each other via shared Java code is to use the resource attribute and an antlib descriptor. If this is not possible, the second best option is to use the loaderref attribute and specify the same name for each and every typedef/taskdef - this way the classes will share the same ClassLoader. Note that the typedef/taskdef tasks must use identical classpath defintions (this includes the order of path components) for the loaderref attribute to work.\n...it appears it's just some unique string key to name the classloader? (no idea if it whatever is causing hte current problem will still plague by creating multiple loaders with the same name)...\nhttps://svn.apache.org/viewvc/ant/core/tags/ANT_171/src/etc/testcases/core/loaderref/ ",
            "author": "Hoss Man",
            "id": "comment-13240943"
        },
        {
            "date": "2012-03-29T04:49:10+0000",
            "content": "Proof of concept patch to show how we can download jetty, patch it, build it and copy the jars of interest into lib.\n\nI've made this against the 3930 branch but its targeting 3x of course. ",
            "author": "Chris Male",
            "id": "comment-13240966"
        },
        {
            "date": "2012-03-29T06:56:39+0000",
            "content": "\nas far as the PermGen OOM goes, the -verbose logs show repeated instances of \"Trying to override old definition of task antlib:org.apache.ivy.ant:...\" suggesting that rmuir's unless=\"ivy.uptodate\" isn't working the way we think it should (possibly because of the way the various build files are included in one another?)\n\nThats right... I don't have a good solution here yet.  ",
            "author": "Robert Muir",
            "id": "comment-13241031"
        },
        {
            "date": "2012-03-29T07:35:51+0000",
            "content": "I read up enough on that issue to know I don't want to be screwing around with it.\n\nSo you have to install ivy in your ~/.ant/lib: I removed any automagical shit, and this is now solved. ",
            "author": "Robert Muir",
            "id": "comment-13241052"
        },
        {
            "date": "2012-03-29T07:54:09+0000",
            "content": "So you have to install ivy in your ~/.ant/lib\n\nI personally don't like it when I need to install ant dependencies in a global scope \u2013 this may not be a problem from one project's perspective but if you're working on multiple projects then this can result in global dependencies shadowing project's local definitions and debugging this is a pain.\n\nNot to mention it's another requirement after checkout. I won't be able to look into this now, just expressing my opinion. ",
            "author": "Dawid Weiss",
            "id": "comment-13241056"
        },
        {
            "date": "2012-03-29T07:54:20+0000",
            "content": "\nProof of concept patch to show how we can download jetty, patch it, build it and copy the jars of interest into lib.\n\nYeah, thats how we should do it. Long term, for developers (like committers) that do this every day,\nwe can add a property you can define in your ~/build.properties declaring where a patched jar already exists\nso it doesn't slow us down: but thats an optimization for guys like us.\n\n\nI'm running into bigger problems with the libs in the solr contrib langid. The langdect jar is from a revision I cannot find in its googlecode project (due to a switch from svn to git) and the jsonic jar it depends on isn't available in ivy accessible repos, only version 1.2.8 is.\n\nOuch, i didn't notice they changed over to git... The git repository they have just doesn't correspond\nto any meaningful rev numbers (die git die), but still has the history from svn. We are going to \nhave to do a git checkout i think? ",
            "author": "Robert Muir",
            "id": "comment-13241057"
        },
        {
            "date": "2012-03-29T07:57:00+0000",
            "content": "~/build.properties\n\nAgain \u2013 can we make it project-wide (${project.home}/build.properties) or at least have a unique name (~/lucene-solr.properties)? ",
            "author": "Dawid Weiss",
            "id": "comment-13241059"
        },
        {
            "date": "2012-03-29T08:02:45+0000",
            "content": "\nI personally don't like it when I need to install ant dependencies in a global scope \u2013 this may not be a problem from one project's perspective but if you're working on multiple projects then this can result in global dependencies shadowing project's local definitions and debugging this is a pain.\n\nNot to mention it's another requirement after checkout. I won't be able to look into this now, just expressing my opinion.\n\nThere's nothing I can do about this. I spent all day trying to look for a better solution.\nYou can use ant -lib too if you want, nothing stops you from doing that.\n\nBut we have to remove all these jars, and for the build to still work. I'm sure ill piss a lot of people off. ",
            "author": "Robert Muir",
            "id": "comment-13241064"
        },
        {
            "date": "2012-03-29T08:13:47+0000",
            "content": "\nAgain \u2013 can we make it project-wide (${project.home}/build.properties) or at least have a unique name (~/lucene-solr.properties)?\n\nits always been:\n\n  <!-- Give user a chance to override without editing this file\n      (and without typing -D each time it compiles it -->\n  <property file=\"${user.home}/lucene.build.properties\"/>\n  <property file=\"${user.home}/build.properties\"/>\n  <property file=\"${basedir}/build.properties\"/>\n  <property file=\"${common.dir}/build.properties\"/>\n\n\n\n\nSo just use lucene.build.properties if you want that. ",
            "author": "Robert Muir",
            "id": "comment-13241070"
        },
        {
            "date": "2012-03-29T08:14:49+0000",
            "content": "You can use ant -lib too if you want, nothing stops you from doing that.\n\nSure, but this introduces additional complexity in setting up shell aliases or simply remembering about it. This just feels wrong somehow (making life harder instead of simpler). I may take a look at it at some point but I also remember having difficulties with multiple antlib definitions in our stuff and I believe you it's a pain. ",
            "author": "Dawid Weiss",
            "id": "comment-13241071"
        },
        {
            "date": "2012-03-29T08:21:17+0000",
            "content": "\nSure, but this introduces additional complexity in setting up shell aliases or simply remembering about it. This just feels wrong somehow (making life harder instead of simpler). I may take a look at it at some point but I also remember having difficulties with multiple antlib definitions in our stuff and I believe you it's a pain.\n\nRight but honestly, while it might not be ideal, I don't think its a blocker? Having jars in our source release is. Having the build OOM is. So I made a tradeoff.\n\nIf you (or any one else) has the time to look at stuff like this, it would be really appreciated: thats why i created a branch:\n\nhttps://svn.apache.org/repos/asf/lucene/dev/branches/lucene3930\n\nWe likely also won't have any of the IDE configurations working unless someone has the time to jump into that, and I have no idea if the maven build will break by us not having jars in the source tree. These are all things I will ignore without hesitation because they don't need to block a release. If anyone wants to fix this stuff, just start committing to the branch, i need your help... its just that simple  ",
            "author": "Robert Muir",
            "id": "comment-13241074"
        },
        {
            "date": "2012-03-29T08:36:31+0000",
            "content": "Having jars in our source release is.\n\nIs a requirement that the source release must \"build out of the box\"? Or is it about code publication only? I don't know, I'm asking. This seems like a revolutionary build change before the release \n\nHaving the build OOM is. So I made a tradeoff.\n\nI understand this, but my gut feeling still says that if you need to install ivy in an ant global space you might as well set ANT_OPTS to increase permgen... The tradeoff made is one of many.\n\ni need your help... its just that simple \n\nCan't jump into it right now, sorry. I'll take a look when I get a spare cycle though. I'm not sure it can be fixed but I'll take a look.\n ",
            "author": "Dawid Weiss",
            "id": "comment-13241083"
        },
        {
            "date": "2012-03-29T08:42:27+0000",
            "content": "\nIs a requirement that the source release must \"build out of the box\"? Or is it about code publication only? I don't know, I'm asking. This seems like a revolutionary build change before the release \n\nYeah you are telling me. trust me i'm not happy. see my note to the dev-list:\n\n\twe have an existing stable build/packaging tasks that works, and have been iterated on for 5 3.x release already.\n\tpersonally i've already tested the crap out of this branch before RC, its not just jenkins but i have my own (http://sierranevada.servebeer.com/) still running now. I was planning on cutting an RC yesterday before this shit\ncame up.\n\n\n\nSo i didnt just rush into this shit and make it blocker as some knee-jerk reaction. I don't feel i have any\nother choice.\n\nAs i said on my email, given the discussion about this on the other thread, i'd rather fix shit than argue\non mailing lists about whether our release is legal or not. If anyone else has a different opinion and is\nwilling to sacrifice days of their life arguing with apache board members instead, then stand up and we'll\ngo with whats in branch_3x now.\n\nBut given the discussion, personally I'm not going to be involved in (and will vote against) any release \nthat has jar files in the source.tgz. ",
            "author": "Robert Muir",
            "id": "comment-13241084"
        },
        {
            "date": "2012-03-29T09:04:04+0000",
            "content": "Clear. It's a pity we have to deal with it right before the release but I understand (or rather accept) the rationale. ",
            "author": "Dawid Weiss",
            "id": "comment-13241091"
        },
        {
            "date": "2012-03-29T09:10:33+0000",
            "content": "\nFWIW.... i did a completley clean checkout of the lucene3930 (r1306662) and got the following build failure trying to run \"ant clean test\" from the top level.\n\nHoss, thank you for checking out the branch and doing tests! this is really useful, i know\nthere are more nasties hanging out there... ",
            "author": "Robert Muir",
            "id": "comment-13241094"
        },
        {
            "date": "2012-03-29T10:31:23+0000",
            "content": "\nFor the unreleased jars, can we just include their source in our source? This would work for commons-csv and noggit which are the only two in solr/lib. They're both very small jars with only a handful of java files.\n\nAny opinions on this? Do I need to change the packages for anything that we put into our source?\n\n\nOuch, i didn't notice they changed over to git... The git repository they have just doesn't correspond\nto any meaningful rev numbers (die git die), but still has the history from svn. We are going to \nhave to do a git checkout i think?\n\nA checkout of head and upgrade to use that? or do a checkout of an older revision? We're going to have to checkout the jsonic source as well.\n\n\nWe likely also won't have any of the IDE configurations working unless someone has the time to jump into that, and I have no idea if the maven build will break by us not having jars in the source tree. These are all things I will ignore without hesitation because they don't need to block a release. If anyone wants to fix this stuff, just start committing to the branch, i need your help... its just that simple\n\nI think both IDE support and Maven will be fine.  The idea and eclipse targets will need to invoke resolve to ensure the libs are downloaded.  Once they're in the same place as they were before, the IDE configurations should march along fine.  Any libs we've changed the name of or dropped, we can just update the configs for.  For Maven all this work is actually going to simplify the poms.  We just need to bring the dependencies inline with the libs we have.  Both wont be big deals.\n\n ",
            "author": "Chris Male",
            "id": "comment-13241136"
        },
        {
            "date": "2012-03-29T10:36:45+0000",
            "content": "\nA checkout of head and upgrade to use that? or do a checkout of an older revision? We're going to have to checkout the jsonic source as well.\n\nI don't care as long as it works, and as long as its not 'head' but a specific revision/hashcode/whatever so its not changing... ",
            "author": "Robert Muir",
            "id": "comment-13241139"
        },
        {
            "date": "2012-03-29T10:39:36+0000",
            "content": "And for reference, the reason we used the revision we had for that, is so that we\nwould load the language profiles from the classpath and not the filesystem.\n\nIn other words, we need this change: http://code.google.com/p/language-detection/issues/detail?id=24 ",
            "author": "Robert Muir",
            "id": "comment-13241141"
        },
        {
            "date": "2012-03-29T11:52:17+0000",
            "content": "For git the revision md5 is unique and you can always do a checkout of a particular revision (typically using so-called detached head). This just moves you to a particular version in the revision tree. ",
            "author": "Dawid Weiss",
            "id": "comment-13241157"
        },
        {
            "date": "2012-03-29T11:54:31+0000",
            "content": "Patch which places noggit and commons csv under org.apache.solr.internal.* and updates everything.\n\nWill definitely need to include a package.html for the internal package detailing its role. ",
            "author": "Chris Male",
            "id": "comment-13241162"
        },
        {
            "date": "2012-03-29T11:55:59+0000",
            "content": "I think its not ideal, but it nukes the jars, so lets do it. I can't think of a solution that really is ideal there... ",
            "author": "Robert Muir",
            "id": "comment-13241164"
        },
        {
            "date": "2012-03-29T12:28:38+0000",
            "content": "Ugh... We copied the source for commons-csv and noggit?  Feels like the cure is worse than the disease here... ",
            "author": "Yonik Seeley",
            "id": "comment-13241179"
        },
        {
            "date": "2012-03-29T12:32:30+0000",
            "content": "\nAs i said on my email, given the discussion about this on the other thread, i'd rather fix shit than argue\non mailing lists about whether our release is legal or not. If anyone else has a different opinion and is\nwilling to sacrifice days of their life arguing with apache board members instead, then stand up and we'll\ngo with whats in branch_3x now. ",
            "author": "Robert Muir",
            "id": "comment-13241180"
        },
        {
            "date": "2012-03-29T12:34:12+0000",
            "content": "Feels like the cure is worse than the disease here...\n\nI fully agree, but see discussion at the thread pointed to by Robert. ",
            "author": "Dawid Weiss",
            "id": "comment-13241181"
        },
        {
            "date": "2012-03-29T12:41:36+0000",
            "content": "I'm looking at changing how we handle commons-csv and noggit, I'll get there. ",
            "author": "Chris Male",
            "id": "comment-13241185"
        },
        {
            "date": "2012-03-29T14:06:59+0000",
            "content": "if anyone else has a different opinion and is willing to sacrifice days of their life arguing with apache board members instead\n\nThe third option was to do nothing hasty and wait for the actual board to come to a decision and communicate with PMCs.  Too late for this issue... but something to consider for the future. ",
            "author": "Yonik Seeley",
            "id": "comment-13241252"
        },
        {
            "date": "2012-03-29T14:25:57+0000",
            "content": "Too late for this issue, because we are doing all the work, and you are just whining.\n\nMeanwhile, the noggit problem you are bitching about is in fact 100% your fault. Get over your control issues and make it a real open source project with real releases already. ",
            "author": "Robert Muir",
            "id": "comment-13241262"
        },
        {
            "date": "2012-03-29T14:32:43+0000",
            "content": "Let's all please try to keep discussions civil folks. ",
            "author": "Yonik Seeley",
            "id": "comment-13241267"
        },
        {
            "date": "2012-03-29T14:41:37+0000",
            "content": "Moving C2 JARs out means we will have to re-release an archival version of C2 just for this purpose. The reasons are that we depend on libraries which themselves don't have 1.5 equivalents (mahout-math) so any newer version would have to be re-released along with backcompat of these libraries too... long story.\n\nAnyway, I will release a weird-looking version 3.5.0.1 which will be 1.5 compatible. I will let you know (and possibly modify the branch) once this happens. Give me a few hours, it'll require some checks/ testing. ",
            "author": "Dawid Weiss",
            "id": "comment-13241276"
        },
        {
            "date": "2012-03-29T16:04:13+0000",
            "content": "Let's try and maintain some self control and avoid the personal attacks. This type of thing is damaging to the whole community and it's not okay.  ",
            "author": "Mark Miller",
            "id": "comment-13241339"
        },
        {
            "date": "2012-03-29T19:55:53+0000",
            "content": "If the mountain won't come to us, we should at least make it easier for users to get to the mountain.\n\nattached patch fails with a helpful message if the ivy tasks can't be loaded from the ant classpath, and adds a new bootstrap target users can run to have us install ivy into ~/.ant/lib for them if they want\n\nI'm sure a lot of improvements could be made to the wording of the helpful message .. it's probably got some typos in it.\n\n\nhossman@bester:~/lucene/branch_lucene3930$ ant compile\nBuildfile: build.xml\n\ncompile:\n\ncompile-lucene-core:\n\njflex-uptodate-check:\n\njflex-notice:\n\njavacc-uptodate-check:\n\njavacc-notice:\n\nivy-availablity-check:\n     [echo] \n     [echo]      This build requires Ivy and Ivy could not be found in your ant classpath\n     [echo] \n     [echo]      (Due to classpath issues and the recursive nature of the Lucene/Solr \n     [echo]      build system, a local copy of Ivy can not be used an loaded dynamicaly \n     [echo]      by the build.xml)\n     [echo] \n     [echo]      You can either manually install a copy of Ivy 2.2.0 in your ant classpath:\n     [echo]        http://ant.apache.org/manual/install.html#optionalTasks\n     [echo] \n     [echo]      Or this build file can do it for you by running the Ivy Bootstrap target:\n     [echo]        ant ivy-bootstrap     \n     [echo]      \n     [echo]      Either way you will only have to install Ivy one time.\n     [echo] \n     [echo]      'ant ivy-bootstrap' will install a copy of Ivy into your Ant User Library:\n     [echo]        /home/hossman/.ant/lib\n     [echo]      \n     [echo]      If you would prefer, you can have it installed into an alternative \n     [echo]      directory using the \"-Divy_install_path=/some/path/you/choose\" option, \n     [echo]      but you will have to specify this path every time you build Lucene/Solr \n     [echo]      in the future...\n     [echo]        ant ivy-bootstrap -Divy_install_path=/some/path/you/choose\n     [echo]        ...\n     [echo]        ant -lib /some/path/you/choose clean compile\n     [echo]        ...\n     [echo]        ant -lib /some/path/you/choose clean compile\n     [echo]     \n\nivy-fail:\n\nBUILD FAILED\n/home/hossman/lucene/branch_lucene3930/build.xml:52: The following error occurred while executing this line:\n/home/hossman/lucene/branch_lucene3930/lucene/common-build.xml:561: The following error occurred while executing this line:\n/home/hossman/lucene/branch_lucene3930/lucene/common-build.xml:289: Ivy is not available\n\nTotal time: 1 second\n\n ",
            "author": "Hoss Man",
            "id": "comment-13241579"
        },
        {
            "date": "2012-03-29T20:02:07+0000",
            "content": "+1 ",
            "author": "Robert Muir",
            "id": "comment-13241583"
        },
        {
            "date": "2012-03-29T20:24:37+0000",
            "content": "Hey Hoss, there's a typo in the target name  \"ivy-availablity-check\". ",
            "author": "Dawid Weiss",
            "id": "comment-13241599"
        },
        {
            "date": "2012-03-29T22:40:06+0000",
            "content": "Guys, this is impressive piece of heavy committing!\nI tested the build on my MacBook. I love how the checkout is small and how it downloads everything on demand!\n\nFirst time I ran ant example the build failed with\n\n\n[ivy:retrieve] \t\t[FAILED     ] com.ibm.icu#icu4j;4.8.1.1!icu4j.jar: Downloaded file size doesn't match expected Content Length for http://repo1.maven.org/maven2/com/ibm/icu/icu4j/4.8.1.1/icu4j-4.8.1.1.jar. Please retry. (204243ms)\n\n\n\nHowever, re-running the same command then got further. But then it froze during jetty-javadoc download and I had to kill and restart. Don't know what happened, have not tried to reproduce. On third attempt all dependencies were fetched and the build succeeded.\n\nQuestions:\n\n\tFor solr/contrib/extraction, could not tika-parsers use transitive=\"true\" to avoid specifying versions for all parsers?\n\tWhy do we let ivy download sources and javadoc jars? They can be excluded in ivy.xml\n\n ",
            "author": "Jan H\u00f8ydahl",
            "id": "comment-13241884"
        },
        {
            "date": "2012-03-29T22:44:49+0000",
            "content": "\nFor solr/contrib/extraction, could not tika-parsers use transitive=\"true\" to avoid specifying versions for all parsers?\n\nBecause by turning it off always, we know exactly what jars we have from the ivy.xml. I think this is the way to go.\n\n\nWhy do we let ivy download sources and javadoc jars? They can be excluded in ivy.xml\n\nJust optimizations that havent been done yet... no reason really. ",
            "author": "Robert Muir",
            "id": "comment-13241889"
        },
        {
            "date": "2012-03-29T23:03:51+0000",
            "content": "Yes we get more control of revisions etc by being explicit. I.e. commons-codec in solr/lib is 1.6 while tika-parsers 1.0 depends on commons-codec 1.5.\n\nAdding these tags just before </dependencies> skips source and javadoc downloads. Have not found anything \"more global\" than this...\n\n<dependencies>\n  ::\n  <exclude org=\"*\" ext=\"*\" type=\"source\"/> \n  <exclude org=\"*\" ext=\"*\" type=\"javadoc\"/> \n</dependencies>\n\n ",
            "author": "Jan H\u00f8ydahl",
            "id": "comment-13241904"
        },
        {
            "date": "2012-03-29T23:05:41+0000",
            "content": "\nFor solr/contrib/extraction, could not tika-parsers use transitive=\"true\" to avoid specifying versions for all parsers?\n\nHaving been the one to go through and add all those parsers and versions, there were many times I wished I did use transitive.  But Robert is right, at this stage we get to see clearly which jars we're using.  In the future I can perhaps see places in Solr for using transitive, but in Lucene I think we should just be clear what dependencies we have.\n\n\nWhy do we let ivy download sources and javadoc jars? They can be excluded in ivy.xml\n\nI quite like this because then we have the sources and javadocs when developing.  They're downloaded once per dependency, no biggie? ",
            "author": "Chris Male",
            "id": "comment-13241907"
        },
        {
            "date": "2012-03-30T00:15:17+0000",
            "content": "The attached patch disables fetching of source jars and javadoc jars by default, to optimize for speed and bandwidth. Without it, the build takes much longer time.\n\nBut it is nice to have the ability to get them automatically. So the exclude is parameterized  You can enable fetching by specifying a Java option (only needed once)\n\n\nant -Dfetch.sources.javadocs compile\n\n ",
            "author": "Jan H\u00f8ydahl",
            "id": "comment-13241950"
        },
        {
            "date": "2012-03-30T00:37:38+0000",
            "content": "+1\n\ni nuked ~/.ivy2 completely, and ran 'ant test' + solr 'ant example' on a clean checkout. everything works. ",
            "author": "Robert Muir",
            "id": "comment-13241966"
        },
        {
            "date": "2012-03-30T09:17:28+0000",
            "content": "The only real remaining issue here is how to handle the langdetect jar in Solr's langid contrib.  The solution in ivy works fine (specifying the location of the jar) except I don't think you can do the same thing in Maven, which stumps our Maven releases a little.  For some people that isn't an issue, but I'd like to see it solved.  Does anybody know of how to do something similar in Maven?\n\nThe other alternative is to get the language-detection project to make an actual release.  It is possible to simulate a repo in a googlecode project.  But I'm unsure how to go about getting the project maintainer to do that?   ",
            "author": "Chris Male",
            "id": "comment-13242180"
        },
        {
            "date": "2012-03-30T09:27:29+0000",
            "content": "Don't we need to get rid of the binary JAR anyway? If so, the alternatives are to either put all the sources in lucene repo or push a maven release of that JAR. SonaType accepts third-party JAR pushes too \u2013 one can do it as a last resort option.\n\nhttps://docs.sonatype.org/display/Repository/Uploading+3rd-party+Artifacts+to+The+Central+Repository ",
            "author": "Dawid Weiss",
            "id": "comment-13242185"
        },
        {
            "date": "2012-03-30T09:39:32+0000",
            "content": "For our official ant build, the jar is now retrieved as an ivy dependency so we've gotten rid of the binary jar.  But its done so using what I think is an ivy only mechanism of specifying a path to a jar.  The language-detection project fortunately includes a jar of itself in its own git, so we simply pull that jar.  But we can't do that for Maven, I think? So yes, we need a release.\n\nI hadn't seen the Sonatype thing before, that is certainly worth considering. ",
            "author": "Chris Male",
            "id": "comment-13242194"
        },
        {
            "date": "2012-03-30T09:54:45+0000",
            "content": "You can do it with Maven by specifying an optional system dependency off the project's basedir and fetching the JAR in a preliminary phase... I think. But it's a hack beyond dirty. And it doesn't make other people's lives any easier (if somebody uses your pom). ",
            "author": "Dawid Weiss",
            "id": "comment-13242203"
        },
        {
            "date": "2012-03-30T10:09:50+0000",
            "content": "hack beyond dirty is what we need.\n\nwe can't be releasing other peoples code as solr-xxx... ",
            "author": "Robert Muir",
            "id": "comment-13242212"
        },
        {
            "date": "2012-03-30T10:14:47+0000",
            "content": "I'm adding a message on the project to see if the maintainer's prepared to following Sonatype's official maven release process.  If not, then we can go the 3rd party route. ",
            "author": "Chris Male",
            "id": "comment-13242220"
        },
        {
            "date": "2012-03-30T10:18:46+0000",
            "content": "keep in mind the solution i have only works for trunk, because they compile with java 6.\ntheir code compiles just fine with a java5 compiler or with java 5 options...\n\nfrom ivy perspective i can add ant logic to just check out their source and compile it ourselves.\n\nbut just keep it in mind for maven. ",
            "author": "Robert Muir",
            "id": "comment-13242225"
        },
        {
            "date": "2012-03-30T10:22:10+0000",
            "content": "Good point. ",
            "author": "Chris Male",
            "id": "comment-13242228"
        },
        {
            "date": "2012-03-30T10:31:07+0000",
            "content": "If we go the third party route I suggest to release an artifact with a -jdk15 classifier to make it explicit it's a 1.5 build. Perhaps we can suggest to the maintainer to compile with 1.5 compatibility if this doesn't involve any source code changes? ",
            "author": "Dawid Weiss",
            "id": "comment-13242237"
        },
        {
            "date": "2012-03-30T10:39:52+0000",
            "content": "\nhttps://docs.sonatype.org/display/Repository/Uploading+3rd-party+Artifacts+to+The+Central+Repository\n\nThanks for bringing this up dawid. Why didn't anyone bring this up before?\n\nIs it considered a dark, secret option that disrupts the viral natural of maven?\n\nI can't believe we've had maven artifacts like solr-xxx for all these 3.x releases\nwhen there was an official mechanism to do this: 'as long as the license permits'\nas the page says.\n ",
            "author": "Robert Muir",
            "id": "comment-13242241"
        },
        {
            "date": "2012-03-30T10:51:06+0000",
            "content": "I hadn't ever heard about it to be honest.  Examining discussions on the language-detection project, the maintainer expressed an inability to find time to make a Maven release, but that was about 9 months ago.  I've dropped in a comment seeing if he'd be prepared to do the release, if not, we know what we have to do. ",
            "author": "Chris Male",
            "id": "comment-13242250"
        },
        {
            "date": "2012-03-30T11:22:02+0000",
            "content": "\nThe attached patch disables fetching of source jars and javadoc jars by default, to optimize for speed and bandwidth. Without it, the build takes much longer time.\n\nJan do you want to commit this? I think its a nice improvement! I can commit it for you if you don't have the time! ",
            "author": "Robert Muir",
            "id": "comment-13242266"
        },
        {
            "date": "2012-03-30T12:59:09+0000",
            "content": "Jan: i committed this as we are getting pretty close... Thanks! ",
            "author": "Robert Muir",
            "id": "comment-13242309"
        },
        {
            "date": "2012-03-30T13:44:51+0000",
            "content": "I added top-level/recursive resolve tasks to resolve any deps and fixed ant eclipse to depend on this.\nAlso added 'clean-jars' top-level that basically does rm */.jar \nI would add this before the hudson 'svn status' check, so if someone commits any jars to the source tree it fails.\n\nAt this point I think everything is generally working nice in trunk (compile/test/packaging/javadocs/maven/...)\n\nI'll be doing testing of all the tasks from all the modules today to find any kinks, but I think we are nearly ready\nto land in trunk.\n\nI'll look at intellij (i already made it depend on resolve) and see if i can get it into shape, since\ne.g. junit.jar and friends are now under test-framework/lib.\n\nAny help testing or fixing intellij or whatever is appreciated  ",
            "author": "Robert Muir",
            "id": "comment-13242336"
        },
        {
            "date": "2012-03-30T14:15:49+0000",
            "content": "ok i downloaded intellij, and from what i can tell its working now... \n(I can run lucene and solr tests etc and it doesnt give me any errors that indicate any issues)\n\ni'll be testing the various ant tasks and trying to find any bugs now. ",
            "author": "Robert Muir",
            "id": "comment-13242363"
        },
        {
            "date": "2012-03-30T15:31:40+0000",
            "content": "i spent about an hour blowing away everything (ant clean clean-jars) and running\nvarious ant targets from various locations and checking stuff out.\n\nIn my opinion this is ready to go into trunk. I'll wait a bit for any feedback though. ",
            "author": "Robert Muir",
            "id": "comment-13242439"
        },
        {
            "date": "2012-03-30T16:16:28+0000",
            "content": "In my opinion this is ready to go into trunk. I'll wait a bit for any feedback though.\n\n+1 ant test worked on my first try (after ivy bootstrap)\n\nHUGE thanks for looking into this ",
            "author": "Ryan McKinley",
            "id": "comment-13242493"
        },
        {
            "date": "2012-03-30T16:29:56+0000",
            "content": "Just some stats on source release sizes:\n\n\nTrunk:\n-rw-rw-r--  1 rmuir rmuir 11372783 2012-03-30 12:25 lucene-4.0-SNAPSHOT-src.tgz\n-rw-rw-r--  1 rmuir rmuir 107074928 2012-03-30 12:20 apache-solr-4.0-SNAPSHOT-src.tgz\n\nBranch:\n-rw-rw-r--  1 rmuir rmuir  8207455 2012-03-30 12:26 lucene-4.0-SNAPSHOT-src.tgz\n-rw-rw-r--  1 rmuir rmuir 30676680 2012-03-30 12:23 apache-solr-4.0-SNAPSHOT-src.tgz\n\n\n\nI think later, we should investigate pulling some of the large test data stuff,\nlike the 5MB europarl-lines file via ivy, this is easy enough to do, would be\ncached locally etc, and make the source release much smaller.\n\nThis could also make it possible to use the 'large' one easier that jenkins uses... \n\nBut those are optimizations for later issues... ",
            "author": "Robert Muir",
            "id": "comment-13242510"
        },
        {
            "date": "2012-03-30T16:33:41+0000",
            "content": "+1. Maybe it's good that this issue came out. I think it straightened a few things out. ",
            "author": "Dawid Weiss",
            "id": "comment-13242513"
        },
        {
            "date": "2012-03-30T16:41:03+0000",
            "content": "In my opinion this is ready to go into trunk. I'll wait a bit for any feedback though.\n\n+1\n\n\"ant test\" passes, after the one-time \"ant ivy-bootstrap\".\n\nThanks everyone! ",
            "author": "Michael McCandless",
            "id": "comment-13242520"
        },
        {
            "date": "2012-03-30T17:11:11+0000",
            "content": "+1 I trust you, merge the shit back. Jenkins already has IVY, only some changes needed for build scripts to cleanup correctly ",
            "author": "Uwe Schindler",
            "id": "comment-13242551"
        },
        {
            "date": "2012-03-30T17:27:06+0000",
            "content": "I'll work on merging this back. I've tried to setup jenkins to where there will be no failed builds,\nbut its the kind of thing where i'll be surprised if I get away without a failure. If there are problems,\nI will fix. If the problems are serious, I will revert.\n\nAs far as the plan for 3.x: my idea is we bake in trunk for a while (let jenkins have its way with the\nchange, etc). At the same time we can look at how to backport for hopefully next week.\n\nI might create a branch off of 3.x (the same way as this one worked) so that its easier for people to help.\nBut first lets get it in trunk and see how that goes.  ",
            "author": "Robert Muir",
            "id": "comment-13242568"
        },
        {
            "date": "2012-03-30T17:42:47+0000",
            "content": "One final test, i checked out on laptop (using hossmans bootstrap), and ran 'ant resolve' \n(also 'ant idea' or 'ant eclipse' call this).. and then cut internet and ran tests/built \nand ran solr example offline. So I think its ready. ",
            "author": "Robert Muir",
            "id": "comment-13242586"
        },
        {
            "date": "2012-03-30T17:56:37+0000",
            "content": "+1 thanks guys! that worked for me though! ",
            "author": "Simon Willnauer",
            "id": "comment-13242605"
        },
        {
            "date": "2012-03-31T19:43:41+0000",
            "content": "I did some testing of the \"packages\" built using trunk (circa r1307608)...\n\n\n\twe don't ship solr's build.xml (or any of the sub-build.xml files) in the \"binary\" artifacts, and with these changes most of the new ivy.xml files are also excluded \u2013 but for some reason these newly added files are showing up, we should probably figure out why and exclude them as well since they aren't usable and could easily people...\n\t\n\t\t./example/example-DIH/ivy.xml\n\t\t./example/example-DIH/build.xml\n\t\t./example/ivy.xml\n\t\t./example/build.xml\n\t\n\t\n\tthe lib's for test-framework (ant, ant-junit, and junit) aren't being included in the lucene \"binary\" artifacts ... for the ant jars this might (test-framework doesn't actually have any run-time deps on anything in ant does it?) but it seems like hte junit jar should be included since including lucene-test-framework.jar in your classpath is useless w/o also including junit\n\t\"ant ivy-bootstrap\" followed by \"ant test\" using the lucene \"source\" package (lucene-4.0-SNAPSHOT-src.tgz) produces a build failure \u2013 but this may have been a problem even before ivy (note the working dir and the final error)...\n\n\n\n\nhossman@bester:~/tmp/ivy-pck-testing/lu/src/lucene-4.0-SNAPSHOT$ ant test\n...\n    [junit] Testsuite: org.apache.lucene.util.junitcompat.TestReproduceMessage\n    [junit] Tests run: 12, Failures: 0, Errors: 0, Time elapsed: 0.114 sec\n    [junit] \n\ntest:\n\ncompile-lucene-core:\n\njflex-uptodate-check:\n\njflex-notice:\n\njavacc-uptodate-check:\n\njavacc-notice:\n\nivy-availability-check:\n\nivy-fail:\n\nresolve:\n[ivy:retrieve] :: loading settings :: url = jar:file:/home/hossman/.ant/lib/ivy-2.2.0.jar!/org/apache/ivy/core/settings/ivysettings.xml\n\ninit:\n\nclover.setup:\n\nclover.info:\n     [echo] \n     [echo]       Clover not found. Code coverage reports disabled.\n     [echo]   \t\n\nclover:\n\ncommon.compile-core:\n    [javac] Compiling 1 source file to /home/hossman/tmp/ivy-pck-testing/lu/src/lucene-4.0-SNAPSHOT/build/core/classes/java\n\ncompile-core:\n\ncompile-test-framework:\n\nivy-availability-check:\n\nivy-fail:\n\nresolve:\n[ivy:retrieve] :: loading settings :: url = jar:file:/home/hossman/.ant/lib/ivy-2.2.0.jar!/org/apache/ivy/core/settings/ivysettings.xml\n\ninit:\n\ncompile-lucene-core:\n\ncompile-core:\n\ncompile-test:\n     [echo] Building demo...\n\nivy-availability-check:\n\nivy-fail:\n\nresolve:\n[ivy:retrieve] :: loading settings :: url = jar:file:/home/hossman/.ant/lib/ivy-2.2.0.jar!/org/apache/ivy/core/settings/ivysettings.xml\n\ncommon.init:\n\ncompile-lucene-core:\n\ncontrib-build.init:\n\ncheck-lucene-core-uptodate:\n\njar-lucene-core:\n\njflex-uptodate-check:\n\njflex-notice:\n\njavacc-uptodate-check:\n\njavacc-notice:\n\nivy-availability-check:\n\nivy-fail:\n\nresolve:\n[ivy:retrieve] :: loading settings :: url = jar:file:/home/hossman/.ant/lib/ivy-2.2.0.jar!/org/apache/ivy/core/settings/ivysettings.xml\n\ninit:\n\nclover.setup:\n\nclover.info:\n     [echo] \n     [echo]       Clover not found. Code coverage reports disabled.\n     [echo]   \t\n\nclover:\n\ncommon.compile-core:\n    [javac] Compiling 1 source file to /home/hossman/tmp/ivy-pck-testing/lu/src/lucene-4.0-SNAPSHOT/build/core/classes/java\n\ncompile-core:\n\njar-core:\n      [jar] Building jar: /home/hossman/tmp/ivy-pck-testing/lu/src/lucene-4.0-SNAPSHOT/build/core/lucene-core-4.0-SNAPSHOT.jar\n\ninit:\n\ncompile-test:\n     [echo] Building demo...\n\ncheck-analyzers-common-uptodate:\n\njar-analyzers-common:\n\nBUILD FAILED\n/home/hossman/tmp/ivy-pck-testing/lu/src/lucene-4.0-SNAPSHOT/build.xml:487: The following error occurred while executing this line:\n/home/hossman/tmp/ivy-pck-testing/lu/src/lucene-4.0-SNAPSHOT/common-build.xml:1026: The following error occurred while executing this line:\n/home/hossman/tmp/ivy-pck-testing/lu/src/lucene-4.0-SNAPSHOT/contrib/contrib-build.xml:58: The following error occurred while executing this line:\n/home/hossman/tmp/ivy-pck-testing/lu/src/lucene-4.0-SNAPSHOT/common-build.xml:551: Basedir /home/hossman/tmp/ivy-pck-testing/lu/src/modules/analysis/common does not exist\n\nTotal time: 5 minutes 10 seconds\n\n\n\n...it's trying to reach back up out of the working directory into \"../modules\" ",
            "author": "Hoss Man",
            "id": "comment-13243266"
        },
        {
            "date": "2012-03-31T20:39:27+0000",
            "content": "patch fixing the first two problems i mentioned above:\n\n\tcategorically exclude build.xml and ivy.xml files from solr binary packages (to prevent the ones under example from being included)\n\tadd parity to what files under test-framework get included in line with how contrib is treated (new patterns try to match some things that don't existing in test-framework, but i don't think that's bad \u2013 future proofs us)\n\n ",
            "author": "Hoss Man",
            "id": "comment-13243284"
        },
        {
            "date": "2012-03-31T23:20:18+0000",
            "content": "We have a 7Mb jar which is included in the binary distro twice. Any way to get rid of one?\n\n./contrib/analysis-extras/lib/icu4j-4.8.1.1.jar\n./contrib/extraction/lib/icu4j-4.8.1.1.jar\n\n\n\nAlso, from what I can see, solr/contrib/extraction/lib/xml-apis-1.0.b2.jar dependency is redundant - tests pass without it\nSee https://issues.apache.org/jira/browse/TIKA-412 and https://issues.apache.org/jira/browse/LUCENE-2961 ",
            "author": "Jan H\u00f8ydahl",
            "id": "comment-13243598"
        },
        {
            "date": "2012-04-01T22:43:38+0000",
            "content": "Hi guys, thanks for testing!\n\nCan we open separate issues for these remaining things? These problems are unrelated in \nany way to any changes in this issue and are pre-existing conditions:\n\n\n\tLUCENE-2999: lucene source release does not work because packaging is fucked\n\tSOLR-2435: duplicated icu4j jars in binary releases\n\n\n\nIts a good thing that packaging is screwed up exactly like it was before this change. Because \ni didnt really have to change its logic..., i kept what was there before.\n\nThanks; ",
            "author": "Robert Muir",
            "id": "comment-13243889"
        },
        {
            "date": "2012-04-02T04:16:09+0000",
            "content": "Haven't heard anything back from the language-detection project, so I'm pressing ahead.  Attached the pom.xml I've created for the project, for review from anybody who knows this kinda thing. ",
            "author": "Chris Male",
            "id": "comment-13243966"
        },
        {
            "date": "2012-04-02T06:54:59+0000",
            "content": "Looks good to me, Chris. Two minor things:\n1) sourceDirectory and testSourceDirectory look like default values anyway?\n2) there is a newer version of jsonic in maven repositories; don't know if this matters at all. ",
            "author": "Dawid Weiss",
            "id": "comment-13244008"
        },
        {
            "date": "2012-04-02T07:25:04+0000",
            "content": "Thanks for the review.\n\n1) sourceDirectory and testSourceDirectory look like default values anyway?\n\nErr.. yes, I used the pom the maintainer had started and forgot to pull those out.  Will do.\n\n2) there is a newer version of jsonic in maven repositories; don't know if this matters at all.\n\nI will stick with the version used in the project. ",
            "author": "Chris Male",
            "id": "comment-13244019"
        },
        {
            "date": "2012-04-02T11:41:30+0000",
            "content": "\npatch fixing the first two problems i mentioned above:\n\nThanks Hossman: I committed this (I am looking at the 3.x merge, i don't want to find/fix the bug twice)! ",
            "author": "Robert Muir",
            "id": "comment-13244137"
        },
        {
            "date": "2012-04-02T17:07:24+0000",
            "content": "I merged back to branch_3x. will let hudson chomp on it for a while, then mark this issue resolved\nif there are no immediate problems.\n\nAny later improvements can be followup issues. ",
            "author": "Robert Muir",
            "id": "comment-13244342"
        },
        {
            "date": "2012-04-02T20:58:55+0000",
            "content": "Thanks everyone! ",
            "author": "Robert Muir",
            "id": "comment-13244610"
        },
        {
            "date": "2012-04-03T05:29:20+0000",
            "content": "JAR which I'll be submitting to Sonatype. ",
            "author": "Chris Male",
            "id": "comment-13244986"
        },
        {
            "date": "2012-04-03T20:00:06+0000",
            "content": "I can't get either branch_3x or trunk to build now, on a system that used to build branch_3x without complaint.  It says that ivy is not available, even after doing \"ant ivy-bootstrap\" to download ivy into the home directory.  Specifically I am trying to build solrj from trunk, but I can't even get \"ant\" in the root directory of the checkout to work.  I'm on CentOS 6 with oracle jdk7 built using the city-fan.org SRPMs.  Ant (1.7.1) and junit are installed from package repositories.  Building a checkout of lucene_solr_3_5 on the same machine works fine. ",
            "author": "Shawn Heisey",
            "id": "comment-13245658"
        },
        {
            "date": "2012-04-03T20:29:38+0000",
            "content": "After printing out all the echo statements under ivy-availability, it spits out this:\n\nivy-fail:\n\nBUILD FAILED\n/index/src/trunk/build.xml:42: The following error occurred while executing this line:\n/index/src/trunk/lucene/common-build.xml:584: The following error occurred while executing this line:\n/index/src/trunk/lucene/common-build.xml:298: Ivy is not available\n\n\n\nBy adding <echo message=\"${java.class.path}\"/> to the validate section of build.xml, I got it to print out the java classpath, which includes the jar downloaded by the ivy-bootstrap option:\n\n     [echo] /usr/share/java/ant.jar:/usr/share/java/ant-launcher.jar:/usr/share/java/jaxp_parser_impl.jar:/usr/share/java/xml-commons-apis.jar:/usr/share/java/junit.jar:/usr/share/java/ant/ant-junit.jar:/usr/share/java/ant/ant-nodeps.jar:/usr/lib/jvm/java/lib/tools.jar:/home/ncindex/.ant/lib/ivy-2.2.0.jar:/usr/share/ant/lib/ant-bootstrap.jar:/usr/share/ant/lib/ant-junit.jar:/usr/share/ant/lib/ant-nodeps.jar:/usr/share/ant/lib/ant-launcher.jar:/usr/share/ant/lib/ant.jar ",
            "author": "Shawn Heisey",
            "id": "comment-13245698"
        },
        {
            "date": "2012-04-03T20:31:38+0000",
            "content": "Did you start a new terminal session after doing ant ivy-bootstrap? FWIW, I had to restart eclipse before I could continue using the eclipse/ant integration. ",
            "author": "Mark Miller",
            "id": "comment-13245699"
        },
        {
            "date": "2012-04-03T21:41:09+0000",
            "content": "Did you start a new terminal session after doing ant ivy-bootstrap? FWIW, I had to restart eclipse before I could continue using the eclipse/ant integration.\n\nI did not think of that, as I am not using Eclipse or any other IDE.  This is purely commandline via ssh.  I did open a new ssh session and try again, no change. ",
            "author": "Shawn Heisey",
            "id": "comment-13245781"
        },
        {
            "date": "2012-04-03T21:42:33+0000",
            "content": "Please take this to the list (This issue is resolved)... but I don't trust the\n'ants' shipped on some of these linux os's... best to download your own ant. ",
            "author": "Robert Muir",
            "id": "comment-13245782"
        },
        {
            "date": "2012-04-03T21:58:55+0000",
            "content": "Shawn, I have similar problems with the builtin ant on Fedora 13, and when I add that same echo line, I can see that the ~/.ant/lib/ivy-2.2.0.jar is on the CLASSPATH... yet it fails the ivy-availability-check.\n\nI never got to the bottom of it ... but installing ant myself (1.8.2) and using that version instead worked around it... ",
            "author": "Michael McCandless",
            "id": "comment-13245799"
        },
        {
            "date": "2012-04-03T22:22:36+0000",
            "content": "Shawn: please see LUCENE-3946 and comment there about the suggested work around ",
            "author": "Hoss Man",
            "id": "comment-13245828"
        }
    ]
}