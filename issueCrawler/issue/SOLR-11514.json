{
    "id": "SOLR-11514",
    "title": "Solr 7.1 does not honor values specified in solr.in.sh",
    "details": {
        "labels": "",
        "priority": "Major",
        "components": [
            "release-scripts",
            "SolrCloud"
        ],
        "type": "Bug",
        "fix_versions": [],
        "affect_versions": "7.1",
        "resolution": "Cannot Reproduce",
        "status": "Closed"
    },
    "description": "Just installed Solr 7.1 and zookeeper 3.4.10 into a test environment and it seems that arguments in the solr.in.sh file in /etc/default are not getting picked up when starting the server.\n\nI have this specified in solr.in.sh SOLR_JAVA_MEM=\"-Xms512m -Xmx6144m\" but the JVM shows -Xms512m -Xmx512m.\n\nSame goes for SOLR_LOGS_DIR=/mnt/logs  logs are still being written to /opt/solr/server/logs\n\nThe command I used to install Solr is this:\n\n./install_solr_service.sh /home/hblack/solr-7.1.0.tgz -i /opt -d /mnt/solr-home -s solr -u solr",
    "attachments": {
        "solr.in.sh": "https://issues.apache.org/jira/secure/attachment/12893428/solr.in.sh",
        "solr": "https://issues.apache.org/jira/secure/attachment/12893429/solr"
    },
    "issue_links": {},
    "comments": [
        {
            "date": "2017-10-21T19:21:46+0000",
            "content": "The install_solr_service.sh has some behavior that's maybe not the most intuitive.  It installs Solr from a fresh extraction of the solr-7.1.0.tgz file, not the already-extracted directory structure containing the install-script you're running in the command posted above.  So if your solr.in.sh changes live next to the install_solr_service.sh script you're running, they aren't going to be installed with Solr.\n\nSo in short, I suspect you just changed the wrong configuration file.\n\nTo verify this, can you check /etc/default/solr.in.sh on your test machine and let us know whether it contains the config changes you're expecting.  If it doesn't, please add the configuration lines, and hopefully that should allow you to see the changes you're expecting.  Please let us know if that doesn't fix things. ",
            "author": "Jason Gerlowski",
            "id": "comment-16214082"
        },
        {
            "date": "2017-10-21T19:27:44+0000",
            "content": "Also, side note, unconfirmed bugs or other similar questions are better sent directly to the solr-user mailing list.  In general there's more eyes over there to chime in on any issues that crop up, so you'll get quicker response times that way usually. ",
            "author": "Jason Gerlowski",
            "id": "comment-16214083"
        },
        {
            "date": "2017-10-21T19:49:52+0000",
            "content": "I have attached the solr file from /etc/init.d and the solr.in.sh file from /etc/default\n\nThis was a brand new build and a new install  using the script ./install_solr_service.sh  If this is not the way to install Solr, I need to know what the correct way is. ",
            "author": "Howard Black",
            "id": "comment-16214085"
        },
        {
            "date": "2017-10-23T03:09:14+0000",
            "content": "I see in the initial description that you mentioned the solr.in.sh in /etc/default.  I think Jason has assumed that you're editing the solr.in.sh in the bin directory.\n\nThe behavior you've described sounds like you're starting Solr in the \"manual\" way instead of starting the service.  When you use \"bin/solr start\" the logs will end up under the server directory and it will look for solr.in.sh in the bin directory \u2013 started in that way, Solr is entirely self-contained within the install directory, which is very different behavior than what the service installer script creates.\n\nWhen you install the service, you must only start the service.  Typical commands for this are \"service solr start\" or \"/etc/init.d/solr start\".\n\nI have an idea for making all this clear to users who install the service.  I'll open a new issue for that idea. ",
            "author": "Shawn Heisey",
            "id": "comment-16214570"
        },
        {
            "date": "2017-10-23T03:27:47+0000",
            "content": "Created SOLR-11527.  I'm not stating categorically that this is the problem on this issue, but the described behavior sounds like that's the problem. ",
            "author": "Shawn Heisey",
            "id": "comment-16214585"
        },
        {
            "date": "2017-10-23T11:05:00+0000",
            "content": "I am starting the service by doing this sudo service solr start. No, I'm \nnot editing anything in the bin directory or for that matter anything in \nthe install directory of /opt/solr\n\n\nHoward\n\n\n ",
            "author": "Howard Black",
            "id": "comment-16214964"
        },
        {
            "date": "2017-10-23T18:09:37+0000",
            "content": "This is from the ./install_solr_service.sh script.\n\n[root@solr-node01 bin]# ./install_solr_service.sh /home/hlblack/solr-7.1.0.tgz -i /opt -d /mnt/solr-home/ -s solr -u solr\n\nExtracting /home/hlblack/solr-7.1.0.tgz to /opt\n\n\nInstalling symlink /opt/solr -> /opt/solr-7.1.0 ...\n\n\nInstalling /etc/init.d/solr script ...\n\n\nInstalling /etc/default/solr.in.sh ...\n\n\n/mnt/solr-home//data/solr.xml already exists. Skipping install ...\n\n\n/mnt/solr-home//log4j.properties already exists. Skipping install ...\n\nService solr installed.\nCustomize Solr startup configuration in /etc/default/solr.in.sh\nWaiting up to 180 seconds to see Solr running on port 8983 []  \nStarted Solr server on port 8983 (pid=10171). Happy searching!\n\n\nFound 1 Solr nodes: \n\nSolr process 10171 running on port 8983\n{\n  \"solr_home\":\"/mnt/solr-home/data\",\n  \"version\":\"7.1.0 84c90ad2c0218156c840e19a64d72b8a38550659 - ubuntu - 2017-10-13 16:15:59\",\n  \"startTime\":\"2017-10-23T18:06:14.533Z\",\n  \"uptime\":\"0 days, 0 hours, 0 minutes, 8 seconds\",\n  \"memory\":\"43 MB (%8.8) of 490.7 MB\"}\n\n[root@solr-node01 bin]# \n\n\nIf I modify the /etc/default/solr.in.sh file, nothing gets picked up. ",
            "author": "Howard Black",
            "id": "comment-16215553"
        },
        {
            "date": "2017-10-23T18:18:05+0000",
            "content": "If I modify the /etc/default/solr.in.sh file, nothing gets picked up.\n\nThis is a potentially basic question, but I think it must be asked:  Did you restart (or stop and then start) the Solr service after modifying the include script? ",
            "author": "Shawn Heisey",
            "id": "comment-16215579"
        },
        {
            "date": "2017-10-23T18:31:00+0000",
            "content": "It was a fresh install.... wiped everything and started over. Went and \nmodified just the SOLR_JAVA_MEM=\"-Xms512m -Xmx4096m\", saved the file and \nthen restarted.\u00a0 Nothing got picked up.\n\n[root@solr-node01 bin]#\n[root@solr-node01 bin]# service solr stop\nSending stop command to Solr running on port 8983 ... waiting up to 180 \nseconds to allow Jetty process 10171 to stop gracefully.\n[root@solr-node01 bin]# cd /etc/default\n[root@solr-node01 default]# nano solr.in.sh\n[root@solr-node01 default]# service solr start\nWaiting up to 180 seconds to see Solr running on port 8983 []\nStarted Solr server on port 8983 (pid=10637). Happy searching!\n\n[root@solr-node01 default]# service solr status\n\nFound 1 Solr nodes:\n\nSolr process 10637 running on port 8983\n{\n \u00a0 \"solr_home\":\"/mnt/solr-home/data\",\n \u00a0 \"version\":\"7.1.0 84c90ad2c0218156c840e19a64d72b8a38550659 - ubuntu - \n2017-10-13 16:15:59\",\n \u00a0 \"startTime\":\"2017-10-23T18:09:18.322Z\",\n \u00a0 \"uptime\":\"0 days, 0 hours, 0 minutes, 10 seconds\",\n \u00a0 \"memory\":\"23.6 MB (%0.6) of 490.7 MB\"}\n\n\n\n\n ",
            "author": "Howard Black",
            "id": "comment-16215611"
        },
        {
            "date": "2017-10-23T18:40:16+0000",
            "content": "It was a fresh install.... wiped everything and started over. \n\nThe output you shared says it couldn't have been a fresh install.\n\n\n/mnt/solr-home//data/solr.xml already exists. Skipping install ...\n\n/mnt/solr-home//log4j.properties already exists. Skipping install ...\n\n\n\nYou might want to investigate the \"-f\" option on the service installer script, to force the install even when existing config is detected.\n\nI'm going to try this out, see if I can reproduce the problem. ",
            "author": "Shawn Heisey",
            "id": "comment-16215630"
        },
        {
            "date": "2017-10-23T19:03:06+0000",
            "content": "Steps for reproduction (on Ubuntu 16)\n\n\nroot@smeagol:/usr/local/src# ./install_solr_service.sh solr-7.1.0.tgz\nid: \u2018solr\u2019: no such user\nCreating new user: solr\nAdding system user `solr' (UID 141) ...\nAdding new group `solr' (GID 147) ...\nAdding new user `solr' (UID 141) with group `solr' ...\nCreating home directory `/var/solr' ...\n\nExtracting solr-7.1.0.tgz to /opt\n\n\nInstalling symlink /opt/solr -> /opt/solr-7.1.0 ...\n\n\nInstalling /etc/init.d/solr script ...\n\n\nInstalling /etc/default/solr.in.sh ...\n\nService solr installed.\nCustomize Solr startup configuration in /etc/default/solr.in.sh\n\u25cf solr.service - LSB: Controls Apache Solr as a Service\n   Loaded: loaded (/etc/init.d/solr; bad; vendor preset: enabled)\n   Active: active (exited) since Mon 2017-10-23 12:50:12 MDT; 5s ago\n     Docs: man:systemd-sysv-generator(8)\n  Process: 25798 ExecStart=/etc/init.d/solr start (code=exited, status=0/SUCCESS)\n\nOct 23 12:50:05 smeagol systemd[1]: Starting LSB: Controls Apache Solr as a Service...\nOct 23 12:50:05 smeagol su[25805]: Successful su for solr by root\nOct 23 12:50:05 smeagol su[25805]: + ??? root:solr\nOct 23 12:50:05 smeagol su[25805]: pam_unix(su:session): session opened for user solr by (uid=0)\nOct 23 12:50:12 smeagol solr[25798]: [146B blob data]\nOct 23 12:50:12 smeagol solr[25798]: Started Solr server on port 8983 (pid=25945). Happy searching!\nOct 23 12:50:12 smeagol solr[25798]: [14B blob data]\nOct 23 12:50:12 smeagol systemd[1]: Started LSB: Controls Apache Solr as a Service.\n\n\n\nThe I edited the include script and added a SOLR_HEAP=\"2g\" line.\n\n\nroot@smeagol:/usr/local/src# vi /etc/default/solr.in.sh\nroot@smeagol:/usr/local/src# service solr stop\nroot@smeagol:/usr/local/src# service solr start\nroot@smeagol:/usr/local/src# service solr status\n\u25cf solr.service - LSB: Controls Apache Solr as a Service\n   Loaded: loaded (/etc/init.d/solr; bad; vendor preset: enabled)\n   Active: active (exited) since Mon 2017-10-23 12:53:24 MDT; 2s ago\n     Docs: man:systemd-sysv-generator(8)\n  Process: 26182 ExecStop=/etc/init.d/solr stop (code=exited, status=0/SUCCESS)\n  Process: 26336 ExecStart=/etc/init.d/solr start (code=exited, status=0/SUCCESS)\n\nOct 23 12:53:18 smeagol systemd[1]: Starting LSB: Controls Apache Solr as a Service...\nOct 23 12:53:18 smeagol su[26339]: Successful su for solr by root\nOct 23 12:53:18 smeagol su[26339]: + ??? root:solr\nOct 23 12:53:18 smeagol su[26339]: pam_unix(su:session): session opened for user solr by (uid=0)\nOct 23 12:53:24 smeagol solr[26336]: [146B blob data]\nOct 23 12:53:24 smeagol solr[26336]: Started Solr server on port 8983 (pid=26475). Happy searching!\nOct 23 12:53:24 smeagol solr[26336]: [14B blob data]\nOct 23 12:53:24 smeagol systemd[1]: Started LSB: Controls Apache Solr as a Service.\n\n\n\nIt's not showing me the status, so I asked the running Solr for a system info dump:\n\n\nroot@smeagol:/usr/local/src# curl http://localhost:8983/solr/admin/info/system\n{\n  \"responseHeader\":{\n    \"status\":0,\n    \"QTime\":91},\n  \"mode\":\"std\",\n  \"solr_home\":\"/var/solr/data\",\n  \"lucene\":{\n    \"solr-spec-version\":\"7.1.0\",\n    \"solr-impl-version\":\"7.1.0 84c90ad2c0218156c840e19a64d72b8a38550659 - ubuntu - 2017-10-13 16:15:59\",\n    \"lucene-spec-version\":\"7.1.0\",\n    \"lucene-impl-version\":\"7.1.0 84c90ad2c0218156c840e19a64d72b8a38550659 - ubuntu - 2017-10-13 16:12:42\"},\n  \"jvm\":{\n    \"version\":\"1.8.0_144 25.144-b01\",\n    \"name\":\"Oracle Corporation Java HotSpot(TM) 64-Bit Server VM\",\n    \"spec\":{\n      \"vendor\":\"Oracle Corporation\",\n      \"name\":\"Java Platform API Specification\",\n      \"version\":\"1.8\"},\n    \"jre\":{\n      \"vendor\":\"Oracle Corporation\",\n      \"version\":\"1.8.0_144\"},\n    \"vm\":{\n      \"vendor\":\"Oracle Corporation\",\n      \"name\":\"Java HotSpot(TM) 64-Bit Server VM\",\n      \"version\":\"25.144-b01\"},\n    \"processors\":4,\n    \"memory\":{\n      \"free\":\"1.8 GB\",\n      \"total\":\"1.9 GB\",\n      \"max\":\"1.9 GB\",\n      \"used\":\"102.6 MB (%5.2)\",\n      \"raw\":{\n        \"free\":1950475352,\n        \"total\":2058027008,\n        \"max\":2058027008,\n        \"used\":107551656,\n        \"used%\":5.225959405873842}},\n    \"jmx\":{\n      \"bootclasspath\":\"/usr/lib/jvm/java-8-oracle/jre/lib/resources.jar:/usr/lib/jvm/java-8-oracle/jre/lib/rt.jar:/usr/lib/jvm/java-8-oracle/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-8-oracle/jre/lib/jsse.jar:/usr/lib/jvm/java-8-oracle/jre/lib/jce.jar:/usr/lib/jvm/java-8-oracle/jre/lib/charsets.jar:/usr/lib/jvm/java-8-oracle/jre/lib/jfr.jar:/usr/lib/jvm/java-8-oracle/jre/classes\",\n      \"classpath\":\"/opt/solr-7.1.0/server/lib/gmetric4j-1.0.7.jar:/opt/solr-7.1.0/server/lib/javax.servlet-api-3.1.0.jar:/opt/solr-7.1.0/server/lib/jetty-continuation-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-deploy-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-http-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-io-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-jmx-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-rewrite-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-security-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-server-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-servlet-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-servlets-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-util-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-webapp-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-xml-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/metrics-core-3.2.2.jar:/opt/solr-7.1.0/server/lib/metrics-ganglia-3.2.2.jar:/opt/solr-7.1.0/server/lib/metrics-graphite-3.2.2.jar:/opt/solr-7.1.0/server/lib/metrics-jetty9-3.2.2.jar:/opt/solr-7.1.0/server/lib/metrics-jvm-3.2.2.jar:/opt/solr-7.1.0/server/lib/ext/jcl-over-slf4j-1.7.7.jar:/opt/solr-7.1.0/server/lib/ext/jul-to-slf4j-1.7.7.jar:/opt/solr-7.1.0/server/lib/ext/log4j-1.2.17.jar:/opt/solr-7.1.0/server/lib/ext/slf4j-api-1.7.7.jar:/opt/solr-7.1.0/server/lib/ext/slf4j-log4j12-1.7.7.jar:/opt/solr-7.1.0/server/resources\",\n      \"commandLineArgs\":[\"-Xms2g\",\n        \"-Xmx2g\",\n        \"-XX:NewRatio=3\",\n        \"-XX:SurvivorRatio=4\",\n        \"-XX:TargetSurvivorRatio=90\",\n        \"-XX:MaxTenuringThreshold=8\",\n        \"-XX:+UseConcMarkSweepGC\",\n        \"-XX:+UseParNewGC\",\n        \"-XX:ConcGCThreads=4\",\n        \"-XX:ParallelGCThreads=4\",\n        \"-XX:+CMSScavengeBeforeRemark\",\n        \"-XX:PretenureSizeThreshold=64m\",\n        \"-XX:+UseCMSInitiatingOccupancyOnly\",\n        \"-XX:CMSInitiatingOccupancyFraction=50\",\n        \"-XX:CMSMaxAbortablePrecleanTime=6000\",\n        \"-XX:+CMSParallelRemarkEnabled\",\n        \"-XX:+ParallelRefProcEnabled\",\n        \"-XX:-OmitStackTraceInFastThrow\",\n        \"-verbose:gc\",\n        \"-XX:+PrintHeapAtGC\",\n        \"-XX:+PrintGCDetails\",\n        \"-XX:+PrintGCDateStamps\",\n        \"-XX:+PrintGCTimeStamps\",\n        \"-XX:+PrintTenuringDistribution\",\n        \"-XX:+PrintGCApplicationStoppedTime\",\n        \"-Xloggc:/var/solr/logs/solr_gc.log\",\n        \"-XX:+UseGCLogFileRotation\",\n        \"-XX:NumberOfGCLogFiles=9\",\n        \"-XX:GCLogFileSize=20M\",\n        \"-Dsolr.log.dir=/var/solr/logs\",\n        \"-Djetty.port=8983\",\n        \"-DSTOP.PORT=7983\",\n        \"-DSTOP.KEY=solrrocks\",\n        \"-Duser.timezone=UTC\",\n        \"-Djetty.home=/opt/solr/server\",\n        \"-Dsolr.solr.home=/var/solr/data\",\n        \"-Dsolr.data.home=\",\n        \"-Dsolr.install.dir=/opt/solr\",\n        \"-Dsolr.default.confdir=/opt/solr/server/solr/configsets/_default/conf\",\n        \"-Dlog4j.configuration=file:/var/solr/log4j.properties\",\n        \"-Xss256k\",\n        \"-Dsolr.jetty.https.port=8983\",\n        \"-Dsolr.log.muteconsole\",\n        \"-XX:OnOutOfMemoryError=/opt/solr/bin/oom_solr.sh 8983 /var/solr/logs\"],\n      \"startTime\":\"2017-10-23T18:53:20.289Z\",\n      \"upTimeMS\":118809}},\n  \"system\":{\n    \"name\":\"Linux\",\n    \"arch\":\"amd64\",\n    \"availableProcessors\":4,\n    \"systemLoadAverage\":1.07,\n    \"version\":\"4.10.0-32-generic\",\n    \"committedVirtualMemorySize\":5796089856,\n    \"freePhysicalMemorySize\":743649280,\n    \"freeSwapSpaceSize\":8055865344,\n    \"processCpuLoad\":0.0,\n    \"processCpuTime\":5860000000,\n    \"systemCpuLoad\":0.0,\n    \"totalPhysicalMemorySize\":25226625024,\n    \"totalSwapSpaceSize\":8192520192,\n    \"maxFileDescriptorCount\":1048576,\n    \"openFileDescriptorCount\":126,\n    \"uname\":\"Linux smeagol 4.10.0-32-generic #36~16.04.1-Ubuntu SMP Wed Aug 9 09:19:02 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\\n\",\n    \"uptime\":\" 12:55:19 up 69 days,  5:04,  3 users,  load average: 1.07, 1.14, 1.11\\n\"}}\n\n\n\nThe first two commandline options in that info dump are setting the heap to 2g, and the section about memory reflects the change.  Then, because the change to the include script was not the exact same change that you made, I removed the line I added and substituted SOLR_JAVA_MEM=\"-Xms512m -Xmx2g\" ... after a \"service solr restart\", I see the new commandline options in the info dump. ",
            "author": "Shawn Heisey",
            "id": "comment-16215671"
        },
        {
            "date": "2017-10-23T19:03:29+0000",
            "content": "FWIW, I was unable to reproduce on my system.  It was a fresh install for me, I had never used the install_solr_service.sh script before.\n\nAnyway, hence my (misguided) suspicion earlier that Howard was editing the wrong solr.in.sh file, because I couldn't reproduce it locally in 7.1 ",
            "author": "Jason Gerlowski",
            "id": "comment-16215672"
        },
        {
            "date": "2017-10-23T19:11:37+0000",
            "content": "After a closer look at the output, if you are basing the heap size on the status output from the init script, then I think it may actually be working, but you're looking in the wrong place.\n\nHere's an excerpt from the system info dump when I started with min 512MB and max 2GB:\n\n\n    \"memory\":{\n      \"free\":\"451.3 MB\",\n      \"total\":\"490.7 MB\",\n      \"max\":\"1.9 GB\",\n      \"used\":\"39.4 MB (%2)\",\n      \"raw\":{\n        \"free\":473181152,\n        \"total\":514523136,\n        \"max\":2058027008,\n\"used\":41341984,\n        \"used%\":2.0088163974182405}},\n\n\n\nNote that \"total\" in the main section is 490.7 MB ... but \"max\" is 1.9 GB.  I bet the status output you're looking at is showing you that \"total\" number rather than \"max\", and that max is probably increased to the 4GB that you have indicated.  Check the admin UI in a graphical browser, and see if the third number on the \"JVM memory\" graph is up around 4000. ",
            "author": "Shawn Heisey",
            "id": "comment-16215680"
        },
        {
            "date": "2017-10-23T21:11:04+0000",
            "content": "I have confirmed that the \"status\" output does only show the \"total\" memory.  Right after startup with -Xms512m, if there is not a significant amount of data indexed to the Solr instance, that number will show 490.7 MB, even if the -Xmx setting is much higher.\n\nThis patch to the code should fix that output:\n\n\ndiff --git a/solr/core/src/java/org/apache/solr/util/SolrCLI.java b/solr/core/src/java/org/apache/solr/util/SolrCLI.java\nindex f4cd7c7..5cbcc13 100644\n--- a/solr/core/src/java/org/apache/solr/util/SolrCLI.java\n+++ b/solr/core/src/java/org/apache/solr/util/SolrCLI.java\n@@ -942,7 +942,8 @@ public class SolrCLI {\n       \n       String usedMemory = asString(\"/jvm/memory/used\", info);\n       String totalMemory = asString(\"/jvm/memory/total\", info);\n-      status.put(\"memory\", usedMemory+\" of \"+totalMemory);\n+      String maxMemory = asString(\"/jvm/memory/max\", info);\n+      status.put(\"memory\", usedMemory+\" of \"+totalMemory+\", max=\"+maxMemory);\n       \n       // if this is a Solr in solrcloud mode, gather some basic cluster info\n       if (\"solrcloud\".equals(info.get(\"mode\"))) {\n\n ",
            "author": "Shawn Heisey",
            "id": "comment-16215847"
        },
        {
            "date": "2017-10-23T21:13:59+0000",
            "content": "To check whether my thoughts about what's happening here are right, try this line in solr.in.sh instead of the one that you tried already:\n\nSOLR_JAVA_MEM=\"-Xms1g -Xmx4g\"\n\nNote that we strongly recommend setting Xms and Xmx to the same value, so that Java doesn't need to allocate additional memory if it ends up needing more than the minimum.  General java operation tends to allocate the maximum anyway, so it's generally better to allocate it all up front and save Java the effort of increasing its memory allocation. ",
            "author": "Shawn Heisey",
            "id": "comment-16215856"
        },
        {
            "date": "2017-10-25T15:01:00+0000",
            "content": "OK... I'll give you that it is picking the SOLR_JAVA_MEM variable with \nthe correct value.\u00a0 However, it is not picking up any of the following \nafter I changed it in /etc/default/solr.in.sh\n\n\nZK_HOST=\"solr-zoo01:2601,solr-zoo02:2601,solr-zoo03:2601,solr-zoo04:2601,solr-zoo05:2601\"\n\n# Set the ZooKeeper client timeout (for SolrCloud mode)\nZK_CLIENT_TIMEOUT=\"15000\"\n\n# By default the start script uses \"localhost\"; override the hostname here\n# for production SolrCloud environments to control the hostname exposed \nto cluster state\nSOLR_HOST=\"solr-node01\"\n\n# By default the start script uses UTC; override the timezone if needed\nSOLR_TIMEZONE=\"US/Eastern\"\n\n# Location where the bin/solr script will save PID files for running \ninstances\n# If not set, the script will create PID files in $SOLR_TIP/bin\nSOLR_PID_DIR=/mnt/solr-home\n\n# Path to a directory for Solr to store cores and their data. By \ndefault, Solr will use server/solr\n# If solr.xml is not stored in ZooKeeper, this directory needs to \ncontain solr.xml\nSOLR_HOME=/mnt/solr-home\n\n# Path to a directory that Solr will use as root for data folders for \neach core.\n# If not set, defaults to <instance_dir>/data. Overridable per core \nthrough 'dataDir' core property\nSOLR_DATA_HOME=/mnt/solr-home/data\n\n# Solr provides a default Log4J configuration properties file in \nserver/resources\n# however, you may want to customize the log settings and file appender \nlocation\n# so you can point the script to use a different log4j.properties file\nLOG4J_PROPS=/mnt/solr-home/log4j.properties\n\n# Changes the logging level. Valid values: ALL, TRACE, DEBUG, INFO, \nWARN, ERROR, FATAL, OFF. Default is INFO\n# This is an alternative to changing the rootLogger in log4j.properties\nSOLR_LOG_LEVEL=WARN\n\n# Location where Solr should write logs to. Absolute or relative to solr \nstart dir\nSOLR_LOGS_DIR=/mnt/logs\n\n# Enables log rotation, cleanup, and archiving during start. Setting \nSOLR_LOG_PRESTART_ROTATION=false will skip start\n# time rotation of logs, and the archiving of the last GC and console \nlog files. It does not affect Log4j configuration.\n# This pre-startup rotation may need to be disabled depending how much \nyou customize the default logging setup.\nSOLR_LOG_PRESTART_ROTATION=true\n\n# Sets the port Solr binds to, default is 8983\nSOLR_PORT=9080\n\n\n\n\n[root@solr-node01 logs]# curl http://localhost:8983/solr/admin/info/system\n{\n \u00a0 \"responseHeader\":{\n \u00a0\u00a0\u00a0 \"status\":0,\n \u00a0\u00a0\u00a0 \"QTime\":46},\n \u00a0 \"mode\":\"std\",\n \u00a0 \"solr_home\":\"/opt/solr/server/solr\",\n \u00a0 \"lucene\":{\n \u00a0\u00a0\u00a0 \"solr-spec-version\":\"7.1.0\",\n \u00a0\u00a0\u00a0 \"solr-impl-version\":\"7.1.0 84c90ad2c0218156c840e19a64d72b8a38550659 \n- ubuntu - 2017-10-13 16:15:59\",\n \u00a0\u00a0\u00a0 \"lucene-spec-version\":\"7.1.0\",\n \u00a0\u00a0\u00a0 \"lucene-impl-version\":\"7.1.0 \n84c90ad2c0218156c840e19a64d72b8a38550659 - ubuntu - 2017-10-13 16:12:42\"},\n \u00a0 \"jvm\":{\n \u00a0\u00a0\u00a0 \"version\":\"1.8.0_144 25.144-b01\",\n \u00a0\u00a0\u00a0 \"name\":\"Oracle Corporation OpenJDK 64-Bit Server VM\",\n \u00a0\u00a0\u00a0 \"spec\":{\n \u00a0\u00a0\u00a0\u00a0\u00a0 \"vendor\":\"Oracle Corporation\",\n \u00a0\u00a0\u00a0\u00a0\u00a0 \"name\":\"Java Platform API Specification\",\n \u00a0\u00a0\u00a0\u00a0\u00a0 \"version\":\"1.8\"},\n \u00a0\u00a0\u00a0 \"jre\":{\n \u00a0\u00a0\u00a0\u00a0\u00a0 \"vendor\":\"Oracle Corporation\",\n \u00a0\u00a0\u00a0\u00a0\u00a0 \"version\":\"1.8.0_144\"},\n \u00a0\u00a0\u00a0 \"vm\":{\n \u00a0\u00a0\u00a0\u00a0\u00a0 \"vendor\":\"Oracle Corporation\",\n \u00a0\u00a0\u00a0\u00a0\u00a0 \"name\":\"OpenJDK 64-Bit Server VM\",\n \u00a0\u00a0\u00a0\u00a0\u00a0 \"version\":\"25.144-b01\"},\n \u00a0\u00a0\u00a0 \"processors\":2,\n \u00a0\u00a0\u00a0 \"memory\":{\n \u00a0\u00a0\u00a0\u00a0\u00a0 \"free\":\"463.6 MB\",\n \u00a0\u00a0\u00a0\u00a0\u00a0 \"total\":\"490.7 MB\",\n \u00a0\u00a0\u00a0\u00a0\u00a0 \"max\":\"3.8 GB\",\n \u00a0\u00a0\u00a0\u00a0\u00a0 \"used\":\"27.1 MB (%0.7)\",\n \u00a0\u00a0\u00a0\u00a0\u00a0 \"raw\":{\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"free\":486137936,\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"total\":514523136,\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"max\":4116054016,\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"used\":28385200,\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"used%\":0.6896216592314031}},\n \u00a0\u00a0\u00a0 \"jmx\":{\n\"bootclasspath\":\"/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.144-0.b01.el7_4.x86_64/jre/lib/resources.jar:/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.144-0.b01.el7_4.x86_64/jre/lib/rt.jar:/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.144-0.b01.el7_4.x86_64/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.144-0.b01.el7_4.x86_64/jre/lib/jsse.jar:/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.144-0.b01.el7_4.x86_64/jre/lib/jce.jar:/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.144-0.b01.el7_4.x86_64/jre/lib/charsets.jar:/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.144-0.b01.el7_4.x86_64/jre/lib/jfr.jar:/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.144-0.b01.el7_4.x86_64/jre/classes\",\n\"classpath\":\"/opt/solr-7.1.0/server/lib/gmetric4j-1.0.7.jar:/opt/solr-7.1.0/server/lib/javax.servlet-api-3.1.0.jar:/opt/solr-7.1.0/server/lib/jetty-continuation-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-deploy-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-http-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-io-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-jmx-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-rewrite-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-security-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-server-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-servlet-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-servlets-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-util-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-webapp-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/jetty-xml-9.3.20.v20170531.jar:/opt/solr-7.1.0/server/lib/metrics-core-3.2.2.jar:/opt/solr-7.1.0/server/lib/metrics-ganglia-3.2.2.jar:/opt/solr-7.1.0/server/lib/metrics-graphite-3.2.2.jar:/opt/solr-7.1.0/server/lib/metrics-jetty9-3.2.2.jar:/opt/solr-7.1.0/server/lib/metrics-jvm-3.2.2.jar:/opt/solr-7.1.0/server/lib/ext/jcl-over-slf4j-1.7.7.jar:/opt/solr-7.1.0/server/lib/ext/jul-to-slf4j-1.7.7.jar:/opt/solr-7.1.0/server/lib/ext/log4j-1.2.17.jar:/opt/solr-7.1.0/server/lib/ext/slf4j-api-1.7.7.jar:/opt/solr-7.1.0/server/lib/ext/slf4j-log4j12-1.7.7.jar:/opt/solr-7.1.0/server/resources\",\n \u00a0\u00a0\u00a0\u00a0\u00a0 \"commandLineArgs\":[\"-Xms512m\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-Xmx4096m\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:NewRatio=3\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:SurvivorRatio=4\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:TargetSurvivorRatio=90\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:MaxTenuringThreshold=8\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:+UseConcMarkSweepGC\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:+UseParNewGC\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:ConcGCThreads=4\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:ParallelGCThreads=4\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:+CMSScavengeBeforeRemark\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:PretenureSizeThreshold=64m\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:+UseCMSInitiatingOccupancyOnly\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:CMSInitiatingOccupancyFraction=50\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:CMSMaxAbortablePrecleanTime=6000\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:+CMSParallelRemarkEnabled\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:+ParallelRefProcEnabled\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:-OmitStackTraceInFastThrow\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-verbose:gc\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:+PrintHeapAtGC\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:+PrintGCDetails\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:+PrintGCDateStamps\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:+PrintGCTimeStamps\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:+PrintTenuringDistribution\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:+PrintGCApplicationStoppedTime\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-Xloggc:/opt/solr/server/logs/solr_gc.log\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:+UseGCLogFileRotation\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:NumberOfGCLogFiles=9\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:GCLogFileSize=20M\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-Dsolr.log.dir=/opt/solr/server/logs\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-Djetty.port=8983\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-DSTOP.PORT=7983\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-DSTOP.KEY=solrrocks\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-Duser.timezone=UTC\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-Djetty.home=/opt/solr/server\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-Dsolr.solr.home=/opt/solr/server/solr\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-Dsolr.data.home=\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-Dsolr.install.dir=/opt/solr\",\n\"-Dsolr.default.confdir=/opt/solr/server/solr/configsets/_default/conf\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-Xss256k\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-Dsolr.jetty.https.port=8983\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-Dsolr.log.muteconsole\",\n \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"-XX:OnOutOfMemoryError=/opt/solr/bin/oom_solr.sh 8983 \n/opt/solr/server/logs\"],\n \u00a0\u00a0\u00a0\u00a0\u00a0 \"startTime\":\"2017-10-25T14:44:30.708Z\",\n \u00a0\u00a0\u00a0\u00a0\u00a0 \"upTimeMS\":204483}},\n \u00a0 \"system\":{\n \u00a0\u00a0\u00a0 \"name\":\"Linux\",\n \u00a0\u00a0\u00a0 \"arch\":\"amd64\",\n \u00a0\u00a0\u00a0 \"availableProcessors\":2,\n \u00a0\u00a0\u00a0 \"systemLoadAverage\":0.08,\n \u00a0\u00a0\u00a0 \"version\":\"3.10.0-693.2.2.el7.x86_64\",\n \u00a0\u00a0\u00a0 \"committedVirtualMemorySize\":6980812800,\n \u00a0\u00a0\u00a0 \"freePhysicalMemorySize\":3074637824,\n \u00a0\u00a0\u00a0 \"freeSwapSpaceSize\":4294963200,\n \u00a0\u00a0\u00a0 \"processCpuLoad\":0.0,\n \u00a0\u00a0\u00a0 \"processCpuTime\":5070000000,\n \u00a0\u00a0\u00a0 \"systemCpuLoad\":0.0,\n \u00a0\u00a0\u00a0 \"totalPhysicalMemorySize\":6072004608,\n \u00a0\u00a0\u00a0 \"totalSwapSpaceSize\":4294963200,\n \u00a0\u00a0\u00a0 \"maxFileDescriptorCount\":4096,\n \u00a0\u00a0\u00a0 \"openFileDescriptorCount\":122,\n \u00a0\u00a0\u00a0 \"uname\":\"Linux solr-node01 3.10.0-693.2.2.el7.x86_64 #1 SMP Sat Sep \n9 03:55:24 EDT 2017 x86_64 x86_64 x86_64 GNU/Linux\\n\",\n \u00a0\u00a0\u00a0 \"uptime\":\" 10:47:55 up 48 min,\u00a0 3 users,\u00a0 load average: 0.08, 0.04, \n0.08\\n\"}}\n\n ",
            "author": "Howard Black",
            "id": "comment-16218840"
        },
        {
            "date": "2017-10-26T15:57:40+0000",
            "content": "I added one of your statements to /etc/default/solr.in.sh on my Ubuntu 16 system, specifically the ZK_HOST variable.  I see the results of that change on the Solr commandline after restarting the service.\n\nBecause I don't actually have ZK running, much less with the specific hostnames your ZK_HOST references, that Solr install isn't actually working, but it did start with the correct option.  In the \"ps\" output you can see -DzkHost:\n\n\nelyograg@smeagol:~$ ps ax | grep solr\n34919 ?        Sl     0:02 /usr/lib/jvm/java-8-oracle/bin/java -server -Xms512m -Xmx2g -XX:NewRatio=3 -XX:SurvivorRatio=4 -XX:TargetSurvivorRatio=90 -XX:MaxTenuringThreshold=8 -XX:+UseConcMarkSweepGC -XX:+UseParNewGC -XX:ConcGCThreads=4 -XX:ParallelGCThreads=4 -XX:+CMSScavengeBeforeRemark -XX:PretenureSizeThreshold=64m -XX:+UseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction=50 -XX:CMSMaxAbortablePrecleanTime=6000 -XX:+CMSParallelRemarkEnabled -XX:+ParallelRefProcEnabled -XX:-OmitStackTraceInFastThrow -verbose:gc -XX:+PrintHeapAtGC -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationStoppedTime -Xloggc:/var/solr/logs/solr_gc.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=9 -XX:GCLogFileSize=20M -DzkClientTimeout=15000 -DzkHost=solr-zoo01:2601,solr-zoo02:2601,solr-zoo03:2601,solr-zoo04:2601,solr-zoo05:2601 -Dsolr.log.dir=/var/solr/logs -Djetty.port=8983 -DSTOP.PORT=7983 -DSTOP.KEY=solrrocks -Duser.timezone=UTC -Djetty.home=/opt/solr/server -Dsolr.solr.home=/var/solr/data -Dsolr.data.home= -Dsolr.install.dir=/opt/solr -Dsolr.default.confdir=/opt/solr/server/solr/configsets/_default/conf -Dlog4j.configuration=file:/var/solr/log4j.properties -Xss256k -Dsolr.jetty.https.port=8983 -Dsolr.log.muteconsole -XX:OnOutOfMemoryError=/opt/solr/bin/oom_solr.sh 8983 /var/solr/logs -jar start.jar --module=http\n35035 pts/3    S+     0:00 grep --color=auto solr\n\n\n\nThis is Solr 7.1.0, installed with default options.  I have been unable to replicate the problem you're seeing. ",
            "author": "Shawn Heisey",
            "id": "comment-16220672"
        },
        {
            "date": "2017-10-26T17:27:00+0000",
            "content": "Just close this.\u00a0\u00a0 I've resolved my issues by completely building new \nservers.\n\n\n\n ",
            "author": "Howard Black",
            "id": "comment-16220846"
        }
    ]
}