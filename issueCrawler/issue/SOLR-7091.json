{
    "id": "SOLR-7091",
    "title": "Data-driven schema and block-join style update requests don't play well together",
    "details": {
        "components": [],
        "type": "Bug",
        "labels": "",
        "fix_versions": [
            "5.3",
            "6.0"
        ],
        "affect_versions": "None",
        "status": "Closed",
        "resolution": "Fixed",
        "priority": "Major"
    },
    "description": "Tried to index the basic block-join example docs from the refguide (see link below) into the gettingstarted collection, which uses the data-driven schema configs:\nhttps://cwiki.apache.org/confluence/display/solr/Other+Parsers#OtherParsers-BlockJoinQueryParsers\n\nHere's the result:\n\n\n$ bin/post -c gettingstarted block-join/docs.xml \njava -classpath dist/solr-core-6.0.0-SNAPSHOT.jar -Dauto=yes -Dc=gettingstarted -Ddata=files org.apache.solr.util.SimplePostTool block-join/docs.xml\nSimplePostTool version 5.0.0\nPosting files to [base] url http://localhost:8983/solr/gettingstarted/update...\nEntering auto mode. File endings considered are xml,json,csv,pdf,doc,docx,ppt,pptx,xls,xlsx,odt,odp,ods,ott,otp,ots,rtf,htm,html,txt,log\nPOSTing file docs.xml (application/xml) to [base]\nSimplePostTool: WARNING: Solr returned an error #400 (Bad Request) for url: http://localhost:8983/solr/gettingstarted/update\nSimplePostTool: WARNING: Response: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<response>\n<lst name=\"responseHeader\"><int name=\"status\">400</int><int name=\"QTime\">429</int></lst><lst name=\"error\"><str name=\"msg\">undefined field: \"comments\"</str><int name=\"code\">400</int></lst>\n</response>\nSimplePostTool: WARNING: IOException while reading response: java.io.IOException: Server returned HTTP response code: 400 for URL: http://localhost:8983/solr/gettingstarted/update\n1 files indexed.\nCOMMITting Solr index changes to http://localhost:8983/solr/gettingstarted/update...\nTime spent: 0:00:00.481\n\n\n\nLogs from the leader are:\n\n\nINFO  - 2015-02-09 17:08:27.882; org.apache.solr.schema.ManagedIndexSchema; Persisted managed schema version 1 at /configs/gettingstarted/managed-schema\nERROR - 2015-02-09 17:08:27.882; org.apache.solr.schema.ManagedIndexSchema; Bad version when trying to persist schema using 0 due to: org.apache.zookeeper.KeeperException$BadVersionException: KeeperErrorCode = BadVersion for /configs/gettingstarted/managed-schema\nINFO  - 2015-02-09 17:08:27.883; org.apache.solr.schema.ManagedIndexSchema; Failed to persist managed schema at /configs/gettingstarted/managed-schema - version mismatch\nINFO  - 2015-02-09 17:08:27.882; org.apache.solr.schema.ZkIndexSchemaReader$1; A schema change: WatchedEvent state:SyncConnected type:NodeDataChanged path:/configs/gettingstarted/managed-schema, has occurred - updating schema from ZooKeeper ...\nINFO  - 2015-02-09 17:08:27.882; org.apache.solr.schema.ZkIndexSchemaReader$1; A schema change: WatchedEvent state:SyncConnected type:NodeDataChanged path:/configs/gettingstarted/managed-schema, has occurred - updating schema from ZooKeeper ...\nINFO  - 2015-02-09 17:08:27.884; org.apache.solr.schema.ZkIndexSchemaReader; Retrieved schema version 1 from ZooKeeper\nERROR - 2015-02-09 17:08:27.891; org.apache.solr.schema.ManagedIndexSchema; Bad version when trying to persist schema using 0 due to: org.apache.zookeeper.KeeperException$BadVersionException: KeeperErrorCode = BadVersion for /configs/gettingstarted/managed-schema\nINFO  - 2015-02-09 17:08:27.892; org.apache.solr.schema.ManagedIndexSchema; Failed to persist managed schema at /configs/gettingstarted/managed-schema - version mismatch\nERROR - 2015-02-09 17:08:27.896; org.apache.solr.schema.ManagedIndexSchema; Bad version when trying to persist schema using 0 due to: org.apache.zookeeper.KeeperException$BadVersionException: KeeperErrorCode = BadVersion for /configs/gettingstarted/managed-schema\nINFO  - 2015-02-09 17:08:27.896; org.apache.solr.schema.ManagedIndexSchema; Failed to persist managed schema at /configs/gettingstarted/managed-schema - version mismatch\nINFO  - 2015-02-09 17:08:27.896; org.apache.solr.schema.ZkIndexSchemaReader; Retrieved schema version 1 from ZooKeeper\nINFO  - 2015-02-09 17:08:27.947; org.apache.solr.update.processor.LogUpdateProcessor; [gettingstarted_shard1_replica2] webapp=/solr path=/update params={update.distrib=TOLEADER&update.chain=add-unknown-fields-to-the-schema&distrib.from=http://192.168.1.2:8983/solr/gettingstarted_shard2_replica2/&wt=javabin&version=2} {} 0 90\nERROR - 2015-02-09 17:08:27.949; org.apache.solr.common.SolrException; org.apache.solr.common.SolrException: undefined field: \"comments\"\n\tat org.apache.solr.schema.IndexSchema.getField(IndexSchema.java:1221)\n\tat org.apache.solr.schema.IndexSchema.getCopyFieldsList(IndexSchema.java:1338)\n\tat org.apache.solr.update.DocumentBuilder.toDocument(DocumentBuilder.java:110)\n\tat org.apache.solr.update.AddUpdateCommand$1.next(AddUpdateCommand.java:187)\n\tat org.apache.solr.update.AddUpdateCommand$1.next(AddUpdateCommand.java:162)\n\tat org.apache.lucene.index.DocumentsWriterPerThread.updateDocuments(DocumentsWriterPerThread.java:257)\n\tat org.apache.lucene.index.DocumentsWriter.updateDocuments(DocumentsWriter.java:410)\n\tat org.apache.lucene.index.IndexWriter.updateDocuments(IndexWriter.java:1194)\n\tat org.apache.solr.update.DirectUpdateHandler2.addDoc0(DirectUpdateHandler2.java:238)\n\tat org.apache.solr.update.DirectUpdateHandler2.addDoc(DirectUpdateHandler2.java:166)\n\tat org.apache.solr.update.processor.RunUpdateProcessor.processAdd(RunUpdateProcessorFactory.java:69)\n\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n\tat org.apache.solr.update.processor.AddSchemaFieldsUpdateProcessorFactory$AddSchemaFieldsUpdateProcessor.processAdd(AddSchemaFieldsUpdateProcessorFactory.java:328)\n\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n\tat org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n\tat org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n\tat org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n\tat org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n\tat org.apache.solr.update.processor.FieldNameMutatingUpdateProcessorFactory$1.processAdd(FieldNameMutatingUpdateProcessorFactory.java:79)\n\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n\tat org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n\tat org.apache.solr.update.processor.DistributedUpdateProcessor.doLocalAdd(DistributedUpdateProcessor.java:935)\n\tat org.apache.solr.update.processor.DistributedUpdateProcessor.versionAdd(DistributedUpdateProcessor.java:1089)\n\tat org.apache.solr.update.processor.DistributedUpdateProcessor.processAdd(DistributedUpdateProcessor.java:701)\n\tat org.apache.solr.update.processor.LogUpdateProcessor.processAdd(LogUpdateProcessorFactory.java:104)\n\tat org.apache.solr.handler.loader.JavabinLoader$1.update(JavabinLoader.java:96)\n\tat org.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec$1.readOuterMostDocIterator(JavaBinUpdateRequestCodec.java:166)\n\tat org.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec$1.readIterator(JavaBinUpdateRequestCodec.java:136)\n\tat org.apache.solr.common.util.JavaBinCodec.readVal(JavaBinCodec.java:225)\n\tat org.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec$1.readNamedList(JavaBinUpdateRequestCodec.java:121)\n\tat org.apache.solr.common.util.JavaBinCodec.readVal(JavaBinCodec.java:190)\n\tat org.apache.solr.common.util.JavaBinCodec.unmarshal(JavaBinCodec.java:116)\n\tat org.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec.unmarshal(JavaBinUpdateRequestCodec.java:173)\n\tat org.apache.solr.handler.loader.JavabinLoader.parseAndLoadDocs(JavabinLoader.java:106)\n\tat org.apache.solr.handler.loader.JavabinLoader.load(JavabinLoader.java:58)\n\tat org.apache.solr.handler.UpdateRequestHandler$1.load(UpdateRequestHandler.java:103)\n\tat org.apache.solr.handler.ContentStreamHandlerBase.handleRequestBody(ContentStreamHandlerBase.java:74)\n\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:144)\n\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:2027)\n\tat org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:777)\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:413)\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:204)\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1652)\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:585)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:577)\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:223)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1125)\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:515)\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1059)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:215)\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:110)\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:97)\n\tat org.eclipse.jetty.server.Server.handle(Server.java:497)\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:313)\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:248)\n\tat org.eclipse.jetty.io.AbstractConnection$2.run(AbstractConnection.java:540)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:626)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:546)\n\tat java.lang.Thread.run(Thread.java:745)\n\nERROR - 2015-02-09 17:08:27.952; org.apache.solr.update.StreamingSolrClients$1; error\norg.apache.solr.common.SolrException: Bad Request\n\n\n\nrequest: http://192.168.1.2:8983/solr/gettingstarted_shard1_replica2/update?update.chain=add-unknown-fields-to-the-schema&update.distrib=TOLEADER&distrib.from=http%3A%2F%2F192.168.1.2%3A8983%2Fsolr%2Fgettingstarted_shard2_replica2%2F&wt=javabin&version=2\n\tat org.apache.solr.client.solrj.impl.ConcurrentUpdateSolrClient$Runner.run(ConcurrentUpdateSolrClient.java:242)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat java.lang.Thread.run(Thread.java:745)\nINFO  - 2015-02-09 17:08:28.242; org.apache.solr.schema.ZkIndexSchemaReader; Finished refreshing schema in 345 ms\nERROR - 2015-02-09 17:08:28.247; org.apache.solr.schema.ManagedIndexSchema; Bad version when trying to persist schema using 0 due to: org.apache.zookeeper.KeeperException$BadVersionException: KeeperErrorCode = BadVersion for /configs/gettingstarted/managed-schema\nINFO  - 2015-02-09 17:08:28.247; org.apache.solr.schema.ManagedIndexSchema; Failed to persist managed schema at /configs/gettingstarted/managed-schema - version mismatch\nINFO  - 2015-02-09 17:08:28.249; org.apache.solr.update.processor.LogUpdateProcessor; [gettingstarted_shard2_replica2] webapp=/solr path=/update params={} {add=[1]} 0 429\nERROR - 2015-02-09 17:08:28.249; org.apache.solr.common.SolrException; org.apache.solr.common.SolrException: undefined field: \"comments\"\n\tat org.apache.solr.schema.IndexSchema.getField(IndexSchema.java:1221)\n\tat org.apache.solr.schema.IndexSchema.getCopyFieldsList(IndexSchema.java:1338)\n\tat org.apache.solr.update.DocumentBuilder.toDocument(DocumentBuilder.java:110)\n\tat org.apache.solr.update.AddUpdateCommand$1.next(AddUpdateCommand.java:187)\n\tat org.apache.solr.update.AddUpdateCommand$1.next(AddUpdateCommand.java:162)\n\tat org.apache.lucene.index.DocumentsWriterPerThread.updateDocuments(DocumentsWriterPerThread.java:257)\n\tat org.apache.lucene.index.DocumentsWriter.updateDocuments(DocumentsWriter.java:410)\n\tat org.apache.lucene.index.IndexWriter.updateDocuments(IndexWriter.java:1194)\n\tat org.apache.solr.update.DirectUpdateHandler2.addDoc0(DirectUpdateHandler2.java:238)\n\tat org.apache.solr.update.DirectUpdateHandler2.addDoc(DirectUpdateHandler2.java:166)\n\tat org.apache.solr.update.processor.RunUpdateProcessor.processAdd(RunUpdateProcessorFactory.java:69)\n\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n\tat org.apache.solr.update.processor.AddSchemaFieldsUpdateProcessorFactory$AddSchemaFieldsUpdateProcessor.processAdd(AddSchemaFieldsUpdateProcessorFactory.java:328)\n\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n\tat org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n\tat org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n\tat org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n\tat org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n\tat org.apache.solr.update.processor.FieldNameMutatingUpdateProcessorFactory$1.processAdd(FieldNameMutatingUpdateProcessorFactory.java:79)\n\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n\tat org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n\tat org.apache.solr.update.processor.DistributedUpdateProcessor.doLocalAdd(DistributedUpdateProcessor.java:935)\n\tat org.apache.solr.update.processor.DistributedUpdateProcessor.versionAdd(DistributedUpdateProcessor.java:1089)\n\tat org.apache.solr.update.processor.DistributedUpdateProcessor.processAdd(DistributedUpdateProcessor.java:701)\n\tat org.apache.solr.update.processor.LogUpdateProcessor.processAdd(LogUpdateProcessorFactory.java:104)\n\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n\tat org.apache.solr.update.processor.AbstractDefaultValueUpdateProcessorFactory$DefaultValueUpdateProcessor.processAdd(AbstractDefaultValueUpdateProcessorFactory.java:94)\n\tat org.apache.solr.handler.loader.XMLLoader.processUpdate(XMLLoader.java:247)\n\tat org.apache.solr.handler.loader.XMLLoader.load(XMLLoader.java:174)\n\tat org.apache.solr.handler.UpdateRequestHandler$1.load(UpdateRequestHandler.java:103)\n\tat org.apache.solr.handler.ContentStreamHandlerBase.handleRequestBody(ContentStreamHandlerBase.java:74)\n\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:144)\n\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:2027)\n\tat org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:777)\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:413)\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:204)\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1652)\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:585)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:577)\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:223)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1125)\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:515)\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1059)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:215)\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:110)\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:97)\n\tat org.eclipse.jetty.server.Server.handle(Server.java:497)\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:313)\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:248)\n\tat org.eclipse.jetty.io.AbstractConnection$2.run(AbstractConnection.java:540)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:626)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:546)\n\tat java.lang.Thread.run(Thread.java:745)\n\nINFO  - 2015-02-09 17:08:28.250; org.apache.solr.schema.ZkIndexSchemaReader; Finished refreshing schema in 365 ms\nINFO  - 2015-02-09 17:08:28.262; org.apache.solr.update.DirectUpdateHandler2; start commit{,optimize=false,openSearcher=true,waitSearcher=true,expungeDeletes=false,softCommit=false,prepareCommit=false}\nINFO  - 2015-02-09 17:08:28.262; org.apache.solr.update.DirectUpdateHandler2; start commit{,optimize=false,openSearcher=true,waitSearcher=true,expungeDeletes=false,softCommit=false,prepareCommit=false}\nINFO  - 2015-02-09 17:08:28.265; org.apache.solr.core.SolrDeletionPolicy; SolrDeletionPolicy.onCommit: commits: num=2\n\tcommit{dir=NRTCachingDirectory(MMapDirectory@/Users/timpotter/dev/lw/projects/solr_trunk_co/solr/example/cloud/node1/solr/gettingstarted_shard1_replica2/data/index lockFactory=org.apache.lucene.store.NativeFSLockFactory@70ce628e; maxCacheMB=48.0 maxMergeSizeMB=4.0),segFN=segments_1,generation=1}\n\tcommit{dir=NRTCachingDirectory(MMapDirectory@/Users/timpotter/dev/lw/projects/solr_trunk_co/solr/example/cloud/node1/solr/gettingstarted_shard1_replica2/data/index lockFactory=org.apache.lucene.store.NativeFSLockFactory@70ce628e; maxCacheMB=48.0 maxMergeSizeMB=4.0),segFN=segments_2,generation=2}\nINFO  - 2015-02-09 17:08:28.265; org.apache.solr.core.SolrDeletionPolicy; SolrDeletionPolicy.onCommit: commits: num=2\n\tcommit{dir=NRTCachingDirectory(MMapDirectory@/Users/timpotter/dev/lw/projects/solr_trunk_co/solr/example/cloud/node1/solr/gettingstarted_shard2_replica2/data/index lockFactory=org.apache.lucene.store.NativeFSLockFactory@70ce628e; maxCacheMB=48.0 maxMergeSizeMB=4.0),segFN=segments_1,generation=1}\n\tcommit{dir=NRTCachingDirectory(MMapDirectory@/Users/timpotter/dev/lw/projects/solr_trunk_co/solr/example/cloud/node1/solr/gettingstarted_shard2_replica2/data/index lockFactory=org.apache.lucene.store.NativeFSLockFactory@70ce628e; maxCacheMB=48.0 maxMergeSizeMB=4.0),segFN=segments_2,generation=2}\nINFO  - 2015-02-09 17:08:28.265; org.apache.solr.core.SolrDeletionPolicy; newest commit generation = 2\nINFO  - 2015-02-09 17:08:28.265; org.apache.solr.core.SolrDeletionPolicy; newest commit generation = 2\nINFO  - 2015-02-09 17:08:28.268; org.apache.solr.search.SolrIndexSearcher; Opening Searcher@3f1b8e55[gettingstarted_shard1_replica2] main\nINFO  - 2015-02-09 17:08:28.268; org.apache.solr.search.SolrIndexSearcher; Opening Searcher@71fc4c98[gettingstarted_shard2_replica2] main\nINFO  - 2015-02-09 17:08:28.269; org.apache.solr.update.DirectUpdateHandler2; end_commit_flush\nINFO  - 2015-02-09 17:08:28.269; org.apache.solr.update.DirectUpdateHandler2; end_commit_flush\nINFO  - 2015-02-09 17:08:28.269; org.apache.solr.core.QuerySenderListener; QuerySenderListener sending requests to Searcher@3f1b8e55[gettingstarted_shard1_replica2] main{ExitableDirectoryReader(UninvertingDirectoryReader())}\nINFO  - 2015-02-09 17:08:28.269; org.apache.solr.core.QuerySenderListener; QuerySenderListener sending requests to Searcher@71fc4c98[gettingstarted_shard2_replica2] main{ExitableDirectoryReader(UninvertingDirectoryReader())}\nINFO  - 2015-02-09 17:08:28.269; org.apache.solr.core.QuerySenderListener; QuerySenderListener done.\nINFO  - 2015-02-09 17:08:28.270; org.apache.solr.core.QuerySenderListener; QuerySenderListener done.\nINFO  - 2015-02-09 17:08:28.271; org.apache.solr.core.SolrCore; [gettingstarted_shard1_replica2] Registered new searcher Searcher@3f1b8e55[gettingstarted_shard1_replica2] main{ExitableDirectoryReader(UninvertingDirectoryReader())}\nINFO  - 2015-02-09 17:08:28.271; org.apache.solr.core.SolrCore; [gettingstarted_shard2_replica2] Registered new searcher Searcher@71fc4c98[gettingstarted_shard2_replica2] main{ExitableDirectoryReader(UninvertingDirectoryReader())}\nINFO  - 2015-02-09 17:08:28.272; org.apache.solr.update.processor.LogUpdateProcessor; [gettingstarted_shard1_replica2] webapp=/solr path=/update params={update.distrib=FROMLEADER&update.chain=add-unknown-fields-to-the-schema&waitSearcher=true&openSearcher=true&commit=true&softCommit=false&distrib.from=http://192.168.1.2:8983/solr/gettingstarted_shard2_replica2/&commit_end_point=true&wt=javabin&version=2&expungeDeletes=false} {commit=} 0 10\nINFO  - 2015-02-09 17:08:28.272; org.apache.solr.update.processor.LogUpdateProcessor; [gettingstarted_shard2_replica2] webapp=/solr path=/update params={update.distrib=FROMLEADER&update.chain=add-unknown-fields-to-the-schema&waitSearcher=true&openSearcher=true&commit=true&softCommit=false&distrib.from=http://192.168.1.2:8983/solr/gettingstarted_shard2_replica2/&commit_end_point=true&wt=javabin&version=2&expungeDeletes=false} {commit=} 0 10\nINFO  - 2015-02-09 17:08:28.283; org.apache.solr.update.processor.LogUpdateProcessor; [gettingstarted_shard2_replica2] webapp=/solr path=/update params={commit=true} {commit=} 0 27",
    "attachments": {
        "SOLR-7091.patch": "https://issues.apache.org/jira/secure/attachment/12697864/SOLR-7091.patch"
    },
    "issue_links": {},
    "comments": [
        {
            "date": "2015-02-09T19:59:43+0000",
            "author": "Steve Rowe",
            "content": "I see the same problem on standalone Solr - from solr/example/schemaless/logs/solr.log after launching the schemaless example (bin/solr -e schemaless and sending the nested docs update from the ref guide link in the issue description:\n\n\nINFO  - 2015-02-09 19:50:36.131; org.apache.solr.schema.ManagedIndexSchema; Upgraded to managed schema at /Users/sarowe/svn/lucene/dev/branches/lucene_solr_5_0/solr/example/schemaless/solr/gettingstarted/conf/managed-schema\nINFO  - 2015-02-09 19:50:36.144; org.apache.solr.update.processor.LogUpdateProcessor; [gettingstarted] webapp=/solr path=/update params={} {} 0 84\nERROR - 2015-02-09 19:50:36.145; org.apache.solr.common.SolrException; org.apache.solr.common.SolrException: undefined field: \"comments\"\n        at org.apache.solr.schema.IndexSchema.getField(IndexSchema.java:1222)\n        at org.apache.solr.schema.IndexSchema.getCopyFieldsList(IndexSchema.java:1339)\n        at org.apache.solr.update.DocumentBuilder.toDocument(DocumentBuilder.java:110)\n        at org.apache.solr.update.AddUpdateCommand$1.next(AddUpdateCommand.java:186)\n        at org.apache.solr.update.AddUpdateCommand$1.next(AddUpdateCommand.java:161)\n        at org.apache.lucene.index.DocumentsWriterPerThread.updateDocuments(DocumentsWriterPerThread.java:256)\n        at org.apache.lucene.index.DocumentsWriter.updateDocuments(DocumentsWriter.java:411)\n        at org.apache.lucene.index.IndexWriter.updateDocuments(IndexWriter.java:1199)\n        at org.apache.solr.update.DirectUpdateHandler2.addDoc0(DirectUpdateHandler2.java:238)\n        at org.apache.solr.update.DirectUpdateHandler2.addDoc(DirectUpdateHandler2.java:166)\n        at org.apache.solr.update.processor.RunUpdateProcessor.processAdd(RunUpdateProcessorFactory.java:69)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.AddSchemaFieldsUpdateProcessorFactory$AddSchemaFieldsUpdateProcessor.processAdd(AddSchemaFieldsUpdateProcessorFactory.java:328)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.FieldNameMutatingUpdateProcessorFactory$1.processAdd(FieldNameMutatingUpdateProcessorFactory.java:79)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.DistributedUpdateProcessor.doLocalAdd(DistributedUpdateProcessor.java:931)\n        at org.apache.solr.update.processor.DistributedUpdateProcessor.versionAdd(DistributedUpdateProcessor.java:1085)\n        at org.apache.solr.update.processor.DistributedUpdateProcessor.processAdd(DistributedUpdateProcessor.java:697)\n        at org.apache.solr.update.processor.LogUpdateProcessor.processAdd(LogUpdateProcessorFactory.java:104)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.AbstractDefaultValueUpdateProcessorFactory$DefaultValueUpdateProcessor.processAdd(AbstractDefaultValueUpdateProcessorFactory.java:94)\n        at org.apache.solr.handler.loader.XMLLoader.processUpdate(XMLLoader.java:247)\n        at org.apache.solr.handler.loader.XMLLoader.load(XMLLoader.java:174)\n        at org.apache.solr.handler.UpdateRequestHandler$1.load(UpdateRequestHandler.java:103)\n        at org.apache.solr.handler.ContentStreamHandlerBase.handleRequestBody(ContentStreamHandlerBase.java:74)\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:144)\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:2006)\n        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:777)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:413)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:204)\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1419)\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:455)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:557)\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1075)\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:384)\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1009)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n        at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:255)\n        at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154)\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)\n        at org.eclipse.jetty.server.Server.handle(Server.java:368)\n        at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:489)\n        at org.eclipse.jetty.server.BlockingHttpConnection.handleRequest(BlockingHttpConnection.java:53)\n        at org.eclipse.jetty.server.AbstractHttpConnection.content(AbstractHttpConnection.java:953)\n        at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.content(AbstractHttpConnection.java:1014)\n        at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:861)\n        at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:240)\n        at org.eclipse.jetty.server.BlockingHttpConnection.handle(BlockingHttpConnection.java:72)\n        at org.eclipse.jetty.server.bio.SocketConnector$ConnectorEndPoint.run(SocketConnector.java:264)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543)\n        at java.lang.Thread.run(Thread.java:745)\n\n ",
            "id": "comment-14312758"
        },
        {
            "date": "2015-02-10T20:26:45+0000",
            "author": "Steve Rowe",
            "content": "Simple test that reproduces the problem on standalone Solr, along with test schema and solrconfig changes necessary to support blockjoin: _root_ field in the schema and perSegCache in solrconfig (these didn't fix the problem). ",
            "id": "comment-14314853"
        },
        {
            "date": "2015-02-10T21:05:35+0000",
            "author": "Steve Rowe",
            "content": "The first patch only worked in IntelliJ, because it was modifying files in the test resources directory, and the Ant build disallows that.\n\nThis version of the patch runs properly under Ant.\n\nHere's the log:\n\n\n   [junit4]   2> 3800 T13 oas.SolrTestCaseJ4.initCore ####initCore end\n   [junit4]   2> ASYNC  NEW_CORE C0 name=collection1 org.apache.solr.core.SolrCore@567f4255\n   [junit4]   2> 4030 T13 C0 oass.ManagedIndexSchema.persistManagedSchema Upgraded to managed schema at /Users/sarowe/svn/lucene/dev/trunk2/solr/build/solr-core/test/J0/temp/solr.update.DataDrivenBlockJoinTest 70603DAA880A6618-001/tempDir-001/collection1/conf/managed-schema\n   [junit4]   2> 4097 T13 C0 oasup.LogUpdateProcessor.finish [collection1] webapp=null path=null params={} {} 0 295\n   [junit4]   2> 4099 T13 C0 oasc.SolrException.log ERROR org.apache.solr.common.SolrException: ERROR: [doc=2] unknown field 'child'\n   [junit4]   2> \t\tat org.apache.solr.update.DocumentBuilder.toDocument(DocumentBuilder.java:184)\n   [junit4]   2> \t\tat org.apache.solr.update.AddUpdateCommand$1.next(AddUpdateCommand.java:187)\n   [junit4]   2> \t\tat org.apache.solr.update.AddUpdateCommand$1.next(AddUpdateCommand.java:162)\n   [junit4]   2> \t\tat org.apache.lucene.index.DocumentsWriterPerThread.updateDocuments(DocumentsWriterPerThread.java:257)\n   [junit4]   2> \t\tat org.apache.lucene.index.DocumentsWriter.updateDocuments(DocumentsWriter.java:410)\n   [junit4]   2> \t\tat org.apache.lucene.index.IndexWriter.updateDocuments(IndexWriter.java:1194)\n   [junit4]   2> \t\tat org.apache.solr.update.DirectUpdateHandler2.addDoc0(DirectUpdateHandler2.java:235)\n   [junit4]   2> \t\tat org.apache.solr.update.DirectUpdateHandler2.addDoc(DirectUpdateHandler2.java:163)\n   [junit4]   2> \t\tat org.apache.solr.update.processor.RunUpdateProcessor.processAdd(RunUpdateProcessorFactory.java:69)\n   [junit4]   2> \t\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n   [junit4]   2> \t\tat org.apache.solr.update.processor.AddSchemaFieldsUpdateProcessorFactory$AddSchemaFieldsUpdateProcessor.processAdd(AddSchemaFieldsUpdateProcessorFactory.java:328)\n   [junit4]   2> \t\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n   [junit4]   2> \t\tat org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n   [junit4]   2> \t\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n   [junit4]   2> \t\tat org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n   [junit4]   2> \t\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n   [junit4]   2> \t\tat org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n   [junit4]   2> \t\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n   [junit4]   2> \t\tat org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n   [junit4]   2> \t\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n   [junit4]   2> \t\tat org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n   [junit4]   2> \t\tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n   [junit4]   2> \t\tat org.apache.solr.update.processor.DistributedUpdateProcessor.versionAdd(DistributedUpdateProcessor.java:964)\n   [junit4]   2> \t\tat org.apache.solr.update.processor.DistributedUpdateProcessor.processAdd(DistributedUpdateProcessor.java:704)\n   [junit4]   2> \t\tat org.apache.solr.update.processor.LogUpdateProcessor.processAdd(LogUpdateProcessorFactory.java:104)\n   [junit4]   2> \t\tat org.apache.solr.handler.loader.XMLLoader.processUpdate(XMLLoader.java:250)\n   [junit4]   2> \t\tat org.apache.solr.handler.loader.XMLLoader.load(XMLLoader.java:177)\n   [junit4]   2> \t\tat org.apache.solr.handler.UpdateRequestHandler$1.load(UpdateRequestHandler.java:103)\n   [junit4]   2> \t\tat org.apache.solr.handler.ContentStreamHandlerBase.handleRequestBody(ContentStreamHandlerBase.java:74)\n   [junit4]   2> \t\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:144)\n   [junit4]   2> \t\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:2026)\n   [junit4]   2> \t\tat org.apache.solr.servlet.DirectSolrConnection.request(DirectSolrConnection.java:131)\n   [junit4]   2> \t\tat org.apache.solr.util.TestHarness.update(TestHarness.java:278)\n   [junit4]   2> \t\tat org.apache.solr.util.BaseTestHarness.checkUpdateStatus(BaseTestHarness.java:282)\n   [junit4]   2> \t\tat org.apache.solr.util.BaseTestHarness.validateUpdate(BaseTestHarness.java:252)\n   [junit4]   2> \t\tat org.apache.solr.SolrTestCaseJ4.checkUpdateU(SolrTestCaseJ4.java:702)\n   [junit4]   2> \t\tat org.apache.solr.SolrTestCaseJ4.assertU(SolrTestCaseJ4.java:681)\n   [junit4]   2> \t\tat org.apache.solr.SolrTestCaseJ4.assertU(SolrTestCaseJ4.java:675)\n   [junit4]   2> \t\tat org.apache.solr.update.DataDrivenBlockJoinTest.test(DataDrivenBlockJoinTest.java:55)\n   [junit4]   2> \t\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n   [junit4]   2> \t\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n   [junit4]   2> \t\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n   [junit4]   2> \t\tat java.lang.reflect.Method.invoke(Method.java:483)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1618)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:827)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:863)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:877)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:53)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:50)\n   [junit4]   2> \t\tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:46)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:55)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:49)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:65)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:365)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:798)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:458)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:836)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner$3.evaluate(RandomizedRunner.java:738)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner$4.evaluate(RandomizedRunner.java:772)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:783)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:53)\n   [junit4]   2> \t\tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:46)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:42)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:55)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:39)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:39)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:54)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:65)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:55)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:365)\n   [junit4]   2> \t\tat java.lang.Thread.run(Thread.java:745)\n   [junit4]   2> \t\n   [junit4]   2> 4104 T13 oas.SolrTestCaseJ4.tearDown ###Ending test\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=DataDrivenBlockJoinTest -Dtests.method=test -Dtests.seed=70603DAA880A6618 -Dtests.slow=true -Dtests.locale=en_IN -Dtests.timezone=ECT -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1\n   [junit4] ERROR   3.17s | DataDrivenBlockJoinTest.test <<<\n   [junit4]    > Throwable #1: org.apache.solr.common.SolrException: ERROR: [doc=2] unknown field 'child'\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([70603DAA880A6618:F834027026F60BE0]:0)\n   [junit4]    > \tat org.apache.solr.update.DocumentBuilder.toDocument(DocumentBuilder.java:184)\n   [junit4]    > \tat org.apache.solr.update.AddUpdateCommand$1.next(AddUpdateCommand.java:187)\n   [junit4]    > \tat org.apache.solr.update.AddUpdateCommand$1.next(AddUpdateCommand.java:162)\n   [junit4]    > \tat org.apache.lucene.index.DocumentsWriterPerThread.updateDocuments(DocumentsWriterPerThread.java:257)\n   [junit4]    > \tat org.apache.lucene.index.DocumentsWriter.updateDocuments(DocumentsWriter.java:410)\n   [junit4]    > \tat org.apache.lucene.index.IndexWriter.updateDocuments(IndexWriter.java:1194)\n   [junit4]    > \tat org.apache.solr.update.DirectUpdateHandler2.addDoc0(DirectUpdateHandler2.java:235)\n   [junit4]    > \tat org.apache.solr.update.DirectUpdateHandler2.addDoc(DirectUpdateHandler2.java:163)\n   [junit4]    > \tat org.apache.solr.update.processor.RunUpdateProcessor.processAdd(RunUpdateProcessorFactory.java:69)\n   [junit4]    > \tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n   [junit4]    > \tat org.apache.solr.update.processor.AddSchemaFieldsUpdateProcessorFactory$AddSchemaFieldsUpdateProcessor.processAdd(AddSchemaFieldsUpdateProcessorFactory.java:328)\n   [junit4]    > \tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n   [junit4]    > \tat org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n   [junit4]    > \tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n   [junit4]    > \tat org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n   [junit4]    > \tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n   [junit4]    > \tat org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n   [junit4]    > \tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n   [junit4]    > \tat org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n   [junit4]    > \tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n   [junit4]    > \tat org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n   [junit4]    > \tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n   [junit4]    > \tat org.apache.solr.update.processor.DistributedUpdateProcessor.versionAdd(DistributedUpdateProcessor.java:964)\n   [junit4]    > \tat org.apache.solr.update.processor.DistributedUpdateProcessor.processAdd(DistributedUpdateProcessor.java:704)\n   [junit4]    > \tat org.apache.solr.update.processor.LogUpdateProcessor.processAdd(LogUpdateProcessorFactory.java:104)\n   [junit4]    > \tat org.apache.solr.handler.loader.XMLLoader.processUpdate(XMLLoader.java:250)\n   [junit4]    > \tat org.apache.solr.handler.loader.XMLLoader.load(XMLLoader.java:177)\n   [junit4]    > \tat org.apache.solr.handler.UpdateRequestHandler$1.load(UpdateRequestHandler.java:103)\n   [junit4]    > \tat org.apache.solr.handler.ContentStreamHandlerBase.handleRequestBody(ContentStreamHandlerBase.java:74)\n   [junit4]    > \tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:144)\n   [junit4]    > \tat org.apache.solr.core.SolrCore.execute(SolrCore.java:2026)\n   [junit4]    > \tat org.apache.solr.servlet.DirectSolrConnection.request(DirectSolrConnection.java:131)\n   [junit4]    > \tat org.apache.solr.util.TestHarness.update(TestHarness.java:278)\n   [junit4]    > \tat org.apache.solr.util.BaseTestHarness.checkUpdateStatus(BaseTestHarness.java:282)\n   [junit4]    > \tat org.apache.solr.util.BaseTestHarness.validateUpdate(BaseTestHarness.java:252)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.checkUpdateU(SolrTestCaseJ4.java:702)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertU(SolrTestCaseJ4.java:681)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertU(SolrTestCaseJ4.java:675)\n   [junit4]    > \tat org.apache.solr.update.DataDrivenBlockJoinTest.test(DataDrivenBlockJoinTest.java:55)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n\n ",
            "id": "comment-14314924"
        },
        {
            "date": "2015-06-15T19:50:53+0000",
            "author": "Steve Rowe",
            "content": "Patch with a fix, including the test that failed without the patch (modified to include multiple nesting levels: parent/child/grandchild, as well as a same-named field with values that would be guessed differently at each level).\n\nThe issue is that nested documents' fields are completely ignored by AddSchemaFieldsUpdateProcessorFactory.  I had to change the field guessing strategy a little so that all parent + nested documents' same-named fields are examined at the same time when performing the field guessing.\n\nThis patch also adds the \"perSegFilter\" cache (used by the block join parent qparser) to data_driven_schema_configs.\n\nAll Solr core tests pass.  Committing shortly, after precommit succeeds. ",
            "id": "comment-14586559"
        },
        {
            "date": "2015-06-15T20:14:11+0000",
            "author": "ASF subversion and git services",
            "content": "Commit 1685660 from Steve Rowe in branch 'dev/trunk'\n[ https://svn.apache.org/r1685660 ]\n\nSOLR-7091: Nested documents with unknown fields don't work in schemaless mode. ",
            "id": "comment-14586599"
        },
        {
            "date": "2015-06-15T20:49:54+0000",
            "author": "ASF subversion and git services",
            "content": "Commit 1685666 from Steve Rowe in branch 'dev/branches/branch_5x'\n[ https://svn.apache.org/r1685666 ]\n\nSOLR-7091: Nested documents with unknown fields don't work in schemaless mode. (merged trunk r1685660) ",
            "id": "comment-14586677"
        },
        {
            "date": "2015-06-15T20:51:44+0000",
            "author": "Steve Rowe",
            "content": "Committed to trunk and branch_5x.  \n\nThanks for reporting, Tim. ",
            "id": "comment-14586680"
        },
        {
            "date": "2015-08-26T13:05:54+0000",
            "author": "Shalin Shekhar Mangar",
            "content": "Bulk close for 5.3.0 release ",
            "id": "comment-14713146"
        }
    ]
}