{
    "id": "LUCENE-7558",
    "title": "TestGrouping.testBasic() failure",
    "details": {
        "labels": "",
        "priority": "Major",
        "resolution": "Fixed",
        "affect_versions": "None",
        "status": "Resolved",
        "type": "Bug",
        "components": [
            "modules/grouping"
        ],
        "fix_versions": [
            "6.4",
            "7.0"
        ]
    },
    "description": "My Jenkins found a reproducing seed on master:\n\n\n  [junit4] Suite: org.apache.lucene.search.grouping.TestGrouping\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=TestGrouping -Dtests.method=testBasic -Dtests.seed=10F1638A12998EBE -Dtests.slow=true -Dtests.locale=de-GR -Dtests.timezone=Brazil/East -Dtests.asserts=true -Dtests.file.encoding=UTF-8\n   [junit4] FAILURE 0.74s J0 | TestGrouping.testBasic <<<\n   [junit4]    > Throwable #1: java.lang.AssertionError: expected:<[61 75 74 68 6f 72 33]> but was:<[61 75 74 68 6f 72 31]>\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([10F1638A12998EBE:BB0B7E9FCD450890]:0)\n   [junit4]    > \tat org.apache.lucene.search.grouping.TestGrouping.compareGroupValue(TestGrouping.java:298)\n   [junit4]    > \tat org.apache.lucene.search.grouping.TestGrouping.testBasic(TestGrouping.java:165)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n   [junit4]   2> NOTE: test params are: codec=Asserting(Lucene70): {groupend=Lucene50(blocksize=128), sort1=FSTOrd50, sort2=Lucene50(blocksize=128), content=PostingsFormat(name=MockRandom), group=FSTOrd50}, docValues:{author=DocValuesFormat(name=Lucene70), sort1=DocValuesFormat(name=Lucene70), id=DocValuesFormat(name=Lucene70), sort2=DocValuesFormat(name=Asserting), group=DocValuesFormat(name=Lucene70)}, maxPointsInLeafNode=957, maxMBSortInHeap=5.940529900406627, sim=RandomSimilarity(queryNorm=false): {content=org.apache.lucene.search.similarities.BooleanSimilarity@2ad2a093}, locale=de-GR, timezone=Brazil/East\n   [junit4]   2> NOTE: Linux 4.1.0-custom2-amd64 amd64/Oracle Corporation 1.8.0_77 (64-bit)/cpus=16,threads=1,free=449830384,total=511705088\n   [junit4]   2> NOTE: All tests run in this JVM: [TestGrouping]\n   [junit4] Completed [6/6 (1!)] on J0 in 5.34s, 2 tests, 1 failure <<< FAILURES!",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "id": "comment-15659607",
            "date": "2016-11-12T12:43:42+0000",
            "content": "Another reproducing branch_6x seed from my Jenkins:\n\n\n  [junit4] Suite: org.apache.lucene.search.grouping.TestGrouping\n  [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=TestGrouping -Dtests.method=testBasic -Dtests.seed=90A490B8A905A4E3 -Dtests.slow=true -Dtests.locale=ca-ES -Dtests.timezone=Australia/Eucla -Dtests.asserts=true -Dtests.file.encoding=US-ASCII\n  [junit4] FAILURE 0.70s J0 | TestGrouping.testBasic <<<\n  [junit4]    > Throwable #1: java.lang.AssertionError: expected:<[61 75 74 68 6f 72 33]> but was:<[61 75 74 68 6f 72 31]>\n  [junit4]    > \tat __randomizedtesting.SeedInfo.seed([90A490B8A905A4E3:3B5E8DAD76D922CD]:0)\n  [junit4]    > \tat org.apache.lucene.search.grouping.TestGrouping.compareGroupValue(TestGrouping.java:298)\n  [junit4]    > \tat org.apache.lucene.search.grouping.TestGrouping.testBasic(TestGrouping.java:165)\n  [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n  [junit4]   2> NOTE: test params are: codec=Asserting(Lucene62): {groupend=PostingsFormat(name=LuceneVarGapDocFreqInterval), sort1=Lucene50(blocksize=128), sort2=PostingsFormat(name=LuceneVarGapDocFreqInterval), content=BlockTreeOrds(blocksize=128), group=Lucene50(blocksize=128)}, docValues:{author=DocValuesFormat(name=Asserting), sort1=DocValuesFormat(name=Lucene54), id=DocValuesFormat(name=Lucene54), sort2=DocValuesFormat(name=Direct), group=DocValuesFormat(name=Lucene54)}, maxPointsInLeafNode=600, maxMBSortInHeap=6.285305045283985, sim=RandomSimilarity(queryNorm=true,coord=crazy): {content=org.apache.lucene.search.similarities.BooleanSimilarity@7cd27aa}, locale=ca-ES, timezone=Australia/Eucla\n  [junit4]   2> NOTE: Linux 4.1.0-custom2-amd64 amd64/Oracle Corporation 1.8.0_77 (64-bit)/cpus=16,threads=1,free=462939376,total=501743616\n  [junit4]   2> NOTE: All tests run in this JVM: [TestGrouping]\n  [junit4] Completed [6/6 (1!)] on J0 in 6.59s, 2 tests, 1 failure <<< FAILURES!\n\n\n\nAnd two reproducing master seeds from https://jenkins.thetaphi.de/job/Lucene-Solr-master-Linux/18259/ and https://builds.apache.org/job/Lucene-Tests-MMAP-master/194/, respectively:\n\n\n  [junit4] Suite: org.apache.lucene.search.grouping.TestGrouping\n  [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=TestGrouping -Dtests.method=testBasic -Dtests.seed=26E177E5E4FC0BCB -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=ja -Dtests.timezone=America/Boise -Dtests.asserts=true -Dtests.file.encoding=UTF-8\n  [junit4] FAILURE 0.02s J0 | TestGrouping.testBasic <<<\n  [junit4]    > Throwable #1: java.lang.AssertionError: expected:<[61 75 74 68 6f 72 33]> but was:<[61 75 74 68 6f 72 31]>\n  [junit4]    > \tat __randomizedtesting.SeedInfo.seed([26E177E5E4FC0BCB:8D1B6AF03B208DE5]:0)\n  [junit4]    > \tat org.apache.lucene.search.grouping.TestGrouping.compareGroupValue(TestGrouping.java:298)\n  [junit4]    > \tat org.apache.lucene.search.grouping.TestGrouping.testBasic(TestGrouping.java:165)\n  [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n  [junit4]   2> NOTE: test params are: codec=CheapBastard, sim=RandomSimilarity(queryNorm=false): {content=org.apache.lucene.search.similarities.BooleanSimilarity@274bc67b}, locale=ja, timezone=America/Boise\n  [junit4]   2> NOTE: Linux 4.4.0-42-generic amd64/Oracle Corporation 1.8.0_102 (64-bit)/cpus=12,threads=1,free=475433328,total=508887040\n  [junit4]   2> NOTE: All tests run in this JVM: [TestGrouping]\n  [junit4] Completed [6/6 (2!)] on J0 in 9.21s, 2 tests, 1 failure <<< FAILURES!\n\n\n\n\n  [junit4] Suite: org.apache.lucene.search.grouping.TestGrouping\n  [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=TestGrouping -Dtests.method=testBasic -Dtests.seed=F8923EE8245C91CE -Dtests.multiplier=2 -Dtests.slow=true -Dtests.directory=MMapDirectory -Dtests.locale=ms -Dtests.timezone=Iceland -Dtests.asserts=true -Dtests.file.encoding=UTF-8\n  [junit4] FAILURE 0.06s J0 | TestGrouping.testBasic <<<\n  [junit4]    > Throwable #1: java.lang.AssertionError: expected:<[61 75 74 68 6f 72 33]> but was:<[61 75 74 68 6f 72 31]>\n  [junit4]    > \tat __randomizedtesting.SeedInfo.seed([F8923EE8245C91CE:536823FDFB8017E0]:0)\n  [junit4]    > \tat org.apache.lucene.search.grouping.TestGrouping.compareGroupValue(TestGrouping.java:298)\n  [junit4]    > \tat org.apache.lucene.search.grouping.TestGrouping.testBasic(TestGrouping.java:165)\n  [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n  [junit4]   2> NOTE: leaving temporary files on disk at: /x1/jenkins/jenkins-slave/workspace/Lucene-Tests-MMAP-master/lucene/build/grouping/test/J0/temp/lucene.search.grouping.TestGrouping_F8923EE8245C91CE-001\n  [junit4]   2> NOTE: test params are: codec=Asserting(Lucene70): {groupend=PostingsFormat(name=MockRandom), sort1=BlockTreeOrds(blocksize=128), sort2=PostingsFormat(name=MockRandom), content=TestBloomFilteredLucenePostings(BloomFilteringPostingsFormat(Lucene50(blocksize=128))), group=BlockTreeOrds(blocksize=128)}, docValues:{author=DocValuesFormat(name=Direct), sort1=DocValuesFormat(name=Memory), id=DocValuesFormat(name=Memory), sort2=DocValuesFormat(name=Lucene70), group=DocValuesFormat(name=Memory)}, maxPointsInLeafNode=135, maxMBSortInHeap=7.831384345350328, sim=RandomSimilarity(queryNorm=false): {content=org.apache.lucene.search.similarities.BooleanSimilarity@6fc09a1a}, locale=ms, timezone=Iceland\n  [junit4]   2> NOTE: Linux 3.13.0-85-generic amd64/Oracle Corporation 1.8.0_102 (64-bit)/cpus=4,threads=1,free=267112440,total=300417024\n  [junit4]   2> NOTE: All tests run in this JVM: [TestGrouping]\n  [junit4] Completed [6/6 (1!)] on J0 in 23.93s, 2 tests, 1 failure <<< FAILURES!\n\n ",
            "author": "Steve Rowe"
        },
        {
            "id": "comment-15659850",
            "date": "2016-11-12T15:53:27+0000",
            "content": "Commit 4d9451034dd6c4d272903d155da37d3db2180a5e in lucene-solr's branch refs/heads/master from Mike McCandless\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4d94510 ]\n\nLUCENE-7558: use BM25Similarity for this test ",
            "author": "ASF subversion and git services"
        },
        {
            "id": "comment-15659852",
            "date": "2016-11-12T15:54:00+0000",
            "content": "Commit d64a6347820679eb698b42b6ce73c0207bd4b5ff in lucene-solr's branch refs/heads/branch_6x from Mike McCandless\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d64a634 ]\n\nLUCENE-7558: use BM25Similarity for this test ",
            "author": "ASF subversion and git services"
        }
    ]
}