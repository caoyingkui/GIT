{
    "id": "SOLR-9747",
    "title": "Issue when upgrade Apache Solr from version 5.4.1 to 5.5.0 the parse serialization is not working from SolrDocument class to json",
    "details": {
        "components": [
            "search"
        ],
        "type": "Bug",
        "labels": "",
        "fix_versions": [],
        "affect_versions": "5.5,                                            6.3",
        "status": "Closed",
        "resolution": "Works for Me",
        "priority": "Major"
    },
    "description": "When upgrade Apache Solr from version 5.4.1 to 5.5.0, the parse serialization is not working from SolrDocument class to json.\nwe use library com.fasterxml.jackson.core:jackson-databind:2.5.4 for json parsing. We are getting this exception:\n\norg.springframework.web.util.NestedServletException: Handler processing failed; nested exception is java.lang.StackOverflowError\n\torg.springframework.web.servlet.DispatcherServlet.triggerAfterCompletionWithError(DispatcherServlet.java:1302)\n\torg.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:977)\n\torg.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:893)\n\torg.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:969)\n\torg.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:871)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:647)\n\torg.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:845)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:728)\n\torg.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)\n\n\n   causa ra\u00edz\n            java.lang.StackOverflowError\n\tcom.fasterxml.jackson.databind.type.HierarchicType.getRawClass(HierarchicType.java:74)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._doFindSuperInterfaceChain(TypeFactory.java:1009)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._findSuperInterfaceChain(TypeFactory.java:1004)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._findSuperTypeChain(TypeFactory.java:958)\n\tcom.fasterxml.jackson.databind.type.TypeFactory.findTypeParameters(TypeFactory.java:285)\n\tcom.fasterxml.jackson.databind.type.TypeFactory.findTypeParameters(TypeFactory.java:279)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._mapType(TypeFactory.java:891)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._fromClass(TypeFactory.java:732)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._constructType(TypeFactory.java:387)\n\tcom.fasterxml.jackson.databind.type.TypeFactory.findTypeParameters(TypeFactory.java:303)\n\tcom.fasterxml.jackson.databind.type.TypeFactory.findTypeParameters(TypeFactory.java:279)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._mapType(TypeFactory.java:891)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._fromClass(TypeFactory.java:732)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._constructType(TypeFactory.java:387)\n\tcom.fasterxml.jackson.databind.type.TypeFactory.findTypeParameters(TypeFactory.java:303)\n\tcom.fasterxml.jackson.databind.type.TypeFactory.findTypeParameters(TypeFactory.java:279)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._mapType(TypeFactory.java:891)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._fromClass(TypeFactory.java:732)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._constructType(TypeFactory.java:387)\n\tcom.fasterxml.jackson.databind.type.TypeFactory.findTypeParameters(TypeFactory.java:303)\n\tcom.fasterxml.jackson.databind.type.TypeFactory.findTypeParameters(TypeFactory.java:279)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._mapType(TypeFactory.java:891)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._fromClass(TypeFactory.java:732)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._constructType(TypeFactory.java:387)\n\tcom.fasterxml.jackson.databind.type.TypeFactory.findTypeParameters(TypeFactory.java:303)\n\tcom.fasterxml.jackson.databind.type.TypeFactory.findTypeParameters(TypeFactory.java:279)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._mapType(TypeFactory.java:891)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._fromClass(TypeFactory.java:732)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._constructType(TypeFactory.java:387)\n\tcom.fasterxml.jackson.databind.type.TypeFactory.findTypeParameters(TypeFactory.java:303)\n\tcom.fasterxml.jackson.databind.type.TypeFactory.findTypeParameters(TypeFactory.java:279)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._mapType(TypeFactory.java:891)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._fromClass(TypeFactory.java:732)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._constructType(TypeFactory.java:387)\n\tcom.fasterxml.jackson.databind.type.TypeFactory.findTypeParameters(TypeFactory.java:303)\n\tcom.fasterxml.jackson.databind.type.TypeFactory.findTypeParameters(TypeFactory.java:279)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._mapType(TypeFactory.java:891)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._fromClass(TypeFactory.java:732)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._constructType(TypeFactory.java:387)\n\tcom.fasterxml.jackson.databind.type.TypeFactory.findTypeParameters(TypeFactory.java:303)\n\tcom.fasterxml.jackson.databind.type.TypeFactory.findTypeParameters(TypeFactory.java:279)\n\tcom.fasterxml.jackson.databind.type.TypeFactory._mapType(TypeFactory.java:891)\n\n\nWe solved this error getting fields manually from the map _field, the code is:\npublic List<Object> transformSolrDocumentsListToDocuments(SolrDocumentList searched) {\n\tList<Object> documents = new ArrayList<>();\n\tfor (SolrDocument solrDocument : searched) {\n\t\tMap<String, Object> fields = new HashMap<>();\n\t\tfor (String key : solrDocument.getFieldValueMap().keySet()) \n{\n\t\t\tObject field = solrDocument.getFieldValue(key);\n\t\t\tfields.put(key, field);\n\t\t}\n\t\tdocuments.add(fields);\n\t}\n\n\treturn documents;\n}",
    "attachments": {
        "issue-solr-code": "https://issues.apache.org/jira/secure/attachment/12838391/issue-solr-code"
    },
    "issue_links": {},
    "comments": [
        {
            "date": "2016-11-11T12:32:08+0000",
            "author": "Juan Jos\u00e9",
            "content": "From version 2.7.3 of com.fasterxml.jackson.core:jackson-databind is controlled this bug at class com.fasterxml.jackson.databind.type.TypeFactory checking if exist a supertype with the same type that current field. ",
            "id": "comment-15656966"
        }
    ]
}