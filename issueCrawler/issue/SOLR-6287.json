{
    "id": "SOLR-6287",
    "title": "CollectionsAPIDistributedZkTest fails with a create collection timeout",
    "details": {
        "affect_versions": "None",
        "status": "Open",
        "fix_versions": [],
        "components": [
            "SolrCloud",
            "Tests"
        ],
        "type": "Bug",
        "priority": "Major",
        "labels": "",
        "resolution": "Unresolved"
    },
    "description": "http://jenkins.thetaphi.de/job/Lucene-Solr-trunk-Linux/10905/\n\n\n4 tests failed.\nFAILED:  junit.framework.TestSuite.org.apache.solr.cloud.CollectionsAPIDistributedZkTest\n\nError Message:\nERROR: SolrZkClient opens=16 closes=15\n\nStack Trace:\njava.lang.AssertionError: ERROR: SolrZkClient opens=16 closes=15\n        at __randomizedtesting.SeedInfo.seed([EC56B329DF05FAC4]:0)\n        at org.junit.Assert.fail(Assert.java:93)\n        at org.apache.solr.SolrTestCaseJ4.endTrackingZkClients(SolrTestCaseJ4.java:451)\n        at org.apache.solr.SolrTestCaseJ4.afterClass(SolrTestCaseJ4.java:184)\n        at sun.reflect.GeneratedMethodAccessor29.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:606)\n        at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1618)\n        at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:790)\n        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n        at com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:53)\n        at org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:46)\n        at org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:42)\n        at com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:55)\n        at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:39)\n        at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:39)\n        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n        at org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:43)\n        at org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n        at org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:65)\n        at org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:55)\n        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n        at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:365)\n        at java.lang.Thread.run(Thread.java:745)\n\n\nFAILED:  junit.framework.TestSuite.org.apache.solr.cloud.CollectionsAPIDistributedZkTest\n\nError Message:\n2 threads leaked from SUITE scope at org.apache.solr.cloud.CollectionsAPIDistributedZkTest:     1) Thread[id=1693, name=TEST-CollectionsAPIDistributedZkTest.testDistribSearch-seed#[EC56B329DF05FAC4]-SendThread(127.0.0.1:47930), state=TIMED_WAITING, group=TGRP-CollectionsAPIDistributedZkTest]         at java.lang.Thread.sleep(Native Method)         at org.apache.zookeeper.client.StaticHostProvider.next(StaticHostProvider.java:101)         at org.apache.zookeeper.ClientCnxn$SendThread.startConnect(ClientCnxn.java:940)         at org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1003)    2) Thread[id=1694, name=TEST-CollectionsAPIDistributedZkTest.testDistribSearch-seed#[EC56B329DF05FAC4]-EventThread, state=WAITING, group=TGRP-CollectionsAPIDistributedZkTest]         at sun.misc.Unsafe.park(Native Method)         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2043)         at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)         at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:494)\n\nStack Trace:\ncom.carrotsearch.randomizedtesting.ThreadLeakError: 2 threads leaked from SUITE scope at org.apache.solr.cloud.CollectionsAPIDistributedZkTest:\n   1) Thread[id=1693, name=TEST-CollectionsAPIDistributedZkTest.testDistribSearch-seed#[EC56B329DF05FAC4]-SendThread(127.0.0.1:47930), state=TIMED_WAITING, group=TGRP-CollectionsAPIDistributedZkTest]\n        at java.lang.Thread.sleep(Native Method)\n        at org.apache.zookeeper.client.StaticHostProvider.next(StaticHostProvider.java:101)\n        at org.apache.zookeeper.ClientCnxn$SendThread.startConnect(ClientCnxn.java:940)\n        at org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1003)\n   2) Thread[id=1694, name=TEST-CollectionsAPIDistributedZkTest.testDistribSearch-seed#[EC56B329DF05FAC4]-EventThread, state=WAITING, group=TGRP-CollectionsAPIDistributedZkTest]\n        at sun.misc.Unsafe.park(Native Method)\n        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2043)\n        at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)\n        at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:494)\n        at __randomizedtesting.SeedInfo.seed([EC56B329DF05FAC4]:0)\n\n\nFAILED:  junit.framework.TestSuite.org.apache.solr.cloud.CollectionsAPIDistributedZkTest\n\nError Message:\nThere are still zombie threads that couldn't be terminated:    1) Thread[id=1693, name=TEST-CollectionsAPIDistributedZkTest.testDistribSearch-seed#[EC56B329DF05FAC4]-SendThread(127.0.0.1:47930), state=TIMED_WAITING, group=TGRP-CollectionsAPIDistributedZkTest]         at java.lang.Thread.sleep(Native Method)         at org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:994)\n\nStack Trace:\ncom.carrotsearch.randomizedtesting.ThreadLeakError: There are still zombie threads that couldn't be terminated:\n   1) Thread[id=1693, name=TEST-CollectionsAPIDistributedZkTest.testDistribSearch-seed#[EC56B329DF05FAC4]-SendThread(127.0.0.1:47930), state=TIMED_WAITING, group=TGRP-CollectionsAPIDistributedZkTest]\n        at java.lang.Thread.sleep(Native Method)\n        at org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:994)\n        at __randomizedtesting.SeedInfo.seed([EC56B329DF05FAC4]:0)\n\n\nREGRESSION:  org.apache.solr.cloud.CollectionsAPIDistributedZkTest.testDistribSearch\n\nError Message:\ncreatecollection the collection time out:180s\n\nStack Trace:\norg.apache.solr.client.solrj.impl.HttpSolrServer$RemoteSolrException: createcollection the collection time out:180s\n        at org.apache.solr.client.solrj.impl.HttpSolrServer.executeMethod(HttpSolrServer.java:551)\n        at org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:210)\n        at org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:206)\n        at org.apache.solr.cloud.CollectionsAPIDistributedZkTest.testCollectionsAPI(CollectionsAPIDistributedZkTest.java:884)\n        at org.apache.solr.cloud.CollectionsAPIDistributedZkTest.doTest(CollectionsAPIDistributedZkTest.java:203)\n        at org.apache.solr.BaseDistributedSearchTestCase.testDistribSearch(BaseDistributedSearchTestCase.java:865)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)",
    "attachments": {},
    "issue_links": {},
    "comments": []
}