{
    "id": "SOLR-2720",
    "title": "TestLBHttpSolrServer sometimes fails",
    "details": {
        "affect_versions": "4.0-ALPHA",
        "status": "Open",
        "fix_versions": [],
        "components": [],
        "type": "Bug",
        "priority": "Major",
        "labels": "",
        "resolution": "Unresolved"
    },
    "description": "Triggered a random fail with this test on tnrk.",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "author": "Robert Muir",
            "id": "comment-13087725",
            "date": "2011-08-19T14:04:55+0000",
            "content": "\n    [junit] Testsuite: org.apache.solr.client.solrj.TestLBHttpSolrServer\n    [junit] Testcase: testReliability(org.apache.solr.client.solrj.TestLBHttpSolrServer):\tCaused an ERROR\n    [junit] No live SolrServers available to handle this request\n    [junit] org.apache.solr.client.solrj.SolrServerException: No live SolrServers available to handle this request\n    [junit] \tat org.apache.solr.client.solrj.impl.LBHttpSolrServer.request(LBHttpSolrServer.java:442)\n    [junit] \tat org.apache.solr.client.solrj.request.QueryRequest.process(QueryRequest.java:89)\n    [junit] \tat org.apache.solr.client.solrj.SolrServer.query(SolrServer.java:119)\n    [junit] \tat org.apache.solr.client.solrj.TestLBHttpSolrServer.testReliability(TestLBHttpSolrServer.java:176)\n    [junit] \tat org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1526)\n    [junit] \tat org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1428)\n    [junit] Caused by: org.apache.solr.client.solrj.SolrServerException: java.net.SocketTimeoutException: Read timed out\n    [junit] \tat org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.request(CommonsHttpSolrServer.java:482)\n    [junit] \tat org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.request(CommonsHttpSolrServer.java:244)\n    [junit] \tat org.apache.solr.client.solrj.impl.LBHttpSolrServer.request(LBHttpSolrServer.java:395)\n    [junit] Caused by: java.net.SocketTimeoutException: Read timed out\n    [junit] \tat jrockit.net.SocketNativeIO.readBytesPinned(Native Method)\n    [junit] \tat jrockit.net.SocketNativeIO.socketRead(SocketNativeIO.java:32)\n    [junit] \tat java.net.SocketInputStream.socketRead0(SocketInputStream.java)\n    [junit] \tat java.net.SocketInputStream.read(SocketInputStream.java:129)\n    [junit] \tat java.io.BufferedInputStream.fill(BufferedInputStream.java:218)\n    [junit] \tat java.io.BufferedInputStream.read(BufferedInputStream.java:237)\n    [junit] \tat org.apache.commons.httpclient.HttpParser.readRawLine(HttpParser.java:78)\n    [junit] \tat org.apache.commons.httpclient.HttpParser.readLine(HttpParser.java:106)\n    [junit] \tat org.apache.commons.httpclient.HttpConnection.readLine(HttpConnection.java:1116)\n    [junit] \tat org.apache.commons.httpclient.MultiThreadedHttpConnectionManager$HttpConnectionAdapter.readLine(MultiThreadedHttpConnectionManager.java:1413)\n    [junit] \tat org.apache.commons.httpclient.HttpMethodBase.readStatusLine(HttpMethodBase.java:1973)\n    [junit] \tat org.apache.commons.httpclient.HttpMethodBase.readResponse(HttpMethodBase.java:1735)\n    [junit] \tat org.apache.commons.httpclient.HttpMethodBase.execute(HttpMethodBase.java:1098)\n    [junit] \tat org.apache.commons.httpclient.HttpMethodDirector.executeWithRetry(HttpMethodDirector.java:398)\n    [junit] \tat org.apache.commons.httpclient.HttpMethodDirector.executeMethod(HttpMethodDirector.java:171)\n    [junit] \tat org.apache.commons.httpclient.HttpClient.executeMethod(HttpClient.java:397)\n    [junit] \tat org.apache.commons.httpclient.HttpClient.executeMethod(HttpClient.java:323)\n    [junit] \tat org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.request(CommonsHttpSolrServer.java:426)\n    [junit] \tat org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.request(CommonsHttpSolrServer.java:244)\n    [junit] \tat org.apache.solr.client.solrj.impl.LBHttpSolrServer.request(LBHttpSolrServer.java:395)\n    [junit] \tat org.apache.solr.client.solrj.request.QueryRequest.process(QueryRequest.java:89)\n    [junit] \tat org.apache.solr.client.solrj.SolrServer.query(SolrServer.java:119)\n    [junit] \tat org.apache.solr.client.solrj.TestLBHttpSolrServer.testReliability(TestLBHttpSolrServer.java:176)\n    [junit] \tat org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1526)\n    [junit] \tat org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1428)\n    [junit] \n    [junit] \n    [junit] Tests run: 3, Failures: 0, Errors: 1, Time elapsed: 13.537 sec\n    [junit] \n    [junit] ------------- Standard Error -----------------\n    [junit] NOTE: reproduce with: ant test -Dtestcase=TestLBHttpSolrServer -Dtestmethod=testReliability -Dtests.seed=6954804f80726637:5cbc2a8458b1473f:4a2ea5b4bd8b97d5 -Dtests.multiplier=3\n\n "
        },
        {
            "author": "Mark Miller",
            "id": "comment-13141317",
            "date": "2011-11-01T16:56:51+0000",
            "content": "\nBuild: https://hudson.apache.org/hudson/job/Solr-trunk/1342/\n\n1 tests failed.\nREGRESSION:  org.apache.solr.client.solrj.TestLBHttpSolrServer.testSimple\n\nError Message:\nexpected:<3> but was:<2>\n\nStack Trace:\njunit.framework.AssertionFailedError: expected:<3> but was:<2>\n\tat org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1043)\n\tat org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:981)\n\tat org.apache.solr.client.solrj.TestLBHttpSolrServer.testSimple(TestLBHttpSolrServer.java:126)\n\n\n\n "
        },
        {
            "author": "Sami Siren",
            "id": "comment-13143015",
            "date": "2011-11-03T10:04:57+0000",
            "content": "I have been trying to reproduce the problems of this test and so far I have had very little success.\n\nI have not been able to reproduce either of these in isolation, I mean by executing only this single test case (have ran it several thousands of times).\nI was able to see the assertion failed error once when running solrj tests. That time I saw OOM Exception in the logs:\n\n\njava.lang.OutOfMemoryError: unable to create new native thread\n\n\n\nDuring that time I was doing other heavy actions in other processes and I suspect that the cause was indeed another process running on the same machine. In general it seems to be easy to have some sporadic errors related to that same problem: \"unable to create new native thread\" in many tests when the machine running the tests is used heavily for something else at the same time. "
        },
        {
            "author": "Sami Siren",
            "id": "comment-13143793",
            "date": "2011-11-04T07:07:33+0000",
            "content": "New failure with 3.x:\n\nhttps://builds.apache.org/job/Lucene-Solr-tests-only-3.x-java7/838/testReport/junit/org.apache.solr.client.solrj/TestLBHttpSolrServer/testReliability/\n\n [junit] No live SolrServers available to handle this request\n    [junit] org.apache.solr.client.solrj.SolrServerException: No live SolrServers available to handle this request\n    [junit] \tat org.apache.solr.client.solrj.impl.LBHttpSolrServer.request(LBHttpSolrServer.java:222)\n    [junit] \tat org.apache.solr.client.solrj.request.QueryRequest.process(QueryRequest.java:89)\n    [junit] \tat org.apache.solr.client.solrj.SolrServer.query(SolrServer.java:266)\n    [junit] \tat org.apache.solr.client.solrj.TestLBHttpSolrServer.waitForServer(TestLBHttpSolrServer.java:189)\n    [junit] \tat org.apache.solr.client.solrj.TestLBHttpSolrServer.testReliability(TestLBHttpSolrServer.java:182)\n    [junit] \tat org.apache.lucene.util.LuceneTestCase$2$1.evaluate(LuceneTestCase.java:440)\n    [junit] \tat org.apache.lucene.util.LuceneTestCaseRunner.runChild(LuceneTestCaseRunner.java:147)\n    [junit] \tat org.apache.lucene.util.LuceneTestCaseRunner.runChild(LuceneTestCaseRunner.java:50)\n    [junit] Caused by: org.apache.solr.client.solrj.SolrServerException: java.net.SocketTimeoutException: Read timed out\n    [junit] \tat org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.request(CommonsHttpSolrServer.java:480)\n    [junit] \tat org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.request(CommonsHttpSolrServer.java:246)\n    [junit] \tat org.apache.solr.client.solrj.impl.LBHttpSolrServer.request(LBHttpSolrServer.java:206)\n    [junit] Caused by: java.net.SocketTimeoutException: Read timed out\n    [junit] \tat java.net.SocketInputStream.socketRead0(Native Method)\n    [junit] \tat java.net.SocketInputStream.read(SocketInputStream.java:150)\n    [junit] \tat java.net.SocketInputStream.read(SocketInputStream.java:121)\n    [junit] \tat java.io.BufferedInputStream.fill(BufferedInputStream.java:235)\n    [junit] \tat java.io.BufferedInputStream.read(BufferedInputStream.java:254)\n    [junit] \tat org.apache.commons.httpclient.HttpParser.readRawLine(HttpParser.java:78)\n    [junit] \tat org.apache.commons.httpclient.HttpParser.readLine(HttpParser.java:106)\n    [junit] \tat org.apache.commons.httpclient.HttpConnection.readLine(HttpConnection.java:1116)\n    [junit] \tat org.apache.commons.httpclient.MultiThreadedHttpConnectionManager$HttpConnectionAdapter.readLine(MultiThreadedHttpConnectionManager.java:1413)\n    [junit] \tat org.apache.commons.httpclient.HttpMethodBase.readStatusLine(HttpMethodBase.java:1973)\n    [junit] \tat org.apache.commons.httpclient.HttpMethodBase.readResponse(HttpMethodBase.java:1735)\n    [junit] \tat org.apache.commons.httpclient.HttpMethodBase.execute(HttpMethodBase.java:1098)\n    [junit] \tat org.apache.commons.httpclient.HttpMethodDirector.executeWithRetry(HttpMethodDirector.java:398)\n    [junit] \tat org.apache.commons.httpclient.HttpMethodDirector.executeMethod(HttpMethodDirector.java:171)\n    [junit] \tat org.apache.commons.httpclient.HttpClient.executeMethod(HttpClient.java:397)\n    [junit] \tat org.apache.commons.httpclient.HttpClient.executeMethod(HttpClient.java:323)\n    [junit] \tat org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.request(CommonsHttpSolrServer.java:424) "
        }
    ]
}