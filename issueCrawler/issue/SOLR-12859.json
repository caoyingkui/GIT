{
    "id": "SOLR-12859",
    "title": "DocExpirationUpdateProcessorFactory does not work with BasicAuth",
    "details": {
        "type": "Bug",
        "status": "Open",
        "labels": "",
        "fix_versions": [],
        "components": [],
        "priority": "Major",
        "resolution": "Unresolved",
        "affect_versions": "7.5"
    },
    "description": "I setup a cluster with basic auth and then wanted to use Solr's TTL feature ( DocExpirationUpdateProcessorFactory ) to auto-delete documents.\n\n\u00a0\n\nTurns out it doesn't work when Basic Auth is enabled. I get the following stacktrace from the logs\n\n2018-10-12 22:06:38.967 ERROR (autoExpireDocs-42-thread-1) [\u00a0\u00a0 ] o.a.s.u.p.DocExpirationUpdateProcessorFactory Runtime error in periodic deletion of expired docs: Async exception during distributed update: Error from server at http://192.168.0.8:8983/solr/gettingstarted_shard2_replica_n6: require authentication\n\n\n\nrequest: http://192.168.0.8:8983/solr/gettingstarted_shard2_replica_n6/update?update.distrib=TOLEADER&distrib.from=http%3A%2F%2F192.168.0.8%3A8983%2Fsolr%2Fgettingstarted_shard1_replica_n2%2F&wt=javabin&version=2\norg.apache.solr.update.processor.DistributedUpdateProcessor$DistributedUpdatesAsyncException: Async exception during distributed update: Error from server at http://192.168.0.8:8983/solr/gettingstarted_shard2_replica_n6: require authentication\n\n\n\nrequest: http://192.168.0.8:8983/solr/gettingstarted_shard2_replica_n6/update?update.distrib=TOLEADER&distrib.from=http%3A%2F%2F192.168.0.8%3A8983%2Fsolr%2Fgettingstarted_shard1_replica_n2%2F&wt=javabin&version=2\n\u00a0\u00a0 \u00a0at org.apache.solr.update.processor.DistributedUpdateProcessor.doFinish(DistributedUpdateProcessor.java:964) ~[solr-core-7.5.0.jar:7.5.0 b5bf70b7e32d7ddd9742cc821d471c5fabd4e3df - jimczi - 2018-09-18 13:07:55]\n\u00a0\u00a0 \u00a0at org.apache.solr.update.processor.DistributedUpdateProcessor.finish(DistributedUpdateProcessor.java:1976) ~[solr-core-7.5.0.jar:7.5.0 b5bf70b7e32d7ddd9742cc821d471c5fabd4e3df - jimczi - 2018-09-18 13:07:55]\n\u00a0\u00a0 \u00a0at org.apache.solr.update.processor.LogUpdateProcessorFactory$LogUpdateProcessor.finish(LogUpdateProcessorFactory.java:182) ~[solr-core-7.5.0.jar:7.5.0 b5bf70b7e32d7ddd9742cc821d471c5fabd4e3df - jimczi - 2018-09-18 13:07:55]\n\u00a0\u00a0 \u00a0at org.apache.solr.update.processor.UpdateRequestProcessor.finish(UpdateRequestProcessor.java:80) ~[solr-core-7.5.0.jar:7.5.0 b5bf70b7e32d7ddd9742cc821d471c5fabd4e3df - jimczi - 2018-09-18 13:07:55]\n\u00a0\u00a0 \u00a0at org.apache.solr.update.processor.UpdateRequestProcessor.finish(UpdateRequestProcessor.java:80) ~[solr-core-7.5.0.jar:7.5.0 b5bf70b7e32d7ddd9742cc821d471c5fabd4e3df - jimczi - 2018-09-18 13:07:55]\n\u00a0\u00a0 \u00a0at org.apache.solr.update.processor.UpdateRequestProcessor.finish(UpdateRequestProcessor.java:80) ~[solr-core-7.5.0.jar:7.5.0 b5bf70b7e32d7ddd9742cc821d471c5fabd4e3df - jimczi - 2018-09-18 13:07:55]\n\u00a0\u00a0 \u00a0at org.apache.solr.update.processor.UpdateRequestProcessor.finish(UpdateRequestProcessor.java:80) ~[solr-core-7.5.0.jar:7.5.0 b5bf70b7e32d7ddd9742cc821d471c5fabd4e3df - jimczi - 2018-09-18 13:07:55]\n\u00a0\u00a0 \u00a0at org.apache.solr.update.processor.UpdateRequestProcessor.finish(UpdateRequestProcessor.java:80) ~[solr-core-7.5.0.jar:7.5.0 b5bf70b7e32d7ddd9742cc821d471c5fabd4e3df - jimczi - 2018-09-18 13:07:55]\n\u00a0\u00a0 \u00a0at org.apache.solr.update.processor.UpdateRequestProcessor.finish(UpdateRequestProcessor.java:80) ~[solr-core-7.5.0.jar:7.5.0 b5bf70b7e32d7ddd9742cc821d471c5fabd4e3df - jimczi - 2018-09-18 13:07:55]\n\u00a0\u00a0 \u00a0at org.apache.solr.update.processor.UpdateRequestProcessor.finish(UpdateRequestProcessor.java:80) ~[solr-core-7.5.0.jar:7.5.0 b5bf70b7e32d7ddd9742cc821d471c5fabd4e3df - jimczi - 2018-09-18 13:07:55]\n\u00a0\u00a0 \u00a0at org.apache.solr.update.processor.UpdateRequestProcessor.finish(UpdateRequestProcessor.java:80) ~[solr-core-7.5.0.jar:7.5.0 b5bf70b7e32d7ddd9742cc821d471c5fabd4e3df - jimczi - 2018-09-18 13:07:55]\n\u00a0\u00a0 \u00a0at org.apache.solr.update.processor.UpdateRequestProcessor.finish(UpdateRequestProcessor.java:80) ~[solr-core-7.5.0.jar:7.5.0 b5bf70b7e32d7ddd9742cc821d471c5fabd4e3df - jimczi - 2018-09-18 13:07:55]\n\u00a0\u00a0 \u00a0at org.apache.solr.update.processor.UpdateRequestProcessor.finish(UpdateRequestProcessor.java:80) ~[solr-core-7.5.0.jar:7.5.0 b5bf70b7e32d7ddd9742cc821d471c5fabd4e3df - jimczi - 2018-09-18 13:07:55]\n\u00a0\u00a0 \u00a0at org.apache.solr.update.processor.UpdateRequestProcessor.finish(UpdateRequestProcessor.java:80) ~[solr-core-7.5.0.jar:7.5.0 b5bf70b7e32d7ddd9742cc821d471c5fabd4e3df - jimczi - 2018-09-18 13:07:55]\n\u00a0\u00a0 \u00a0at org.apache.solr.update.processor.DocExpirationUpdateProcessorFactory$DeleteExpiredDocsRunnable.run(DocExpirationUpdateProcessorFactory.java:419) [solr-core-7.5.0.jar:7.5.0 b5bf70b7e32d7ddd9742cc821d471c5fabd4e3df - jimczi - 2018-09-18 13:07:55]\n\u00a0\u00a0 \u00a0at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_112]\n\u00a0\u00a0 \u00a0at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308) [?:1.8.0_112]\n\u00a0\u00a0 \u00a0at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180) [?:1.8.0_112]\n\u00a0\u00a0 \u00a0at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294) [?:1.8.0_112]\n\u00a0\u00a0 \u00a0at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_112]\n\u00a0\u00a0 \u00a0at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_112]\n\u00a0\u00a0 \u00a0at java.lang.Thread.run(Thread.java:745) [?:1.8.0_112]",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "id": "comment-16649482",
            "content": "Guess we'll have to force it into using PKI, which it should automatically do if the TTL feature\u00a0uses the correct thread pool...? ",
            "author": "Jan H\u00f8ydahl",
            "date": "2018-10-14T18:24:33+0000"
        },
        {
            "id": "comment-16649488",
            "content": "Linking with SOLR-12860 which I believe may have the same cause/solution ",
            "author": "Jan H\u00f8ydahl",
            "date": "2018-10-14T18:27:10+0000"
        }
    ]
}