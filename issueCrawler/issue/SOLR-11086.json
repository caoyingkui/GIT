{
    "id": "SOLR-11086",
    "title": "Grouping by TrieDateField and DatePointField fails",
    "details": {
        "labels": "",
        "priority": "Minor",
        "components": [
            "search"
        ],
        "type": "Bug",
        "fix_versions": [],
        "affect_versions": "6.6,                                            7.0.1",
        "resolution": "Unresolved",
        "status": "Open"
    },
    "description": "Whenever grouping is done by either TrieDateField or DatePointField in SolrCloud the request fails with the following error:\n\n\n\nERROR - 2017-07-14 13:29:29.587; [c:offers s:shard1 r:core_node1 x:offers_shard1_replica1] org.apache.solr.common.SolrException; org.apache.solr.common.SolrException: Invalid Date String:'Fri Feb 16 00:00:00 UTC 2018'\n        at org.apache.solr.util.DateMathParser.parseMath(DateMathParser.java:234)\n        at org.apache.solr.schema.DatePointField.toNativeType(DatePointField.java:118)\n        at org.apache.solr.schema.DatePointField.readableToIndexed(DatePointField.java:187)\n        at org.apache.solr.search.grouping.distributed.command.GroupConverter.fromMutable(GroupConverter.java:57)\n        at org.apache.solr.search.grouping.distributed.command.SearchGroupsFieldCommand.result(SearchGroupsFieldCommand.java:124)\n        at org.apache.solr.search.grouping.distributed.shardresultserializer.SearchGroupsResultTransformer.transform(SearchGroupsResultTransformer.java:58)\n        at org.apache.solr.search.grouping.distributed.shardresultserializer.SearchGroupsResultTransformer.transform(SearchGroupsResultTransformer.java:37)\n        at org.apache.solr.search.grouping.CommandHandler.processResult(CommandHandler.java:206)\n        at org.apache.solr.handler.component.QueryComponent.process(QueryComponent.java:420)\n        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:296)\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:173)\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:2477)\n        at org.apache.solr.servlet.HttpSolrCall.execute(HttpSolrCall.java:723)\n        at org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:529)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:361)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:305)\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1691)\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:582)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)\n        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:548)\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:226)\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1180)\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:512)\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1112)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n        at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213)\n        at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:119)\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)\n        at org.eclipse.jetty.rewrite.handler.RewriteHandler.handle(RewriteHandler.java:335)\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)\n        at org.eclipse.jetty.server.Server.handle(Server.java:534)\n        at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:320)\n        at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:251)\n        at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273)\n        at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)\n        at org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)\n        at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.executeProduceConsume(ExecuteProduceConsume.java:303)\n        at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:148)\n        at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:136)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:671)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:589)\n        at java.lang.Thread.run(Thread.java:748)\n\n\n\nThe problem is in the way groups are collected for numeric fields.",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "date": "2017-07-14T14:58:45+0000",
            "content": "GitHub user lavrov opened a pull request:\n\n    https://github.com/apache/lucene-solr/pull/221\n\n    SOLR-11086 Fix grouping by TrieDateField and DatePointFiled\n\n\n\tFix converting MutableValueDate to the format that FieldType.indexedToReadable will handle\n\tthis is a quick fix\n\tthe proper fix requires changes in group collecting mechanism\n\n\n\n    https://issues.apache.org/jira/browse/SOLR-11086\n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/elmarreizen/lucene-solr jira/solr-11086\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/lucene-solr/pull/221.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #221\n\n\ncommit 346171add7b30362fe3163f777e067bbd43123d1\nAuthor: Vitaly Lavrov <lavrovvv@gmail.com>\nDate:   2017-07-14T14:52:52Z\n\n    SOLR-11086 Fix converting MutableValueDate to the format that FieldType.indexedToReadable will handle\n\n\n\tthis is a quick fix\n\tthe proper fix requires changes in group collecting mechanism\n\n\n\n ",
            "author": "ASF GitHub Bot",
            "id": "comment-16087427"
        }
    ]
}