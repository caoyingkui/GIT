{
    "id": "SOLR-6572",
    "title": "lineshift in solrconfig.xml is not supported",
    "details": {
        "components": [],
        "type": "Bug",
        "labels": "",
        "fix_versions": [],
        "affect_versions": "4.8.1",
        "status": "Open",
        "resolution": "Unresolved",
        "priority": "Major"
    },
    "description": "This has been a problem for a long time, and is still a problem at least for SOLR 4.8.1.\n\nIf lineshifts are introduced in some elements in solrconfig.xml SOLR fails to pick up on the values.\n\nexample:\nok:\n\n    <requestHandler name=\"/replication\" class=\"solr.ReplicationHandler\" enable=\"${enable.replication:false}\">\n        <lst name=\"slave\">\n            <str name=\"masterUrl\">${solr.master.url:http://solr-admin1.finn.no:12910/solr/front-static/replication}</str>\n\n\n\nnot ok:\n\n    <requestHandler name=\"/replication\" class=\"solr.ReplicationHandler\" enable=\"${enable.replication:false}\">\n        <lst name=\"slave\">\n            <str name=\"masterUrl\">${solr.master.url:http://solr-admin1.finn.no:12910/solr/front-static/replication}\n</str>\n\n\n\nOther example:\nok:\n\n            <str name=\"shards\">localhost:12100/solr,localhost:12200/solr,localhost:12300/solr,localhost:12400/solr,localhost:12500/solr,localhost:12530/solr</str>\n\n\n\nnot ok:\n\n            <str name=\"shards\">\nlocalhost:12100/solr,localhost:12200/solr,localhost:12300/solr,localhost:12400/solr,localhost:12500/solr,localhost:12530/solr\n           </str>\n\n\n\nIDEs and people tend to introduce lineshifts in xml-files to make them prettyer.  SOLR should really not be affected by this.",
    "attachments": {
        "SOLR-6572.unittest": "https://issues.apache.org/jira/secure/attachment/12677102/SOLR-6572.unittest",
        "SOLR-6572.patch": "https://issues.apache.org/jira/secure/attachment/12677101/SOLR-6572.patch"
    },
    "issue_links": {},
    "comments": [
        {
            "date": "2014-10-08T11:23:58+0000",
            "author": "Jan H\u00f8ydahl",
            "content": "Can you elaborate what happens instead? Do you get some log error msg or the param is silently ignored? I'm using whitespace all over the place and have never seen this? A failing JUnit test is a good place to start... ",
            "id": "comment-14163352"
        },
        {
            "date": "2014-10-08T11:54:57+0000",
            "author": "Fredrik Rodland",
            "content": "1. \"all over the place\":  so do we, but we found that these 2 xml-attributes do not support them.  Other xml-attribute do indead support lineshifts.  For instance this is perfectly legal in the master-section of replication request-handler:\n\n            <str name=\"confFiles\">\n                solrconfig.xml,schema.xml,schema-types.xml,schema-commonfields.xml,synonyms.txt,odin.ini,keyword.txt,makemodel.txt,manual.txt\n            </str>\n\n\n\n2. I struggle grasping SOLR and tests regarding to this, but I have no problem reproducing the first example.\n\nstarting up a solr server, I get the following message in the log:\n\nERROR [20141008 134840,044] snapPuller-12-thread-1 org.apache.solr.handler.SnapPuller - Master at:\n\t\thttp://solr-admin1.finn.no:12100/solr/classified/replication\n is not available. Index fetch failed. Exception: Illegal character in scheme name at index 0:\n\t\thttp://solr-admin1.finn.no:12100/solr/classified/replication\n/replication?command=indexversion&wt=javabin&qt=%2Freplication&version=2\n\n\nand trying to view the replication-screen in SOLR-admin I get the floowing msg in the log:\n\nERROR [20141008 134850,000] snapPuller-12-thread-1 org.apache.solr.handler.SnapPuller - Master at:\n\t\thttp://solr-admin1.finn.no:12100/solr/classified/replication\n is not available. Index fetch failed. Exception: Illegal character in scheme name at index 0:\n\t\thttp://solr-admin1.finn.no:12100/solr/classified/replication\n/replication?command=indexversion&wt=javabin&qt=%2Freplication&version=2\nWARN [20141008 134855,008] http-12100-19 org.apache.solr.handler.ReplicationHandler - Exception while invoking 'details' method for replication on master\njava.lang.IllegalArgumentException: Illegal character in scheme name at index 0:\n\t\thttp://solr-admin1.finn.no:12100/solr/classified/replication\n/replication?command=details&slave=false&qt=%2Freplication&wt=javabin&version=2\n\tat java.net.URI.create(URI.java:859) ~[?:1.7.0_45]\n\tat org.apache.http.client.methods.HttpGet.<init>(HttpGet.java:69) ~[httpclient-4.3.1.jar:4.3.1]\n\tat org.apache.solr.client.solrj.impl.HttpSolrServer.createMethod(HttpSolrServer.java:294) ~[solr-solrj-4.8.1.jar:4.8.1 1594670 - rmuir - 2014-05-14 19:38:42]\n\tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:210) ~[solr-solrj-4.8.1.jar:4.8.1 1594670 - rmuir - 2014-05-14 19:38:42]\n\tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:206) ~[solr-solrj-4.8.1.jar:4.8.1 1594670 - rmuir - 2014-05-14 19:38:42]\n\tat org.apache.solr.handler.SnapPuller.getDetails(SnapPuller.java:1657) ~[solr-core-4.8.1.jar:4.8.1 1594670 - rmuir - 2014-05-14 19:38:41]\n\tat org.apache.solr.handler.ReplicationHandler.getReplicationDetails(ReplicationHandler.java:643) [solr-core-4.8.1.jar:4.8.1 1594670 - rmuir - 2014-05-14 19:38:41]\n\tat org.apache.solr.handler.ReplicationHandler.handleRequestBody(ReplicationHandler.java:260) [solr-core-4.8.1.jar:4.8.1 1594670 - rmuir - 2014-05-14 19:38:41]\n\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135) [solr-core-4.8.1.jar:4.8.1 1594670 - rmuir - 2014-05-14 19:38:41]\n\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:1952) [solr-core-4.8.1.jar:4.8.1 1594670 - rmuir - 2014-05-14 19:38:41]\n\tat org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:774) [solr-core-4.8.1.jar:4.8.1 1594670 - rmuir - 2014-05-14 19:38:41]\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:418) [solr-core-4.8.1.jar:4.8.1 1594670 - rmuir - 2014-05-14 19:38:41]\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:207) [solr-core-4.8.1.jar:4.8.1 1594670 - rmuir - 2014-05-14 19:38:41]\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235) [catalina.jar:6.0.26]\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) [catalina.jar:6.0.26]\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233) [catalina.jar:6.0.26]\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191) [catalina.jar:6.0.26]\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127) [catalina.jar:6.0.26]\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102) [catalina.jar:6.0.26]\n\tat org.apache.catalina.authenticator.SingleSignOn.invoke(SingleSignOn.java:394) [catalina.jar:6.0.26]\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109) [catalina.jar:6.0.26]\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298) [catalina.jar:6.0.26]\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:852) [tomcat-coyote.jar:6.0.26]\n\tat org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:588) [tomcat-coyote.jar:6.0.26]\n\tat org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489) [tomcat-coyote.jar:6.0.26]\n\tat java.lang.Thread.run(Thread.java:744) [?:1.7.0_45]\nCaused by: java.net.URISyntaxException: Illegal character in scheme name at index 0:\n\t\thttp://solr-admin1.finn.no:12100/solr/classified/replication\n/replication?command=details&slave=false&qt=%2Freplication&wt=javabin&version=2\n\tat java.net.URI$Parser.fail(URI.java:2829) ~[?:1.7.0_45]\n\tat java.net.URI$Parser.checkChars(URI.java:3002) ~[?:1.7.0_45]\n\tat java.net.URI$Parser.checkChar(URI.java:3012) ~[?:1.7.0_45]\n\tat java.net.URI$Parser.parse(URI.java:3028) ~[?:1.7.0_45]\n\tat java.net.URI.<init>(URI.java:595) ~[?:1.7.0_45]\n\tat java.net.URI.create(URI.java:857) ~[?:1.7.0_45]\n\t... 25 more\n\n ",
            "id": "comment-14163393"
        },
        {
            "date": "2014-10-08T11:59:11+0000",
            "author": "Fredrik Rodland",
            "content": "If I should guess to the whereabouts of this, I guess SnapPuller.java could sanitize/trim the masterUrl it's using.\n\nBut this should really be fixed parsing the XML, shouldn't it? ",
            "id": "comment-14163398"
        },
        {
            "date": "2014-10-08T12:13:43+0000",
            "author": "Fredrik Rodland",
            "content": "After a bit more trial and error: I was also able to reproduce the latter example, WHEN             \n\n<str name=\"shards.tolerant\">true</str>\n\n is not set.  This gives the following error when starting the server:\n\n\nERROR] null:org.apache.solr.common.SolrException: java.lang.IllegalArgumentException: Illegal character in authority at index 7: http://\n                localhost:12100/solr/select\n\tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:311)\n\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135)\n\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:1952)\n\tat org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:774)\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:418)\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:207)\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1489)\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:517)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:138)\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:564)\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:213)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1097)\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:446)\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:175)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1031)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:136)\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:200)\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:109)\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:97)\n\tat org.eclipse.jetty.server.Server.handle(Server.java:445)\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:269)\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:229)\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.run(AbstractConnection.java:358)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:601)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:532)\n\tat java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.IllegalArgumentException: Illegal character in authority at index 7: http://\n                localhost:12100/solr/select\n\tat java.net.URI.create(URI.java:852)\n\tat org.apache.http.client.methods.HttpPost.<init>(HttpPost.java:76)\n\tat org.apache.solr.client.solrj.impl.HttpSolrServer.createMethod(HttpSolrServer.java:324)\n\tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:210)\n\tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:206)\n\tat org.apache.solr.handler.component.HttpShardHandler$1.call(HttpShardHandler.java:157)\n\tat org.apache.solr.handler.component.HttpShardHandler$1.call(HttpShardHandler.java:119)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\t... 1 more\nCaused by: java.net.URISyntaxException: Illegal character in authority at index 7: http://\n                localhost:12100/solr/select\n\tat java.net.URI$Parser.fail(URI.java:2848)\n\tat java.net.URI$Parser.parseAuthority(URI.java:3186)\n\tat java.net.URI$Parser.parseHierarchical(URI.java:3097)\n\tat java.net.URI$Parser.parse(URI.java:3053)\n\tat java.net.URI.<init>(URI.java:588)\n\tat java.net.URI.create(URI.java:850)\n\t... 12 more\n ",
            "id": "comment-14163413"
        },
        {
            "date": "2014-10-08T13:02:22+0000",
            "author": "Jan H\u00f8ydahl",
            "content": "I think it's dangerous to always strip whitespace when parsing XML, cause there may be cases where they are significant. Better to fix it for masterUrl and shards? ",
            "id": "comment-14163452"
        },
        {
            "date": "2014-10-08T14:10:52+0000",
            "author": "Fredrik Rodland",
            "content": "Maybe, but according to:\nhttp://www.w3.org/TR/REC-xml/#sec-white-space\nwe should really remove them? ",
            "id": "comment-14163528"
        },
        {
            "date": "2014-10-18T15:51:24+0000",
            "author": "Anurag Sharma",
            "content": "As mentioned by Jan in the first comment a failing JUnit test is very helpful. It can speed up analysing/fixing the actual issue. ",
            "id": "comment-14176046"
        },
        {
            "date": "2014-10-25T11:21:05+0000",
            "author": "Anurag Sharma",
            "content": "I think this issue could have been easily reproduced in unit test. In DOMUtilTest some how space, new line, tab unit tests were missing before and after node value. This infers that other elements in solrconfig.xml will also have issues. One sample I tried is in <infoStream> under <indexConfig> tag. eg. \nIf I give like \"infoStream\" value is picked as true and works fine.\n\n<indexConfig>\n:\n<infoStream>true</infoStream>\n</indexConfig>\n\n\non the other hand If I give like \"infoStream\" value is picked as \"false\" and miss to read it as \"true\"\n\n<indexConfig>\n:\n<infoStream>true \n</infoStream>\n</indexConfig>\n\n\n\nFix with unit tests and unit test run report is attached. ",
            "id": "comment-14184063"
        }
    ]
}