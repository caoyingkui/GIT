{
    "id": "SOLR-6975",
    "title": "Sort on _docid_ fails for distributed search",
    "details": {
        "components": [],
        "type": "Bug",
        "labels": "",
        "fix_versions": [],
        "affect_versions": "4.10.2,                                            4.10.3,                                            5.0,                                            6.0",
        "status": "Open",
        "resolution": "Unresolved",
        "priority": "Major"
    },
    "description": "Sorting by _docid_ doesn't work for distributed search.  To quickly try for yourself, put the following one-liner to DistributedQueryComponentOptimizationTest line 74 (after the commit):\n\nquery(\"q\", \"*:*\", \"fl\", \"id,test_sS\", \"sort\", \"_docid_ asc\", \"rows\", \"20\");\n\n\n\nMore details to follow...",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "date": "2015-01-14T04:13:51+0000",
            "author": "David Smiley",
            "content": "My initial suspicion was that this had something to do with the distrib single pass optimizations but that seems to be false (as we see here, we return a field other than id & score so it won't do that optimization).\n\nHere's the stack trace:\n\n4044 T38 C1 oasc.SolrException.log ERROR java.lang.IndexOutOfBoundsException: Index: 0, Size: 0\n\t\tat java.util.ArrayList.rangeCheck(ArrayList.java:653)\n\t\tat java.util.ArrayList.get(ArrayList.java:429)\n\t\tat org.apache.solr.common.util.NamedList.getName(NamedList.java:158)\n\t\tat org.apache.solr.handler.component.ShardFieldSortedHitQueue$ShardComparator.sortVal(ShardDoc.java:205)\n\t\tat org.apache.solr.handler.component.ShardFieldSortedHitQueue$2.compare(ShardDoc.java:242)\n\t\tat org.apache.solr.handler.component.ShardFieldSortedHitQueue$2.compare(ShardDoc.java:234)\n\t\tat org.apache.solr.handler.component.ShardFieldSortedHitQueue.lessThan(ShardDoc.java:160)\n\t\tat org.apache.solr.handler.component.ShardFieldSortedHitQueue.lessThan(ShardDoc.java:101)\n\t\tat org.apache.lucene.util.PriorityQueue.upHeap(PriorityQueue.java:225)\n\t\tat org.apache.lucene.util.PriorityQueue.add(PriorityQueue.java:133)\n\t\tat org.apache.lucene.util.PriorityQueue.insertWithOverflow(PriorityQueue.java:149)\n\t\tat org.apache.solr.handler.component.QueryComponent.mergeIds(QueryComponent.java:1058)\n\t\tat org.apache.solr.handler.component.QueryComponent.handleRegularResponses(QueryComponent.java:743)\n\t\tat org.apache.solr.handler.component.QueryComponent.handleResponses(QueryComponent.java:722)\n\t\tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:350)\n\t\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:144)\n\t\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:2006)\n\t\tat org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:781)\n\t\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:417)\n\t\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:204)\n\t\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1652)\n\t\tat org.apache.solr.client.solrj.embedded.JettySolrRunner$DebugFilter.doFilter(JettySolrRunner.java:138)\n\t\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1652)\n\t\tat org.eclipse.jetty.servlets.UserAgentFilter.doFilter(UserAgentFilter.java:83)\n\t\tat org.eclipse.jetty.servlets.GzipFilter.doFilter(GzipFilter.java:364)\n\t\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1652)\n\t\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:585)\n\t\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:221)\n\t\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1125)\n\t\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:515)\n\t\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\n\t\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1059)\n\t\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n\t\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:97)\n\t\tat org.eclipse.jetty.server.Server.handle(Server.java:497)\n\t\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:313)\n\t\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:248)\n\t\tat org.eclipse.jetty.io.AbstractConnection$2.run(AbstractConnection.java:540)\n\t\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:626)\n\t\tat org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:546)\n\t\tat java.lang.Thread.run(Thread.java:745)\n\n ",
            "id": "comment-14276464"
        }
    ]
}