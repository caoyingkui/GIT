{
    "id": "LUCENE-3361",
    "title": "port url+email tokenizer to standardtokenizerinterface (or similar)",
    "details": {
        "labels": "",
        "priority": "Major",
        "components": [
            "modules/analysis"
        ],
        "type": "Bug",
        "fix_versions": [
            "3.4",
            "4.0-ALPHA"
        ],
        "affect_versions": "3.3",
        "resolution": "Fixed",
        "status": "Closed"
    },
    "description": "We should do this so that we can fix the LUCENE-3358 bug there, and preserve backwards.\nWe also want this mechanism anyway, for upgrading to new unicode versions in the future.\n\nWe can regenerate the new TLD list for 3.4 but, we should ensure the existing one is used for the urlemail33 or whatever,\nso that its exactly the same.",
    "attachments": {
        "LUCENE-3361.patch": "https://issues.apache.org/jira/secure/attachment/12489425/LUCENE-3361.patch"
    },
    "issue_links": {},
    "comments": [
        {
            "date": "2011-08-04T23:52:29+0000",
            "content": "Attached is a patch, before applying it you must move the UAX29URLEmailTokenizer.jflex to UAX29URLEmailTOkenizerImpl.jflex\n\n\n\tports this tokenizer over to StandardTokenizerInterface\n\tFixes LUCENE-3358 bug\n\tregenerates TLDs for trunk only\n\tadds backwards 3.1 version with bug and old TLDs and some basic tests.\n\tadds new ctors that require version, deprecates version-less ones\n\tdeprecates inputstream ctor that uses default charset\n\treorganizes constants like standardtokenizer and deprecates the old ones.\n\n ",
            "author": "Robert Muir",
            "id": "comment-13079683"
        },
        {
            "date": "2011-08-04T23:53:59+0000",
            "content": "by the way, the patch is for trunk, but has all the deprecations, including API ones: these can be removed in trunk immediately after porting back,\nbut I would prefer to do this as a separate step, just so i dont forget anything. ",
            "author": "Robert Muir",
            "id": "comment-13079685"
        },
        {
            "date": "2011-08-06T04:45:51+0000",
            "content": "The jflex target depends on the clean-jflex target, which deletes all src/.../standard/*.java files whose contents match regex /generated.*by.*JFlex/.  Your patch leaves intact the first line of UAX29URLEmailTokenizer.java, which matches the regex in a comment.  As a result, running ant jflex deletes UAX29URLEmailTokenizer.java, and since it's no longer generated by JFlex, compilation fails.\n\nWhen I remove this JFlex comment line from UAX29URLEmailTokenizer.java, ant jflex works, everything compiles, and all tests succeed.  +1 to commit after removing this line. ",
            "author": "Steve Rowe",
            "id": "comment-13080353"
        },
        {
            "date": "2011-08-06T05:04:39+0000",
            "content": "One other minor issue: ant clean-jflex doesn't remove the JFlex-generated *.java files under the new directory src/.../standard/std31/.  \n\nTo include them, on line #92 in modules/analysis/common/build.xml, change includes=\"*.java\" to includes=\"**/*.java\". ",
            "author": "Steve Rowe",
            "id": "comment-13080356"
        },
        {
            "date": "2011-08-07T21:34:51+0000",
            "content": "good catch, thanks for reviewing and finding these issues! ",
            "author": "Robert Muir",
            "id": "comment-13080672"
        }
    ]
}