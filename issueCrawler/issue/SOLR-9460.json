{
    "id": "SOLR-9460",
    "title": "Testcase org.apache.solr.cloud.TestSolrCloudWithSecureImpersonation breaks on Windows",
    "details": {
        "components": [
            "Hadoop Integration"
        ],
        "type": "Bug",
        "labels": "",
        "fix_versions": [
            "7.0"
        ],
        "affect_versions": "None",
        "status": "Resolved",
        "resolution": "Fixed",
        "priority": "Major"
    },
    "description": "The above test breaks on windows, because it does not find some crazy executables.\n\nI think it should have the assumption to respect the automatically set sysprop \"tests.disableHdfs\" (if its related to HDFS) or simply assumeFalse(Constants.WINDOWS).:\n\n\n[junit4] Suite: org.apache.solr.cloud.TestSolrCloudWithSecureImpersonation\n   [junit4]   2> Creating dataDir: C:\\Users\\jenkins\\workspace\\Lucene-Solr-master-Windows\\solr\\build\\solr-core\\test\\J1\\temp\\solr.cloud.TestSolrCloudWithSecureImpersonation_357B7FD39643C4D2-001\\init-core-data-001\n   [junit4]   2> 1213353 INFO  (SUITE-TestSolrCloudWithSecureImpersonation-seed#[357B7FD39643C4D2]-worker) [    ] o.a.s.SolrTestCaseJ4 Randomized ssl (false) and clientAuth (false) via: @org.apache.solr.util.RandomizeSSL(reason=, value=NaN, ssl=NaN, clientAuth=NaN)\n   [junit4]   2> 1213678 WARN  (SUITE-TestSolrCloudWithSecureImpersonation-seed#[357B7FD39643C4D2]-worker) [    ] o.a.h.u.NativeCodeLoader Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\n   [junit4]   2> 1213719 ERROR (SUITE-TestSolrCloudWithSecureImpersonation-seed#[357B7FD39643C4D2]-worker) [    ] o.a.h.u.Shell Failed to locate the winutils binary in the hadoop binary path\n   [junit4]   2> java.io.IOException: Could not locate executable null\\bin\\winutils.exe in the Hadoop binaries.\n   [junit4]   2> \tat org.apache.hadoop.util.Shell.getQualifiedBinPath(Shell.java:356)\n   [junit4]   2> \tat org.apache.hadoop.util.Shell.getWinUtilsPath(Shell.java:371)\n   [junit4]   2> \tat org.apache.hadoop.util.Shell.<clinit>(Shell.java:364)\n   [junit4]   2> \tat org.apache.hadoop.util.StringUtils.<clinit>(StringUtils.java:80)\n   [junit4]   2> \tat org.apache.hadoop.security.Groups.parseStaticMapping(Groups.java:130)\n   [junit4]   2> \tat org.apache.hadoop.security.Groups.<init>(Groups.java:94)\n   [junit4]   2> \tat org.apache.hadoop.security.Groups.<init>(Groups.java:74)\n   [junit4]   2> \tat org.apache.solr.cloud.TestSolrCloudWithSecureImpersonation.getUsersFirstGroup(TestSolrCloudWithSecureImpersonation.java:60)\n   [junit4]   2> \tat org.apache.solr.cloud.TestSolrCloudWithSecureImpersonation.getImpersonatorSettings(TestSolrCloudWithSecureImpersonation.java:86)\n   [junit4]   2> \tat org.apache.solr.cloud.TestSolrCloudWithSecureImpersonation.startup(TestSolrCloudWithSecureImpersonation.java:99)\n   [junit4]   2> \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n   [junit4]   2> \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n   [junit4]   2> \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n   [junit4]   2> \tat java.lang.reflect.Method.invoke(Method.java:498)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1764)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:811)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:827)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:57)\n   [junit4]   2> \tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n   [junit4]   2> \tat org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:41)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n   [junit4]   2> \tat org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)\n   [junit4]   2> \tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)\n   [junit4]   2> \tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)\n   [junit4]   2> \tat org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:54)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n   [junit4]   2> \tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:367)\n   [junit4]   2> \tat java.lang.Thread.run(Thread.java:745)\n   [junit4]   2> 1213749 INFO  (SUITE-TestSolrCloudWithSecureImpersonation-seed#[357B7FD39643C4D2]-worker) [    ] o.a.s.SolrTestCaseJ4 ###deleteCore\n   [junit4]   2> NOTE: test params are: codec=DummyCompressingStoredFields(storedFieldsFormat=CompressingStoredFieldsFormat(compressionMode=DUMMY, chunkSize=21944, maxDocsPerChunk=322, blockSize=9), termVectorsFormat=CompressingTermVectorsFormat(compressionMode=DUMMY, chunkSize=21944, blockSize=9)), sim=ClassicSimilarity, locale=ga, timezone=Asia/Kathmandu\n   [junit4]   2> NOTE: Windows 10 10.0 x86/Oracle Corporation 1.8.0_102 (32-bit)/cpus=3,threads=1,free=164468016,total=536870912\n   [junit4]   2> NOTE: All tests run in this JVM: [TestQuerySenderListener, QueryResultKeyTest, TestBinaryResponseWriter, ResponseHeaderTest, TestSolrDeletionPolicy2, TestInitQParser, DistributedTermsComponentTest, TestDistribDocBasedVersion, DistributedFacetPivotLongTailTest, TestOnReconnectListenerSupport, ExitableDirectoryReaderTest, SuggesterWFSTTest, TestSolr4Spatial, ChaosMonkeySafeLeaderTest, TestStressUserVersions, WrapperMergePolicyFactoryTest, FileUtilsTest, TestCopyFieldCollectionResource, TestSmileRequest, TestDistribIDF, TestFastOutputStream, NotRequiredUniqueKeyTest, TestNamedUpdateProcessors, RAMDirectoryFactoryTest, TestConfigSetsAPIZkFailure, CollectionsAPIAsyncDistributedZkTest, TestStressRecovery, TestRandomRequestDistribution, BitVectorTest, BasicAuthIntegrationTest, HdfsBasicDistributedZk2Test, HdfsThreadLeakTest, LeaderFailoverAfterPartitionTest, TestRandomFaceting, TestUseDocValuesAsStored2, OutputWriterTest, TestRuleBasedAuthorizationPlugin, FieldAnalysisRequestHandlerTest, UUIDUpdateProcessorFallbackTest, BasicDistributedZk2Test, GraphQueryTest, DateMathParserTest, TestRangeQuery, TestTrie, DirectUpdateHandlerOptimizeTest, TestNumericTerms64, TestSolrIndexConfig, FieldMutatingUpdateProcessorTest, DistanceFunctionTest, CollectionsAPIDistributedZkTest, DocExpirationUpdateProcessorFactoryTest, TestSolrConfigHandlerConcurrent, TestRecoveryHdfs, DeleteLastCustomShardedReplicaTest, TestSerializedLuceneMatchVersion, AnalyticsQueryTest, SolrInfoMBeanTest, TestCustomDocTransformer, RulesTest, TestFiltering, BasicFunctionalityTest, TestAnalyzeInfixSuggestions, CopyFieldTest, DistributedExpandComponentTest, TestBadConfig, CoreAdminRequestStatusTest, CurrencyFieldOpenExchangeTest, TestInfoStreamLogging, TestMaxScoreQueryParser, DeleteStatusTest, SortSpecParsingTest, SpatialRPTFieldTypeTest, TestStressLiveNodes, ForceLeaderTest, DefaultValueUpdateProcessorTest, TestFieldSortValues, TestAuthorizationFramework, DebugComponentTest, BadIndexSchemaTest, ClassificationUpdateProcessorFactoryTest, TestGraphTermsQParserPlugin, UpdateRequestProcessorFactoryTest, TestTrackingShardHandlerFactory, ZkNodePropsTest, TestSubQueryTransformerDistrib, TestCloudPseudoReturnFields, BinaryUpdateRequestHandlerTest, TestSolrCloudWithSecureImpersonation]\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=TestSolrCloudWithSecureImpersonation -Dtests.seed=357B7FD39643C4D2 -Dtests.slow=true -Dtests.locale=ga -Dtests.timezone=Asia/Kathmandu -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1\n   [junit4] ERROR   0.00s J1 | TestSolrCloudWithSecureImpersonation (suite) <<<\n   [junit4]    > Throwable #1: com.google.common.util.concurrent.UncheckedExecutionException: java.lang.NullPointerException\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([357B7FD39643C4D2]:0)\n   [junit4]    > \tat com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2263)\n   [junit4]    > \tat com.google.common.cache.LocalCache.get(LocalCache.java:4000)\n   [junit4]    > \tat com.google.common.cache.LocalCache.getOrLoad(LocalCache.java:4004)\n   [junit4]    > \tat com.google.common.cache.LocalCache$LocalLoadingCache.get(LocalCache.java:4874)\n   [junit4]    > \tat org.apache.hadoop.security.Groups.getGroups(Groups.java:182)\n   [junit4]    > \tat org.apache.solr.cloud.TestSolrCloudWithSecureImpersonation.getUsersFirstGroup(TestSolrCloudWithSecureImpersonation.java:64)\n   [junit4]    > \tat org.apache.solr.cloud.TestSolrCloudWithSecureImpersonation.getImpersonatorSettings(TestSolrCloudWithSecureImpersonation.java:86)\n   [junit4]    > \tat org.apache.solr.cloud.TestSolrCloudWithSecureImpersonation.startup(TestSolrCloudWithSecureImpersonation.java:99)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n   [junit4]    > Caused by: java.lang.NullPointerException\n   [junit4]    > \tat java.lang.ProcessBuilder.start(ProcessBuilder.java:1012)\n   [junit4]    > \tat org.apache.hadoop.util.Shell.runCommand(Shell.java:483)\n   [junit4]    > \tat org.apache.hadoop.util.Shell.run(Shell.java:456)\n   [junit4]    > \tat org.apache.hadoop.util.Shell$ShellCommandExecutor.execute(Shell.java:722)\n   [junit4]    > \tat org.apache.hadoop.util.Shell.execCommand(Shell.java:815)\n   [junit4]    > \tat org.apache.hadoop.util.Shell.execCommand(Shell.java:798)\n   [junit4]    > \tat org.apache.hadoop.security.ShellBasedUnixGroupsMapping.getUnixGroups(ShellBasedUnixGroupsMapping.java:84)\n   [junit4]    > \tat org.apache.hadoop.security.ShellBasedUnixGroupsMapping.getGroups(ShellBasedUnixGroupsMapping.java:52)\n   [junit4]    > \tat org.apache.hadoop.security.JniBasedUnixGroupsMappingWithFallback.getGroups(JniBasedUnixGroupsMappingWithFallback.java:51)\n   [junit4]    > \tat org.apache.hadoop.security.Groups$GroupCacheLoader.fetchGroupList(Groups.java:239)\n   [junit4]    > \tat org.apache.hadoop.security.Groups$GroupCacheLoader.load(Groups.java:220)\n   [junit4]    > \tat org.apache.hadoop.security.Groups$GroupCacheLoader.load(Groups.java:208)\n   [junit4]    > \tat com.google.common.cache.LocalCache$LoadingValueReference.loadFuture(LocalCache.java:3599)\n   [junit4]    > \tat com.google.common.cache.LocalCache$Segment.loadSync(LocalCache.java:2379)\n   [junit4]    > \tat com.google.common.cache.LocalCache$Segment.lockedGetOrLoad(LocalCache.java:2342)\n   [junit4]    > \tat com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2257)\n   [junit4]    > \t... 31 moreThrowable #2: java.lang.NullPointerException\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([357B7FD39643C4D2]:0)\n   [junit4]    > \tat org.apache.solr.cloud.TestSolrCloudWithSecureImpersonation.shutdown(TestSolrCloudWithSecureImpersonation.java:154)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n   [junit4] Completed [245/632 (2!)] on J1 in 0.43s, 0 tests, 2 errors <<< FAILURES!\n\n\n\nI think this is related to Noble Paul's recent commits on this test.",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "date": "2016-09-03T08:49:04+0000",
            "author": "ASF subversion and git services",
            "content": "Commit 62f8b8d02a3060547105e7a24e680fac46e1bf39 in lucene-solr's branch refs/heads/master from Uwe Schindler\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=62f8b8d ]\n\nSOLR-9460: Disable test that does not work with Windows ",
            "id": "comment-15460718"
        },
        {
            "date": "2016-09-03T08:51:46+0000",
            "author": "Uwe Schindler",
            "content": "I disabled the test ",
            "id": "comment-15460724"
        },
        {
            "date": "2016-09-03T18:30:53+0000",
            "author": "ASF subversion and git services",
            "content": "Commit e026ac4fe5d1bbb1c798699feeb39bf2efa15be2 in lucene-solr's branch refs/heads/master from Uwe Schindler\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e026ac4 ]\n\nSOLR-9460: Fully fix test setup ",
            "id": "comment-15461498"
        },
        {
            "date": "2016-09-07T09:57:00+0000",
            "author": "ASF subversion and git services",
            "content": "Commit 62f8b8d02a3060547105e7a24e680fac46e1bf39 in lucene-solr's branch refs/heads/apiv2 from Uwe Schindler\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=62f8b8d ]\n\nSOLR-9460: Disable test that does not work with Windows ",
            "id": "comment-15470190"
        },
        {
            "date": "2016-09-07T09:57:02+0000",
            "author": "ASF subversion and git services",
            "content": "Commit e026ac4fe5d1bbb1c798699feeb39bf2efa15be2 in lucene-solr's branch refs/heads/apiv2 from Uwe Schindler\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e026ac4 ]\n\nSOLR-9460: Fully fix test setup ",
            "id": "comment-15470191"
        },
        {
            "date": "2016-11-17T21:39:52+0000",
            "author": "ASF subversion and git services",
            "content": "Commit 225198a2b754783d485b2cee7d1aa4741f65e5a3 in lucene-solr's branch refs/heads/branch_6x from Uwe Schindler\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=225198a ]\n\nSOLR-9460: Disable test that does not work with Windows ",
            "id": "comment-15674886"
        },
        {
            "date": "2016-11-17T21:39:54+0000",
            "author": "ASF subversion and git services",
            "content": "Commit 6428772aa2cd3a1c344cfcaeec7c30fd46071134 in lucene-solr's branch refs/heads/branch_6x from Uwe Schindler\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6428772 ]\n\nSOLR-9460: Fully fix test setup ",
            "id": "comment-15674887"
        }
    ]
}