{
    "id": "SOLR-7224",
    "title": "HashQParserPlugin test failures due to java.util.concurrent.RejectedExecutionException",
    "details": {
        "components": [],
        "type": "Bug",
        "labels": "",
        "fix_versions": [
            "5.1"
        ],
        "affect_versions": "6.0",
        "status": "Closed",
        "resolution": "Fixed",
        "priority": "Major"
    },
    "description": "Initial commit of the HashQParserPlugin is causing the following test errors:\n\nBuild: http://jenkins.thetaphi.de/job/Lucene-Solr-trunk-MacOSX/2045/\nJava: 64bit/jdk1.8.0 -XX:-UseCompressedOops -XX:+UseSerialGC\n\n1 tests failed.\nFAILED:  org.apache.solr.search.TestHashQParserPlugin.testHashPartition\n\nError Message:\njava.util.concurrent.RejectedExecutionException: Task org.apache.solr.search.HashQParserPlugin$HashQuery$SegmentPartitioner@4a0a82b6 rejected from java.util.concurrent.ThreadPoolExecutor@aad7186[Terminated, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]\n\nStack Trace:\njava.io.IOException: java.util.concurrent.RejectedExecutionException: Task org.apache.solr.search.HashQParserPlugin$HashQuery$SegmentPartitioner@4a0a82b6 rejected from java.util.concurrent.ThreadPoolExecutor@aad7186[Terminated, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]\n        at __randomizedtesting.SeedInfo.seed([B0C766A25E8A6825:617A474765E0D14E]:0)\n        at org.apache.solr.search.HashQParserPlugin$HashQuery.createWeight(HashQParserPlugin.java:168)\n        at org.apache.lucene.search.IndexSearcher.createWeight(IndexSearcher.java:623)\n        at org.apache.lucene.search.IndexSearcher.createNormalizedWeight(IndexSearcher.java:606)\n        at org.apache.solr.search.SolrIndexSearcher.getProcessedFilter(SolrIndexSearcher.java:1123)\n        at org.apache.solr.search.SolrIndexSearcher.getDocListNC(SolrIndexSearcher.java:1605)\n        at org.apache.solr.search.SolrIndexSearcher.getDocListC(SolrIndexSearcher.java:1481)\n        at org.apache.solr.search.SolrIndexSearcher.search(SolrIndexSearcher.java:557)\n        at org.apache.solr.handler.component.QueryComponent.process(QueryComponent.java:512)\n        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:226)\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:142)\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1967)\n        at org.apache.solr.util.TestHarness.query(TestHarness.java:320)\n        at org.apache.solr.util.TestHarness.query(TestHarness.java:302)\n        at org.apache.solr.search.TestHashQParserPlugin.testHashPartition(TestHashQParserPlugin.java:94)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:483)\n        at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1627)\n        at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:836)\n        at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:872)\n        at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:886)\n        at com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:53)\n        at org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:50)\n        at org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:46)\n        at org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:49)\n        at org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:65)\n        at org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n        at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:365)\n        at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:798)\n        at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:458)\n        at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:845)\n        at com.carrotsearch.randomizedtesting.RandomizedRunner$3.evaluate(RandomizedRunner.java:747)\n        at com.carrotsearch.randomizedtesting.RandomizedRunner$4.evaluate(RandomizedRunner.java:781)\n        at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:792)\n        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n        at com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:53)\n        at org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:46)\n        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n        at org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:42)\n        at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:39)\n        at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:39)\n        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n        at org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:54)\n        at org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n        at org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:65)\n        at org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:55)\n        at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n        at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:365)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: java.util.concurrent.RejectedExecutionException: Task org.apache.solr.search.HashQParserPlugin$HashQuery$SegmentPartitioner@4a0a82b6 rejected from java.util.concurrent.ThreadPoolExecutor@aad7186[Terminated, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]\n        at java.util.concurrent.ThreadPoolExecutor$AbortPolicy.rejectedExecution(ThreadPoolExecutor.java:2047)\n        at java.util.concurrent.ThreadPoolExecutor.reject(ThreadPoolExecutor.java:823)\n        at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:1369)\n        at org.apache.solr.search.HashQParserPlugin$HashQuery.createWeight(HashQParserPlugin.java:166)\n        ... 52 more",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "date": "2015-03-10T12:59:04+0000",
            "author": "Joel Bernstein",
            "content": "The initial version of the HashQParserPlugin uses a thread pool to build it's filter. The automated testes are frequently failing with the RejectedExecutionException. I'll need a little time to investigate so I'll switch to using a single thread to create the filter. ",
            "id": "comment-14354843"
        },
        {
            "date": "2015-03-10T13:07:49+0000",
            "author": "ASF subversion and git services",
            "content": "Commit 1665517 from Joel Bernstein in branch 'dev/trunk'\n[ https://svn.apache.org/r1665517 ]\n\nSOLR-7224: HashQParserPlugin test failures due to java.util.concurrent.RejectedExecutionException ",
            "id": "comment-14354854"
        },
        {
            "date": "2015-03-25T19:42:29+0000",
            "author": "ASF subversion and git services",
            "content": "Commit 1669212 from Joel Bernstein in branch 'dev/branches/branch_5x'\n[ https://svn.apache.org/r1669212 ]\n\nSOLR-7082 SOLR-7224 SOLR-7225: Streaming Aggregation for SolrCloud ",
            "id": "comment-14380605"
        }
    ]
}