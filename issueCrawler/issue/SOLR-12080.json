{
    "id": "SOLR-12080",
    "title": "Frequent failures of MoveReplicaHDFSTest.testFailedMove",
    "details": {
        "labels": "",
        "priority": "Major",
        "components": [],
        "type": "Bug",
        "fix_versions": [],
        "affect_versions": "None",
        "resolution": "Unresolved",
        "status": "Open"
    },
    "description": "This test frequently fails. This is one of the failing seeds:\n\n   [junit4]   2> 129275 INFO  (qtp1647120030-248) [n:127.0.0.1:55469_solr c:MoveReplicaHDFSTest_failed_coll_true s:shard2 r:core_node7 x:MoveReplicaHDFSTest_failed_coll_true_shard2_replica_n4] o.a.s.c.S.Request [MoveReplicaHDFSTest_failed_coll_true_shard2_replica_n4]  webapp=/solr path=/select params={q=*:*&_stateVer_=MoveReplicaHDFSTest_failed_coll_true:9&wt=javabin&version=2} status=503 QTime=0\n   [junit4]   2> 129278 ERROR (qtp148844424-682) [n:127.0.0.1:54855_solr c:MoveReplicaHDFSTest_failed_coll_true s:shard2 r:core_node8 x:MoveReplicaHDFSTest_failed_coll_true_shard2_replica_n6] o.a.s.h.RequestHandlerBase org.apache.solr.common.SolrException: no servers hosting shard: shard1\n   [junit4]   2> \tat org.apache.solr.handler.component.HttpShardHandler.prepDistributed(HttpShardHandler.java:436)\n   [junit4]   2> \tat org.apache.solr.handler.component.SearchHandler.getAndPrepShardHandler(SearchHandler.java:226)\n   [junit4]   2> \tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:264)\n   [junit4]   2> \tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:195)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore.execute(SolrCore.java:2503)\n   [junit4]   2> \tat org.apache.solr.servlet.HttpSolrCall.execute(HttpSolrCall.java:711)\n   [junit4]   2> \tat org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:517)\n   [junit4]   2> \tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:384)\n   [junit4]   2> \tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:330)\n   [junit4]   2> \tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1637)\n   [junit4]   2> \tat org.apache.solr.client.solrj.embedded.JettySolrRunner$DebugFilter.doFilter(JettySolrRunner.java:139)\n   [junit4]   2> \tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1637)\n   [junit4]   2> \tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:533)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:188)\n   [junit4]   2> \tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1595)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:188)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1253)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:168)\n   [junit4]   2> \tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:473)\n   [junit4]   2> \tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1564)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:166)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1155)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:527)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132)\n   [junit4]   2> \tat org.eclipse.jetty.server.Server.handle(Server.java:530)\n   [junit4]   2> \tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:347)\n   [junit4]   2> \tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:256)\n   [junit4]   2> \tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:279)\n   [junit4]   2> \tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:102)\n   [junit4]   2> \tat org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:124)\n   [junit4]   2> \tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:247)\n   [junit4]   2> \tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.produce(EatWhatYouKill.java:140)\n   [junit4]   2> \tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:131)\n   [junit4]   2> \tat org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:382)\n   [junit4]   2> \tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:708)\n   [junit4]   2> \tat org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:626)\n   [junit4]   2> \tat java.lang.Thread.run(Thread.java:748)\n   [junit4]   2> \n   [junit4]   2> 129279 INFO  (qtp148844424-682) [n:127.0.0.1:54855_solr c:MoveReplicaHDFSTest_failed_coll_true s:shard2 r:core_node8 x:MoveReplicaHDFSTest_failed_coll_true_shard2_replica_n6] o.a.s.c.S.Request [MoveReplicaHDFSTest_failed_coll_true_shard2_replica_n6]  webapp=/solr path=/select params={q=*:*&_stateVer_=MoveReplicaHDFSTest_failed_coll_true:9&wt=javabin&version=2} status=503 QTime=1\n   [junit4]   2> 129280 ERROR (TEST-MoveReplicaHDFSTest.testFailedMove-seed#[26ECC6481A5A977A]) [    ] o.a.s.c.s.i.CloudSolrClient Request to collection [MoveReplicaHDFSTest_failed_coll_true] failed due to (503) org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server at http://127.0.0.1:54855/solr/MoveReplicaHDFSTest_failed_coll_true: no servers hosting shard: shard1, retry? 1\n   [junit4]   2> 129281 INFO  (TEST-MoveReplicaHDFSTest.testFailedMove-seed#[26ECC6481A5A977A]) [    ] o.a.s.SolrTestCaseJ4 ###Ending testFailedMove\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=MoveReplicaHDFSTest -Dtests.method=testFailedMove -Dtests.seed=26ECC6481A5A977A -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=is-IS -Dtests.timezone=Asia/Macau -Dtests.asserts=true -Dtests.file.encoding=US-ASCII\n   [junit4] ERROR   21.0s J10 | MoveReplicaHDFSTest.testFailedMove <<<\n   [junit4]    > Throwable #1: org.apache.solr.client.solrj.SolrServerException: No live SolrServers available to handle this request:[http://127.0.0.1:54855/solr/MoveReplicaHDFSTest_failed_coll_true, http://127.0.0.1:55469/solr/MoveReplicaHDFSTest_failed_coll_true]\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([26ECC6481A5A977A:8C2115BAAD8942AA]:0)\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.LBHttpSolrClient.request(LBHttpSolrClient.java:462)\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.CloudSolrClient.sendRequest(CloudSolrClient.java:1104)\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:884)\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:991)\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.CloudSolrClient.request(CloudSolrClient.java:817)\n   [junit4]    > \tat org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:194)\n   [junit4]    > \tat org.apache.solr.client.solrj.SolrClient.query(SolrClient.java:942)\n   [junit4]    > \tat org.apache.solr.cloud.MoveReplicaTest.testFailedMove(MoveReplicaTest.java:309)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:748)\n   [junit4]    > Caused by: org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server at http://127.0.0.1:54855/solr/MoveReplicaHDFSTest_failed_coll_true: no servers hosting shard: shard1\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:643)\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:255)\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:244)\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.LBHttpSolrClient.doRequest(LBHttpSolrClient.java:483)\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.LBHttpSolrClient.request(LBHttpSolrClient.java:413)\n   [junit4]    > \t... 46 more\n\n\n\nFull log attached.",
    "attachments": {
        "jenkins.log.txt.gz": "https://issues.apache.org/jira/secure/attachment/12914073/jenkins.log.txt.gz"
    },
    "issue_links": {},
    "comments": [
        {
            "date": "2018-09-20T10:39:32+0000",
            "content": "Commit 52bdcf6bb0b7645da55124298f6d268fe8f4a77a in lucene-solr's branch refs/heads/master from Andrzej Bialecki\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=52bdcf6 ]\n\niSOLR-12080: Improve error handling of MoveReplicaCmd. Improve the test stability\nby avoiding killing overseer. ",
            "author": "ASF subversion and git services",
            "id": "comment-16621811"
        },
        {
            "date": "2018-09-20T23:59:13+0000",
            "content": "Commit 52bdcf6bb0b7645da55124298f6d268fe8f4a77a in lucene-solr's branch refs/heads/jira/http2 from Andrzej Bialecki\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=52bdcf6 ]\n\niSOLR-12080: Improve error handling of MoveReplicaCmd. Improve the test stability\nby avoiding killing overseer. ",
            "author": "ASF subversion and git services",
            "id": "comment-16622891"
        },
        {
            "date": "2018-09-21T05:00:28+0000",
            "content": "Commit 1b0b33eaf1c0de8cd70b64dd27ef91e0f8d2482a in lucene-solr's branch refs/heads/branch_7x from Andrzej Bialecki\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1b0b33e ]\n\niSOLR-12080: Improve error handling of MoveReplicaCmd. Improve the test stability\nby avoiding killing overseer. ",
            "author": "ASF subversion and git services",
            "id": "comment-16623070"
        },
        {
            "date": "2018-10-02T23:21:08+0000",
            "content": "This test still fails a lot. Any objections in setting it to @AwaitsFix until this Jira is addressed? ",
            "author": "Tom\u00e1s Fern\u00e1ndez L\u00f6bbe",
            "id": "comment-16636224"
        },
        {
            "date": "2018-10-03T05:56:56+0000",
            "content": "Commit e687748405f5ef439969b542aaec014abdfbfaec in lucene-solr's branch refs/heads/master from Andrzej Bialecki\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e687748 ]\n\nSOLR-12080: Disable this test until it's fixed. ",
            "author": "ASF subversion and git services",
            "id": "comment-16636490"
        },
        {
            "date": "2018-10-03T05:57:21+0000",
            "content": "Commit 29a99a69a0659ba3cc80bb36b97728fce789af83 in lucene-solr's branch refs/heads/branch_7x from Andrzej Bialecki\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=29a99a6 ]\n\nSOLR-12080: Disable this test until it's fixed. ",
            "author": "ASF subversion and git services",
            "id": "comment-16636491"
        }
    ]
}