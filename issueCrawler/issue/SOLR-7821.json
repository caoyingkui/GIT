{
    "id": "SOLR-7821",
    "title": "example films data doesn't work consistently with data-driven schema (schemaless)",
    "details": {
        "components": [],
        "type": "Bug",
        "labels": "",
        "fix_versions": [],
        "affect_versions": "None",
        "status": "Closed",
        "resolution": "Won't Fix",
        "priority": "Major"
    },
    "description": "On 5.2.1, tried to index the films data into a collection\n\n\n[~/dev/lw/tools/solr-5.2.1]$ bin/solr -cloud\nWaiting to see Solr listening on port 8983 [/]  \nStarted Solr server on port 8983 (pid=98797). Happy searching!\n\n[~/dev/lw/tools/solr-5.2.1]$ bin/solr create -c gettingstarted -shards 2\nConnecting to ZooKeeper at localhost:9983\nUploading /Users/timpotter/dev/lw/tools/solr-5.2.1/server/solr/configsets/data_driven_schema_configs/conf for config gettingstarted to ZooKeeper at localhost:9983\n\nCreating new collection 'gettingstarted' using command:\nhttp://192.168.1.2:8983/solr/admin/collections?action=CREATE&name=gettingstarted&numShards=2&replicationFactor=1&maxShardsPerNode=2&collection.configName=gettingstarted\n\n{\n  \"responseHeader\":{\n    \"status\":0,\n    \"QTime\":2575},\n  \"success\":{\"\":{\n      \"responseHeader\":{\n        \"status\":0,\n        \"QTime\":2367},\n      \"core\":\"gettingstarted_shard2_replica1\"}}}\n\n[~/dev/lw/tools/solr-5.2.1]$ bin/post -c gettingstarted example/films/films.json\n/Library/Java/JavaVirtualMachines/jdk1.8.0_25.jdk/Contents/Home/bin/java -classpath /Users/timpotter/dev/lw/tools/solr-5.2.1/dist/solr-core-5.2.1.jar -Dauto=yes -Dc=gettingstarted -Ddata=files org.apache.solr.util.SimplePostTool example/films/films.json\nSimplePostTool version 5.0.0\nPosting files to [base] url http://localhost:8983/solr/gettingstarted/update...\nEntering auto mode. File endings considered are xml,json,csv,pdf,doc,docx,ppt,pptx,xls,xlsx,odt,odp,ods,ott,otp,ots,rtf,htm,html,txt,log\nPOSTing file films.json (application/json) to [base]\nSimplePostTool: WARNING: Solr returned an error #400 (Bad Request) for url: http://localhost:8983/solr/gettingstarted/update\nSimplePostTool: WARNING: Response: {\"responseHeader\":{\"status\":400,\"QTime\":285},\"error\":{\"msg\":\"ERROR: [doc=/en/quien_es_el_senor_lopez] Error adding field 'name'='\u00bfQui\u00e9n es el se\u00f1or L\u00f3pez?' msg=For input string: \\\"\u00bfQui\u00e9n es el se\u00f1or L\u00f3pez?\\\"\",\"code\":400}}\nSimplePostTool: WARNING: IOException while reading response: java.io.IOException: Server returned HTTP response code: 400 for URL: http://localhost:8983/solr/gettingstarted/update\n1 files indexed.\nCOMMITting Solr index changes to http://localhost:8983/solr/gettingstarted/update...\nTime spent: 0:00:00.370\n\n\n\nIn the solr.log, I see:\n\n\nERROR - 2015-07-22 21:54:36.395; [gettingstarted shard2 core_node1 gettingstarted_shard2_replica1] org.apache.solr.common.SolrException; org.apache.solr.common.SolrException: ERROR: [doc=/en/quien_es_el_senor_lopez] Error adding field 'name'='\u00bfQui\u00e9n es el se\u00f1or L\u00f3pez?' msg=For input string: \"\u00bfQui\u00e9n es el se\u00f1or L\u00f3pez?\"\n        at org.apache.solr.update.DocumentBuilder.toDocument(DocumentBuilder.java:176)\n        at org.apache.solr.update.AddUpdateCommand.getLuceneDocument(AddUpdateCommand.java:83)\n        at org.apache.solr.update.DirectUpdateHandler2.addDoc0(DirectUpdateHandler2.java:237)\n        at org.apache.solr.update.DirectUpdateHandler2.addDoc(DirectUpdateHandler2.java:163)\n        at org.apache.solr.update.processor.RunUpdateProcessor.processAdd(RunUpdateProcessorFactory.java:69)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.AddSchemaFieldsUpdateProcessorFactory$AddSchemaFieldsUpdateProcessor.processAdd(AddSchemaFieldsUpdateProcessorFactory.java:328)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.FieldNameMutatingUpdateProcessorFactory$1.processAdd(FieldNameMutatingUpdateProcessorFactory.java:79)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.FieldMutatingUpdateProcessor.processAdd(FieldMutatingUpdateProcessor.java:117)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.DistributedUpdateProcessor.doLocalAdd(DistributedUpdateProcessor.java:955)\n        at org.apache.solr.update.processor.DistributedUpdateProcessor.versionAdd(DistributedUpdateProcessor.java:1110)\n        at org.apache.solr.update.processor.DistributedUpdateProcessor.processAdd(DistributedUpdateProcessor.java:706)\n        at org.apache.solr.update.processor.LogUpdateProcessor.processAdd(LogUpdateProcessorFactory.java:104)\n        at org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:51)\n        at org.apache.solr.update.processor.AbstractDefaultValueUpdateProcessorFactory$DefaultValueUpdateProcessor.processAdd(AbstractDefaultValueUpdateProcessorFactory.java:94)\n        at org.apache.solr.handler.loader.JsonLoader$SingleThreadedJsonLoader.handleAdds(JsonLoader.java:470)\n        at org.apache.solr.handler.loader.JsonLoader$SingleThreadedJsonLoader.processUpdate(JsonLoader.java:134)\n        at org.apache.solr.handler.loader.JsonLoader$SingleThreadedJsonLoader.load(JsonLoader.java:113)\n        at org.apache.solr.handler.loader.JsonLoader.load(JsonLoader.java:76)\n        at org.apache.solr.handler.UpdateRequestHandler$1.load(UpdateRequestHandler.java:98)\n        at org.apache.solr.handler.ContentStreamHandlerBase.handleRequestBody(ContentStreamHandlerBase.java:74)\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:143)\n       at org.apache.solr.core.SolrCore.execute(SolrCore.java:2064)\n        at org.apache.solr.servlet.HttpSolrCall.execute(HttpSolrCall.java:654)\n        at org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:450)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:227)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:196)\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1652)\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:585)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)\n        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:577)\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:223)\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1127)\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:515)\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1061)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n        at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:215)\n        at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:110)\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:97)\n        at org.eclipse.jetty.server.Server.handle(Server.java:497)\n        at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:310)\n        at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:257)\n        at org.eclipse.jetty.io.AbstractConnection$2.run(AbstractConnection.java:540)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:635)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:555)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.NumberFormatException: For input string: \"\u00bfQui\u00e9n es el se\u00f1or L\u00f3pez?\"\n        at java.lang.NumberFormatException.forInputString(NumberFormatException.java:65)\n        at java.lang.Long.parseLong(Long.java:589)\n        at java.lang.Long.parseLong(Long.java:631)\n        at org.apache.solr.schema.TrieField.createField(TrieField.java:643)\n        at org.apache.solr.schema.TrieField.createFields(TrieField.java:694)\n        at org.apache.solr.update.DocumentBuilder.addField(DocumentBuilder.java:48)\n        at org.apache.solr.update.DocumentBuilder.toDocument(DocumentBuilder.java:123)\n        ... 57 more\n\n\n\nClearly this is because some films have already been added that have numbers as the name (but in double quotes). Perhaps the field-guessing component should take into account whether the field value is a string in the JSON?",
    "attachments": {
        "tutorial-add-field.png": "https://issues.apache.org/jira/secure/attachment/12912416/tutorial-add-field.png"
    },
    "issue_links": {},
    "comments": [
        {
            "date": "2015-07-22T22:13:11+0000",
            "author": "Timothy Potter",
            "content": "see example/films/README.txt ",
            "id": "comment-14637742"
        },
        {
            "date": "2018-02-28T09:48:37+0000",
            "author": "Swapnil M Mane",
            "content": "Hi team, \n\nWhile following tutorial (http://lucene.apache.org/solr/guide/7_2/solr-tutorial.html#create-the-names-field)\nI have faced the same issue, then I figured out I have created field with 'names' instead of 'name'. This is because I have seen this screenshot http://lucene.apache.org/solr/guide/7_2/images/solr-tutorial/tutorial-add-field.png\n\nI know it will be a very minor change but should we change the screenshot (In new screenshot value in the input field should be 'name' instead of 'names')\n\nThanks! ",
            "id": "comment-16380062"
        },
        {
            "date": "2018-02-28T15:05:11+0000",
            "author": "Cassandra Targett",
            "content": "Swapnil M Mane - the screenshot was fixed for SOLR-11893. That will be released when Solr 7.3 is released (which should be soon). ",
            "id": "comment-16380434"
        },
        {
            "date": "2018-03-01T06:26:53+0000",
            "author": "Swapnil M Mane",
            "content": "Nice, thanks Cassandra Targett  ",
            "id": "comment-16381574"
        }
    ]
}