{
    "id": "SOLR-6167",
    "title": "SolrDocumentList cannot be cast to ResultContext on Solr 4.8.0",
    "details": {
        "affect_versions": "4.8",
        "status": "Resolved",
        "fix_versions": [],
        "components": [
            "clients - php"
        ],
        "type": "Bug",
        "priority": "Major",
        "labels": "",
        "resolution": "Invalid"
    },
    "description": "Hello,\n\nI have a running instance of Solr 4.2.1 (I will refer to it as 'instance A') and I am trying to pass to Solr 4.8.0. For this purpose, I created a copy of the machine which hosts 'instance A' (I will refer to the copy as 'instance B') and, on this new machine, I have installed Solr 4.8.0 and I have created a collection with 4 shards. Then, on the new machine, I have iterated over a copy of the index built on instance A and I have re-indexed all the documents and inserted them inside the new collection of Solr 4.8.0. I have completed this process, the two index seem to contain the same documents and I am successfully able to query properly both the indexes.\n\nWhen I try to run the following query on 'instance A':\n\nhttp://instance_A_ip:23332/solr/myindex/query?q=id%3Amyid&fl=html&wt=html\n\nI get a well formatted html response. Unfortunately, when I try the same query on the 'instance B'\n\nhttp://instance_B_ip:23332/solr/mycollection/query?q=id%3Amyid&fl=html&wt=html\n\nI receive the following error code:\n\nHTTP Status 500 - \n{msg=org.apache.solr.common.SolrDocumentList cannot be cast to org.apache.solr.response.ResultContext,trace=java.lang.ClassCastException: org.apache.solr.common.SolrDocumentList cannot be cast to org.apache.solr.response.ResultContext at my.library.solr.HtmlResponseWriter.write(HtmlResponseWriter.java:33) at org.apache.solr.servlet.SolrDispatchFilter.writeResponse(SolrDispatchFilter.java:762) at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:431) at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:207) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:103) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293) at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:861) at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:606) at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489) at java.lang.Thread.run(Thread.java:744) ,code=500}\n\nThis is the error that I grep from the solr log file:\n\n org.apache.solr.common.SolrException; null:java.lang.ClassCastException: org.apache.solr.common.SolrDocumentList cannot be cast to org.apache.solr.response.ResultContext\n        at my.library.solr.HtmlResponseWriter.write(HtmlResponseWriter.java:33)\n        at org.apache.solr.servlet.SolrDispatchFilter.writeResponse(SolrDispatchFilter.java:762)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:431)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:207)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:103)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293)\n        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:861)\n        at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:606)\n        at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)\n        at java.lang.Thread.run(Thread.java:744)\n\nThis is the error that I grep from the tomcat log file:\t\t\n\norg.apache.solr.servlet.SolrDispatchFilter  \u2013 null:java.lang.ClassCastException: org.apache.solr.common.SolrDocumentList cannot be cast to org.apache.solr.response.ResultContext\n        at my.library.solr.HtmlResponseWriter.write(HtmlResponseWriter.java:33)\n        at org.apache.solr.servlet.SolrDispatchFilter.writeResponse(SolrDispatchFilter.java:762)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:431)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:207)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:103)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293)\n        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:861)\n        at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:606)\n        at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)\n        at java.lang.Thread.run(Thread.java:744)\n\n\nThe differences between instance A and instance B are:\n\n\tthe Solr versions\n\ton instance A, I am using a single Solr instance (without Solr Cloud)\n\ton instance B, I am using Solr Cloud and I created a collection with 4 shards\n\tI removed a couple of not necessary fields inside the schema of the instance B when I created the collection (before to load documents) and I loaded documents according to the new schema (I have not loaded the removed fields)\n\n\n\nThe instance B is installed on a clone of the machine on which instance A is running, so the software stack as well as the hardware are the same. On both the machines I have installed Apache Tomcat 6.0.37.\n\nIf I try to run the same query on instance B by specifying wt=csv I obtain the right field value, but unfortunately it's not a well formatted html reply.\n\nInside the schema on instance A, these are the information related to the html field:\n\nField: html\nFlags:    Stored\nProperties  yes\t\nSchema      yes\nField-Type: org.apache.solr.schema.StrField\nIndex Analyzer: org.apache.solr.schema.FieldType$DefaultAnalyzer\nQuery Analyzer: org.apache.solr.schema.FieldType$DefaultAnalyzer\n\nInside the schema on instance B, these are the information related to the html field:\n\nField: html\nFlags:    Stored  Sort Missing Last\nProperties  yes     yes\t\nSchema      yes     yes\nField-Type: org.apache.solr.schema.StrField\nIndex Analyzer: org.apache.solr.schema.FieldType$DefaultAnalyzer\nQuery Analyzer: org.apache.solr.schema.FieldType$DefaultAnalyzer\n\nDo you know if there is a way to execute on a Solr cloud collection with Solr 4.8.0 this same query that I am successfully able to execute on my single instance of Solr 4.2.1?\n\nI would really appreciate every suggestion about it. Please, let me know if you need any further information.\n\nThank you.\n\nBest Regards,\n\nGuido",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "author": "Hoss Man",
            "id": "comment-14031246",
            "date": "2014-06-13T22:05:45+0000",
            "content": "This does not appear to be a problem with solr.\n\nyour stack trace shows that the error is coming from a custom response writer (HtmlResponseWriter) that you have installed..\n\n\njava.lang.ClassCastException: org.apache.solr.common.SolrDocumentList cannot be cast to org.apache.solr.response.ResultContext\n        at my.library.solr.HtmlResponseWriter.write(HtmlResponseWriter.java:33)\n        at org.apache.solr.servlet.SolrDispatchFilter.writeResponse(SolrDispatchFilter.java:762)\n\n\n\n\nMy suspicion is that your custom plugin was initially written against an older version of Solr (at some point before the ResultContext class was introduced) and is making some harded codded assumptions about what objects it finds in the response which are no longer accurate.\n\nIf you have further questions, please raise them on the solr-user@lucene mailing list. "
        },
        {
            "author": "Guido",
            "id": "comment-14072280",
            "date": "2014-07-23T20:29:21+0000",
            "content": "You was right: I solved this issue by modifying my library accordingly to the new version of Solr.\n\nThank you very much for your help.\n\nBest Regards,\n\nGuido "
        }
    ]
}