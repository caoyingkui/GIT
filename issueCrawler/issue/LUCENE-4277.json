{
    "id": "LUCENE-4277",
    "title": "TestIndexWriterWithThreads hung in DocumentsWriterFlushControl.",
    "details": {
        "labels": "",
        "priority": "Major",
        "components": [],
        "type": "Bug",
        "fix_versions": [
            "4.0-BETA",
            "6.0"
        ],
        "affect_versions": "None",
        "resolution": "Fixed",
        "status": "Closed"
    },
    "description": "I've hit this when trying out the new runner with suite timeouts. And voila, it works  Output below.\n\n\nSuite: org.apache.lucene.index.TestIndexWriterWithThreads\n   > (@AfterClass output)\n  2> 31.7.2012 15:28:45 com.carrotsearch.randomizedtesting.ThreadLeakControl$2 evaluate\n  2> WARNING: Suite execution timed out: org.apache.lucene.index.TestIndexWriterWithThreads\n  2> ==== jstack at approximately timeout time ====\n  2> \"Thread-54\" ID=98 WAITING on java.util.concurrent.locks.ReentrantLock$NonfairSync@2103217a owned by \"Thread-53\" ID=97\n  2> \tat sun.misc.Unsafe.park(Native Method)\n  2> \t- waiting on java.util.concurrent.locks.ReentrantLock$NonfairSync@2103217a\n  2> \tat java.util.concurrent.locks.LockSupport.park(LockSupport.java:158)\n  2> \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:747)\n  2> \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:778)\n  2> \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1114)\n  2> \tat java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:186)\n  2> \tat java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:262)\n  2> \tat org.apache.lucene.index.TestIndexWriterWithThreads$1.run(TestIndexWriterWithThreads.java:532)\n  2> \n  2> \"Thread-53\" ID=97 WAITING on org.apache.lucene.index.DocumentsWriterFlushControl@5d4d1093\n  2> \tat java.lang.Object.wait(Native Method)\n  2> \t- waiting on org.apache.lucene.index.DocumentsWriterFlushControl@5d4d1093\n  2> \tat java.lang.Object.wait(Object.java:485)\n  2> \tat org.apache.lucene.index.DocumentsWriterFlushControl.waitForFlush(DocumentsWriterFlushControl.java:221)\n  2> \tat org.apache.lucene.index.DocumentsWriter.abort(DocumentsWriter.java:233)\n  2> \t- locked org.apache.lucene.index.DocumentsWriter@548ae184\n  2> \tat org.apache.lucene.index.IndexWriter.rollbackInternal(IndexWriter.java:1845)\n  2> \tat org.apache.lucene.index.IndexWriter.rollback(IndexWriter.java:1813)\n  2> \t- locked java.lang.Object@69dbcc78\n  2> \tat org.apache.lucene.index.TestIndexWriterWithThreads$1.run(TestIndexWriterWithThreads.java:537)\n  2> \tLocked synchronizers:\n  2> \t- java.util.concurrent.locks.ReentrantLock$NonfairSync@2103217a\n  2> \n  2> \"Thread-52\" ID=96 WAITING on java.util.concurrent.locks.ReentrantLock$NonfairSync@2103217a owned by \"Thread-53\" ID=97\n  2> \tat sun.misc.Unsafe.park(Native Method)\n  2> \t- waiting on java.util.concurrent.locks.ReentrantLock$NonfairSync@2103217a\n  2> \tat java.util.concurrent.locks.LockSupport.park(LockSupport.java:158)\n  2> \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:747)\n  2> \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:778)\n  2> \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1114)\n  2> \tat java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:186)\n  2> \tat java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:262)\n  2> \tat org.apache.lucene.index.TestIndexWriterWithThreads$1.run(TestIndexWriterWithThreads.java:532)\n  2> \n  2> \"Thread-51\" ID=95 WAITING on java.util.concurrent.locks.ReentrantLock$NonfairSync@2103217a owned by \"Thread-53\" ID=97\n  2> \tat sun.misc.Unsafe.park(Native Method)\n  2> \t- waiting on java.util.concurrent.locks.ReentrantLock$NonfairSync@2103217a\n  2> \tat java.util.concurrent.locks.LockSupport.park(LockSupport.java:158)\n  2> \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:747)\n  2> \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:778)\n  2> \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1114)\n  2> \tat java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:186)\n  2> \tat java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:262)\n  2> \tat org.apache.lucene.index.TestIndexWriterWithThreads$1.run(TestIndexWriterWithThreads.java:532)\n  2> \n  2> \"Thread-50\" ID=94 WAITING on java.util.concurrent.locks.ReentrantLock$NonfairSync@2103217a owned by \"Thread-53\" ID=97\n  2> \tat sun.misc.Unsafe.park(Native Method)\n  2> \t- waiting on java.util.concurrent.locks.ReentrantLock$NonfairSync@2103217a\n  2> \tat java.util.concurrent.locks.LockSupport.park(LockSupport.java:158)\n  2> \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:747)\n  2> \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:778)\n  2> \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1114)\n  2> \tat java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:186)\n  2> \tat java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:262)\n  2> \tat org.apache.lucene.index.TestIndexWriterWithThreads$1.run(TestIndexWriterWithThreads.java:532)\n  2> \n  2> \"TEST-TestIndexWriterWithThreads.testRollbackAndCommitWithThreads-seed#[844703FAAAFA8855]\" ID=87 WAITING on org.apache.lucene.index.TestIndexWriterWithThreads$1@358ce15a\n  2> \tat java.lang.Object.wait(Native Method)\n  2> \t- waiting on org.apache.lucene.index.TestIndexWriterWithThreads$1@358ce15a\n  2> \tat java.lang.Thread.join(Thread.java:1143)\n  2> \tat java.lang.Thread.join(Thread.java:1196)\n  2> \tat org.apache.lucene.index.TestIndexWriterWithThreads.testRollbackAndCommitWithThreads(TestIndexWriterWithThreads.java:590)\n  2> \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  2> \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n  2> \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n  2> \tat java.lang.reflect.Method.invoke(Method.java:597)\n  2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1569)\n  2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner.access$600(RandomizedRunner.java:81)\n  2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:739)\n  2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:775)\n  2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:789)\n  2> \tat org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:50)\n  2> \tat org.apache.lucene.util.TestRuleFieldCacheSanity$1.evaluate(TestRuleFieldCacheSanity.java:32)\n  2> \tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\n  2> \tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:55)\n  2> \tat org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:48)\n  2> \tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:70)\n  2> \tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n  2> \tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n  2> \tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:345)\n  2> \tat com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:763)\n  2> \tat com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:424)\n  2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:748)\n  2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner$3.evaluate(RandomizedRunner.java:650)\n  2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner$4.evaluate(RandomizedRunner.java:684)\n  2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:695)\n  2> \tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\n  2> \tat org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)\n  2> \tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:55)\n  2> \tat org.apache.lucene.util.TestRuleNoInstanceHooksOverrides$1.evaluate(TestRuleNoInstanceHooksOverrides.java:53)\n  2> \tat org.apache.lucene.util.TestRuleNoStaticHooksShadowing$1.evaluate(TestRuleNoStaticHooksShadowing.java:52)\n  2> \tat org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:36)\n  2> \tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n  2> \tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:70)\n  2> \tat org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:55)\n  2> \tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n  2> \tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:345)\n  2> \tat java.lang.Thread.run(Thread.java:619)\n  2> \n  2> \"SUITE-TestIndexWriterWithThreads-seed#[844703FAAAFA8855]\" ID=86 RUNNABLE\n  2> \tat sun.management.ThreadImpl.dumpThreads0(Native Method)\n  2> \tat sun.management.ThreadImpl.dumpAllThreads(ThreadImpl.java:374)\n  2> \tat com.carrotsearch.randomizedtesting.ThreadLeakControl.formatThreadStacksFull(ThreadLeakControl.java:636)\n  2> \tat com.carrotsearch.randomizedtesting.ThreadLeakControl.access$800(ThreadLeakControl.java:60)\n  2> \tat com.carrotsearch.randomizedtesting.ThreadLeakControl$2.evaluate(ThreadLeakControl.java:379)\n  2> \t- locked java.lang.Object@6e7b52bf\n  2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSuite(RandomizedRunner.java:557)\n  2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner.access$200(RandomizedRunner.java:81)\n  2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner$1.run(RandomizedRunner.java:491)\n  2> \n  2> \"Signal Dispatcher\" ID=4 RUNNABLE\n  2> \n  2> \"Finalizer\" ID=3 WAITING on java.lang.ref.ReferenceQueue$Lock@6275b243\n  2> \tat java.lang.Object.wait(Native Method)\n  2> \t- waiting on java.lang.ref.ReferenceQueue$Lock@6275b243\n  2> \tat java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:118)\n  2> \tat java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:134)\n  2> \tat java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:159)\n  2> \n  2> \"Reference Handler\" ID=2 WAITING on java.lang.ref.Reference$Lock@1d0a7f35\n  2> \tat java.lang.Object.wait(Native Method)\n  2> \t- waiting on java.lang.ref.Reference$Lock@1d0a7f35\n  2> \tat java.lang.Object.wait(Object.java:485)\n  2> \tat java.lang.ref.Reference$ReferenceHandler.run(Reference.java:116)\n  2> \n  2> \"main\" ID=1 WAITING on com.carrotsearch.randomizedtesting.RandomizedRunner$1@3f1074b4\n  2> \tat java.lang.Object.wait(Native Method)\n  2> \t- waiting on com.carrotsearch.randomizedtesting.RandomizedRunner$1@3f1074b4\n  2> \tat java.lang.Thread.join(Thread.java:1143)\n  2> \tat java.lang.Thread.join(Thread.java:1196)\n  2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSuite(RandomizedRunner.java:501)\n  2> \tat com.carrotsearch.randomizedtesting.RandomizedRunner.run(RandomizedRunner.java:398)\n  2> \tat com.carrotsearch.ant.tasks.junit4.slave.SlaveMain.execute(SlaveMain.java:153)\n  2> \tat com.carrotsearch.ant.tasks.junit4.slave.SlaveMain.main(SlaveMain.java:246)\n  2> \tat com.carrotsearch.ant.tasks.junit4.slave.SlaveMainSafe.main(SlaveMainSafe.java:12)\n  2> \n  2> ^^==============================================\n  2> \n  2> 31.7.2012 15:29:05 com.carrotsearch.randomizedtesting.ThreadLeakControl checkThreadLeaks\n  2> SEVERE: 6 threads leaked from SUITE scope at org.apache.lucene.index.TestIndexWriterWithThreads: \n  2>    1) Thread[id=87, name=TEST-TestIndexWriterWithThreads.testRollbackAndCommitWithThreads-seed#[844703FAAAFA8855], state=WAITING, group=TGRP-TestIndexWriterWithThreads]\n  2>         at java.lang.Object.wait(Native Method)\n  2>         at java.lang.Thread.join(Thread.java:1143)\n  2>         at java.lang.Thread.join(Thread.java:1196)\n  2>         at org.apache.lucene.index.TestIndexWriterWithThreads.testRollbackAndCommitWithThreads(TestIndexWriterWithThreads.java:590)\n  2>         at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  2>         at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n  2>         at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n  2>         at java.lang.reflect.Method.invoke(Method.java:597)\n  2>         at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1569)\n  2>         at com.carrotsearch.randomizedtesting.RandomizedRunner.access$600(RandomizedRunner.java:81)\n  2>         at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:739)\n  2>         at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:775)\n  2>         at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:789)\n  2>         at org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:50)\n  2>         at org.apache.lucene.util.TestRuleFieldCacheSanity$1.evaluate(TestRuleFieldCacheSanity.java:32)\n  2>         at org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\n  2>         at com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:55)\n  2>         at org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:48)\n  2>         at org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:70)\n  2>         at org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n  2>         at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n  2>         at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:345)\n  2>         at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:763)\n  2>         at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:424)\n  2>         at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:748)\n  2>         at com.carrotsearch.randomizedtesting.RandomizedRunner$3.evaluate(RandomizedRunner.java:650)\n  2>         at com.carrotsearch.randomizedtesting.RandomizedRunner$4.evaluate(RandomizedRunner.java:684)\n  2>         at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:695)\n  2>         at org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\n  2>         at org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)\n  2>         at com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:55)\n  2>         at org.apache.lucene.util.TestRuleNoInstanceHooksOverrides$1.evaluate(TestRuleNoInstanceHooksOverrides.java:53)\n  2>         at org.apache.lucene.util.TestRuleNoStaticHooksShadowing$1.evaluate(TestRuleNoStaticHooksShadowing.java:52)\n  2>         at org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:36)\n  2>         at org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n  2>         at org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:70)\n  2>         at org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:55)\n  2>         at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n  2>         at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:345)\n  2>         at java.lang.Thread.run(Thread.java:619)\n  2>    2) Thread[id=96, name=Thread-52, state=WAITING, group=TGRP-TestIndexWriterWithThreads]\n  2>         at sun.misc.Unsafe.park(Native Method)\n  2>         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:158)\n  2>         at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:747)\n  2>         at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:778)\n  2>         at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1114)\n  2>         at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:186)\n  2>         at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:262)\n  2>         at org.apache.lucene.index.TestIndexWriterWithThreads$1.run(TestIndexWriterWithThreads.java:532)\n  2>    3) Thread[id=94, name=Thread-50, state=WAITING, group=TGRP-TestIndexWriterWithThreads]\n  2>         at sun.misc.Unsafe.park(Native Method)\n  2>         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:158)\n  2>         at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:747)\n  2>         at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:778)\n  2>         at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1114)\n  2>         at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:186)\n  2>         at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:262)\n  2>         at org.apache.lucene.index.TestIndexWriterWithThreads$1.run(TestIndexWriterWithThreads.java:532)\n  2>    4) Thread[id=98, name=Thread-54, state=WAITING, group=TGRP-TestIndexWriterWithThreads]\n  2>         at sun.misc.Unsafe.park(Native Method)\n  2>         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:158)\n  2>         at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:747)\n  2>         at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:778)\n  2>         at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1114)\n  2>         at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:186)\n  2>         at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:262)\n  2>         at org.apache.lucene.index.TestIndexWriterWithThreads$1.run(TestIndexWriterWithThreads.java:532)\n  2>    5) Thread[id=95, name=Thread-51, state=WAITING, group=TGRP-TestIndexWriterWithThreads]\n  2>         at sun.misc.Unsafe.park(Native Method)\n  2>         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:158)\n  2>         at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:747)\n  2>         at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:778)\n  2>         at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1114)\n  2>         at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:186)\n  2>         at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:262)\n  2>         at org.apache.lucene.index.TestIndexWriterWithThreads$1.run(TestIndexWriterWithThreads.java:532)\n  2>    6) Thread[id=97, name=Thread-53, state=WAITING, group=TGRP-TestIndexWriterWithThreads]\n  2>         at java.lang.Object.wait(Native Method)\n  2>         at java.lang.Object.wait(Object.java:485)\n  2>         at org.apache.lucene.index.DocumentsWriterFlushControl.waitForFlush(DocumentsWriterFlushControl.java:221)\n  2>         at org.apache.lucene.index.DocumentsWriter.abort(DocumentsWriter.java:233)\n  2>         at org.apache.lucene.index.IndexWriter.rollbackInternal(IndexWriter.java:1845)\n  2>         at org.apache.lucene.index.IndexWriter.rollback(IndexWriter.java:1813)\n  2>         at org.apache.lucene.index.TestIndexWriterWithThreads$1.run(TestIndexWriterWithThreads.java:537)\n  2> 31.7.2012 15:29:05 com.carrotsearch.randomizedtesting.ThreadLeakControl tryToInterruptAll\n  2> INFO: Starting to interrupt leaked threads:\n  2>    1) Thread[id=87, name=TEST-TestIndexWriterWithThreads.testRollbackAndCommitWithThreads-seed#[844703FAAAFA8855], state=WAITING, group=TGRP-TestIndexWriterWithThreads]\n  2>    2) Thread[id=96, name=Thread-52, state=WAITING, group=TGRP-TestIndexWriterWithThreads]\n  2>    3) Thread[id=94, name=Thread-50, state=WAITING, group=TGRP-TestIndexWriterWithThreads]\n  2>    4) Thread[id=98, name=Thread-54, state=WAITING, group=TGRP-TestIndexWriterWithThreads]\n  2>    5) Thread[id=95, name=Thread-51, state=WAITING, group=TGRP-TestIndexWriterWithThreads]\n  2>    6) Thread[id=97, name=Thread-53, state=WAITING, group=TGRP-TestIndexWriterWithThreads]\n  2> 31.7.2012 15:29:07 com.carrotsearch.randomizedtesting.ThreadLeakControl tryToInterruptAll\n  2> INFO: All leaked threads terminated.\n  1> org.apache.lucene.store.LockObtainFailedException: Lock obtain timed out: org.apache.lucene.store.SingleInstanceLock@7685706f: write.lock\n  1> \tat org.apache.lucene.store.Lock.obtain(Lock.java:84)\n  1> \tat org.apache.lucene.index.IndexWriter.<init>(IndexWriter.java:595)\n  1> \tat org.apache.lucene.index.TestIndexWriterWithThreads$DelayedIndexAndCloseRunnable.run(TestIndexWriterWithThreads.java:490)\n  2> NOTE: test params are: codec=Lucene40: {field=PostingsFormat(name=Memory doPackFST= true), docid=PostingsFormat(name=MockSep), body=PostingsFormat(name=Memory doPackFST= true), title=PostingsFormat(name=Lucene40WithOrds), titleTokenized=PostingsFormat(name=NestedPulsing), date=PostingsFormat(name=Memory doPackFST= true)}, sim=RandomSimilarityProvider(queryNorm=false,coord=false): {field=IB SPL-D3(800.0), body=DFR I(ne)2, titleTokenized=IB LL-L3(800.0)}, locale=cs_CZ, timezone=America/Anguilla\n  2> NOTE: Linux 2.6.32-38-server amd64/Sun Microsystems Inc. 1.6.0_20 (64-bit)/cpus=4,threads=2,free=122913408,total=155123712\n  2> NOTE: All tests run in this JVM: [TestFieldMaskingSpanQuery, TestDocValuesTypeCompatibility, TestTermScorer, TestSnapshotDeletionPolicy, TestLongPostings, TestSort, TestIndexWriter, TestCopyBytes, TestDocumentWriter, TestDateFilter, TestParallelReaderEmptyIndex, TestDateTools, TestMergeSchedulerExternal, TestPrefixInBooleanQuery, TestIndexWriterWithThreads]\n  1> \n  2> \nERROR   0.00s J0 | TestIndexWriterWithThreads (suite)\n   > Throwable #1: java.lang.Exception: Suite timeout exceeded (>= 600000 msec).\n   > \tat __randomizedtesting.SeedInfo.seed([844703FAAAFA8855]:0)\n   >\nCompleted on J0 in 622.52s, 3 tests, 1 error <<< FAILURES!",
    "attachments": {
        "LUCENE-4277.patch": "https://issues.apache.org/jira/secure/attachment/12538659/LUCENE-4277.patch"
    },
    "issue_links": {},
    "comments": [
        {
            "date": "2012-07-31T19:25:50+0000",
            "content": "Another one, killed yesterday by me:\n\n\nHi,\nThis one was hanging in TestIndexWriterWithThreads#testRollbackAndCommitWithThreads for 40 minutes, doing nothing. Seems to be a locking problem.\n\nUwe\n\n\nUwe Schindler\nH.-H.-Meier-Allee 63, D-28213 Bremen\nhttp://www.thetaphi.de\neMail: uwe@thetaphi.de\n\n> ----Original Message----\n> From: Policeman Jenkins Server jenkins@sd-datasolutions.de\n> Sent: Monday, July 30, 2012 11:04 PM\n> To: dev@lucene.apache.org\n> Subject: [JENKINS] Lucene-Solr-4.x-Linux (32bit/jdk1.8.0-ea-b49) - \n> Build # 30 - Failure!\n> \n> Build: \n> http://jenkins.sd-datasolutions.de/job/Lucene-Solr-4.x-Linux/30/\n> Java: 32bit/jdk1.8.0-ea-b49 -server -XX:+UseParallelGC\n> \n> All tests passed\n> \n> Build Log:\n> [...truncated 1090 lines...]\n> [junit4:junit4] 2012-07-30 21:03:27\n> [junit4:junit4] Full thread dump Java HotSpot(TM) Server VM (24.0-b16 \n> mixed\n> mode):\n> [junit4:junit4]\n> [junit4:junit4] \"Thread-190\" prio=10 tid=0xc95a6000 nid=0xcd7 waiting \n> on condition [0xc81fe000]\n> [junit4:junit4]    java.lang.Thread.State: WAITING (parking)\n> [junit4:junit4] \tat sun.misc.Unsafe.park(Native Method)\n> [junit4:junit4] \t- parking to wait for  <0xe6fde900> (a\n> java.util.concurrent.locks.ReentrantLock$NonfairSync)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInte\n> rrupt(\n> AbstractQueuedSynchronizer.java:834)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(Ab\n> stract\n> QueuedSynchronizer.java:868)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(Abstract\n> Queued\n> Synchronizer.java:1198)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLoc\n> k.java:2\n> 14)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:290)\n> [junit4:junit4] \tat\n> org.apache.lucene.index.TestIndexWriterWithThreads$1.run(TestIndexWrit\n> erW\n> ithThreads.java:534)\n> [junit4:junit4]\n> [junit4:junit4] \"Thread-189\" prio=10 tid=0xc95a5c00 nid=0xcd6 waiting \n> on condition [0xc8e7d000]\n> [junit4:junit4]    java.lang.Thread.State: WAITING (parking)\n> [junit4:junit4] \tat sun.misc.Unsafe.park(Native Method)\n> [junit4:junit4] \t- parking to wait for  <0xe6fde900> (a\n> java.util.concurrent.locks.ReentrantLock$NonfairSync)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInte\n> rrupt(\n> AbstractQueuedSynchronizer.java:834)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(Ab\n> stract\n> QueuedSynchronizer.java:868)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(Abstract\n> Queued\n> Synchronizer.java:1198)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLoc\n> k.java:2\n> 14)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:290)\n> [junit4:junit4] \tat\n> org.apache.lucene.index.TestIndexWriterWithThreads$1.run(TestIndexWrit\n> erW\n> ithThreads.java:534)\n> [junit4:junit4]\n> [junit4:junit4] \"Thread-188\" prio=10 tid=0xc95a5400 nid=0xcd5 waiting \n> on condition [0xc8159000]\n> [junit4:junit4]    java.lang.Thread.State: WAITING (parking)\n> [junit4:junit4] \tat sun.misc.Unsafe.park(Native Method)\n> [junit4:junit4] \t- parking to wait for  <0xe6fde900> (a\n> java.util.concurrent.locks.ReentrantLock$NonfairSync)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInte\n> rrupt(\n> AbstractQueuedSynchronizer.java:834)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(Ab\n> stract\n> QueuedSynchronizer.java:868)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(Abstract\n> Queued\n> Synchronizer.java:1198)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLoc\n> k.java:2\n> 14)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:290)\n> [junit4:junit4] \tat\n> org.apache.lucene.index.TestIndexWriterWithThreads$1.run(TestIndexWrit\n> erW\n> ithThreads.java:534)\n> [junit4:junit4]\n> [junit4:junit4] \"Thread-187\" prio=10 tid=0xc95a5000 nid=0xcd4 waiting \n> on condition [0xc907d000]\n> [junit4:junit4]    java.lang.Thread.State: WAITING (parking)\n> [junit4:junit4] \tat sun.misc.Unsafe.park(Native Method)\n> [junit4:junit4] \t- parking to wait for  <0xe6fde900> (a\n> java.util.concurrent.locks.ReentrantLock$NonfairSync)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInte\n> rrupt(\n> AbstractQueuedSynchronizer.java:834)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(Ab\n> stract\n> QueuedSynchronizer.java:868)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(Abstract\n> Queued\n> Synchronizer.java:1198)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLoc\n> k.java:2\n> 14)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:290)\n> [junit4:junit4] \tat\n> org.apache.lucene.index.TestIndexWriterWithThreads$1.run(TestIndexWrit\n> erW\n> ithThreads.java:534)\n> [junit4:junit4]\n> [junit4:junit4] \"Thread-186\" prio=10 tid=0xc95a4800 nid=0xcd3 in \n> Object.wait() [0xc797d000]\n> [junit4:junit4]    java.lang.Thread.State: WAITING (on object monitor)\n> [junit4:junit4] \tat java.lang.Object.wait(Native Method)\n> [junit4:junit4] \t- waiting on <0xe6fd2160> (a\n> org.apache.lucene.index.DocumentsWriterFlushControl)\n> [junit4:junit4] \tat java.lang.Object.wait(Object.java:502)\n> [junit4:junit4] \tat\n> org.apache.lucene.index.DocumentsWriterFlushControl.waitForFlush(Docum\n> ent\n> sWriterFlushControl.java:221)\n> [junit4:junit4] \t- locked <0xe6fd2160> (a\n> org.apache.lucene.index.DocumentsWriterFlushControl)\n> [junit4:junit4] \tat\n> org.apache.lucene.index.DocumentsWriter.abort(DocumentsWriter.java:233)\n> [junit4:junit4] \t- locked <0xe6fcbda0> (a\n> org.apache.lucene.index.DocumentsWriter)\n> [junit4:junit4] \tat\n> org.apache.lucene.index.IndexWriter.rollbackInternal(IndexWriter.java:1847)\n> [junit4:junit4] \tat\n> org.apache.lucene.index.IndexWriter.rollback(IndexWriter.java:1815)\n> [junit4:junit4] \t- locked <0xe6fc1388> (a java.lang.Object)\n> [junit4:junit4] \tat\n> org.apache.lucene.index.TestIndexWriterWithThreads$1.run(TestIndexWrit\n> erW\n> ithThreads.java:539)\n> [junit4:junit4]\n> [junit4:junit4] \"Thread-185\" prio=10 tid=0xc95a4400 nid=0xcd2 waiting \n> on condition [0xc9275000]\n> [junit4:junit4]    java.lang.Thread.State: WAITING (parking)\n> [junit4:junit4] \tat sun.misc.Unsafe.park(Native Method)\n> [junit4:junit4] \t- parking to wait for  <0xe6fde900> (a\n> java.util.concurrent.locks.ReentrantLock$NonfairSync)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInte\n> rrupt(\n> AbstractQueuedSynchronizer.java:834)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(Ab\n> stract\n> QueuedSynchronizer.java:868)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(Abstract\n> Queued\n> Synchronizer.java:1198)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLoc\n> k.java:2\n> 14)\n> [junit4:junit4] \tat\n> java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:290)\n> [junit4:junit4] \tat\n> org.apache.lucene.index.TestIndexWriterWithThreads$1.run(TestIndexWrit\n> erW\n> ithThreads.java:534)\n> [junit4:junit4]\n> [junit4:junit4] \"TEST-TestScope-\n> org.apache.lucene.index.TestIndexWriterWithThreads.testRollbackAndComm\n> it WithThreads-seed#[CC3428D220522DF8]\" prio=10 tid=0xc97a1c00 \n> nid=0xcd1 in Object.wait() [0xc987d000]\n> [junit4:junit4]    java.lang.Thread.State: WAITING (on object monitor)\n> [junit4:junit4] \tat java.lang.Object.wait(Native Method)\n> [junit4:junit4] \t- waiting on <0xe6fe4ba8> (a\n> org.apache.lucene.index.TestIndexWriterWithThreads$1)\n> [junit4:junit4] \tat java.lang.Thread.join(Thread.java:1261)\n> [junit4:junit4] \t- locked <0xe6fe4ba8> (a\n> org.apache.lucene.index.TestIndexWriterWithThreads$1)\n> [junit4:junit4] \tat java.lang.Thread.join(Thread.java:1335)\n> [junit4:junit4] \tat\n> org.apache.lucene.index.TestIndexWriterWithThreads.testRollbackAndComm\n> it\n> WithThreads(TestIndexWriterWithThreads.java:592)\n> [junit4:junit4] \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native\n> Method)\n> [junit4:junit4] \tat\n> sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:\n> 57)\n> [junit4:junit4] \tat\n> sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccess\n> orI\n> mpl.java:43)\n> [junit4:junit4] \tat java.lang.reflect.Method.invoke(Method.java:474)\n> [junit4:junit4] \tat\n> com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedR\n> u\n> nner.java:1995)\n> [junit4:junit4] \tat\n> com.carrotsearch.randomizedtesting.RandomizedRunner.access$1100(Random\n> izedRunner.java:132)\n> [junit4:junit4] \tat\n> com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(Randomi\n> z\n> edRunner.java:818)\n> [junit4:junit4] \tat\n> com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(Randomi\n> z\n> edRunner.java:877)\n> [junit4:junit4] \tat\n> com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(Randomi\n> z\n> edRunner.java:891)\n> [junit4:junit4] \tat\n> org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRul\n> eSet\n> upTeardownChained.java:50)\n> [junit4:junit4] \tat\n> org.apache.lucene.util.TestRuleFieldCacheSanity$1.evaluate(TestRuleFie\n> ldCach\n> eSanity.java:32)\n> [junit4:junit4] \tat\n> org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBefo\n> reAfte\n> rRule.java:45)\n> [junit4:junit4] \tat\n> com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule\n> $1.ev\n> aluate(SystemPropertiesInvariantRule.java:55)\n> [junit4:junit4] \tat\n> org.apache.lucene.util.TestRuleReportUncaughtExceptions$1.evaluate(Tes\n> tRule\n> ReportUncaughtExceptions.java:68)\n> [junit4:junit4] \tat\n> org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleTh\n> rea\n> dAndTestName.java:48)\n> [junit4:junit4] \tat\n> org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestR\n> uleIgn\n> oreAfterMaxFailures.java:70)\n> [junit4:junit4] \tat\n> org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFail\n> ure.ja\n> va:48)\n> [junit4:junit4] \tat\n> com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(Rand\n> o\n> mizedRunner.java:825)\n> [junit4:junit4] \tat\n> com.carrotsearch.randomizedtesting.RandomizedRunner.access$700(Randomi\n> z\n> edRunner.java:132)\n> [junit4:junit4] \tat\n> com.carrotsearch.randomizedtesting.RandomizedRunner$3$1.run(Randomized\n> Runner.java:671)\n> [junit4:junit4] \tat\n> com.carrotsearch.randomizedtesting.RandomizedRunner$3.evaluate(Randomi\n> z\n> edRunner.java:697)\n> [junit4:junit4] \tat\n> com.carrotsearch.randomizedtesting.RandomizedRunner$4.evaluate(Randomi\n> z\n> edRunner.java:736)\n> [junit4:junit4] \tat\n> com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(Randomi\n> z\n> edRunner.java:747)\n> [junit4:junit4] \tat\n> org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBefo\n> reAfte\n> rRule.java:45)\n> [junit4:junit4] \tat\n> org.apache.lucene.util.TestRuleReportUncaughtExceptions$1.evaluate(Tes\n> tRule\n> ReportUncaughtExceptions.java:68)\n> [junit4:junit4] \tat\n> org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStore\n> Class\n> Name.java:38)\n> [junit4:junit4] \tat\n> com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule\n> $1.ev\n> aluate(SystemPropertiesInvariantRule.java:55)\n> [junit4:junit4] \tat\n> org.apache.lucene.util.TestRuleNoInstanceHooksOverrides$1.evaluate(Tes\n> tRule\n> NoInstanceHooksOverrides.java:53)\n> [junit4:junit4] \tat\n> org.apache.lucene.util.TestRuleNoStaticHooksShadowing$1.evaluate(TestR\n> uleN\n> oStaticHooksShadowing.java:52)\n> [junit4:junit4] \tat\n> org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleA\n> ssertio\n> nsRequired.java:36)\n> [junit4:junit4] \tat\n> org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFail\n> ure.ja\n> va:48)\n> [junit4:junit4] \tat\n> org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestR\n> uleIgn\n> oreAfterMaxFailures.java:70)\n> [junit4:junit4] \tat\n> org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgn\n> oreTest\n> Suites.java:55)\n> [junit4:junit4] \tat\n> com.carrotsearch.randomizedtesting.RandomizedRunner.runSuite(Randomize\n> d\n> Runner.java:605)\n> [junit4:junit4] \tat\n> com.carrotsearch.randomizedtesting.RandomizedRunner.access$400(Randomi\n> z\n> edRunner.java:132)\n> [junit4:junit4] \tat\n> com.carrotsearch.randomizedtesting.RandomizedRunner$2.run(RandomizedRu\n> nner.java:551)\n> [junit4:junit4]\n> [junit4:junit4] \"Service Thread\" daemon prio=10 tid=0xc978c800 \n> nid=0xb87 runnable [0x00000000]\n> [junit4:junit4]    java.lang.Thread.State: RUNNABLE\n> [junit4:junit4]\n> [junit4:junit4] \"C1 CompilerThread3\" daemon prio=10 tid=0xc978ac00\n> nid=0xb86 waiting on condition [0x00000000]\n> [junit4:junit4]    java.lang.Thread.State: RUNNABLE\n> [junit4:junit4]\n> [junit4:junit4] \"C2 CompilerThread2\" daemon prio=10 tid=0xc9789000\n> nid=0xb85 waiting on condition [0x00000000]\n> [junit4:junit4]    java.lang.Thread.State: RUNNABLE\n> [junit4:junit4]\n> [junit4:junit4] \"C2 CompilerThread1\" daemon prio=10 tid=0xc9787800\n> nid=0xb84 waiting on condition [0x00000000]\n> [junit4:junit4]    java.lang.Thread.State: RUNNABLE\n> [junit4:junit4]\n> [junit4:junit4] \"C2 CompilerThread0\" daemon prio=10 tid=0xc9785800\n> nid=0xb83 waiting on condition [0x00000000]\n> [junit4:junit4]    java.lang.Thread.State: RUNNABLE\n> [junit4:junit4]\n> [junit4:junit4] \"Signal Dispatcher\" daemon prio=10 tid=0xc9784000 \n> nid=0xb82 waiting on condition [0x00000000]\n> [junit4:junit4]    java.lang.Thread.State: RUNNABLE\n> [junit4:junit4]\n> [junit4:junit4] \"Finalizer\" daemon prio=10 tid=0xc9774400 nid=0xb7f in\n> Object.wait() [0xcbb7d000]\n> [junit4:junit4]    java.lang.Thread.State: WAITING (on object monitor)\n> [junit4:junit4] \tat java.lang.Object.wait(Native Method)\n> [junit4:junit4] \t- waiting on <0xd051a9d8> (a\n> java.lang.ref.ReferenceQueue$Lock)\n> [junit4:junit4] \tat\n> java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:135)\n> [junit4:junit4] \t- locked <0xd051a9d8> (a java.lang.ref.ReferenceQueue$Lock)\n> [junit4:junit4] \tat\n> java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:151)\n> [junit4:junit4] \tat\n> java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:177)\n> [junit4:junit4]\n> [junit4:junit4] \"Reference Handler\" daemon prio=10 tid=0xc9772c00 \n> nid=0xb7e in Object.wait() [0xcbd7d000]\n> [junit4:junit4]    java.lang.Thread.State: WAITING (on object monitor)\n> [junit4:junit4] \tat java.lang.Object.wait(Native Method)\n> [junit4:junit4] \t- waiting on <0xd051c0d0> (a java.lang.ref.Reference$Lock)\n> [junit4:junit4] \tat java.lang.Object.wait(Object.java:502)\n> [junit4:junit4] \tat\n> java.lang.ref.Reference$ReferenceHandler.run(Reference.java:142)\n> [junit4:junit4] \t- locked <0xd051c0d0> (a java.lang.ref.Reference$Lock)\n> [junit4:junit4]\n> [junit4:junit4] \"main\" prio=10 tid=0xf6708800 nid=0xb61 in \n> Object.wait() [0xf6887000]\n> [junit4:junit4]    java.lang.Thread.State: WAITING (on object monitor)\n> [junit4:junit4] \tat java.lang.Object.wait(Native Method)\n> [junit4:junit4] \t- waiting on <0xe6f7f3e8> (a\n> com.carrotsearch.randomizedtesting.RandomizedRunner$2)\n> [junit4:junit4] \tat java.lang.Thread.join(Thread.java:1261)\n> [junit4:junit4] \t- locked <0xe6f7f3e8> (a\n> com.carrotsearch.randomizedtesting.RandomizedRunner$2)\n> [junit4:junit4] \tat java.lang.Thread.join(Thread.java:1335)\n> [junit4:junit4] \tat\n> com.carrotsearch.randomizedtesting.RandomizedRunner.runSuite(Randomize\n> d\n> Runner.java:561)\n> [junit4:junit4] \tat\n> com.carrotsearch.randomizedtesting.RandomizedRunner.run(RandomizedRunn\n> er.java:521)\n> [junit4:junit4] \tat\n> com.carrotsearch.ant.tasks.junit4.slave.SlaveMain.execute(SlaveMain.java:153)\n> [junit4:junit4] \tat\n> com.carrotsearch.ant.tasks.junit4.slave.SlaveMain.main(SlaveMain.java:246)\n> [junit4:junit4] \tat\n> com.carrotsearch.ant.tasks.junit4.slave.SlaveMainSafe.main(SlaveMainSa\n> fe.jav\n> a:12)\n> [junit4:junit4]\n> [junit4:junit4] \"VM Thread\" prio=10 tid=0xc9770400 nid=0xb7c runnable \n> [junit4:junit4] [junit4:junit4] \"GC task thread#0 (ParallelGC)\" \n> prio=10\n> tid=0xf6712c00 nid=0xb67 runnable [junit4:junit4] [junit4:junit4] \"GC \n> task\n> thread#1 (ParallelGC)\" prio=10 tid=0xf6714000 nid=0xb68 runnable \n> [junit4:junit4] [junit4:junit4] \"GC task thread#2 (ParallelGC)\" \n> prio=10\n> tid=0xf6715800 nid=0xb69 runnable [junit4:junit4] [junit4:junit4] \"GC \n> task\n> thread#3 (ParallelGC)\" prio=10 tid=0xf6717000 nid=0xb6a runnable \n> [junit4:junit4] [junit4:junit4] \"GC task thread#4 (ParallelGC)\" \n> prio=10\n> tid=0xf6718400 nid=0xb6b runnable [junit4:junit4] [junit4:junit4] \"GC \n> task\n> thread#5 (ParallelGC)\" prio=10 tid=0xf6719c00 nid=0xb6c runnable \n> [junit4:junit4] [junit4:junit4] \"GC task thread#6 (ParallelGC)\" \n> prio=10\n> tid=0xf671b400 nid=0xb6d runnable [junit4:junit4] [junit4:junit4] \"GC \n> task\n> thread#7 (ParallelGC)\" prio=10 tid=0xf671c800 nid=0xb6f runnable \n> [junit4:junit4] [junit4:junit4] \"VM Periodic Task Thread\" prio=10\n> tid=0xc9796800 nid=0xb88 waiting on condition [junit4:junit4] \n> [junit4:junit4] JNI global references: 178 [junit4:junit4] [junit4:junit4] Heap\n> [junit4:junit4]  PSYoungGen      total 43008K, used 31193K [0xe5a70000,\n> 0xecf30000, 0xf0510000)\n> [junit4:junit4]   eden space 41664K, 71% used\n> [0xe5a70000,0xe779eeb0,0xe8320000)\n> [junit4:junit4]   from space 1344K, 97% used\n> [0xecde0000,0xecf27550,0xecf30000)\n> [junit4:junit4]   to   space 1728K, 0% used\n> [0xecbd0000,0xecbd0000,0xecd80000)\n> [junit4:junit4]  ParOldGen       total 43712K, used 14083K [0xd0510000,\n> 0xd2fc0000, 0xe5a70000)\n> [junit4:junit4]   object space 43712K, 32% used\n> [0xd0510000,0xd12d0da0,0xd2fc0000)\n> [junit4:junit4]  PSPermGen       total 16384K, used 11741K [0xcc510000,\n> 0xcd510000, 0xd0510000)\n> [junit4:junit4]   object space 16384K, 71% used\n> [0xcc510000,0xcd087558,0xcd510000)\n> [junit4:junit4] <<< JVM J0: EOF ----\n> [junit4:junit4] JVM J1:     0.67 ..   481.32 =   480.65s\n> [junit4:junit4] Execution time total: 40 minutes 20 seconds \n> [junit4:junit4]\n> ERROR: JVM J0 threw an exception, cmd line:\n> /mnt/ssd/jenkins/tools/java/32bit/jdk1.8.0-ea-b49/jre/bin/java -server \n> - XX:+UseParallelGC -Dtests.prefix=tests -Dtests.seed=CC3428D220522DF8 \n> - Xmx512M -Dtests.iters= -Dtests.verbose=false \n> -Dtests.infostream=false -\n> Dtests.lockdir=/mnt/ssd/jenkins/workspace/Lucene-Solr-4.x-\n> Linux/checkout/lucene/build -Dtests.codec=random - \n> Dtests.postingsformat=random -Dtests.locale=random - \n> Dtests.timezone=random -Dtests.directory=random - \n> Dtests.linedocsfile=europarl.lines.txt.gz \n> -Dtests.luceneMatchVersion=4.0 - Dtests.cleanthreads=perMethod \n> -Djava.util.logging.config.file=/dev/null - Dtests.nightly=false \n> -Dtests.weekly=false -Dtests.slow=true - Dtests.asserts.gracious=false \n> -Dtests.multiplier=3 -DtempDir=. - Dlucene.version=4.0-SNAPSHOT \n> -Djetty.testMode=1 -Djetty.insecurerandom=1 \n> -Dsolr.directoryFactory=org.apache.solr.core.MockDirectoryFactory -\n> Dfile.encoding=ISO-8859-1 -classpath \n> /mnt/ssd/jenkins/workspace/Lucene-Solr-\n> 4.x-Linux/checkout/lucene/build/test-\n> framework/classes/java:/mnt/ssd/jenkins/workspace/Lucene-Solr-4.x-\n> Linux/checkout/lucene/test-framework/lib/junit-\n> 4.10.jar:/mnt/ssd/jenkins/workspace/Lucene-Solr-4.x-\n> Linux/checkout/lucene/test-framework/lib/randomizedtesting-runner-\n> 1.6.0.jar:/mnt/ssd/jenkins/workspace/Lucene-Solr-4.x-\n> Linux/checkout/lucene/build/core/classes/java:/mnt/ssd/jenkins/workspa\n> ce/Lu\n> cene-Solr-4.x-\n> Linux/checkout/lucene/build/core/classes/test:/var/lib/jenkins/tools/a\n> nt/suppor\n> ted18/lib/ant-launcher.jar:/var/lib/jenkins/.ant/lib/ivy-\n> 2.2.0.jar:/var/lib/jenkins/tools/ant/supported18/lib/ant-\n> jdepend.jar:/var/lib/jenkins/tools/ant/supported18/lib/ant-\n> netrexx.jar:/var/lib/jenkins/tools/ant/supported18/lib/ant-\n> antlr.jar:/var/lib/jenkins/tools/ant/supported18/lib/ant-commons-\n> net.jar:/var/lib/jenkins/tools/ant/supported18/lib/ant-\n> javamail.jar:/var/lib/jenkins/tools/ant/supported18/lib/ant-apache-\n> regexp.jar:/var/lib/jenkins/tools/ant/supported18/lib/ant-\n> jsch.jar:/var/lib/jenkins/tools/ant/supported18/lib/ant-apache-\n> xalan2.jar:/var/lib/jenkins/tools/ant/supported18/lib/ant-\n> junit4.jar:/var/lib/jenkins/tools/ant/supported18/lib/ant-\n> jmf.jar:/var/lib/jenkins/tools/ant/supported18/lib/ant.jar:/var/lib/je\n> nkins/tools/\n> ant/supported18/lib/ant-\n> junit.jar:/var/lib/jenkins/tools/ant/supported18/lib/ant-apache-\n> bcel.jar:/var/lib/jenkins/tools/ant/supported18/lib/ant-\n> jai.jar:/var/lib/jenkins/tools/ant/supported18/lib/ant-commons-\n> logging.jar:/var/lib/jenkins/tools/ant/supported18/lib/ant-apache-\n> resolver.jar:/var/lib/jenkins/tools/ant/supported18/lib/ant-apache-\n> oro.jar:/var/lib/jenkins/tools/ant/supported18/lib/ant-\n> swing.jar:/var/lib/jenkins/tools/ant/supported18/lib/ant-apache-\n> bsf.jar:/var/lib/jenkins/tools/ant/supported18/lib/ant-apache-\n> log4j.jar:/var/lib/jenkins/tools/ant/supported18/lib/ant-\n> testutil.jar:/mnt/ssd/jenkins/tools/java/32bit/jdk1.8.0-ea-\n> b49/lib/tools.jar:/var/lib/jenkins/.ivy2/cache/com.carrotsearch.random\n> izedtesti ng/junit4-ant/jars/junit4-ant-1.6.0.jar \n> -ea:org.apache.lucene... - ea:org.apache.solr... \n> com.carrotsearch.ant.tasks.junit4.slave.SlaveMainSafe - eventsfile \n> /mnt/ssd/jenkins/workspace/Lucene-Solr-4.x-\n> Linux/checkout/lucene/build/core/test/junit4-J0-2023111371df5f3c7.even\n> ts\n> @/mnt/ssd/jenkins/workspace/Lucene-Solr-4.x-\n> Linux/checkout/lucene/build/core/test/junit4-J0-2023111371df5f3c7.suit\n> es [junit4:junit4] ERROR: JVM J0 exception: Forked process exited with \n> an error\n> code: 137\n> \n> BUILD FAILED\n> /mnt/ssd/jenkins/workspace/Lucene-Solr-4.x-Linux/checkout/build.xml:29\n> : The following error occurred while executing this line:\n> /mnt/ssd/jenkins/workspace/Lucene-Solr-4.x-\n> Linux/checkout/lucene/build.xml:50: The following error occurred while \n> executing this line:\n> /mnt/ssd/jenkins/workspace/Lucene-Solr-4.x-Linux/checkout/lucene/commo\n> n-\n> build.xml:1095: The following error occurred while executing this line:\n> /mnt/ssd/jenkins/workspace/Lucene-Solr-4.x-Linux/checkout/lucene/commo\n> n-\n> build.xml:790: At least one slave process threw an unexpected exception, first:\n> Forked process exited with an error code: 137\n> \n> Total time: 40 minutes 30 seconds\n> Build step 'Execute shell' marked build as failure Archiving artifacts \n> Recording test results Email was triggered for: Failure Sending email \n> for trigger: Failure\n>  ",
            "author": "Uwe Schindler",
            "id": "comment-13426045"
        },
        {
            "date": "2012-07-31T21:44:41+0000",
            "content": "I'm guessing we are waiting for flushes to complete, but one flushing thread (e.g. from the addDocument thread)\nhas thrown some unrelated exception in flush and is still marked as being in queue but will never notify() ? ",
            "author": "Robert Muir",
            "id": "comment-13426155"
        },
        {
            "date": "2012-07-31T22:55:11+0000",
            "content": "OK, I think Uwe's seed reproduces:\n\n\tuse branch_4x\n\tsvn up -r1367267\n\tant test -Dtestcase=TestIndexWriterWithThreads -Dtests.seed=CC3428D220522DF8 -Dtests.multiplier=3\n\n\n\nIts already hung for 5 minutes here, so I think this is working.\n\nhttp://jenkins.sd-datasolutions.de/job/Lucene-Solr-4.x-Linux/lastCompletedBuild/testReport/org.apache.lucene.index/TestIndexWriterWithThreads/testRollbackAndCommitWithThreads/history/? ",
            "author": "Robert Muir",
            "id": "comment-13426196"
        },
        {
            "date": "2012-07-31T23:10:29+0000",
            "content": "OK, I think Uwe's seed reproduces:\n\nFWIW: with that branch+revision+seed+multiplier I'm seeing it hang as well ... been going about 10 minutes.\n ",
            "author": "Hoss Man",
            "id": "comment-13426205"
        },
        {
            "date": "2012-07-31T23:19:46+0000",
            "content": "yeah it doesnt always hang: maybe 20% of the time.\n\nwhen it hangs, cpu shoots drops to 0% after about a minute\notherwise it passes after about a minute, cpu is 100% the entire time.\n\nmight be a concurrency issue, ill keep hacking at adding simple single-threaded\nstuff to TestIWExceptions until i find something (or another bug, or give up).\n ",
            "author": "Robert Muir",
            "id": "comment-13426211"
        },
        {
            "date": "2012-08-01T08:45:35+0000",
            "content": "I can't reproduce this even with the seed & revision etc. But I found a place where we could miss to remove an entry from the flush queue. The patch fixes that issue I found but I struggle to explain in which scenario this could happen without an underlying bug. Robert can you try this patch and see if it still fails? ",
            "author": "Simon Willnauer",
            "id": "comment-13426378"
        },
        {
            "date": "2012-08-01T12:16:41+0000",
            "content": "With the patch, I ran the seed about 10 times, then i hit the hang again:\n\n[junit4:junit4] Full thread dump Java HotSpot(TM) 64-Bit Server VM (19.1-b02 mixed mode):\n[junit4:junit4] \n[junit4:junit4] \"Thread-6\" prio=10 tid=0x00007fec4c0f5000 nid=0x4ba8 waiting on condition [0x00007fec37efd000]\n[junit4:junit4]    java.lang.Thread.State: WAITING (parking)\n[junit4:junit4] \tat sun.misc.Unsafe.park(Native Method)\n[junit4:junit4] \t- parking to wait for  <0x00000000f6c77bb8> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)\n[junit4:junit4] \tat java.util.concurrent.locks.LockSupport.park(LockSupport.java:158)\n[junit4:junit4] \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:811)\n[junit4:junit4] \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:842)\n[junit4:junit4] \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1178)\n[junit4:junit4] \tat java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:186)\n[junit4:junit4] \tat java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:262)\n[junit4:junit4] \tat org.apache.lucene.index.TestIndexWriterWithThreads$1.run(TestIndexWriterWithThreads.java:534)\n[junit4:junit4] \n[junit4:junit4] \"Thread-5\" prio=10 tid=0x00007fec4c0f3800 nid=0x4ba7 in Object.wait() [0x00007fec37ffe000]\n[junit4:junit4]    java.lang.Thread.State: WAITING (on object monitor)\n[junit4:junit4] \tat java.lang.Object.wait(Native Method)\n[junit4:junit4] \t- waiting on <0x00000000f6c2ec18> (a org.apache.lucene.index.DocumentsWriterFlushControl)\n[junit4:junit4] \tat java.lang.Object.wait(Object.java:485)\n[junit4:junit4] \tat org.apache.lucene.index.DocumentsWriterFlushControl.waitForFlush(DocumentsWriterFlushControl.java:221)\n[junit4:junit4] \t- locked <0x00000000f6c2ec18> (a org.apache.lucene.index.DocumentsWriterFlushControl)\n[junit4:junit4] \tat org.apache.lucene.index.DocumentsWriter.abort(DocumentsWriter.java:231)\n[junit4:junit4] \t- locked <0x00000000f6b98518> (a org.apache.lucene.index.DocumentsWriter)\n[junit4:junit4] \tat org.apache.lucene.index.IndexWriter.rollbackInternal(IndexWriter.java:1847)\n[junit4:junit4] \tat org.apache.lucene.index.IndexWriter.rollback(IndexWriter.java:1815)\n[junit4:junit4] \t- locked <0x00000000f6b296f0> (a java.lang.Object)\n[junit4:junit4] \tat org.apache.lucene.index.TestIndexWriterWithThreads$1.run(TestIndexWriterWithThreads.java:539)\n[junit4:junit4] \n[junit4:junit4] \"Thread-4\" prio=10 tid=0x00007fec4c0f2000 nid=0x4ba6 waiting on condition [0x00007fec8c103000]\n[junit4:junit4]    java.lang.Thread.State: WAITING (parking)\n[junit4:junit4] \tat sun.misc.Unsafe.park(Native Method)\n[junit4:junit4] \t- parking to wait for  <0x00000000f6c77bb8> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)\n[junit4:junit4] \tat java.util.concurrent.locks.LockSupport.park(LockSupport.java:158)\n[junit4:junit4] \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:811)\n[junit4:junit4] \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:842)\n[junit4:junit4] \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1178)\n[junit4:junit4] \tat java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:186)\n[junit4:junit4] \tat java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:262)\n[junit4:junit4] \tat org.apache.lucene.index.TestIndexWriterWithThreads$1.run(TestIndexWriterWithThreads.java:534)\n[junit4:junit4] \n[junit4:junit4] \"Thread-3\" prio=10 tid=0x00007fec4c0d5800 nid=0x4ba5 waiting on condition [0x00007fec8c204000]\n[junit4:junit4]    java.lang.Thread.State: WAITING (parking)\n[junit4:junit4] \tat sun.misc.Unsafe.park(Native Method)\n[junit4:junit4] \t- parking to wait for  <0x00000000f6c77bb8> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)\n[junit4:junit4] \tat java.util.concurrent.locks.LockSupport.park(LockSupport.java:158)\n[junit4:junit4] \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:811)\n[junit4:junit4] \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:842)\n[junit4:junit4] \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1178)\n[junit4:junit4] \tat java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:186)\n[junit4:junit4] \tat java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:262)\n[junit4:junit4] \tat org.apache.lucene.index.TestIndexWriterWithThreads$1.run(TestIndexWriterWithThreads.java:534)\n[junit4:junit4] \n[junit4:junit4] \"Thread-2\" prio=10 tid=0x00007fec4c0d4000 nid=0x4ba4 waiting on condition [0x00007fec8c305000]\n[junit4:junit4]    java.lang.Thread.State: WAITING (parking)\n[junit4:junit4] \tat sun.misc.Unsafe.park(Native Method)\n[junit4:junit4] \t- parking to wait for  <0x00000000f6c77bb8> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)\n[junit4:junit4] \tat java.util.concurrent.locks.LockSupport.park(LockSupport.java:158)\n[junit4:junit4] \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:811)\n[junit4:junit4] \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:842)\n[junit4:junit4] \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1178)\n[junit4:junit4] \tat java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:186)\n[junit4:junit4] \tat java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:262)\n[junit4:junit4] \tat org.apache.lucene.index.TestIndexWriterWithThreads$1.run(TestIndexWriterWithThreads.java:534)\n[junit4:junit4] \n[junit4:junit4] \"Thread-1\" prio=10 tid=0x00007fec4c0e6000 nid=0x4ba3 waiting on condition [0x00007fec8c406000]\n[junit4:junit4]    java.lang.Thread.State: WAITING (parking)\n[junit4:junit4] \tat sun.misc.Unsafe.park(Native Method)\n[junit4:junit4] \t- parking to wait for  <0x00000000f6c77bb8> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)\n[junit4:junit4] \tat java.util.concurrent.locks.LockSupport.park(LockSupport.java:158)\n[junit4:junit4] \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:811)\n[junit4:junit4] \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:842)\n[junit4:junit4] \tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1178)\n[junit4:junit4] \tat java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:186)\n[junit4:junit4] \tat java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:262)\n[junit4:junit4] \tat org.apache.lucene.index.TestIndexWriterWithThreads$1.run(TestIndexWriterWithThreads.java:534)\n[junit4:junit4] \n[junit4:junit4] \"TEST-TestScope-org.apache.lucene.index.TestIndexWriterWithThreads.testRollbackAndCommitWithThreads-seed#[CC3428D220522DF8]\" prio=10 tid=0x00007fec90238000 nid=0x4ba2 in Object.wait() [0x00007fec8c60d000]\n[junit4:junit4]    java.lang.Thread.State: WAITING (on object monitor)\n[junit4:junit4] \tat java.lang.Object.wait(Native Method)\n[junit4:junit4] \t- waiting on <0x00000000f6c7dbd8> (a org.apache.lucene.index.TestIndexWriterWithThreads$1)\n[junit4:junit4] \tat java.lang.Thread.join(Thread.java:1186)\n[junit4:junit4] \t- locked <0x00000000f6c7dbd8> (a org.apache.lucene.index.TestIndexWriterWithThreads$1)\n[junit4:junit4] \tat java.lang.Thread.join(Thread.java:1239)\n[junit4:junit4] \tat org.apache.lucene.index.TestIndexWriterWithThreads.testRollbackAndCommitWithThreads(TestIndexWriterWithThreads.java:592)\n[junit4:junit4] \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n[junit4:junit4] \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n[junit4:junit4] \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n[junit4:junit4] \tat java.lang.reflect.Method.invoke(Method.java:597)\n[junit4:junit4] \tat com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1995)\n[junit4:junit4] \tat com.carrotsearch.randomizedtesting.RandomizedRunner.access$1100(RandomizedRunner.java:132)\n[junit4:junit4] \tat com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:818)\n[junit4:junit4] \tat com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:877)\n[junit4:junit4] \tat com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:891)\n[junit4:junit4] \tat org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:50)\n[junit4:junit4] \tat org.apache.lucene.util.TestRuleFieldCacheSanity$1.evaluate(TestRuleFieldCacheSanity.java:32)\n[junit4:junit4] \tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\n[junit4:junit4] \tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:55)\n[junit4:junit4] \tat org.apache.lucene.util.TestRuleReportUncaughtExceptions$1.evaluate(TestRuleReportUncaughtExceptions.java:68)\n[junit4:junit4] \tat org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:48)\n[junit4:junit4] \tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:70)\n[junit4:junit4] \tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n[junit4:junit4] \tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:825)\n[junit4:junit4] \tat com.carrotsearch.randomizedtesting.RandomizedRunner.access$700(RandomizedRunner.java:132)\n[junit4:junit4] \tat com.carrotsearch.randomizedtesting.RandomizedRunner$3$1.run(RandomizedRunner.java:671)\n[junit4:junit4] \tat com.carrotsearch.randomizedtesting.RandomizedRunner$3.evaluate(RandomizedRunner.java:697)\n[junit4:junit4] \tat com.carrotsearch.randomizedtesting.RandomizedRunner$4.evaluate(RandomizedRunner.java:736)\n[junit4:junit4] \tat com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:747)\n[junit4:junit4] \tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\n[junit4:junit4] \tat org.apache.lucene.util.TestRuleReportUncaughtExceptions$1.evaluate(TestRuleReportUncaughtExceptions.java:68)\n[junit4:junit4] \tat org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)\n[junit4:junit4] \tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:55)\n[junit4:junit4] \tat org.apache.lucene.util.TestRuleNoInstanceHooksOverrides$1.evaluate(TestRuleNoInstanceHooksOverrides.java:53)\n[junit4:junit4] \tat org.apache.lucene.util.TestRuleNoStaticHooksShadowing$1.evaluate(TestRuleNoStaticHooksShadowing.java:52)\n[junit4:junit4] \tat org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:36)\n[junit4:junit4] \tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n[junit4:junit4] \tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:70)\n[junit4:junit4] \tat org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:55)\n[junit4:junit4] \tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSuite(RandomizedRunner.java:605)\n[junit4:junit4] \tat com.carrotsearch.randomizedtesting.RandomizedRunner.access$400(RandomizedRunner.java:132)\n[junit4:junit4] \tat com.carrotsearch.randomizedtesting.RandomizedRunner$2.run(RandomizedRunner.java:551)\n[junit4:junit4] \n[junit4:junit4] \"Low Memory Detector\" daemon prio=10 tid=0x00007fec9009c000 nid=0x4ba0 runnable [0x0000000000000000]\n[junit4:junit4]    java.lang.Thread.State: RUNNABLE\n[junit4:junit4] \n[junit4:junit4] \"CompilerThread1\" daemon prio=10 tid=0x00007fec90099800 nid=0x4b9f waiting on condition [0x0000000000000000]\n[junit4:junit4]    java.lang.Thread.State: RUNNABLE\n[junit4:junit4] \n[junit4:junit4] \"CompilerThread0\" daemon prio=10 tid=0x00007fec90096800 nid=0x4b9e waiting on condition [0x0000000000000000]\n[junit4:junit4]    java.lang.Thread.State: RUNNABLE\n[junit4:junit4] \n[junit4:junit4] \"Signal Dispatcher\" daemon prio=10 tid=0x00007fec90094800 nid=0x4b9d waiting on condition [0x0000000000000000]\n[junit4:junit4]    java.lang.Thread.State: RUNNABLE\n[junit4:junit4] \n[junit4:junit4] \"Finalizer\" daemon prio=10 tid=0x00007fec90078000 nid=0x4b9c in Object.wait() [0x00007fec941ec000]\n[junit4:junit4]    java.lang.Thread.State: WAITING (on object monitor)\n[junit4:junit4] \tat java.lang.Object.wait(Native Method)\n[junit4:junit4] \t- waiting on <0x00000000f5561300> (a java.lang.ref.ReferenceQueue$Lock)\n[junit4:junit4] \tat java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:118)\n[junit4:junit4] \t- locked <0x00000000f5561300> (a java.lang.ref.ReferenceQueue$Lock)\n[junit4:junit4] \tat java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:134)\n[junit4:junit4] \tat java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:159)\n[junit4:junit4] \n[junit4:junit4] \"Reference Handler\" daemon prio=10 tid=0x00007fec90076000 nid=0x4b9b in Object.wait() [0x00007fec942ed000]\n[junit4:junit4]    java.lang.Thread.State: WAITING (on object monitor)\n[junit4:junit4] \tat java.lang.Object.wait(Native Method)\n[junit4:junit4] \t- waiting on <0x00000000f55611d8> (a java.lang.ref.Reference$Lock)\n[junit4:junit4] \tat java.lang.Object.wait(Object.java:485)\n[junit4:junit4] \tat java.lang.ref.Reference$ReferenceHandler.run(Reference.java:116)\n[junit4:junit4] \t- locked <0x00000000f55611d8> (a java.lang.ref.Reference$Lock)\n[junit4:junit4] \n[junit4:junit4] \"main\" prio=10 tid=0x00007fec9000a000 nid=0x4b91 in Object.wait() [0x00007fec96893000]\n[junit4:junit4]    java.lang.Thread.State: WAITING (on object monitor)\n[junit4:junit4] \tat java.lang.Object.wait(Native Method)\n[junit4:junit4] \t- waiting on <0x00000000f61ab898> (a com.carrotsearch.randomizedtesting.RandomizedRunner$2)\n[junit4:junit4] \tat java.lang.Thread.join(Thread.java:1186)\n[junit4:junit4] \t- locked <0x00000000f61ab898> (a com.carrotsearch.randomizedtesting.RandomizedRunner$2)\n[junit4:junit4] \tat java.lang.Thread.join(Thread.java:1239)\n[junit4:junit4] \tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSuite(RandomizedRunner.java:561)\n[junit4:junit4] \tat com.carrotsearch.randomizedtesting.RandomizedRunner.run(RandomizedRunner.java:521)\n[junit4:junit4] \tat com.carrotsearch.ant.tasks.junit4.slave.SlaveMain.execute(SlaveMain.java:153)\n[junit4:junit4] \tat com.carrotsearch.ant.tasks.junit4.slave.SlaveMain.main(SlaveMain.java:246)\n[junit4:junit4] \tat com.carrotsearch.ant.tasks.junit4.slave.SlaveMainSafe.main(SlaveMainSafe.java:12)\n[junit4:junit4] \n[junit4:junit4] \"VM Thread\" prio=10 tid=0x00007fec9006f800 nid=0x4b9a runnable \n[junit4:junit4] \n[junit4:junit4] \"GC task thread#0 (ParallelGC)\" prio=10 tid=0x00007fec9001d800 nid=0x4b92 runnable \n[junit4:junit4] \n[junit4:junit4] \"GC task thread#1 (ParallelGC)\" prio=10 tid=0x00007fec9001f000 nid=0x4b93 runnable \n[junit4:junit4] \n[junit4:junit4] \"GC task thread#2 (ParallelGC)\" prio=10 tid=0x00007fec90021000 nid=0x4b94 runnable \n[junit4:junit4] \n[junit4:junit4] \"GC task thread#3 (ParallelGC)\" prio=10 tid=0x00007fec90022800 nid=0x4b95 runnable \n[junit4:junit4] \n[junit4:junit4] \"GC task thread#4 (ParallelGC)\" prio=10 tid=0x00007fec90024800 nid=0x4b96 runnable \n[junit4:junit4] \n[junit4:junit4] \"GC task thread#5 (ParallelGC)\" prio=10 tid=0x00007fec90026800 nid=0x4b97 runnable \n[junit4:junit4] \n[junit4:junit4] \"GC task thread#6 (ParallelGC)\" prio=10 tid=0x00007fec90028000 nid=0x4b98 runnable \n[junit4:junit4] \n[junit4:junit4] \"GC task thread#7 (ParallelGC)\" prio=10 tid=0x00007fec9002a000 nid=0x4b99 runnable \n[junit4:junit4] \n[junit4:junit4] \"VM Periodic Task Thread\" prio=10 tid=0x00007fec900a6800 nid=0x4ba1 waiting on condition \n[junit4:junit4] \n[junit4:junit4] JNI global references: 1751\n[junit4:junit4] \n[junit4:junit4] Heap\n[junit4:junit4]  PSYoungGen      total 74816K, used 40079K [0x00000000f5560000, 0x00000000fa8e0000, 0x0000000100000000)\n[junit4:junit4]   eden space 64128K, 62% used [0x00000000f5560000,0x00000000f7c83f40,0x00000000f9400000)\n[junit4:junit4]   from space 10688K, 0% used [0x00000000f9e70000,0x00000000f9e70000,0x00000000fa8e0000)\n[junit4:junit4]   to   space 10688K, 0% used [0x00000000f9400000,0x00000000f9400000,0x00000000f9e70000)\n[junit4:junit4]  PSOldGen        total 171008K, used 0K [0x00000000e0000000, 0x00000000ea700000, 0x00000000f5560000)\n[junit4:junit4]   object space 171008K, 0% used [0x00000000e0000000,0x00000000e0000000,0x00000000ea700000)\n[junit4:junit4]  PSPermGen       total 21248K, used 12691K [0x00000000dae00000, 0x00000000dc2c0000, 0x00000000e0000000)\n[junit4:junit4]   object space 21248K, 59% used [0x00000000dae00000,0x00000000dba64de0,0x00000000dc2c0000)\n\n ",
            "author": "Robert Muir",
            "id": "comment-13426551"
        },
        {
            "date": "2012-08-01T15:43:39+0000",
            "content": "here is a new patch. Now I have a fix plus an explanation. When we do a full flush we swap in a new DeleteQueue. All subsequent adds / updates / deletes go into the new queue and flushes that are associated with that queue will be blocked until the full flush (commit) is finished. Now imagine you add a document while a full flush is running and that document fills up the in memory buffers such that the DWPT needs to be flushed. Usually the thread adding the document helps flushing segments associated with the full flush until its done and then tries to flush the blocked segments. Yet, there is a window that allows to miss that window since the full flush is still \"running\" while already done ie. the switch is not flipped yet. This means the add thread returns leaving the DWPT in a \"checked out & flushable\" state. If we don't prune those DWPT during rollback / abort we can hit the hang since there are still segments in the pipeline that need to be flushed. If there is no thread adding or committing (which is impossible since we hold the commit log etc) we hang.\n\nThis patch fixes the issue. I asked robert to beast it and it seems fine. Robert, can you confirm?  ",
            "author": "Simon Willnauer",
            "id": "comment-13426706"
        },
        {
            "date": "2012-08-01T15:46:46+0000",
            "content": "patch including a changes.txt entry. ",
            "author": "Simon Willnauer",
            "id": "comment-13426708"
        },
        {
            "date": "2012-08-01T15:48:33+0000",
            "content": "I beasted the seed 50 times @ that revision.\nAlso removed the seed and did 50 more times.\n\nno hangs/no fails. Thanks Simon! ",
            "author": "Robert Muir",
            "id": "comment-13426711"
        },
        {
            "date": "2012-08-01T18:34:27+0000",
            "content": "committed to trunk in revision r1368157\nmerged to 4.x in revision r1368183 ",
            "author": "Simon Willnauer",
            "id": "comment-13426803"
        }
    ]
}