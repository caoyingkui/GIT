{
    "id": "SOLR-5344",
    "title": "SpellCheckCollatorTest.testEstimatedHitCounts fails in jenkins from time to time",
    "details": {
        "affect_versions": "None",
        "status": "Reopened",
        "fix_versions": [],
        "components": [],
        "type": "Bug",
        "priority": "Major",
        "labels": "",
        "resolution": "Unresolved"
    },
    "description": "Doesn't happen very often, but maybe one I can fix. I'll look into it.",
    "attachments": {
        "SOLR-5344.patch": "https://issues.apache.org/jira/secure/attachment/12836625/SOLR-5344.patch"
    },
    "issue_links": {},
    "comments": [
        {
            "author": "Steve Rowe",
            "id": "comment-14709496",
            "date": "2015-08-24T15:52:50+0000",
            "content": "My Jenkins found a seed on the 5.3 release branch with Java8 http://jenkins.sarowe.net/job/Lucene-Solr-tests-5.3-Java8/222/, reproduces for me on OS X on lucene_solr_5_3, branch_5x and trunk with Java8 (all three branches at r1697441): \n\n\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=SpellCheckCollatorTest -Dtests.method=testEstimatedHitCounts -Dtests.seed=9F0E3D70573DAFC9 -Dtests.slow=true -Dtests.locale=en_CA -Dtests.timezone=America/Dawson_Creek -Dtests.asserts=true -Dtests.file.encoding=UTF-8\n   [junit4] ERROR   0.71s | SpellCheckCollatorTest.testEstimatedHitCounts <<<\n   [junit4]    > Throwable #1: java.lang.RuntimeException: Exception during query\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([9F0E3D70573DAFC9:AEB58345F202BF19]:0)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:765)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:732)\n   [junit4]    > \tat org.apache.solr.spelling.SpellCheckCollatorTest.testEstimatedHitCounts(SpellCheckCollatorTest.java:530)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n   [junit4]    > Caused by: java.lang.RuntimeException: REQUEST FAILED: xpath=//lst[@name='spellcheck']/lst[@name='collations']/lst[@name='collation']/int[@name='hits' and 6 <= . and . <= 10]\n   [junit4]    > \txml response was: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n   [junit4]    > <response>\n   [junit4]    > <lst name=\"responseHeader\"><int name=\"status\">0</int><int name=\"QTime\">10</int></lst><result name=\"response\" numFound=\"0\" start=\"0\"></result><lst name=\"spellcheck\"><lst name=\"suggestions\"><lst name=\"everother\"><int name=\"numFound\">1</int><int name=\"startOffset\">9</int><int name=\"endOffset\">18</int><arr name=\"suggestion\"><str>everyother</str></arr></lst></lst><lst name=\"collations\"><lst name=\"collation\"><str name=\"collationQuery\">teststop:everyother</str><int name=\"hits\">12</int><lst name=\"misspellingsAndCorrections\"><str name=\"everother\">everyother</str></lst></lst></lst></lst>\n   [junit4]    > </response>\n   [junit4]    > \trequest was:spellcheck=true&spellcheck.dictionary=direct&spellcheck.count=1&spellcheck.collate=true&spellcheck.maxCollationTries=1&spellcheck.maxCollations=1&spellcheck.collateExtendedResults=true&qt=spellCheckCompRH&q=teststop%3Aeverother&spellcheck.collateMaxCollectDocs=5\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:758)\n   [junit4]    > \t... 41 more\n\n "
        },
        {
            "author": "Steve Rowe",
            "id": "comment-14723609",
            "date": "2015-08-31T16:12:55+0000",
            "content": "Another fail that reproduces for me, this time on branch_5x, from Policeman Jenkins http://jenkins.thetaphi.de/job/Lucene-Solr-5.x-Linux/13781/:\n\n\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=SpellCheckCollatorTest -Dtests.method=testEstimatedHitCounts -Dtests.seed=27DE05F9C4F2FFCE -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=no_NO -Dtests.timezone=Canada/Eastern -Dtests.asserts=true -Dtests.file.encoding=UTF-8\n   [junit4] ERROR   0.30s J1 | SpellCheckCollatorTest.testEstimatedHitCounts <<<\n   [junit4]    > Throwable #1: java.lang.RuntimeException: Exception during query\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([27DE05F9C4F2FFCE:1665BBCC61CDEF1E]:0)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:765)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:732)\n   [junit4]    > \tat org.apache.solr.spelling.SpellCheckCollatorTest.testEstimatedHitCounts(SpellCheckCollatorTest.java:530)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n   [junit4]    > Caused by: java.lang.RuntimeException: REQUEST FAILED: xpath=//lst[@name='spellcheck']/lst[@name='collations']/lst[@name='collation']/int[@name='hits' and 6 <= . and . <= 10]\n   [junit4]    > \txml response was: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n   [junit4]    > <response>\n   [junit4]    > <lst name=\"responseHeader\"><int name=\"status\">0</int><int name=\"QTime\">4</int></lst><result name=\"response\" numFound=\"0\" start=\"0\"></result><lst name=\"spellcheck\"><lst name=\"suggestions\"><lst name=\"everother\"><int name=\"numFound\">1</int><int name=\"startOffset\">9</int><int name=\"endOffset\">18</int><arr name=\"suggestion\"><str>everyother</str></arr></lst></lst><lst name=\"collations\"><lst name=\"collation\"><str name=\"collationQuery\">teststop:everyother</str><int name=\"hits\">14</int><lst name=\"misspellingsAndCorrections\"><str name=\"everother\">everyother</str></lst></lst></lst></lst>\n   [junit4]    > </response>\n   [junit4]    > \trequest was:spellcheck=true&spellcheck.dictionary=direct&spellcheck.count=1&spellcheck.collate=true&spellcheck.maxCollationTries=1&spellcheck.maxCollations=1&spellcheck.collateExtendedResults=true&qt=spellCheckCompRH&q=teststop%3Aeverother&spellcheck.collateMaxCollectDocs=5\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:758)\n   [junit4]    > \t... 41 more\n[...]\n   [junit4]   2> NOTE: leaving temporary files on disk at: /home/jenkins/workspace/Lucene-Solr-5.x-Linux/solr/build/solr-core/test/J1/temp/solr.spelling.SpellCheckCollatorTest_27DE05F9C4F2FFCE-001\n   [junit4]   2> NOTE: test params are: codec=Asserting(Lucene53): {start1=Lucene50(blocksize=128), range_facet_l_dv=Lucene50(blocksize=128), lowerfilt1=Lucene50(blocksize=128), multiDefault=PostingsFormat(name=LuceneVarGapFixedInterval), teststop=PostingsFormat(name=LuceneVarGapFixedInterval), intDefault=PostingsFormat(name=LuceneVarGapDocFreqInterval), range_facet_l=PostingsFormat(name=LuceneVarGapDocFreqInterval), lowerfilt1and2=PostingsFormat(name=LuceneVarGapFixedInterval), end4=Lucene50(blocksize=128), end3=PostingsFormat(name=LuceneVarGapFixedInterval), end2=Lucene50(blocksize=128), end1=PostingsFormat(name=LuceneVarGapDocFreqInterval), lowerfilt=PostingsFormat(name=LuceneVarGapFixedInterval), gram1=PostingsFormat(name=LuceneVarGapDocFreqInterval), id=Lucene50(blocksize=128), range_facet_i_dv=PostingsFormat(name=LuceneVarGapDocFreqInterval), gram2=Lucene50(blocksize=128), gram3=PostingsFormat(name=LuceneVarGapFixedInterval), start3=Lucene50(blocksize=128), gram4=Lucene50(blocksize=128), start2=PostingsFormat(name=LuceneVarGapFixedInterval), word=PostingsFormat(name=LuceneVarGapDocFreqInterval), timestamp=PostingsFormat(name=LuceneVarGapDocFreqInterval), start4=PostingsFormat(name=LuceneVarGapDocFreqInterval)}, docValues:{range_facet_l_dv=DocValuesFormat(name=Direct), range_facet_i_dv=DocValuesFormat(name=Lucene50), timestamp=DocValuesFormat(name=Lucene50)}, sim=DefaultSimilarity, locale=no_NO, timezone=Canada/Eastern\n   [junit4]   2> NOTE: Linux 3.19.0-26-generic i386/Oracle Corporation 1.8.0_60 (32-bit)/cpus=12,threads=1,free=154911392,total=536870912\n   [junit4]   2> NOTE: All tests run in this JVM: [TermVectorComponentTest, TestConfigSetsAPIExclusivity, SliceStateTest, DateRangeFieldTest, TestHashQParserPlugin, NotRequiredUniqueKeyTest, CollectionsAPIDistributedZkTest, TestSolrConfigHandlerCloud, VMParamsZkACLAndCredentialsProvidersTest, TestFieldSortValues, EnumFieldTest, CollectionStateFormat2Test, TestPartialUpdateDeduplication, TestNonDefinedSimilarityFactory, DistribJoinFromCollectionTest, TestNoOpRegenerator, TestQueryUtils, RequestLoggingTest, TestCrossCoreJoin, BasicFunctionalityTest, HdfsSyncSliceTest, CSVRequestHandlerTest, CoreAdminCreateDiscoverTest, SpellCheckCollatorTest]\n   [junit4] Completed [111/536] on J1 in 2.54s, 9 tests, 1 error <<< FAILURES!\n\n "
        },
        {
            "author": "Steve Rowe",
            "id": "comment-15391132",
            "date": "2016-07-24T18:19:40+0000",
            "content": "Reproducing failure on master, from Policeman Jenkins http://jenkins.thetaphi.de/job/Lucene-Solr-master-Linux/17353/:\n\n\nChecking out Revision 85a585c51698edd823769a159856524407cf6456 (refs/remotes/origin/master)\n[...]\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=SpellCheckCollatorTest -Dtests.method=testEstimatedHitCounts -Dtests.seed=5905E11FF6DDFCFD -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=es-PA -Dtests.timezone=Pacific/Honolulu -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1\n   [junit4] ERROR   0.19s J1 | SpellCheckCollatorTest.testEstimatedHitCounts <<<\n   [junit4]    > Throwable #1: java.lang.RuntimeException: Exception during query\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([5905E11FF6DDFCFD:68BE5F2A53E2EC2D]:0)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:782)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:749)\n   [junit4]    > \tat org.apache.solr.spelling.SpellCheckCollatorTest.testEstimatedHitCounts(SpellCheckCollatorTest.java:562)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n   [junit4]    > Caused by: java.lang.RuntimeException: REQUEST FAILED: xpath=//lst[@name='spellcheck']/lst[@name='collations']/lst[@name='collation']/int[@name='hits' and 6 <= . and . <= 10]\n   [junit4]    > \txml response was: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n   [junit4]    > <response>\n   [junit4]    > <lst name=\"responseHeader\"><int name=\"status\">0</int><int name=\"QTime\">3</int></lst><result name=\"response\" numFound=\"0\" start=\"0\"></result><lst name=\"spellcheck\"><lst name=\"suggestions\"><lst name=\"everother\"><int name=\"numFound\">1</int><int name=\"startOffset\">9</int><int name=\"endOffset\">18</int><arr name=\"suggestion\"><str>everyother</str></arr></lst></lst><lst name=\"collations\"><lst name=\"collation\"><str name=\"collationQuery\">teststop:everyother</str><int name=\"hits\">12</int><lst name=\"misspellingsAndCorrections\"><str name=\"everother\">everyother</str></lst></lst></lst></lst>\n   [junit4]    > </response>\n   [junit4]    > \trequest was:spellcheck=true&spellcheck.dictionary=direct&spellcheck.count=1&spellcheck.collate=true&spellcheck.maxCollationTries=1&spellcheck.maxCollations=1&spellcheck.collateExtendedResults=true&qt=spellCheckCompRH&q=teststop:everother&spellcheck.collateMaxCollectDocs=5\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:775)\n   [junit4]    > \t... 41 more\n\n "
        },
        {
            "author": "Alan Woodward",
            "id": "comment-15539023",
            "date": "2016-10-01T19:09:57+0000",
            "content": "The tests are failing because the estimated hits for a collation are too high (12 or 14 in most cases, where the test is expecting between 6 and 10).  I've tried to trace through the code, and it always ends up in SpellCheckCollector#L152, after an EarlyTerminatingCollectorException has been raised.  I don't follow what the estimation calculation is actually supposed to be doing here, though - is this a real bug, or should we just relax the constraints on the test a bit?  Hoss Man James Dyer you were last in this code (albeit three years ago!) - what do you think? "
        },
        {
            "author": "James Dyer",
            "id": "comment-15629832",
            "date": "2016-11-02T17:56:23+0000",
            "content": "ok, I think I know what's going here.  This feature is supposed to estimate hit counts for spelling corrections for cases where the client doesn't care about the exact # of hits, only that a partcular collation, if re-queried, would return something.  To gets estimates, you tell it the max # of documents you would like it to collect before quitting.  It then estimates how many hits it would have counted with this:\n\n\nmaximum-doc-id * number-of-docs-collected / (# visited docs + last-doc-id + 1)\n\n\n\nIn the failing test, we ask it to collect between 5 and 20 documents.  The max-doc-id is always 17 (there are 17 documents and no deletions).\n\nBut the denominator is controlled by the # of visited documents, and also the doc id of the one that happened to be visited last.  But in the face of randomized testing and release-specific index behavior, I think the best we can hope for is a worse-case scenario, between 2 and 15.  The actual correct value is 8.\n\nSo unless there are objections, I am going to relax the requirement of 6 <= hits <= 10 , and use 2 <= hits <= 15.  Maybe we could do better than this, but I would think anyone using this feature probably does not need to know more than whether or not hits can be produced, or the relative # between several collations returned. "
        },
        {
            "author": "ASF subversion and git services",
            "id": "comment-15632739",
            "date": "2016-11-03T13:39:43+0000",
            "content": "Commit 213a2a1791e4557afd2542a25e94eec65e29a42d in lucene-solr's branch refs/heads/master from jdyer1\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=213a2a1 ]\n\nSOLR-5344: relax the test requirements for estimated hit counts "
        },
        {
            "author": "ASF subversion and git services",
            "id": "comment-15632740",
            "date": "2016-11-03T13:40:26+0000",
            "content": "Commit b11e12606573e79ee0a48693cf96979d4615b1ed in lucene-solr's branch refs/heads/branch_6x from jdyer1\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b11e126 ]\n\nSOLR-5344: relax the test requirements for estimated hit counts "
        },
        {
            "author": "James Dyer",
            "id": "comment-15632743",
            "date": "2016-11-03T13:41:07+0000",
            "content": "test fix only, no CHANGES.txt entry. "
        },
        {
            "author": "Steve Rowe",
            "id": "comment-15847556",
            "date": "2017-01-31T21:41:29+0000",
            "content": "There's a new reproducing failure on ASF Jenkins: https://builds.apache.org/job/Lucene-Solr-NightlyTests-master/1227 - the expected hit count range is [3,13] while the actual is 14:\n\n\nChecking out Revision d8d61ff61d1d798f5e3853ef66bc485d0d403f18 (refs/remotes/origin/master)\n[...]\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=SpellCheckCollatorTest -Dtests.method=testEstimatedHitCounts -Dtests.seed=F75C4ADA09152961 -Dtests.multiplier=2 -Dtests.nightly=true -Dtests.slow=true -Dtests.linedocsfile=/home/jenkins/jenkins-slave/workspace/Lucene-Solr-NightlyTests-master/test-data/enwiki.random.lines.txt -Dtests.locale=lt-LT -Dtests.timezone=CNT -Dtests.asserts=true -Dtests.file.encoding=UTF-8\n   [junit4] ERROR   0.33s J2 | SpellCheckCollatorTest.testEstimatedHitCounts <<<\n   [junit4]    > Throwable #1: java.lang.RuntimeException: Exception during query\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([F75C4ADA09152961:C6E7F4EFAC2A39B1]:0)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:857)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:824)\n   [junit4]    > \tat org.apache.solr.spelling.SpellCheckCollatorTest.testEstimatedHitCounts(SpellCheckCollatorTest.java:569)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n   [junit4]    > Caused by: java.lang.RuntimeException: REQUEST FAILED: xpath=//lst[@name='spellcheck']/lst[@name='collations']/lst[@name='collation']/int[@name='hits' and 3 <= . and . <= 13]\n   [junit4]    > \txml response was: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n   [junit4]    > <response>\n   [junit4]    > <lst name=\"responseHeader\"><int name=\"status\">0</int><int name=\"QTime\">2</int></lst><result name=\"response\" numFound=\"0\" start=\"0\"></result><lst name=\"spellcheck\"><lst name=\"suggestions\"><lst name=\"everother\"><int name=\"numFound\">1</int><int name=\"startOffset\">9</int><int name=\"endOffset\">18</int><arr name=\"suggestion\"><str>everyother</str></arr></lst></lst><lst name=\"collations\"><lst name=\"collation\"><str name=\"collationQuery\">teststop:everyother</str><int name=\"hits\">14</int><lst name=\"misspellingsAndCorrections\"><str name=\"everother\">everyother</str></lst></lst></lst></lst>\n   [junit4]    > </response>\n   [junit4]    > \trequest was:spellcheck=true&spellcheck.dictionary=direct&spellcheck.count=1&spellcheck.collate=true&spellcheck.maxCollationTries=1&spellcheck.maxCollations=1&spellcheck.collateExtendedResults=true&qt=spellCheckCompRH&q=teststop:everother&spellcheck.collateMaxCollectDocs=5\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:850)\n   [junit4]    > \t... 41 more\n[...]\n   [junit4]   2> NOTE: test params are: codec=Asserting(Lucene70): {start1=Lucene50(blocksize=128), range_facet_l_dv=PostingsFormat(name=MockRandom), lowerfilt1=Lucene50(blocksize=128), multiDefault=TestBloomFilteredLucenePostings(BloomFilteringPostingsFormat(Lucene50(blocksize=128))), teststop=TestBloomFilteredLucenePostings(BloomFilteringPostingsFormat(Lucene50(blocksize=128))), intDefault=PostingsFormat(name=Memory), range_facet_l=PostingsFormat(name=Memory), lowerfilt1and2=TestBloomFilteredLucenePostings(BloomFilteringPostingsFormat(Lucene50(blocksize=128))), end4=Lucene50(blocksize=128), end3=TestBloomFilteredLucenePostings(BloomFilteringPostingsFormat(Lucene50(blocksize=128))), end2=PostingsFormat(name=MockRandom), end1=PostingsFormat(name=Memory), lowerfilt=TestBloomFilteredLucenePostings(BloomFilteringPostingsFormat(Lucene50(blocksize=128))), gram1=PostingsFormat(name=Memory), id=PostingsFormat(name=MockRandom), range_facet_i_dv=PostingsFormat(name=Memory), gram2=PostingsFormat(name=MockRandom), gram3=TestBloomFilteredLucenePostings(BloomFilteringPostingsFormat(Lucene50(blocksize=128))), start3=PostingsFormat(name=MockRandom), gram4=Lucene50(blocksize=128), start2=TestBloomFilteredLucenePostings(BloomFilteringPostingsFormat(Lucene50(blocksize=128))), word=PostingsFormat(name=Memory), timestamp=PostingsFormat(name=Memory), start4=PostingsFormat(name=Memory)}, docValues:{range_facet_l_dv=DocValuesFormat(name=Asserting), range_facet_i_dv=DocValuesFormat(name=Lucene70), intDvoDefault=DocValuesFormat(name=Direct), timestamp=DocValuesFormat(name=Lucene70)}, maxPointsInLeafNode=549, maxMBSortInHeap=6.553211483764787, sim=RandomSimilarity(queryNorm=false): {}, locale=lt-LT, timezone=CNT\n   [junit4]   2> NOTE: Linux 3.13.0-85-generic amd64/Oracle Corporation 1.8.0_102 (64-bit)/cpus=4,threads=1,free=254106768,total=532152320\n\n "
        },
        {
            "author": "Steve Rowe",
            "id": "comment-16342647",
            "date": "2018-01-28T16:58:07+0000",
            "content": "Another reproducing failure, on branch_7x, from my Jenkins:\n\n\nChecking out Revision a29c2915c79641fc117cc56044d07134f26e8fd7 (refs/remotes/origin/branch_7x)\n[...]\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=SpellCheckCollatorTest -Dtests.method=testEstimatedHitCounts -Dtests.seed=405327DF2F689C38 -Dtests.slow=true -Dtests.locale=zh-HK -Dtests.timezone=Asia/Irkutsk -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1\n   [junit4] ERROR   0.24s J0  | SpellCheckCollatorTest.testEstimatedHitCounts <<<\n   [junit4]    > Throwable #1: java.lang.RuntimeException: Exception during query\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([405327DF2F689C38:71E899EA8A578CE8]:0)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:902)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:862)\n   [junit4]    > \tat org.apache.solr.spelling.SpellCheckCollatorTest.testEstimatedHitCounts(SpellCheckCollatorTest.java:569)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:748)\n   [junit4]    > Caused by: java.lang.RuntimeException: REQUEST FAILED: xpath=//lst[@name='spellcheck']/lst[@name='collations']/lst[@name='collation']/long[@name='hits' and 3 <= . and . <= 13]\n   [junit4]    > \txml response was: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n   [junit4]    > <response>\n   [junit4]    > <lst name=\"responseHeader\"><int name=\"status\">0</int><int name=\"QTime\">11</int></lst><result name=\"response\" numFound=\"0\" start=\"0\"></result><lst name=\"spellcheck\"><lst name=\"suggestions\"><lst name=\"everother\"><int name=\"numFound\">1</int><int name=\"startOffset\">9</int><int name=\"endOffset\">18</int><arr name=\"suggestion\"><str>everyother</str></arr></lst></lst><lst name=\"collations\"><lst name=\"collation\"><str name=\"collationQuery\">teststop:everyother</str><long name=\"hits\">14</long><lst name=\"misspellingsAndCorrections\"><str name=\"everother\">everyother</str></lst></lst></lst></lst>\n   [junit4]    > </response>\n   [junit4]    > \trequest was:spellcheck=true&spellcheck.dictionary=direct&spellcheck.count=1&spellcheck.collate=true&spellcheck.maxCollationTries=1&spellcheck.maxCollations=1&spellcheck.collateExtendedResults=true&qt=/spellCheckCompRH&q=teststop:everother&spellcheck.collateMaxCollectDocs=5\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:895)\n   [junit4]    > \t... 41 more\n[...]\n   [junit4]   2> NOTE: test params are: codec=Lucene70, sim=RandomSimilarity(queryNorm=true): {}, locale=zh-HK, timezone=Asia/Irkutsk\n   [junit4]   2> NOTE: Linux 4.1.0-custom2-amd64 amd64/Oracle Corporation 1.8.0_151 (64-bit)/cpus=16,threads=1,free=345100920,total=530055168\n\n "
        },
        {
            "author": "Steve Rowe",
            "id": "comment-16397012",
            "date": "2018-03-13T14:25:55+0000",
            "content": "Another reproducing failure from https://jenkins.thetaphi.de/job/Lucene-Solr-master-Linux/21631/:\n\n\nChecking out Revision 0cd9f7f35af84ce769a37a2ef1afe8990c5b061a (refs/remotes/origin/master)\n[...]\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=SpellCheckCollatorTest -Dtests.method=testEstimatedHitCounts -Dtests.seed=93BE88EEF2ACCD40 -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=sah -Dtests.timezone=America/Winnipeg -Dtests.asserts=true -Dtests.file.encoding=UTF-8\n   [junit4] ERROR   0.10s J0 | SpellCheckCollatorTest.testEstimatedHitCounts <<<\n   [junit4]    > Throwable #1: java.lang.RuntimeException: Exception during query\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([93BE88EEF2ACCD40:A20536DB5793DD90]:0)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:908)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:868)\n   [junit4]    > \tat org.apache.solr.spelling.SpellCheckCollatorTest.testEstimatedHitCounts(SpellCheckCollatorTest.java:569)\n   [junit4]    > \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n   [junit4]    > \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n   [junit4]    > \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n   [junit4]    > \tat java.base/java.lang.reflect.Method.invoke(Method.java:564)\n   [junit4]    > \tat java.base/java.lang.Thread.run(Thread.java:844)\n   [junit4]    > Caused by: java.lang.RuntimeException: REQUEST FAILED: xpath=//lst[@name='spellcheck']/lst[@name='collations']/lst[@name='collation']/long[@name='hits' and 3 <= . and . <= 13]\n   [junit4]    > \txml response was: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n   [junit4]    > <response>\n   [junit4]    > <lst name=\"responseHeader\"><int name=\"status\">0</int><int name=\"QTime\">2</int></lst><result name=\"response\" numFound=\"0\" start=\"0\"></result><lst name=\"spellcheck\"><lst name=\"suggestions\"><lst name=\"everother\"><int name=\"numFound\">1</int><int name=\"startOffset\">9</int><int name=\"endOffset\">18</int><arr name=\"suggestion\"><str>everyother</str></arr></lst></lst><lst name=\"collations\"><lst name=\"collation\"><str name=\"collationQuery\">teststop:everyother</str><long name=\"hits\">14</long><lst name=\"misspellingsAndCorrections\"><str name=\"everother\">everyother</str></lst></lst></lst></lst>\n   [junit4]    > </response>\n   [junit4]    > \trequest was:spellcheck=true&spellcheck.dictionary=direct&spellcheck.count=1&spellcheck.collate=true&spellcheck.maxCollationTries=1&spellcheck.maxCollations=1&spellcheck.collateExtendedResults=true&qt=/spellCheckCompRH&q=teststop:everother&spellcheck.collateMaxCollectDocs=5\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:901)\n   [junit4]    > \t... 40 more\n[...]\n   [junit4]   2> NOTE: test params are: codec=Asserting(Lucene70): {start1=FST50, lowerfilt1=PostingsFormat(name=LuceneVarGapFixedInterval), multiDefault=PostingsFormat(name=Memory), teststop=PostingsFormat(name=Memory), lowerfilt1and2=PostingsFormat(name=Memory), end4=PostingsFormat(name=LuceneVarGapFixedInterval), end3=PostingsFormat(name=LuceneVarGapDocFreqInterval), end2=FST50, end1=PostingsFormat(name=Memory), lowerfilt=PostingsFormat(name=Memory), gram1=PostingsFormat(name=Memory), id=FST50, gram2=FST50, gram3=PostingsFormat(name=LuceneVarGapDocFreqInterval), start3=PostingsFormat(name=LuceneVarGapFixedInterval), gram4=PostingsFormat(name=LuceneVarGapFixedInterval), start2=PostingsFormat(name=Memory), word=PostingsFormat(name=Memory), start4=PostingsFormat(name=LuceneVarGapDocFreqInterval)}, docValues:{range_facet_l_dv=DocValuesFormat(name=Asserting), range_facet_i_dv=DocValuesFormat(name=Lucene70), intDvoDefault=DocValuesFormat(name=Asserting), timestamp=DocValuesFormat(name=Lucene70)}, maxPointsInLeafNode=111, maxMBSortInHeap=6.299971512535449, sim=Asserting(org.apache.lucene.search.similarities.AssertingSimilarity@496f23b6), locale=sah, timezone=America/Winnipeg\n   [junit4]   2> NOTE: Linux 4.13.0-36-generic amd64/Oracle Corporation 9.0.4 (64-bit)/cpus=8,threads=1,free=128212720,total=518979584\n\n "
        },
        {
            "author": "Steve Rowe",
            "id": "comment-16415714",
            "date": "2018-03-27T14:28:25+0000",
            "content": "Another reproducing failure from https://jenkins.thetaphi.de/job/Lucene-Solr-7.3-Windows/19/:\n\n\nChecking out Revision fa7f702545469a092fbe4f32022a8f60750a2163 (refs/remotes/origin/branch_7_3)\n[...]\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=SpellCheckCollatorTest -Dtests.method=testEstimatedHitCounts -Dtests.seed=370F75B066E182E5 -Dtests.slow=true -Dtests.locale=ca-ES -Dtests.timezone=Mexico/BajaNorte -Dtests.asserts=true -Dtests.file.encoding=UTF-8\n   [junit4] ERROR   0.05s J1 | SpellCheckCollatorTest.testEstimatedHitCounts <<<\n   [junit4]    > Throwable #1: java.lang.RuntimeException: Exception during query\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([370F75B066E182E5:6B4CB85C3DE9235]:0)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:913)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:873)\n   [junit4]    > \tat org.apache.solr.spelling.SpellCheckCollatorTest.testEstimatedHitCounts(SpellCheckCollatorTest.java:569)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:748)\n   [junit4]    > Caused by: java.lang.RuntimeException: REQUEST FAILED: xpath=//lst[@name='spellcheck']/lst[@name='collations']/lst[@name='collation']/long[@name='hits' and 3 <= . and . <= 13]\n   [junit4]    > \txml response was: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n   [junit4]    > <response>\n   [junit4]    > <lst name=\"responseHeader\"><int name=\"status\">0</int><int name=\"QTime\">1</int></lst><result name=\"response\" numFound=\"0\" start=\"0\"></result><lst name=\"spellcheck\"><lst name=\"suggestions\"><lst name=\"everother\"><int name=\"numFound\">1</int><int name=\"startOffset\">9</int><int name=\"endOffset\">18</int><arr name=\"suggestion\"><str>everyother</str></arr></lst></lst><lst name=\"collations\"><lst name=\"collation\"><str name=\"collationQuery\">teststop:everyother</str><long name=\"hits\">14</long><lst name=\"misspellingsAndCorrections\"><str name=\"everother\">everyother</str></lst></lst></lst></lst>\n   [junit4]    > </response>\n   [junit4]    > \trequest was:spellcheck=true&spellcheck.dictionary=direct&spellcheck.count=1&spellcheck.collate=true&spellcheck.maxCollationTries=1&spellcheck.maxCollations=1&spellcheck.collateExtendedResults=true&qt=/spellCheckCompRH&q=teststop:everother&spellcheck.collateMaxCollectDocs=5\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:906)\n   [junit4]    > \t... 41 more\n[...]\n   [junit4]   2> NOTE: test params are: codec=Asserting(Lucene70): {start1=PostingsFormat(name=LuceneVarGapFixedInterval), lowerfilt1=PostingsFormat(name=LuceneVarGapFixedInterval), multiDefault=FST50, teststop=FST50, lowerfilt1and2=FST50, end4=PostingsFormat(name=LuceneVarGapFixedInterval), end3=FST50, end2=Lucene50(blocksize=128), end1=PostingsFormat(name=Memory), lowerfilt=FST50, gram1=PostingsFormat(name=Memory), id=Lucene50(blocksize=128), gram2=Lucene50(blocksize=128), gram3=FST50, start3=Lucene50(blocksize=128), gram4=PostingsFormat(name=LuceneVarGapFixedInterval), start2=FST50, word=PostingsFormat(name=Memory), start4=PostingsFormat(name=Memory)}, docValues:{range_facet_l_dv=DocValuesFormat(name=Memory), range_facet_i_dv=DocValuesFormat(name=Lucene70), intDvoDefault=DocValuesFormat(name=Lucene70), timestamp=DocValuesFormat(name=Lucene70)}, maxPointsInLeafNode=1606, maxMBSortInHeap=7.2099562710611895, sim=RandomSimilarity(queryNorm=true): {}, locale=ca-ES, timezone=Mexico/BajaNorte\n   [junit4]   2> NOTE: Windows 10 10.0 x86/Oracle Corporation 1.8.0_144 (32-bit)/cpus=3,threads=1,free=288755144,total=536870912\n\n "
        },
        {
            "author": "Steve Rowe",
            "id": "comment-16553232",
            "date": "2018-07-23T18:33:37+0000",
            "content": "Another reproducing failure from https://jenkins.thetaphi.de/job/Lucene-Solr-master-Linux/22495/:\n\n\n  [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=SpellCheckCollatorTest -Dtests.method=testEstimatedHitCounts -Dtests.seed=F93E32DC896C6016 -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=mer -Dtests.timezone=SystemV/PST8PDT -Dtests.asserts=true -Dtests.file.encoding=UTF-8\n  [junit4] ERROR   0.34s J0 | SpellCheckCollatorTest.testEstimatedHitCounts <<<\n  [junit4]    > Throwable #1: java.lang.RuntimeException: Exception during query\n  [junit4]    > \tat __randomizedtesting.SeedInfo.seed([F93E32DC896C6016:C8858CE92C5370C6]:0)\n  [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:917)\n  [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:877)\n  [junit4]    > \tat org.apache.solr.spelling.SpellCheckCollatorTest.testEstimatedHitCounts(SpellCheckCollatorTest.java:569)\n  [junit4]    > \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  [junit4]    > \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n  [junit4]    > \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  [junit4]    > \tat java.base/java.lang.reflect.Method.invoke(Method.java:564)\n  [junit4]    > \tat java.base/java.lang.Thread.run(Thread.java:844)\n  [junit4]    > Caused by: java.lang.RuntimeException: REQUEST FAILED: xpath=//lst[@name='spellcheck']/lst[@name='collations']/lst[@name='collation']/long[@name='hits' and 3 <= . and . <= 13]\n  [junit4]    > \txml response was: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n  [junit4]    > <response>\n  [junit4]    > <lst name=\"responseHeader\"><int name=\"status\">0</int><int name=\"QTime\">4</int></lst><result name=\"response\" numFound=\"0\" start=\"0\"></result><lst name=\"spellcheck\"><lst name=\"suggestions\"><lst name=\"everother\"><int name=\"numFound\">1</int><int name=\"startOffset\">9</int><int name=\"endOffset\">18</int><arr name=\"suggestion\"><str>everyother</str></arr></lst></lst><lst name=\"collations\"><lst name=\"collation\"><str name=\"collationQuery\">teststop:everyother</str><long name=\"hits\">14</long><lst name=\"misspellingsAndCorrections\"><str name=\"everother\">everyother</str></lst></lst></lst></lst>\n  [junit4]    > </response>\n  [junit4]    > \trequest was:spellcheck=true&spellcheck.dictionary=direct&spellcheck.count=1&spellcheck.collate=true&spellcheck.maxCollationTries=1&spellcheck.maxCollations=1&spellcheck.collateExtendedResults=true&qt=/spellCheckCompRH&q=teststop:everother&spellcheck.collateMaxCollectDocs=5\n  [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:910)\n  [junit4]    > \t... 40 more\n[...]\n  [junit4]   2> NOTE: test params are: codec=Asserting(Lucene70): {start1=PostingsFormat(name=LuceneVarGapFixedInterval), lowerfilt1=PostingsFormat(name=LuceneVarGapFixedInterval), multiDefault=FST50, teststop=FST50, lowerfilt1and2=FST50, end4=PostingsFormat(name=LuceneVarGapFixedInterval), end3=FST50, end2=BlockTreeOrds(blocksize=128), end1=PostingsFormat(name=LuceneVarGapDocFreqInterval), lowerfilt=FST50, gram1=PostingsFormat(name=LuceneVarGapDocFreqInterval), id=BlockTreeOrds(blocksize=128), gram2=BlockTreeOrds(blocksize=128), gram3=FST50, start3=BlockTreeOrds(blocksize=128), gram4=PostingsFormat(name=LuceneVarGapFixedInterval), start2=FST50, word=PostingsFormat(name=LuceneVarGapDocFreqInterval), start4=PostingsFormat(name=LuceneVarGapDocFreqInterval)}, docValues:{range_facet_l_dv=DocValuesFormat(name=Lucene70), intDefault=DocValuesFormat(name=Lucene70), id_i1=DocValuesFormat(name=Direct), range_facet_i_dv=DocValuesFormat(name=Lucene70), intDvoDefault=DocValuesFormat(name=Asserting), range_facet_l=DocValuesFormat(name=Lucene70), timestamp=DocValuesFormat(name=Lucene70)}, maxPointsInLeafNode=1509, maxMBSortInHeap=7.059537584202553, sim=Asserting(org.apache.lucene.search.similarities.AssertingSimilarity@5e51d18f), locale=mer, timezone=SystemV/PST8PDT\n  [junit4]   2> NOTE: Linux 4.15.0-24-generic amd64/Oracle Corporation 10.0.1 (64-bit)/cpus=8,threads=1,free=105400800,total=532152320\n\n "
        },
        {
            "author": "Steve Rowe",
            "id": "comment-16642347",
            "date": "2018-10-08T19:17:35+0000",
            "content": "Another reproducing failure from https://jenkins.thetaphi.de/job/Lucene-Solr-7.x-Linux/2880/:\n\n\nChecking out Revision 688fe19d5a76596b1d45a9644af5f7f9ba246e84 (refs/remotes/origin/branch_7x)\n[...]\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=SpellCheckCollatorTest -Dtests.method=testEstimatedHitCounts -Dtests.seed=E24A64F535A759FA -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=mzn -Dtests.timezone=Antarctica/Vostok -Dtests.asserts=true -Dtests.file.encoding=UTF-8\n   [junit4] ERROR   0.36s J0 | SpellCheckCollatorTest.testEstimatedHitCounts <<<\n   [junit4]    > Throwable #1: java.lang.RuntimeException: Exception during query\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([E24A64F535A759FA:D3F1DAC09098492A]:0)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:917)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:877)\n   [junit4]    > \tat org.apache.solr.spelling.SpellCheckCollatorTest.testEstimatedHitCounts(SpellCheckCollatorTest.java:569)\n   [junit4]    > \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n   [junit4]    > \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n   [junit4]    > \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n   [junit4]    > \tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\n   [junit4]    > \tat java.base/java.lang.Thread.run(Thread.java:835)\n   [junit4]    > Caused by: java.lang.RuntimeException: REQUEST FAILED: xpath=//lst[@name='spellcheck']/lst[@name='collations']/lst[@name='collation']/long[@name='hits' and 3 <= . and . <= 13]\n   [junit4]    > \txml response was: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n   [junit4]    > <response>\n   [junit4]    > <lst name=\"responseHeader\"><int name=\"status\">0</int><int name=\"QTime\">3</int></lst><result name=\"response\" numFound=\"0\" start=\"0\"></result><lst name=\"spellcheck\"><lst name=\"suggestions\"><lst name=\"everother\"><int name=\"numFound\">1</int><int name=\"startOffset\">9</int><int name=\"endOffset\">18</int><arr name=\"suggestion\"><str>everyother</str></arr></lst></lst><lst name=\"collations\"><lst name=\"collation\"><str name=\"collationQuery\">teststop:everyother</str><long name=\"hits\">14</long><lst name=\"misspellingsAndCorrections\"><str name=\"everother\">everyother</str></lst></lst></lst></lst>\n   [junit4]    > </response>\n   [junit4]    > \trequest was:spellcheck=true&spellcheck.dictionary=direct&spellcheck.count=1&spellcheck.collate=true&spellcheck.maxCollationTries=1&spellcheck.maxCollations=1&spellcheck.collateExtendedResults=true&qt=/spellCheckCompRH&q=teststop:everother&spellcheck.collateMaxCollectDocs=5\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:910)\n   [junit4]    > \t... 40 more\n[...]\n   [junit4]   2> NOTE: test params are: codec=Asserting(Lucene70): {start1=PostingsFormat(name=Memory), lowerfilt1=PostingsFormat(name=Memory), multiDefault=TestBloomFilteredLucenePostings(BloomFilteringPostingsFormat(Lucene50(blocksize=128))), teststop=TestBloomFilteredLucenePostings(BloomFilteringPostingsFormat(Lucene50(blocksize=128))), lowerfilt1and2=TestBloomFilteredLucenePostings(BloomFilteringPostingsFormat(Lucene50(blocksize=128))), end4=PostingsFormat(name=Memory), end3=TestBloomFilteredLucenePostings(BloomFilteringPostingsFormat(Lucene50(blocksize=128))), end2=PostingsFormat(name=Asserting), end1=PostingsFormat(name=MockRandom), lowerfilt=TestBloomFilteredLucenePostings(BloomFilteringPostingsFormat(Lucene50(blocksize=128))), gram1=PostingsFormat(name=MockRandom), id=PostingsFormat(name=Asserting), gram2=PostingsFormat(name=Asserting), gram3=TestBloomFilteredLucenePostings(BloomFilteringPostingsFormat(Lucene50(blocksize=128))), start3=PostingsFormat(name=Asserting), gram4=PostingsFormat(name=Memory), start2=TestBloomFilteredLucenePostings(BloomFilteringPostingsFormat(Lucene50(blocksize=128))), word=PostingsFormat(name=MockRandom), start4=PostingsFormat(name=MockRandom)}, docValues:{range_facet_l_dv=DocValuesFormat(name=Lucene70), range_facet_i_dv=DocValuesFormat(name=Memory), intDvoDefault=DocValuesFormat(name=Asserting), timestamp=DocValuesFormat(name=Memory)}, maxPointsInLeafNode=750, maxMBSortInHeap=6.055347638060191, sim=RandomSimilarity(queryNorm=false): {}, locale=mzn, timezone=Antarctica/Vostok\n   [junit4]   2> NOTE: Linux 4.15.0-36-generic amd64/Oracle Corporation 12-ea (64-bit)/cpus=8,threads=1,free=161239760,total=492830720\n\n "
        }
    ]
}