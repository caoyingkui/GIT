{
    "id": "LUCENE-8377",
    "title": "CI failure in TestAssertingDocValuesFormat",
    "details": {
        "components": [],
        "status": "Open",
        "resolution": "Unresolved",
        "fix_versions": [],
        "affect_versions": "None",
        "labels": "",
        "priority": "Major",
        "type": "New Feature"
    },
    "description": "The elastic CI found the following failure:\n\n10:40:57    [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=TestAssertingDocValuesFormat -Dtests.seed=B67196BB6D1513F4 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=es-UY -Dtests.timezone=PNT -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1\n10:40:57    [junit4] ERROR   0.00s J3 | TestAssertingDocValuesFormat (suite) <<<\n10:40:57    [junit4]    > Throwable #1: java.lang.Exception: Suite timeout exceeded (>= 7200000 msec).\n10:40:57    [junit4]    > \tat __randomizedtesting.SeedInfo.seed([B67196BB6D1513F4]:0)\n\n\n\nDoesn't reproduce after 20 rounds of beasting, unfortunately.",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "id": "comment-16529989",
            "author": "Alan Woodward",
            "content": "Looks like it hung in forceMerge()?  cc Erick Erickson\n\n\nADVERTENCIA: Suite execution timed out: org.apache.lucene.codecs.asserting.TestAssertingDocValuesFormat\n10:40:56    [junit4]   2>    1) Thread[id=43, name=SUITE-TestAssertingDocValuesFormat-seed#[B67196BB6D1513F4], state=RUNNABLE, group=TGRP-TestAssertingDocValuesFormat]\n10:40:56    [junit4]   2>         at java.lang.Thread.getStackTrace(Thread.java:1559)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.ThreadLeakControl$4.run(ThreadLeakControl.java:696)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.ThreadLeakControl$4.run(ThreadLeakControl.java:693)\n10:40:56    [junit4]   2>         at java.security.AccessController.doPrivileged(Native Method)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.ThreadLeakControl.getStackTrace(ThreadLeakControl.java:693)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.ThreadLeakControl.getThreadsWithTraces(ThreadLeakControl.java:709)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.ThreadLeakControl.formatThreadStacksFull(ThreadLeakControl.java:689)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.ThreadLeakControl.access$1000(ThreadLeakControl.java:65)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.ThreadLeakControl$2.evaluate(ThreadLeakControl.java:415)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.RandomizedRunner.runSuite(RandomizedRunner.java:705)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.RandomizedRunner.access$200(RandomizedRunner.java:139)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.RandomizedRunner$2.run(RandomizedRunner.java:626)\n10:40:56    [junit4]   2>    2) Thread[id=1, name=main, state=WAITING, group=main]\n10:40:56    [junit4]   2>         at java.lang.Object.wait(Native Method)\n10:40:56    [junit4]   2>         at java.lang.Thread.join(Thread.java:1252)\n10:40:56    [junit4]   2>         at java.lang.Thread.join(Thread.java:1326)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.RandomizedRunner.runSuite(RandomizedRunner.java:636)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.RandomizedRunner.run(RandomizedRunner.java:493)\n10:40:56    [junit4]   2>         at com.carrotsearch.ant.tasks.junit4.slave.SlaveMain.execute(SlaveMain.java:251)\n10:40:56    [junit4]   2>         at com.carrotsearch.ant.tasks.junit4.slave.SlaveMain.main(SlaveMain.java:368)\n10:40:56    [junit4]   2>         at com.carrotsearch.ant.tasks.junit4.slave.SlaveMainSafe.main(SlaveMainSafe.java:13)\n10:40:56    [junit4]   2>    3) Thread[id=18, name=JUnit4-serializer-daemon, state=TIMED_WAITING, group=main]\n10:40:56    [junit4]   2>         at java.lang.Thread.sleep(Native Method)\n10:40:56    [junit4]   2>         at com.carrotsearch.ant.tasks.junit4.events.Serializer$1.run(Serializer.java:50)\n10:40:56    [junit4]   2>    4) Thread[id=44, name=TEST-TestAssertingDocValuesFormat.testGCDCompression-seed#[B67196BB6D1513F4], state=TIMED_WAITING, group=TGRP-TestAssertingDocValuesFormat]\n10:40:56    [junit4]   2>         at java.lang.Object.wait(Native Method)\n10:40:56    [junit4]   2>         at org.apache.lucene.index.IndexWriter.doWait(IndexWriter.java:4636)\n10:40:56    [junit4]   2>         at org.apache.lucene.index.IndexWriter.forceMerge(IndexWriter.java:2017)\n10:40:56    [junit4]   2>         at org.apache.lucene.index.IndexWriter.forceMerge(IndexWriter.java:1945)\n10:40:56    [junit4]   2>         at org.apache.lucene.index.RandomIndexWriter.forceMerge(RandomIndexWriter.java:456)\n10:40:56    [junit4]   2>         at org.apache.lucene.index.BaseDocValuesFormatTestCase.doTestNumericsVsStoredFields(BaseDocValuesFormatTestCase.java:1247)\n10:40:56    [junit4]   2>         at org.apache.lucene.index.BaseDocValuesFormatTestCase.doTestGCDCompression(BaseDocValuesFormatTestCase.java:2345)\n10:40:56    [junit4]   2>         at org.apache.lucene.index.BaseDocValuesFormatTestCase.testGCDCompression(BaseDocValuesFormatTestCase.java:2330)\n10:40:56    [junit4]   2>         at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n10:40:56    [junit4]   2>         at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n10:40:56    [junit4]   2>         at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n10:40:56    [junit4]   2>         at java.lang.reflect.Method.invoke(Method.java:498)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1737)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:934)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:970)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:984)\n10:40:56    [junit4]   2>         at org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:49)\n10:40:56    [junit4]   2>         at org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\n10:40:56    [junit4]   2>         at org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:48)\n10:40:56    [junit4]   2>         at org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)\n10:40:56    [junit4]   2>         at org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:817)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:468)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:943)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:829)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:879)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:890)\n10:40:56    [junit4]   2>         at org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n10:40:56    [junit4]   2>         at org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:41)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n10:40:56    [junit4]   2>         at org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)\n10:40:56    [junit4]   2>         at org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)\n10:40:56    [junit4]   2>         at org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)\n10:40:56    [junit4]   2>         at org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:54)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n10:40:56    [junit4]   2>         at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)\n10:40:56    [junit4]   2>         at java.lang.Thread.run(Thread.java:748)\n10:40:56    [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=TestAssertingDocValuesFormat -Dtests.method=testGCDCompression -Dtests.seed=B67196BB6D1513F4 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=es-UY -Dtests.timezone=PNT -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1\n\n ",
            "date": "2018-07-02T14:20:53+0000"
        },
        {
            "id": "comment-16530089",
            "author": "Erick Erickson",
            "content": "I'll beast it locally, but there's no evidence that this is TMP, which is the only merge policy that changed. Of course there's no evidence that it's not TMP either, siiigggghhhh.\n\nI'll add a bit of logging locally to see what merge policy is being used so we can tell.\n\nMeanwhile I'll assign to myself but all help of course welcome. ",
            "date": "2018-07-02T15:40:13+0000"
        },
        {
            "id": "comment-16533247",
            "author": "Erick Erickson",
            "content": "Ran 1,000 tests with those flags and no failures.\n\nThis error: \"java.lang.Exception: Suite timeout exceeded (>= 7200000 msec).\" seems to occur upon occasion on tests, not always the same test either. So I'm starting to doubt it's something with the changes to TieredMergePolicy, I'll check as test issues come through and see if it still occurs in other places too. ",
            "date": "2018-07-05T03:48:37+0000"
        },
        {
            "id": "comment-16583199",
            "author": "Erick Erickson",
            "content": "Alan Woodward WDYT about this? I just checked Hoss' rollups that I've been collecting since well before you raised this and don't see this test mentioned.\n\n\u00a0\n\nShould we closes it as \"cannot reproduce\"? At the least I'm going to un-assign it as I don't think it doesn't seem related to TMP changes. ",
            "date": "2018-08-16T23:54:48+0000"
        },
        {
            "id": "comment-16587594",
            "author": "Alan Woodward",
            "content": "If it hasn't recurred I'm fine with closing it for now. ",
            "date": "2018-08-21T15:31:45+0000"
        }
    ]
}