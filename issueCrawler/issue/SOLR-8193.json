{
    "id": "SOLR-8193",
    "title": "Data Import Handler OOM does not trigger the oom killer script",
    "details": {
        "components": [],
        "type": "Bug",
        "labels": "",
        "fix_versions": [],
        "affect_versions": "5.2.1",
        "status": "Open",
        "resolution": "Unresolved",
        "priority": "Major"
    },
    "description": "From the user's list. Probably wrapping an OOM error like we've seen before.\n\n*****\n Some times I see OOM happening on replicas,but does not trigger script\n oom_solr.sh which was passed in as\n -XX:OnOutOfMemoryError=/actualLocation/solr/bin/oom_solr.sh 8091.\n\n These OOM happened while DIH importing data from database. Is this known\n issue? is there any quick fix? Sent yesterday day to users group, no\n response yet.\n\n Here are stack traces when OOM happened\n\n\n 1)\n org.apache.solr.common.SolrException; null:java.lang.RuntimeException:\n java.lang.OutOfMemoryError: Java heap space\n         at\n org.apache.solr.servlet.HttpSolrCall.sendError(HttpSolrCall.java:593)\n         at org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:465)\n         at\n org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java\n :227)\n         at\n org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java\n :196)\n         at\n org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandle\n r.java:1652)\n         at\n org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:585)\n         at\n org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:14\n 3)\n         at\n org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:577)\n         at\n org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.jav\n a:223)\n         at\n org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.jav\n a:1127)\n         at\n org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:515)\n         at\n org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java\n :185)\n         at\n org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java\n :1061)\n         at\n org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:14\n 1)\n         at\n org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHan\n dlerCollection.java:215)\n         at\n org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection\n .java:110)\n         at\n org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:\n 97)\n         at org.eclipse.jetty.server.Server.handle(Server.java:497)\n         at\n org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:310)\n         at\n org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:257)\n         at\n org.eclipse.jetty.io.AbstractConnection$2.run(AbstractConnection.java:540)\n         at\n org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java\n :635)\n         at\n org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:\n 555)\n         at java.lang.Thread.run(Thread.java:745)\n Caused by: java.lang.OutOfMemoryError: Java heap space\n\n\n\n 2)\n         org.apache.solr.common.SolrException;\n org.apache.solr.common.SolrException: Exception writing document id\n R277453962 to the index; possible analysis error.\n         at\n org.apache.solr.update.DirectUpdateHandler2.addDoc(DirectUpdateHandler2.jav\n a:167)\n         at\n org.apache.solr.update.processor.RunUpdateProcessor.processAdd(RunUpdatePro\n cessorFactory.java:69)\n         at\n org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRe\n questProcessor.java:51)\n         at\n org.apache.solr.update.processor.DistributedUpdateProcessor.doLocalAdd(Dist\n ributedUpdateProcessor.java:955)\n         at\n org.apache.solr.update.processor.DistributedUpdateProcessor.versionAdd(Dist\n ributedUpdateProcessor.java:1110)\n         at\n org.apache.solr.update.processor.DistributedUpdateProcessor.processAdd(Dist\n ributedUpdateProcessor.java:706)\n         at\n org.apache.solr.update.processor.LogUpdateProcessor.processAdd(LogUpdatePro\n cessorFactory.java:104)\n         at\n org.apache.solr.handler.loader.JavabinLoader$1.update(JavabinLoader.java:10\n 1)\n         at\n org.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec$1.readOuterM\n ostDocIterator(JavaBinUpdateRequestCodec.java:179)\n         at\n org.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec$1.readIterat\n or(JavaBinUpdateRequestCodec.java:135)\n         at\n org.apache.solr.common.util.JavaBinCodec.readVal(JavaBinCodec.java:241)\n         at\n org.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec$1.readNamedL\n ist(JavaBinUpdateRequestCodec.java:121)\n         at\n org.apache.solr.common.util.JavaBinCodec.readVal(JavaBinCodec.java:206)\n         at\n org.apache.solr.common.util.JavaBinCodec.unmarshal(JavaBinCodec.java:126)\n         at\n org.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec.unmarshal(Ja\n vaBinUpdateRequestCodec.java:186)\n at\n org.apache.solr.handler.loader.JavabinLoader.parseAndLoadDocs(JavabinLoader\n .java:111)\n         at\n org.apache.solr.handler.loader.JavabinLoader.load(JavabinLoader.java:58)\n         at\n org.apache.solr.handler.UpdateRequestHandler$1.load(UpdateRequestHandler.ja\n va:98)\n         at\n org.apache.solr.handler.ContentStreamHandlerBase.handleRequestBody(ContentS\n treamHandlerBase.java:74)\n         at\n org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase\n .java:143)\n         at org.apache.solr.core.SolrCore.execute(SolrCore.java:2064)\n         at\n org.apache.solr.servlet.HttpSolrCall.execute(HttpSolrCall.java:654)\n         at org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:450)\n         at\n org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java\n :227)\n         at\n org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java\n :196)\n         at\n org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandle\n r.java:1652)\n         at\n org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:585)\n         at\n org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:14\n 3)\n         at\n org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:577)\n         at\n org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.jav\n a:223)\n         at\n org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.jav\n a:1127)\n         at\n org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:515)\n         at\n org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java\n :185)\n         at\n org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java\n :1061)\n         at\n org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:14\n 1)\n         at\n org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHan\n dlerCollection.java:215)\n         at\n org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection\n .java:110)\n         at\n org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:\n 97)\n         at org.eclipse.jetty.server.Server.handle(Server.java:497)\n         at\n org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:310)\n         at\n org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:257)\n         at\n org.eclipse.jetty.io.AbstractConnection$2.run(AbstractConnection.java:540)\n         at\n org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java\n :635)\n         at\n org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:\n 555)\n         at java.lang.Thread.run(Thread.java:745)\n Caused by: org.apache.lucene.store.AlreadyClosedException: this\n IndexWriter is closed\n         at\n org.apache.lucene.index.IndexWriter.ensureOpen(IndexWriter.java:718)\n         at\n org.apache.lucene.index.IndexWriter.ensureOpen(IndexWriter.java:732)\n         at\n org.apache.lucene.index.IndexWriter.updateDocument(IndexWriter.java:1359)\n         at\n org.apache.solr.update.DirectUpdateHandler2.addDoc0(DirectUpdateHandler2.ja\n va:239)\n         at\n org.apache.solr.update.DirectUpdateHandler2.addDoc(DirectUpdateHandler2.jav\n a:163)\n         ... 44 more\n Caused by: java.lang.OutOfMemoryError: Java heap space",
    "attachments": {},
    "issue_links": {},
    "comments": []
}