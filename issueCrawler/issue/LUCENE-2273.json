{
    "id": "LUCENE-2273",
    "title": "FieldCacheImpl's getCacheEntries() is buggy as it uses WeakHashMap incorrectly and leads to ConcurrentModExceptions",
    "details": {
        "labels": "",
        "priority": "Major",
        "components": [],
        "type": "Bug",
        "fix_versions": [
            "4.0-ALPHA"
        ],
        "affect_versions": "None",
        "resolution": "Fixed",
        "status": "Closed"
    },
    "description": "The way how WeakHashMap works internally leads to the fact that it is not allowed to iterate over a WHM.keySet() and then get() the value. As each get() operation inspects the ReferenceQueue of the weak keys, they may suddenly disappear. If you use the entrySet() iterator you get key and value and no need to call get(), contains(),... that inspects the ReferenceQueue.",
    "attachments": {
        "LUCENE-2273.patch": "https://issues.apache.org/jira/secure/attachment/12436483/LUCENE-2273.patch"
    },
    "issue_links": {},
    "comments": [
        {
            "date": "2010-02-21T10:56:31+0000",
            "content": "Can we add @lucene.internal to this API as well?  Or lucene.experimental? ",
            "author": "Michael McCandless",
            "id": "comment-12836353"
        },
        {
            "date": "2010-02-21T11:00:13+0000",
            "content": "Its already marked as experimental in the interface ",
            "author": "Uwe Schindler",
            "id": "comment-12836354"
        },
        {
            "date": "2010-02-21T11:06:10+0000",
            "content": "Here the fix, will commit this soon. ",
            "author": "Uwe Schindler",
            "id": "comment-12836355"
        },
        {
            "date": "2010-02-21T11:17:05+0000",
            "content": "Committed  revision: 912330 ",
            "author": "Uwe Schindler",
            "id": "comment-12836357"
        },
        {
            "date": "2010-02-21T11:24:03+0000",
            "content": "I added one more null check on the weak key of the cache in rev 912331 ",
            "author": "Uwe Schindler",
            "id": "comment-12836361"
        }
    ]
}