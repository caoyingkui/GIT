{
    "id": "LUCENE-1205",
    "title": "java.io.FileNotFoundException: /data/tomcats/tomcat-public/solr/data/index/_1u5.nrm (Too many open files)",
    "details": {
        "labels": "",
        "priority": "Blocker",
        "components": [],
        "type": "Bug",
        "fix_versions": [],
        "affect_versions": "None",
        "resolution": "Invalid",
        "status": "Resolved"
    },
    "description": "The below exception starts occuring when my application tries to update index of consumers.\nWhen all consumers are rebuild, the indexes are not updated and all threads of apache is occupied by this error.\nSo I need to restart my tomcat every time and this happens for every 4 hours.\n\nI saw some issues related in JIRA but when I used links to go to bugzilla it never works. \nIt would be great if some explanation is given.\n\nFor setting ulimit in linux it is told that it should be (1+mergeFactor) * FilesPerSegment.\nWe have mergeFactor of 10.\nWe are also not clear on what is FilesPerSegment\n\nBelow is the stack trace which comes continuosly\n\n06.03.2008 10:25:02 [ERROR] MQ Consumer (Index.Update) com.unilever.brandcom.sdse.services.index.IndexUpdateConsumer []:\nGot solr server exception:\norg.apache.solr.client.exception.SolrServerException: Server returned non-zero status:\nCaused by:\nServer side exception, status = 1: java.io.FileNotFoundException: /data/tomcats/tomcat-public/solr/data/index/_1u5.nrm (Too many open files)\nat java.io.RandomAccessFile.open(Native Method)\nat java.io.RandomAccessFile.<init>(RandomAccessFile.java:212)\nat org.apache.lucene.store.FSIndexInput$Descriptor.<init>(FSDirectory.java:497)\nat org.apache.lucene.store.FSIndexInput.<init>(FSDirectory.java:522)\nat org.apache.lucene.store.FSDirectory.openInput(FSDirectory.java:434)\nat org.apache.lucene.index.SegmentReader.openNorms(SegmentReader.java:503)\nat org.apache.lucene.index.SegmentReader.initialize(SegmentReader.java:183)\nat org.apache.lucene.index.SegmentReader.get(SegmentReader.java:140)\nat org.apache.lucene.index.SegmentReader.get(SegmentReader.java:121)\nat org.apache.lucene.index.IndexReader$1.doBody(IndexReader.java:166)\nat org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.java:579)\nat org.apache.lucene.index.IndexReader.open(IndexReader.java:147)\nat org.apache.lucene.index.IndexReader.open(IndexReader.java:131)\nat org.apache.solr.search.SolrIndexSearcher.<init>(SolrIndexSearcher.java:86)\nat org.apache.solr.core.SolrCore.newSearcher(SolrCore.java:117)\nat org.apache.solr.update.DirectUpdateHandler2.openSearcher(DirectUpdateHandler2.java:199)\nat org.apache.solr.update.DirectUpdateHandler2.doDeletions(DirectUpdateHandler2.java:423)\nat org.apache.solr.update.DirectUpdateHandler2.commit(DirectUpdateHandler2.java:496)\nat org.apache.solr.handler.XmlUpdateRequestHandler.update(XmlUpdateRequestHandler.java:225)\nat org.apache.solr.handler.XmlUpdateRequestHandler.doLegacyUpdate(XmlUpdateRequestHandler.java:366)\nat org.apache.solr.servlet.SolrUpdateServlet.doPost(SolrUpdateServlet.java:58)\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:709)\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:802)\nat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)\nat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)\nat com.freiheit.commons.sensor.PerformanceLogFilter.doFilter(Unknown Source)\nat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)\nat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)\nat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)\nat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)\nat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)\nat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)\nat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)\nat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)\nat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)\nat org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664)\nat org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)\nat org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:80)\nat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)\nat java.lang.Thread.run(Thread.java:595) \nAfter sending request:\n<commit waitFlush=\"true\" waitSearcher=\"true\" />\nat org.apache.solr.client.impl.SolrClientImpl.postUpdateXml(SolrClientImpl.java:187)\nat org.apache.solr.client.impl.SolrClientImpl.commit(SolrClientImpl.java:332)\nat com.unilever.brandcom.sdse.services.index.IndexUpdateConsumer.closeClient(IndexUpdateConsumer.java:114)\nat com.unilever.brandcom.sdse.services.index.IndexUpdateConsumer.solRCommit(IndexUpdateConsumer.java:83)\nat com.unilever.brandcom.sdse.services.index.IndexUpdateConsumer.checkForSolrCommit(IndexUpdateConsumer.java:75)\nat com.unilever.brandcom.sdse.services.index.IndexUpdateConsumer.onBeforeCommit(IndexUpdateConsumer.java:64)\nat com.unilever.brandcom.sdse.services.AbstractConsumer.run(AbstractConsumer.java:339)\nat java.lang.Thread.run(Thread.java:595)\norg.apache.solr.client.exception.SolrServerException: Server returned non-zero status:",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "date": "2008-03-07T03:36:08+0000",
            "content": "Hi Rajesh, since you are using Solr, this should really have been opened as a Solr issue.\nYou are running out of descriptors... try setting the limit to something high like 10000. ",
            "author": "Yonik Seeley",
            "id": "comment-12576028"
        }
    ]
}