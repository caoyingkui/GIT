{
    "id": "SOLR-8958",
    "title": "OutOfMemoryError while processing search results",
    "details": {
        "components": [
            "clients - java"
        ],
        "type": "Bug",
        "labels": "",
        "fix_versions": [],
        "affect_versions": "5.5",
        "status": "Resolved",
        "resolution": "Won't Fix",
        "priority": "Critical"
    },
    "description": "When searching is happens that OutOfMemoryErrors occur.\n\nThis is probably a known issue:\n\nByteUtils.java\n  /** Convert UTF8 bytes into UTF16 characters. */\n  public static void UTF8toUTF16(byte[] utf8, int offset, int len, CharArr out) {\n    // TODO: do in chunks if the input is large\n    out.reserve(len);\n    int n = UTF8toUTF16(utf8, offset, len, out.getArray(), out.getEnd());\n    out.setEnd(out.getEnd() + n);\n  }\n\n\n\nThese are stack traces from the generated hprof file.\n\n\nWebConnectorWorker-localhost:8102-2\n  at org.apache.solr.common.util.ByteUtils.UTF8toUTF16([BII[CI)I (ByteUtils.java:60)\n  at org.apache.solr.common.util.ByteUtils.UTF8toUTF16([BIILorg/noggit/CharArr;)V (ByteUtils.java:69)\n  at org.apache.solr.common.util.JavaBinCodec.readStr(Lorg/apache/solr/common/util/DataInputInputStream;Lorg/apache/solr/common/util/JavaBinCodec$StringCache;)Ljava/lang/String; (JavaBinCodec.java:664)\n  at org.apache.solr.common.util.JavaBinCodec.readStr(Lorg/apache/solr/common/util/DataInputInputStream;)Ljava/lang/String; (JavaBinCodec.java:653)\n  at org.apache.solr.common.util.JavaBinCodec.readVal(Lorg/apache/solr/common/util/DataInputInputStream;)Ljava/lang/Object; (JavaBinCodec.java:215)\n  at org.apache.solr.common.util.JavaBinCodec.readArray(Lorg/apache/solr/common/util/DataInputInputStream;)Ljava/util/List; (JavaBinCodec.java:543)\n  at org.apache.solr.common.util.JavaBinCodec.readVal(Lorg/apache/solr/common/util/DataInputInputStream;)Ljava/lang/Object; (JavaBinCodec.java:221)\n  at org.apache.solr.common.util.JavaBinCodec.readSolrDocument(Lorg/apache/solr/common/util/DataInputInputStream;)Lorg/apache/solr/common/SolrDocument; (JavaBinCodec.java:411)\n  at org.apache.solr.common.util.JavaBinCodec.readVal(Lorg/apache/solr/common/util/DataInputInputStream;)Ljava/lang/Object; (JavaBinCodec.java:254)\n  at org.apache.solr.common.util.JavaBinCodec.readArray(Lorg/apache/solr/common/util/DataInputInputStream;)Ljava/util/List; (JavaBinCodec.java:543)\n  at org.apache.solr.common.util.JavaBinCodec.readVal(Lorg/apache/solr/common/util/DataInputInputStream;)Ljava/lang/Object; (JavaBinCodec.java:221)\n  at org.apache.solr.common.util.JavaBinCodec.readSolrDocumentList(Lorg/apache/solr/common/util/DataInputInputStream;)Lorg/apache/solr/common/SolrDocumentList; (JavaBinCodec.java:425)\n  at org.apache.solr.common.util.JavaBinCodec.readVal(Lorg/apache/solr/common/util/DataInputInputStream;)Ljava/lang/Object; (JavaBinCodec.java:256)\n  at org.apache.solr.common.util.JavaBinCodec.readOrderedMap(Lorg/apache/solr/common/util/DataInputInputStream;)Lorg/apache/solr/common/util/SimpleOrderedMap; (JavaBinCodec.java:154)\n  at org.apache.solr.common.util.JavaBinCodec.readVal(Lorg/apache/solr/common/util/DataInputInputStream;)Ljava/lang/Object; (JavaBinCodec.java:223)\n  at org.apache.solr.common.util.JavaBinCodec.unmarshal(Ljava/io/InputStream;)Ljava/lang/Object; (JavaBinCodec.java:145)\n  at org.apache.solr.client.solrj.impl.BinaryResponseParser.processResponse(Ljava/io/InputStream;Ljava/lang/String;)Lorg/apache/solr/common/util/NamedList; (BinaryResponseParser.java:50)\n  at org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(Lorg/apache/http/client/methods/HttpRequestBase;Lorg/apache/solr/client/solrj/ResponseParser;)Lorg/apache/solr/common/util/NamedList; (HttpSolrClient.java:551)\n  at org.apache.solr.client.solrj.impl.HttpSolrClient.request(Lorg/apache/solr/client/solrj/SolrRequest;Lorg/apache/solr/client/solrj/ResponseParser;Ljava/lang/String;)Lorg/apache/solr/common/util/NamedList; (HttpSolrClient.java:240)\n  at org.apache.solr.client.solrj.impl.HttpSolrClient.request(Lorg/apache/solr/client/solrj/SolrRequest;Ljava/lang/String;)Lorg/apache/solr/common/util/NamedList; (HttpSolrClient.java:229)\n  at org.apache.solr.client.solrj.SolrRequest.process(Lorg/apache/solr/client/solrj/SolrClient;Ljava/lang/String;)Lorg/apache/solr/client/solrj/SolrResponse; (SolrRequest.java:149)\n  at org.apache.solr.client.solrj.SolrClient.query(Ljava/lang/String;Lorg/apache/solr/common/params/SolrParams;)Lorg/apache/solr/client/solrj/response/QueryResponse; (SolrClient.java:942)\n\n\n\nAnother one:\n\n\nWebConnectorWorker-localhost:8102-8\n  at java.lang.OutOfMemoryError.<init>()V (OutOfMemoryError.java:48)\n  at java.util.Arrays.copyOfRange([CII)[C (Arrays.java:3664)\n  at java.lang.String.<init>([CII)V (String.java:207)\n  at org.noggit.CharArr.toString()Ljava/lang/String; (CharArr.java:168)\n  at org.apache.solr.common.util.JavaBinCodec.readStr(Lorg/apache/solr/common/util/DataInputInputStream;Lorg/apache/solr/common/util/JavaBinCodec$StringCache;)Ljava/lang/String; (JavaBinCodec.java:665)\n  at org.apache.solr.common.util.JavaBinCodec.readStr(Lorg/apache/solr/common/util/DataInputInputStream;)Ljava/lang/String; (JavaBinCodec.java:653)\n  at org.apache.solr.common.util.JavaBinCodec.readVal(Lorg/apache/solr/common/util/DataInputInputStream;)Ljava/lang/Object; (JavaBinCodec.java:215)\n  at org.apache.solr.common.util.JavaBinCodec.readArray(Lorg/apache/solr/common/util/DataInputInputStream;)Ljava/util/List; (JavaBinCodec.java:543)\n  at org.apache.solr.common.util.JavaBinCodec.readVal(Lorg/apache/solr/common/util/DataInputInputStream;)Ljava/lang/Object; (JavaBinCodec.java:221)\n  at org.apache.solr.common.util.JavaBinCodec.readSolrDocument(Lorg/apache/solr/common/util/DataInputInputStream;)Lorg/apache/solr/common/SolrDocument; (JavaBinCodec.java:411)\n  at org.apache.solr.common.util.JavaBinCodec.readVal(Lorg/apache/solr/common/util/DataInputInputStream;)Ljava/lang/Object; (JavaBinCodec.java:254)\n  at org.apache.solr.common.util.JavaBinCodec.readArray(Lorg/apache/solr/common/util/DataInputInputStream;)Ljava/util/List; (JavaBinCodec.java:543)\n  at org.apache.solr.common.util.JavaBinCodec.readVal(Lorg/apache/solr/common/util/DataInputInputStream;)Ljava/lang/Object; (JavaBinCodec.java:221)\n  at org.apache.solr.common.util.JavaBinCodec.readSolrDocumentList(Lorg/apache/solr/common/util/DataInputInputStream;)Lorg/apache/solr/common/SolrDocumentList; (JavaBinCodec.java:425)\n  at org.apache.solr.common.util.JavaBinCodec.readVal(Lorg/apache/solr/common/util/DataInputInputStream;)Ljava/lang/Object; (JavaBinCodec.java:256)\n  at org.apache.solr.common.util.JavaBinCodec.readOrderedMap(Lorg/apache/solr/common/util/DataInputInputStream;)Lorg/apache/solr/common/util/SimpleOrderedMap; (JavaBinCodec.java:154)\n  at org.apache.solr.common.util.JavaBinCodec.readVal(Lorg/apache/solr/common/util/DataInputInputStream;)Ljava/lang/Object; (JavaBinCodec.java:223)\n  at org.apache.solr.common.util.JavaBinCodec.unmarshal(Ljava/io/InputStream;)Ljava/lang/Object; (JavaBinCodec.java:145)\n  at org.apache.solr.client.solrj.impl.BinaryResponseParser.processResponse(Ljava/io/InputStream;Ljava/lang/String;)Lorg/apache/solr/common/util/NamedList; (BinaryResponseParser.java:50)\n  at org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(Lorg/apache/http/client/methods/HttpRequestBase;Lorg/apache/solr/client/solrj/ResponseParser;)Lorg/apache/solr/common/util/NamedList; (HttpSolrClient.java:551)\n  at org.apache.solr.client.solrj.impl.HttpSolrClient.request(Lorg/apache/solr/client/solrj/SolrRequest;Lorg/apache/solr/client/solrj/ResponseParser;Ljava/lang/String;)Lorg/apache/solr/common/util/NamedList; (HttpSolrClient.java:240)\n  at org.apache.solr.client.solrj.impl.HttpSolrClient.request(Lorg/apache/solr/client/solrj/SolrRequest;Ljava/lang/String;)Lorg/apache/solr/common/util/NamedList; (HttpSolrClient.java:229)\n  at org.apache.solr.client.solrj.SolrRequest.process(Lorg/apache/solr/client/solrj/SolrClient;Ljava/lang/String;)Lorg/apache/solr/client/solrj/SolrResponse; (SolrRequest.java:149)\n  at org.apache.solr.client.solrj.SolrClient.query(Ljava/lang/String;Lorg/apache/solr/common/params/SolrParams;)Lorg/apache/solr/client/solrj/response/QueryResponse; (SolrClient.java:942)",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "date": "2016-04-07T11:55:24+0000",
            "author": "Shalin Shekhar Mangar",
            "content": "This OutOfMemory is happening on the client while parsing the returned documents. What is the value of \"rows\" in your search query? ",
            "id": "comment-15230132"
        },
        {
            "date": "2016-04-07T14:08:25+0000",
            "author": "Alexander Veit",
            "content": "According to the admin the value is 50. ",
            "id": "comment-15230285"
        },
        {
            "date": "2016-04-07T15:48:34+0000",
            "author": "Erick Erickson",
            "content": "This is overwhelmingly likely to be a configuration issue on your part. Please raise this kind of question on the user's list first, you'll get more eyes on the problem.\n\nJava starts with a defined amount of memory. This error usually means you're trying to cram too much stuff into too little memory. You have to tell us a lot more information before we can make any suggestions.\n\nWhen you move the question to the user's list, you need to include:\nHow much memory are you allocating to your JVM? What query are you running? How many docs in the index? What are the rest of the parameters you use to start your Solr instance? What are the docs like in terms of size and fields? You might review:\n\nhttp://wiki.apache.org/solr/UsingMailingLists\n\nAnd if we determine that it really is a bug, we can open the appropriate JIRA. ",
            "id": "comment-15230447"
        }
    ]
}