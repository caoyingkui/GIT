{
    "id": "LUCENE-6726",
    "title": "TestIndexWriterOnDiskFull.testAddDocumentOnDiskFull() failure",
    "details": {
        "resolution": "Unresolved",
        "affect_versions": "None",
        "components": [],
        "labels": "",
        "fix_versions": [],
        "priority": "Major",
        "status": "Open",
        "type": "Bug"
    },
    "description": "My Linux Jenkins found a seed that reproduces 100% for me on OS X w/Java7, but only if I run the whole suite (i.e., exclude -Dtests.method=testAddDocumentOnDiskFull from the repro line) http://jenkins.sarowe.net/job/Lucene-core-nightly-monster-5.x-Java7/68/:\n\n\n[junit4:pickseed] Seed property 'tests.seed' already defined: 6B36AD57BB5A1779\n   [junit4] <JUnit4> says \u05e9\u05dc\u05d5\u05dd! Master seed: 6B36AD57BB5A1779\n   [junit4] Executing 1 suite with 1 JVM.\n   [junit4] \n   [junit4] Started J0 PID(86114@localhost).\n   [junit4] Suite: org.apache.lucene.index.TestIndexWriterOnDiskFull\n   [junit4] HEARTBEAT J0 PID(86114@localhost): 2015-08-06T09:44:03, stalled for 70.7s at: TestIndexWriterOnDiskFull.testAddIndexOnDiskFull\n   [junit4] OK      73.8s | TestIndexWriterOnDiskFull.testAddIndexOnDiskFull\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=TestIndexWriterOnDiskFull -Dtests.method=testAddDocumentOnDiskFull -Dtests.seed=6B36AD57BB5A1779 -Dtests.nightly=true -Dtests.slow=true -Dtests.locale=ar_AE -Dtests.timezone=America/Boa_Vista -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1\n   [junit4] ERROR   0.25s | TestIndexWriterOnDiskFull.testAddDocumentOnDiskFull <<<\n   [junit4]    > Throwable #1: org.apache.lucene.store.AlreadyClosedException: this IndexWriter is closed\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([6B36AD57BB5A1779:E72E952846CFC1BD]:0)\n   [junit4]    > \tat org.apache.lucene.index.IndexWriter.ensureOpen(IndexWriter.java:719)\n   [junit4]    > \tat org.apache.lucene.index.IndexWriter.ensureOpen(IndexWriter.java:733)\n   [junit4]    > \tat org.apache.lucene.index.IndexWriter.updateDocument(IndexWriter.java:1471)\n   [junit4]    > \tat org.apache.lucene.index.IndexWriter.addDocument(IndexWriter.java:1254)\n   [junit4]    > \tat org.apache.lucene.index.TestIndexWriterOnDiskFull.addDoc(TestIndexWriterOnDiskFull.java:575)\n   [junit4]    > \tat org.apache.lucene.index.TestIndexWriterOnDiskFull.testAddDocumentOnDiskFull(TestIndexWriterOnDiskFull.java:80)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n   [junit4]    > Caused by: java.io.IOException: fake disk full at 7402 bytes when writing _4_Lucene50_0.dvm (file length=0)\n   [junit4]    > \tat org.apache.lucene.store.MockIndexOutputWrapper.checkDiskFull(MockIndexOutputWrapper.java:88)\n   [junit4]    > \tat org.apache.lucene.store.MockIndexOutputWrapper.writeBytes(MockIndexOutputWrapper.java:134)\n   [junit4]    > \tat org.apache.lucene.store.MockIndexOutputWrapper.writeByte(MockIndexOutputWrapper.java:127)\n   [junit4]    > \tat org.apache.lucene.store.RateLimitedIndexOutput.writeByte(RateLimitedIndexOutput.java:66)\n   [junit4]    > \tat org.apache.lucene.store.DataOutput.writeInt(DataOutput.java:70)\n   [junit4]    > \tat org.apache.lucene.codecs.CodecUtil.writeHeader(CodecUtil.java:91)\n   [junit4]    > \tat org.apache.lucene.codecs.CodecUtil.writeIndexHeader(CodecUtil.java:134)\n   [junit4]    > \tat org.apache.lucene.codecs.lucene50.Lucene50DocValuesConsumer.<init>(Lucene50DocValuesConsumer.java:68)\n   [junit4]    > \tat org.apache.lucene.codecs.lucene50.Lucene50DocValuesFormat.fieldsConsumer(Lucene50DocValuesFormat.java:197)\n   [junit4]    > \tat org.apache.lucene.codecs.perfield.PerFieldDocValuesFormat$FieldsWriter.getInstance(PerFieldDocValuesFormat.java:187)\n   [junit4]    > \tat org.apache.lucene.codecs.perfield.PerFieldDocValuesFormat$FieldsWriter.addNumericField(PerFieldDocValuesFormat.java:111)\n   [junit4]    > \tat org.apache.lucene.codecs.DocValuesConsumer.mergeNumericField(DocValuesConsumer.java:252)\n   [junit4]    > \tat org.apache.lucene.codecs.DocValuesConsumer.merge(DocValuesConsumer.java:163)\n   [junit4]    > \tat org.apache.lucene.index.SegmentMerger.mergeDocValues(SegmentMerger.java:150)\n   [junit4]    > \tat org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:105)\n   [junit4]    > \tat org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:4089)\n   [junit4]    > \tat org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:3664)\n   [junit4]    > \tat org.apache.lucene.index.ConcurrentMergeScheduler.doMerge(ConcurrentMergeScheduler.java:588)\n   [junit4]    > \tat org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:626)\n   [junit4] OK      0.12s | TestIndexWriterOnDiskFull.testCorruptionAfterDiskFullDuringMerge\n   [junit4] OK      0.00s | TestIndexWriterOnDiskFull.testImmediateDiskFull\n   [junit4]   2> NOTE: leaving temporary files on disk at: /Users/sarowe/svn/lucene/dev/branches/branch_5x/lucene/build/core/test/J0/temp/lucene.index.TestIndexWriterOnDiskFull_6B36AD57BB5A1779-002\n   [junit4]   2> NOTE: test params are: codec=Asserting(Lucene53): {id=PostingsFormat(name=MockRandom), f=PostingsFormat(name=Memory doPackFST= false), content=PostingsFormat(name=SimpleText)}, docValues:{numericdv=DocValuesFormat(name=Lucene50)}, sim=RandomSimilarityProvider(queryNorm=false,coord=crazy): {id=LM Jelinek-Mercer(0.700000), f=DFR I(ne)3(800.0), content=DFR GL2}, locale=ar_AE, timezone=America/Boa_Vista\n   [junit4]   2> NOTE: Mac OS X 10.10.4 x86_64/Oracle Corporation 1.7.0_71 (64-bit)/cpus=8,threads=1,free=159451480,total=211288064\n   [junit4]   2> NOTE: All tests run in this JVM: [TestIndexWriterOnDiskFull]\n   [junit4] Completed [1/1] in 74.53s, 4 tests, 1 error <<< FAILURES!\n\n\n\nNot sure if they're related, but the most recent changes to this test were made under LUCENE-6579 and LUCENE-6616.",
    "attachments": {},
    "issue_links": {},
    "comments": []
}