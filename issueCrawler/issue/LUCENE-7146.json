{
    "id": "LUCENE-7146",
    "title": "\"Latest SVN\" needs replaced on the website",
    "details": {
        "resolution": "Unresolved",
        "affect_versions": "None",
        "components": [
            "general/website"
        ],
        "labels": "",
        "fix_versions": [],
        "priority": "Major",
        "status": "Open",
        "type": "Bug"
    },
    "description": "Mike ask a little while back on dev@lucene...\n\n\nOn the bottom right of Lucene's index.html we have \"Latest SVN\" but of\ncourse it only displays this last svn commit:\n\n  r1726344 LUCENE-6937: moving trunk from SVN to GIT. (lucene) \u2014 dweiss\n\nDoes anyone know how to convert this to the \"Latest GIT\"?\n\n\n\nThis isn't particularly straight forward, so filing an issue to track it",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "id": "comment-15215153",
            "author": "Hoss Man",
            "date": "2016-03-29T00:31:12+0000",
            "content": "\nQuick summary of how the CMS currently gets that data...\n\n\n\ttemplates/core-sidebar.html & templates/solr-sidebar.html currently have blocks that look like this...\n\n{% if svn %}\n<div id=\"svn\">\n  <h1>Latest SVN</h1>\n  <div class=\"status-item\">\n  {% for e in svn.list %}\n  <div class=\"section-content\">\n    <a class=\"svn\" href=\"http://svn.apache.org/viewvc?revision={{ e.revision }};view=revision\">r{{ e.revision }}</a>\n    {{ e.message|safe|truncatewords_html:20 }} ({{\n    e.projects|safe }}) &mdash;\n    <a href=\"http://people.apache.org/committer-index.html#{{ e.author }}\">{{ e.author }}</a>\n  </div>\n{% endfor %}</div></div>\n\n\n\tthe svn variable(s) are populated by some code in lib/path.pm when it detecs that the page is either (core|solr)/index.html...\n\n# there is a similar looking block for solr's index.html\n[qr!core\\/index\\.mdtext$!, main => { template => \"core.html\",\n  preprocess => 1,\n      jira     => ASF::Value::Jira->new(limit => 5,\n                                    url => \"http://s.apache.org/corejira\", localMode => $localMode),\n  svn      => ASF::Value::SVN->new(limit => 5, project => \"/lucene/dev/trunk\",\n                                    localMode => $localMode),\n  coreuser => ASF::Value::Mail->new(list => 'java-user@lucene.apache.org',\n                                        limit => 3,\n                                        localMode => $localMode),\n  dev => ASF::Value::Mail->new(list => 'dev@lucene.apache.org',\n                                          limit => 3, localMode => $localMode),\n\n\n\tthe ASF::Value::SVN package is some ASF CMS custom code that can be found here: https://svn.apache.org/repos/infra/websites/cms/build/lib/ASF/Value/SVN.pm\n\t\n\t\tit uses SVN::Client under the covers\n\t\n\t\n\n\n\n\nA big caveat here, is that unless i'm remembering completely wrong, all of this code is only evaluated when teh site is \"built\" just before it's \"published\" \u2013 once upon a time there was a cron that automatically rebuilt & republished the site once an hour in order to dynamically update content like this, but IIRC we ask infra to disable that for our site because it was anoying, and was pushing out site updates even when we really didn't want it to (like when staging release announcement)\n\n\n\nNow, with all the \"existing\" stuff out of the way, some misc notes on how we could \"fix\" \"Latest SVN\"...\n\n\n\twe could always just choose to completley remove that section from those sidebars\n\tAs you can see in the code snippet above, in addition to ASF::Value::SVN, there are a few other \"ASF::Value::\" modules available to fetch data from ASF sources for sidebars: https://svn.apache.org/repos/infra/websites/cms/build/lib/ASF/Value/\n\t\n\t\tbut none for GIT at the moment\n\t\tand even if there was it wouldn't solve the \"this data will only updated on site publish\" part of the problem\n\t\n\t\n\tthe web based git browser apache is running does have an option to get an ATOM or RSS feed for a repo:\n\t\n\t\thttps://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;a=atom\n\t\tyou can even restrict it by path so we could have distinct sidebar content for lucene and solr\n\t\t\n\t\t\thttps://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;a=atom;f=lucene\n\t\t\thttps://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;a=atom;f=solr\n\t\t\n\t\t\n\t\tby default it seems to constrain to master commits, but we could alternatively restrict to any named branch:\n\t\t\n\t\t\thttps://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;a=atom;h=refs/heads/branch_6x\n\t\t\n\t\t\n\t\n\t\n\twritting our own perl code to fetch these feeds and populate variables for use in our sidebar templates would be fairly straight forward\n\t\n\t\tthe existing ASF::Value::Blog class could almost be used as-is for this, except it's hard coded to only work with the blog.apache.org domain.\n\t\n\t\n\tone option to completely bypass the \"this data will only updated on site publish\" part of the problem would be to switch to a javascript solution for fetching the data\n\t\n\t\tmy understanding of using javascript for this however is that it would require git-wip-us.apache.org to provide a Access-Control-Allow-Origin: * or Access-Control-Allow-Origin: *.apache.org header when serving these feeds \u2013 something not currently done.\n\t\tit's possible infra might be willing to configure the webserver on git-wip-us.apache.org to add this, but i have no idea if there would be objections to that \u2013 or to the subsequent load on that webserver (one ATOM feed request for ever index.html page view)\n\t\n\t\n\n\n "
        }
    ]
}