{
    "id": "SOLR-9428",
    "title": "TestManagedSchemaAPI Objects not released test failures",
    "details": {
        "components": [],
        "type": "Bug",
        "labels": "",
        "fix_versions": [],
        "affect_versions": "None",
        "status": "Open",
        "resolution": "Unresolved",
        "priority": "Major"
    },
    "description": "I've seen quite a few jenkins failures of this nature : ObjectTracker found 1 object(s) that were not released!!! [MockDirectoryWrapper]\n\n\nHere are the symptoms - \n\n\n[junit4]   2> 3000951 ERROR (Thread-4650) [n:127.0.0.1:49362_solr c:testschemaapi s:shard1 r:core_node1 x:testschemaapi_shard1_replica2] o.a.s.r.ManagedResourceStorage Failed to get config name for collection testschemaapi due to: org.apache.solr.common.SolrException: Error loading config name for collection testschemaapi\n\n\n - We don't know the root cause\n\nTo start with I am going to put up a patch to display the root cause. We can then figure out whats going wrong",
    "attachments": {
        "build6069.log.zip": "https://issues.apache.org/jira/secure/attachment/12825235/build6069.log.zip",
        "build401.log.zip": "https://issues.apache.org/jira/secure/attachment/12824745/build401.log.zip",
        "SOLR-9428.patch": "https://issues.apache.org/jira/secure/attachment/12824744/SOLR-9428.patch"
    },
    "issue_links": {},
    "comments": [
        {
            "date": "2016-08-21T19:32:52+0000",
            "author": "Varun Thacker",
            "content": "Patch which will log the root cause and a sample Jenkins test failure.\n\nNote : I removed the for collection abc part from the logging as MDC takes care of displaying the collection ",
            "id": "comment-15429864"
        },
        {
            "date": "2016-08-21T19:39:26+0000",
            "author": "ASF subversion and git services",
            "content": "Commit 364a29c0ab151d4e3bf1bebbbbed83b9b1830abb in lucene-solr's branch refs/heads/master from Varun Thacker\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=364a29c ]\n\nSOLR-9428: Improve logging to log root cause ",
            "id": "comment-15429871"
        },
        {
            "date": "2016-08-21T19:40:22+0000",
            "author": "ASF subversion and git services",
            "content": "Commit 141ccdefd0902a2ce6f66073e76782607b75a968 in lucene-solr's branch refs/heads/branch_6x from Varun Thacker\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=141ccde ]\n\nSOLR-9428: Improve logging to log root cause ",
            "id": "comment-15429874"
        },
        {
            "date": "2016-08-21T19:41:25+0000",
            "author": "Varun Thacker",
            "content": "I'll keep an eye out on future failures to help pinpoint the root cause ",
            "id": "comment-15429875"
        },
        {
            "date": "2016-08-24T09:38:53+0000",
            "author": "Varun Thacker",
            "content": "Here is the analysis from build #6069 failure on Jenkins \n\nErrors from the logs\n\n\n   [junit4]   2> 214317 WARN  (Thread-357) [n:127.0.0.1:54085_solr c:testschemaapi s:shard1 r:core_node2 x:testschemaapi_shard1_replica2] o.a.s.c.SolrCores Tried to remove core testschemaapi_shard1_replica2 from pendingCoreOps and it wasn't there. \n   [junit4]   2> 214317 WARN  (Thread-357) [n:127.0.0.1:54085_solr c:testschemaapi s:shard1 r:core_node2 x:testschemaapi_shard1_replica2] o.a.s.c.ZkController listener throws error\n   [junit4]   2> org.apache.solr.common.SolrException: Unable to reload core [testschemaapi_shard1_replica2]\n   [junit4]   2> \tat org.apache.solr.core.CoreContainer.reload(CoreContainer.java:968)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore.lambda$getConfListener$6(SolrCore.java:2578)\n   [junit4]   2> \tat org.apache.solr.cloud.ZkController.lambda$fireEventListeners$3(ZkController.java:2443)\n   [junit4]   2> \tat java.lang.Thread.run(Thread.java:745)\n   [junit4]   2> Caused by: org.apache.solr.common.SolrException: Failed to load config name for collection:testschemaapi due to: \n   [junit4]   2> \tat org.apache.solr.core.SolrCore.<init>(SolrCore.java:815)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore.reload(SolrCore.java:503)\n   [junit4]   2> \tat org.apache.solr.core.CoreContainer.reload(CoreContainer.java:962)\n   [junit4]   2> \t... 3 more\n   [junit4]   2> Caused by: org.apache.solr.common.SolrException: Failed to load config name for collection:testschemaapi due to: \n   [junit4]   2> \tat org.apache.solr.rest.ManagedResourceStorage.newStorageIO(ManagedResourceStorage.java:98)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore.initRestManager(SolrCore.java:2358)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore.<init>(SolrCore.java:791)\n   [junit4]   2> \t... 5 more\n   [junit4]   2> Caused by: org.apache.solr.common.SolrException: Error loading config name for collection testschemaapi\n   [junit4]   2> \tat org.apache.solr.common.cloud.ZkStateReader.readConfigName(ZkStateReader.java:197)\n   [junit4]   2> \tat org.apache.solr.rest.ManagedResourceStorage.newStorageIO(ManagedResourceStorage.java:95)\n   [junit4]   2> \t... 7 more\n   [junit4]   2> Caused by: org.apache.zookeeper.KeeperException$SessionExpiredException: KeeperErrorCode = Session expired for /collections/testschemaapi\n   [junit4]   2> \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:127)\n   [junit4]   2> \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:51)\n   [junit4]   2> \tat org.apache.zookeeper.ZooKeeper.getData(ZooKeeper.java:1155)\n   [junit4]   2> \tat org.apache.solr.common.cloud.SolrZkClient$7.execute(SolrZkClient.java:348)\n   [junit4]   2> \tat org.apache.solr.common.cloud.SolrZkClient$7.execute(SolrZkClient.java:345)\n   [junit4]   2> \tat org.apache.solr.common.cloud.ZkCmdExecutor.retryOperation(ZkCmdExecutor.java:60)\n   [junit4]   2> \tat org.apache.solr.common.cloud.SolrZkClient.getData(SolrZkClient.java:345)\n   [junit4]   2> \tat org.apache.solr.common.cloud.ZkStateReader.readConfigName(ZkStateReader.java:178)\n   [junit4]   2> \t... 8 more\n\n   [junit4]   2> 214302 ERROR (Thread-357) [n:127.0.0.1:54085_solr c:testschemaapi s:shard1 r:core_node2 x:testschemaapi_shard1_replica2] o.a.s.r.ManagedResourceStorage Failed to get config name due to\n   [junit4]   2> org.apache.solr.common.SolrException: Error loading config name for collection testschemaapi\n   [junit4]   2> \tat org.apache.solr.common.cloud.ZkStateReader.readConfigName(ZkStateReader.java:197)\n   [junit4]   2> \tat org.apache.solr.rest.ManagedResourceStorage.newStorageIO(ManagedResourceStorage.java:95)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore.initRestManager(SolrCore.java:2358)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore.<init>(SolrCore.java:791)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore.reload(SolrCore.java:503)\n   [junit4]   2> \tat org.apache.solr.core.CoreContainer.reload(CoreContainer.java:962)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore.lambda$getConfListener$6(SolrCore.java:2578)\n   [junit4]   2> \tat org.apache.solr.cloud.ZkController.lambda$fireEventListeners$3(ZkController.java:2443)\n   [junit4]   2> \tat java.lang.Thread.run(Thread.java:745)\n   [junit4]   2> Caused by: org.apache.zookeeper.KeeperException$SessionExpiredException: KeeperErrorCode = Session expired for /collections/testschemaapi\n   [junit4]   2> \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:127)\n   [junit4]   2> \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:51)\n   [junit4]   2> \tat org.apache.zookeeper.ZooKeeper.getData(ZooKeeper.java:1155)\n   [junit4]   2> \tat org.apache.solr.common.cloud.SolrZkClient$7.execute(SolrZkClient.java:348)\n   [junit4]   2> \tat org.apache.solr.common.cloud.SolrZkClient$7.execute(SolrZkClient.java:345)\n   [junit4]   2> \tat org.apache.solr.common.cloud.ZkCmdExecutor.retryOperation(ZkCmdExecutor.java:60)\n   [junit4]   2> \tat org.apache.solr.common.cloud.SolrZkClient.getData(SolrZkClient.java:345)\n   [junit4]   2> \tat org.apache.solr.common.cloud.ZkStateReader.readConfigName(ZkStateReader.java:178)\n   [junit4]   2> \t... 8 more\n\n\n\nAnd because of the failed error we leak objects\n\n\n      [junit4]   2> 214299 INFO  (SUITE-TestManagedSchemaAPI-seed#[DAD5B4DBB2D62717]-worker) [    ] o.a.s.SolrTestCaseJ4 ###deleteCore\n   [junit4]   2> ObjectTracker found 5 object(s) that were not released!!! [MockDirectoryWrapper, MDCAwareThreadPoolExecutor, MockDirectoryWrapper, MockDirectoryWrapper, TransactionLog]\n   [junit4]   2> org.apache.solr.common.util.ObjectReleaseTracker$ObjectTrackerException\n   [junit4]   2> \tat org.apache.solr.common.util.ObjectReleaseTracker.track(ObjectReleaseTracker.java:42)\n   [junit4]   2> \tat org.apache.solr.core.CachingDirectoryFactory.get(CachingDirectoryFactory.java:347)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore.initSnapshotMetaDataManager(SolrCore.java:426)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore.<init>(SolrCore.java:756)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore.<init>(SolrCore.java:688)\n   [junit4]   2> \tat org.apache.solr.core.CoreContainer.create(CoreContainer.java:860)\n   [junit4]   2> \tat org.apache.solr.core.CoreContainer.create(CoreContainer.java:797)\n   [junit4]   2> \tat org.apache.solr.handler.admin.CoreAdminOperation.lambda$static$0(CoreAdminOperation.java:125)\n   [junit4]   2> \tat org.apache.solr.handler.admin.CoreAdminOperation.execute(CoreAdminOperation.java:1053)\n   [junit4]   2> \tat org.apache.solr.handler.admin.CoreAdminHandler$CallInfo.call(CoreAdminHandler.java:365)\n   [junit4]   2> \tat org.apache.solr.handler.admin.CoreAdminHandler.handleRequestBody(CoreAdminHandler.java:156)\n   [junit4]   2> \tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:154)\n   [junit4]   2> \tat org.apache.solr.servlet.HttpSolrCall.handleAdminRequest(HttpSolrCall.java:659)\n   [junit4]   2> \tat org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:441)\n   [junit4]   2> \tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:257)\n   [junit4]   2> \tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:208)\n   [junit4]   2> \tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676)\n   [junit4]   2> \tat org.apache.solr.client.solrj.embedded.JettySolrRunner$DebugFilter.doFilter(JettySolrRunner.java:111)\n   [junit4]   2> \tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676)\n   [junit4]   2> \tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:581)\n   [junit4]   2> \tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:224)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1160)\n   [junit4]   2> \tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:511)\n   [junit4]   2> \tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1092)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:399)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)\n   [junit4]   2> \tat org.eclipse.jetty.server.Server.handle(Server.java:518)\n   [junit4]   2> \tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:308)\n   [junit4]   2> \tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:244)\n   [junit4]   2> \tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273)\n   [junit4]   2> \tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)\n   [junit4]   2> \tat org.eclipse.jetty.io.ssl.SslConnection.onFillable(SslConnection.java:186)\n   [junit4]   2> \tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273)\n   [junit4]   2> \tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)\n   [junit4]   2> \tat org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)\n   [junit4]   2> \tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceAndRun(ExecuteProduceConsume.java:246)\n   [junit4]   2> \tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:156)\n   [junit4]   2> \tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:654)\n   [junit4]   2> \tat org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:572)\n   [junit4]   2> \tat java.lang.Thread.run(Thread.java:745)\n   [junit4]   2> \n   [junit4]   2> org.apache.solr.common.util.ObjectReleaseTracker$ObjectTrackerException\n   [junit4]   2> \tat org.apache.solr.common.util.ObjectReleaseTracker.track(ObjectReleaseTracker.java:42)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore.<init>(SolrCore.java:711)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore.reload(SolrCore.java:503)\n   [junit4]   2> \tat org.apache.solr.core.CoreContainer.reload(CoreContainer.java:962)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore.lambda$getConfListener$6(SolrCore.java:2578)\n   [junit4]   2> \tat org.apache.solr.cloud.ZkController.lambda$fireEventListeners$3(ZkController.java:2443)\n   [junit4]   2> \tat java.lang.Thread.run(Thread.java:745)\n   [junit4]   2> \n   [junit4]   2> org.apache.solr.common.util.ObjectReleaseTracker$ObjectTrackerException\n   [junit4]   2> \tat org.apache.solr.common.util.ObjectReleaseTracker.track(ObjectReleaseTracker.java:42)\n   [junit4]   2> \tat org.apache.solr.core.CachingDirectoryFactory.get(CachingDirectoryFactory.java:347)\n   [junit4]   2> \tat org.apache.solr.update.SolrIndexWriter.create(SolrIndexWriter.java:63)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore.initIndex(SolrCore.java:586)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore.<init>(SolrCore.java:762)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore.<init>(SolrCore.java:688)\n   [junit4]   2> \tat org.apache.solr.core.CoreContainer.create(CoreContainer.java:860)\n   [junit4]   2> \tat org.apache.solr.core.CoreContainer.create(CoreContainer.java:797)\n   [junit4]   2> \tat org.apache.solr.handler.admin.CoreAdminOperation.lambda$static$0(CoreAdminOperation.java:125)\n   [junit4]   2> \tat org.apache.solr.handler.admin.CoreAdminOperation.execute(CoreAdminOperation.java:1053)\n   [junit4]   2> \tat org.apache.solr.handler.admin.CoreAdminHandler$CallInfo.call(CoreAdminHandler.java:365)\n   [junit4]   2> \tat org.apache.solr.handler.admin.CoreAdminHandler.handleRequestBody(CoreAdminHandler.java:156)\n   [junit4]   2> \tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:154)\n   [junit4]   2> \tat org.apache.solr.servlet.HttpSolrCall.handleAdminRequest(HttpSolrCall.java:659)\n   [junit4]   2> \tat org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:441)\n   [junit4]   2> \tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:257)\n   [junit4]   2> \tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:208)\n   [junit4]   2> \tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676)\n   [junit4]   2> \tat org.apache.solr.client.solrj.embedded.JettySolrRunner$DebugFilter.doFilter(JettySolrRunner.java:111)\n   [junit4]   2> \tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676)\n   [junit4]   2> \tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:581)\n   [junit4]   2> \tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:224)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1160)\n   [junit4]   2> \tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:511)\n   [junit4]   2> \tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1092)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:399)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)\n   [junit4]   2> \tat org.eclipse.jetty.server.Server.handle(Server.java:518)\n   [junit4]   2> \tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:308)\n   [junit4]   2> \tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:244)\n   [junit4]   2> \tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273)\n   [junit4]   2> \tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)\n   [junit4]   2> \tat org.eclipse.jetty.io.ssl.SslConnection.onFillable(SslConnection.java:186)\n   [junit4]   2> \tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273)\n   [junit4]   2> \tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)\n   [junit4]   2> \tat org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)\n   [junit4]   2> \tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceAndRun(ExecuteProduceConsume.java:246)\n   [junit4]   2> \tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:156)\n   [junit4]   2> \tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:654)\n   [junit4]   2> \tat org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:572)\n   [junit4]   2> \tat java.lang.Thread.run(Thread.java:745)\n   [junit4]   2> \n   [junit4]   2> org.apache.solr.common.util.ObjectReleaseTracker$ObjectTrackerException\n   [junit4]   2> \tat org.apache.solr.common.util.ObjectReleaseTracker.track(ObjectReleaseTracker.java:42)\n   [junit4]   2> \tat org.apache.solr.core.CachingDirectoryFactory.get(CachingDirectoryFactory.java:347)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore.getNewIndexDir(SolrCore.java:324)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore.initIndex(SolrCore.java:554)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore.<init>(SolrCore.java:762)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore.<init>(SolrCore.java:688)\n   [junit4]   2> \tat org.apache.solr.core.CoreContainer.create(CoreContainer.java:860)\n   [junit4]   2> \tat org.apache.solr.core.CoreContainer.create(CoreContainer.java:797)\n   [junit4]   2> \tat org.apache.solr.handler.admin.CoreAdminOperation.lambda$static$0(CoreAdminOperation.java:125)\n   [junit4]   2> \tat org.apache.solr.handler.admin.CoreAdminOperation.execute(CoreAdminOperation.java:1053)\n   [junit4]   2> \tat org.apache.solr.handler.admin.CoreAdminHandler$CallInfo.call(CoreAdminHandler.java:365)\n   [junit4]   2> \tat org.apache.solr.handler.admin.CoreAdminHandler.handleRequestBody(CoreAdminHandler.java:156)\n   [junit4]   2> \tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:154)\n   [junit4]   2> \tat org.apache.solr.servlet.HttpSolrCall.handleAdminRequest(HttpSolrCall.java:659)\n   [junit4]   2> \tat org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:441)\n   [junit4]   2> \tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:257)\n   [junit4]   2> \tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:208)\n   [junit4]   2> \tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676)\n   [junit4]   2> \tat org.apache.solr.client.solrj.embedded.JettySolrRunner$DebugFilter.doFilter(JettySolrRunner.java:111)\n   [junit4]   2> \tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676)\n   [junit4]   2> \tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:581)\n   [junit4]   2> \tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:224)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1160)\n   [junit4]   2> \tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:511)\n   [junit4]   2> \tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1092)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:399)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)\n   [junit4]   2> \tat org.eclipse.jetty.server.Server.handle(Server.java:518)\n   [junit4]   2> \tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:308)\n   [junit4]   2> \tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:244)\n   [junit4]   2> \tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273)\n   [junit4]   2> \tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)\n   [junit4]   2> \tat org.eclipse.jetty.io.ssl.SslConnection.onFillable(SslConnection.java:186)\n   [junit4]   2> \tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273)\n   [junit4]   2> \tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)\n   [junit4]   2> \tat org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)\n   [junit4]   2> \tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceAndRun(ExecuteProduceConsume.java:246)\n   [junit4]   2> \tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:156)\n   [junit4]   2> \tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:654)\n   [junit4]   2> \tat org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:572)\n   [junit4]   2> \tat java.lang.Thread.run(Thread.java:745)\n   [junit4]   2> \n   [junit4]   2> org.apache.solr.common.util.ObjectReleaseTracker$ObjectTrackerException\n   [junit4]   2> \tat org.apache.solr.common.util.ObjectReleaseTracker.track(ObjectReleaseTracker.java:42)\n   [junit4]   2> \tat org.apache.solr.update.TransactionLog.<init>(TransactionLog.java:188)\n   [junit4]   2> \tat org.apache.solr.update.UpdateLog.newTransactionLog(UpdateLog.java:344)\n   [junit4]   2> \tat org.apache.solr.update.UpdateLog.ensureLog(UpdateLog.java:857)\n   [junit4]   2> \tat org.apache.solr.update.UpdateLog.add(UpdateLog.java:428)\n   [junit4]   2> \tat org.apache.solr.update.UpdateLog.add(UpdateLog.java:415)\n   [junit4]   2> \tat org.apache.solr.update.DirectUpdateHandler2.doNormalUpdate(DirectUpdateHandler2.java:302)\n   [junit4]   2> \tat org.apache.solr.update.DirectUpdateHandler2.addDoc0(DirectUpdateHandler2.java:214)\n   [junit4]   2> \tat org.apache.solr.update.DirectUpdateHandler2.addDoc(DirectUpdateHandler2.java:169)\n   [junit4]   2> \tat org.apache.solr.update.processor.RunUpdateProcessor.processAdd(RunUpdateProcessorFactory.java:67)\n   [junit4]   2> \tat org.apache.solr.update.processor.UpdateRequestProcessor.processAdd(UpdateRequestProcessor.java:48)\n   [junit4]   2> \tat org.apache.solr.update.processor.DistributedUpdateProcessor.doLocalAdd(DistributedUpdateProcessor.java:939)\n   [junit4]   2> \tat org.apache.solr.update.processor.DistributedUpdateProcessor.versionAdd(DistributedUpdateProcessor.java:1094)\n   [junit4]   2> \tat org.apache.solr.update.processor.DistributedUpdateProcessor.processAdd(DistributedUpdateProcessor.java:720)\n   [junit4]   2> \tat org.apache.solr.update.processor.LogUpdateProcessorFactory$LogUpdateProcessor.processAdd(LogUpdateProcessorFactory.java:103)\n   [junit4]   2> \tat org.apache.solr.handler.loader.JavabinLoader$1.update(JavabinLoader.java:97)\n   [junit4]   2> \tat org.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec$1.readOuterMostDocIterator(JavaBinUpdateRequestCodec.java:179)\n   [junit4]   2> \tat org.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec$1.readIterator(JavaBinUpdateRequestCodec.java:135)\n   [junit4]   2> \tat org.apache.solr.common.util.JavaBinCodec.readVal(JavaBinCodec.java:274)\n   [junit4]   2> \tat org.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec$1.readNamedList(JavaBinUpdateRequestCodec.java:121)\n   [junit4]   2> \tat org.apache.solr.common.util.JavaBinCodec.readVal(JavaBinCodec.java:239)\n   [junit4]   2> \tat org.apache.solr.common.util.JavaBinCodec.unmarshal(JavaBinCodec.java:157)\n   [junit4]   2> \tat org.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec.unmarshal(JavaBinUpdateRequestCodec.java:186)\n   [junit4]   2> \tat org.apache.solr.handler.loader.JavabinLoader.parseAndLoadDocs(JavabinLoader.java:107)\n   [junit4]   2> \tat org.apache.solr.handler.loader.JavabinLoader.load(JavabinLoader.java:54)\n   [junit4]   2> \tat org.apache.solr.handler.UpdateRequestHandler$1.load(UpdateRequestHandler.java:97)\n   [junit4]   2> \tat org.apache.solr.handler.ContentStreamHandlerBase.handleRequestBody(ContentStreamHandlerBase.java:68)\n   [junit4]   2> \tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:154)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore.execute(SolrCore.java:2089)\n   [junit4]   2> \tat org.apache.solr.servlet.HttpSolrCall.execute(HttpSolrCall.java:653)\n   [junit4]   2> \tat org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:460)\n   [junit4]   2> \tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:257)\n   [junit4]   2> \tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:208)\n   [junit4]   2> \tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676)\n   [junit4]   2> \tat org.apache.solr.client.solrj.embedded.JettySolrRunner$DebugFilter.doFilter(JettySolrRunner.java:111)\n   [junit4]   2> \tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676)\n   [junit4]   2> \tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:581)\n   [junit4]   2> \tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:224)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1160)\n   [junit4]   2> \tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:511)\n   [junit4]   2> \tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1092)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:399)\n   [junit4]   2> \tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)\n   [junit4]   2> \tat org.eclipse.jetty.server.Server.handle(Server.java:518)\n   [junit4]   2> \tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:308)\n   [junit4]   2> \tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:244)\n   [junit4]   2> \tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273)\n   [junit4]   2> \tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)\n   [junit4]   2> \tat org.eclipse.jetty.io.ssl.SslConnection.onFillable(SslConnection.java:186)\n   [junit4]   2> \tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273)\n   [junit4]   2> \tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)\n   [junit4]   2> \tat org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)\n   [junit4]   2> \tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceAndRun(ExecuteProduceConsume.java:246)\n   [junit4]   2> \tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:156)\n   [junit4]   2> \tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:654)\n   [junit4]   2> \tat org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:572)\n   [junit4]   2> \tat java.lang.Thread.run(Thread.java:745)\n\n ",
            "id": "comment-15434602"
        },
        {
            "date": "2016-08-25T07:43:18+0000",
            "author": "Varun Thacker",
            "content": "ZkSolrResourceLoader#openResource added retry logic in SOLR-8662 . \n\nWe can add similar retry logic to ZkStateReader#readConfigName or revisit SOLR-8067 . \n\nI'm going to do some research and reply with how I plan on tackling it ",
            "id": "comment-15436431"
        },
        {
            "date": "2017-07-06T07:26:33+0000",
            "author": "Mikhail Khludnev",
            "content": "We can add similar retry logic to ZkStateReader#readConfigName \nYes, please. Unrelated tests fail from time to time with the same reason: Session expired under ZkStateReader.readConfigName\n\n  [beaster]   2> 78020 ERROR (qtp1143534288-61) [n:127.0.0.1:52648_solr c:collection1 s:shard1 r:core_node2 x:collection1_shard1_replica_n2] o.a.s.r.ManagedResourceStorage Failed to get config name due to\n  [beaster]   2> org.apache.solr.common.SolrException: Error loading config name for collection collection1\n  [beaster]   2> \tat org.apache.solr.common.cloud.ZkStateReader.readConfigName(ZkStateReader.java:206)\n  [beaster]   2> \tat org.apache.solr.rest.ManagedResourceStorage.newStorageIO(ManagedResourceStorage.java:95)\n  [beaster]   2> \tat org.apache.solr.core.SolrCore.initRestManager(SolrCore.java:2768)\n  [beaster]   2> \tat org.apache.solr.core.SolrCore.<init>(SolrCore.java:963)\n  [beaster]   2> \tat org.apache.solr.core.SolrCore.<init>(SolrCore.java:843)\n  [beaster]   2> \tat org.apache.solr.core.CoreContainer.create(CoreContainer.java:969)\n...\n  [beaster]   2> Caused by: org.apache.zookeeper.KeeperException$SessionExpiredException: KeeperErrorCode = Session expired for /collections/collection1\n  [beaster]   2> \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:127)\n  [beaster]   2> \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:51)\n  [beaster]   2> \tat org.apache.zookeeper.ZooKeeper.getData(ZooKeeper.java:1212)\n  [beaster]   2> \tat org.apache.solr.common.cloud.SolrZkClient$7.execute(SolrZkClient.java:357)\n  [beaster]   2> \tat org.apache.solr.common.cloud.SolrZkClient$7.execute(SolrZkClient.java:354)\n  [beaster]   2> \tat org.apache.solr.common.cloud.ZkCmdExecutor.retryOperation(ZkCmdExecutor.java:60)\n  [beaster]   2> \tat org.apache.solr.common.cloud.SolrZkClient.getData(SolrZkClient.java:354)\n  [beaster]   2> \tat org.apache.solr.common.cloud.ZkStateReader.readConfigName(ZkStateReader.java:186)\n  [beaster]   2> \t... 40 more\n\n ",
            "id": "comment-16076086"
        }
    ]
}