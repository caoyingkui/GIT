{
    "id": "SOLR-11840",
    "title": "Inconsistencies in the Usage Messages of bin/solr.cmd",
    "details": {
        "labels": "",
        "priority": "Major",
        "components": [],
        "type": "Improvement",
        "fix_versions": [
            "7.4",
            "master (8.0)"
        ],
        "affect_versions": "7.2",
        "resolution": "Fixed",
        "status": "Closed"
    },
    "description": "I noticed a number of errors/problems/peculiarities in the Usage Messages that are displayed when using bin/solr.cmd with the parameter -help.\n\nThe items are listed in no particular order and may be addressed independantly.\n\nTo spot the differences between the Usage Messages of bin/solr and bin/solr.cmd I compiled an extract of the Usage Messages of the two files so that they can be compared using WinMerge or a similar diff tool.\nSee the attached files solr.cmd.txt and solr.txt.\n\nNote that I work on a German Windows 10, therefore some error messages I quote here are in German.\n\n\n\n\tsolr start -help results in a syntax error\nThe special characters '<' and '>' are not escaped.\nThe line 314 must be changed as follows:\n\nCURRENT : ... the default server/<dir>\nSHALL_BE: ... the default server/^<dir^>\n\n\n\n\tsolr auth -help ends is empty\nA goto label ':auth_usage' with the appropriate Usage Messages already exists.\nAt line 266 an additional if-statement is required.\nAlso, a respective if-statement will be required on line 1858.\n\nNEW_CODE: IF \"%SCRIPT_CMD%\"==\"auth\" goto auth_usage\n\n\nSome additional bugs in the section ':auth_usage' must then also be addressed.\nThe special character '|' is not escaped at a number of locations.\nThe lines 568, 569, 570, 577, 580 and 585 must be changed, e.g.\n\nCURRENT : echo Usage: solr auth enable [-type basicAuth] -credentials user:pass [-blockUnknown ^<true|false^>] [-updateIncludeFileOnly ^<true|false^>] [-V]\nSHALL_BE: echo Usage: solr auth enable [-type basicAuth] -credentials user:pass [-blockUnknown ^<true^|false^>] [-updateIncludeFileOnly ^<true^|false^>] [-V]\n\n\nThe empty 'echo' statement (i.e. 'newline') needs the be written with a dot ('echo.') to avoid \"ECHO ist ausgeschaltet (OFF).\" statements.\nThe lines 571, 573, 576, 577, 579, 584, 587, 589, 591, 594 and 596 must be changed:\n\nCURRENT : echo\nSHALL_BE: echo.\n\n\n\n\tsolr -help does not mention the command status\nThe line 271 must be changed as follows:\n\nCURRENT : @echo        where COMMAND is one of: start, stop, restart, healthcheck, create, create_core, create_collection, delete, version, zk, auth, assert\nSHALL_BE: @echo        where COMMAND is one of: start, stop, restart, status, healthcheck, create, create_core, create_collection, delete, version, zk, auth, assert\n\n\n\n\tIn bin/solr.cmd the description of solr start -p port does not mention the STOP_PORT and the RMI_PORT, see line 324 to 326 of bin/solr.\n\necho \"  -p <port>     Specify the port to start the Solr HTTP listener on; default is 8983\"\necho \"                  The specified port (SOLR_PORT) will also be used to determine the stop port\"\necho \"                  STOP_PORT=(\\$SOLR_PORT-1000) and JMX RMI listen port RMI_PORT=(\\$SOLR_PORT+10000). \"\necho \"                  For instance, if you set -p 8985, then the STOP_PORT=7985 and RMI_PORT=18985\"\n\n\n\n\tThe description of solr start -s dir seems to have been revised in bin/solr.cmd but not in bin/solr.\n\n                  on which example is run. The default value is server/solr. If passed a relative dir\n                  validation with the current dir will be done before trying the default server/<dir>\n\n\nvs.\n\n\t\t  \n                  on which example is run. The default value is server/solr. If passed relative dir,\n                  validation with current dir will be done, before trying default server/<dir>\n\n\n\n\tThe description of solr start -t dir is different\n\n  -t dir        Sets the solr.data.home system property, used as root for ^<instance_dir^>/data directories.\n                  If not set, Solr uses solr.solr.home for both config and data.\n\n\nvs.\n\n  -t <dir>      Sets the solr.data.home system property, where Solr will store data (index).\n                  If not set, Solr uses solr.solr.home for config and data.\n\n\n\n\tThe description of solr start -V does not mention -verbose\n\n  -V            Verbose messages from this script\n\n\nvs.\n\n  -V or -verbose Verbose messages from this script\n\n\n\n\tThe syntax of solr stop does not mention the parameter -V\n\nUsage: solr stop [-k key] [-p port]\n\n\nvs.\n\nUsage: solr stop [-k key] [-p port] [-V]\n\n\nNote that there is also no description of -V in bin/solr, even though the parameter is mentioned in the syntax.\n\n\n\tThe description of solr stop does not mention the command status\nThis additional information is present in bin/solr.\n\n  NOTE: To see if any Solr servers are running, do: solr status\n\n\nThis can be added in the section ':stop_usage' at line 352.\n\n\n\tThe syntax of solr healthcheck does not mention the parameter -V\n\nUsage: solr healthcheck [-c collection] [-z zkHost]\n\n\nvs.\n\nUsage: solr healthcheck [-c collection] [-z zkHost] [-V]\n\n\n\n\tThere is no Usage Message for solr status.\nThe command solr status -help does not output any help message, it actually runs the solr status instead.\n\nUsage: solr status\n\n  NOTE: This command will show the status of all running Solr servers\n\n\nA new goto label ':status_usage' is required, probably right after the label ':start_usage'.\nAt line 266 an additional if-statement is required.\nAlso, a respective if-statement will be required on line 1858.\n\n\n\tThe syntax of solr stop -deleteConfig mentions boolean, while everywhere else this is indicated as true|false\n\nUsage: solr delete [-c name] [-deleteConfig boolean] [-p port] [-V]\n\n\nvs.\n\nUsage: solr delete [-c name] [-deleteConfig true|false] [-p port] [-V]\n\n\n\n\tThe description of solr delete -c name is different\nNote: The documentation should say delete, not create a core.\n\n  -c name     Name of core to create\n\n\nvs.\n\n  -c <name>               Name of the core / collection to delete\n\n\n\n\tThe description of solr delete -p port is different\nNote: The documentation should say delete, not create a core.\n\n  -p port     Port of a local Solr instance where you want to create the new core\n\n\nvs.\n\n  -p <port>               Port of a local Solr instance where you want to delete the core/collection\n\n\n\n\tThe description of solr delete -V is spelt differently\n\n  -V            Enable more verbose output.\n\n\nvs.\n\n  -V                      Enables more verbose output.\n\n\n\n\tThe description of solr create_core -c uses a different parameter name\n\nUsage: solr create_core [-c name] [-d confdir] [-p port] [-V]\n  -c name     Name of core to create\n\n\nvs.\n\nUsage: solr create_core [-c core] [-d confdir] [-p port] [-V]\n  -c <core>     Name of core to create\n\n\n\n\tThe description of solr create_collection -c and -n uses a different parameter name\n\nUsage: solr create_collection [-c name] [-d confdir] [-n confname] [-shards #] [-replicationFactor #] [-p port] [-V]\n  -c name               Name of collection to create\n  -d confdir            Configuration directory to copy when creating the new collection, built-in options are:\n\n\nvs.\n\nUsage: solr create_collection [-c collection] [-d confdir] [-n configName] [-shards #] [-replicationFactor #] [-p port] [-V]\n  -c <collection>         Name of collection to create\n  -d <confdir>            Configuration directory to copy when creating the new collection, built-in options are:\n\n\n\n\tThe description of solr create_collection -shards does not mention the default value\n\n  -shards #             Number of shards to split the collection into\n\n\nvs.\n\n  -shards <#>             Number of shards to split the collection into; default is 1\n\n\n\n\tThe description of solr create_collection -replicationFactor does not mention the default value\n\n  -replicationFactor #  Number of copies of each document in the collection\n\n\nvs.\n\n  -replicationFactor <#>  Number of copies of each document in the collection, default is 1 (no replication)\n\n\n\n\tThe description of solr zk cp <src>, <dest> is missing a sentence\n\n             ^<src^>, ^<dest^> : [file:][/]path/to/local/file or zk:/path/to/zk/node\n                             NOTE: ^<src^> and ^<dest^> may both be Zookeeper resources prefixed by 'zk:'\n            When ^<src^> is a zk resource, ^<dest^> may be '.'\n            element of the ^<src^> path will be appended unless ^<src^> also ends in a slash. \n            ^<dest^> may be zk:, which may be useful when using the cp -r form to backup/restore \n\n\nvs.\n\n             <src>, <dest> : [file:][/]path/to/local/file or zk:/path/to/zk/node\n                             NOTE: <src> and <dest> may both be Zookeeper resources prefixed by 'zk:'\n             When <src> is a zk resource, <dest> may be '.'\n             If <dest> ends with '/', then <dest> will be a local folder or parent znode and the last\n             element of the <src> path will be appended unless <src> also ends in a slash. \n             <dest> may be zk:, which may be useful when using the cp -r form to backup/restore \n\n\nAlso, the fullstop here should be at the end of the sentence, not on the next line.\n\n             but 'bin/solr zk cp -r /some/dir/* zk:/ -z localhost:2181' will throw an error\n.\n\n\nThe sentence \"here's an example of backup/restore ...\" should start with a captial letter.\nThe paragraph from \"... the entire zk state.\" to \"... /some/dir/ zk:/ -z localhost:2181'\" has one space too much indentation.\n\n\n\tThe description of solr zk mkroot is different\n\n        mkroot makes a znode in Zookeeper with no data. Can be used to make a path of arbitrary\n\n\nvs.\n\n         mkroot makes a znode on Zookeeper with no data. Can be used to make a path of arbitrary\n\n\n\n\tThe description of solr auth is different\nBasic usage does not mention -type kerberos:\n\nUsage: solr auth enable [-type basicAuth] -credentials user:pass [-blockUnknown ^<true|false^>] [-updateIncludeFileOnly ^<true|false^>] [-V]\n       solr auth enable [-type basicAuth] -prompt ^<true|false^> [-blockUnknown ^<true|false^>] [-updateIncludeFileOnly ^<true|false^>] [-V]\n       solr auth disable [-updateIncludeFileOnly ^<true|false^>] [-V]\n\n\nvs.\n\nUsage: solr auth enable [-type basicAuth] -credentials user:pass [-blockUnknown <true|false>] [-updateIncludeFileOnly <true|false>] [-V]\n       solr auth enable [-type basicAuth] -prompt <true|false> [-blockUnknown <true|false>] [-updateIncludeFileOnly <true|false>] [-V]\n       solr auth enable -type kerberos -config \\\"<kerberos configs>\\\" [-updateIncludeFileOnly <true|false>] [-V]\n       solr auth disable [-updateIncludeFileOnly <true|false>] [-V]\n\n\n\nThe description of the paramter -type is different\n\n  -type ^<type^>                 The authentication mechanism to enable. Defaults to 'basicAuth'.\n\n\nvs.\n\n  -type <type>                           The authentication mechanism (basicAuth or kerberos) to enable. Defaults to 'basicAuth'.\n\n\n\nThe description of the paramter -credentials is different\n\n  -credentials ^<user:pass^>     The username and password of the initial user\n\n\nvs.\n\n  -credentials <user:pass>               The username and password of the initial user. Applicable for basicAuth only.\n\n\n\nThe description of the paramter -config is missing\n\n  -config \\\"<configs>\\\"                    Configuration parameters (Solr startup parameters). Required and applicable only for Kerberos\n\n\n\nThe description of the paramter -blockUnknown is different\n\n                               guide for Basic Authentication for more details.\n\n\nvs.\n\n                                         guide for Basic Authentication for more details. Applicable for basicAuth only.\n\n\n\nThe descriptions of the paramters -updateIncludeFileOnly, -d and -s contain an annoying double quote at the end of the line\n\nThe descriptions of the paramters -d and -s do not escape '<' and '>', resulting in error messages in the command line (note that before fixing the call to ':auth_usage' there is no output at all, see point 2 above).\n\n\nC:\\solr-7.2.0_test\\bin>solr.cmd auth -help\n\nUsage: ... <blablabla> ...\n\n  -updateIncludeFileOnly <true|false>    Only update the solr.in.sh or solr.in.cmd file, and skip actual enabling/disabling\"\n                                         authentication (i.e. don't update security.json)\"\n\n  -z zkHost                    Zookeeper connection string\n\nDas System kann die angegebene Datei nicht finden.\n\nDas System kann die angegebene Datei nicht finden.\n                               configuration files (e.g. basicAuth.conf) would be placed.\"\n\n  -V                           Enable more verbose output",
    "attachments": {
        "solr.cmd.txt": "https://issues.apache.org/jira/secure/attachment/12905449/solr.cmd.txt",
        "SOLR-11840.patch": "https://issues.apache.org/jira/secure/attachment/12908065/SOLR-11840.patch",
        "solr_start_help_Syntaxfehler.png": "https://issues.apache.org/jira/secure/attachment/12905447/solr_start_help_Syntaxfehler.png",
        "solr.txt": "https://issues.apache.org/jira/secure/attachment/12905448/solr.txt"
    },
    "issue_links": {},
    "comments": [
        {
            "date": "2018-01-10T23:24:26+0000",
            "content": "\n\tThe description of solr assert has an incorrect usage message\nThe usage message should describe the syntax for the command, instead it says usage: org.apache.solr.util.SolrCLI.\n\n\n\n\nC:\\solr-7.2.0_test\\bin>solr.cmd assert -help\nusage: org.apache.solr.util.SolrCLI\n -e,--exitcode                 Return an exit code instead of printing\n                               error message on assert fail.\n -help                         Print this message\n -m,--message <message>        Exception message to be used in place of\n                               the default error message\n -R,--not-root                 Asserts that we are NOT the root user\n -r,--root                     Asserts that we are the root user\n -S,--not-started <url>        Asserts that Solr is NOT running on a\n                               certain URL. Default timeout is 1000ms\n -s,--started <url>            Asserts that Solr is running on a certain\n                               URL. Default timeout is 1000ms\n -t,--timeout <ms>             Timeout in ms for commands supporting a\n                               timeout\n -u,--same-user <directory>    Asserts that we run as same user that owns\n                               <directory>\n -verbose                      Generate verbose log messages\n -x,--exists <directory>       Asserts that directory <directory> exists\n -X,--not-exists <directory>   Asserts that directory <directory> does NOT\n                               exist\n\nC:\\solr-7.2.0_test\\bin>\n\n\n\n\nThere is no label ':assert_usage' in bin/solr.cmd.\nApparently the help text for >solr.cmd assert -help instead comes from the Java implementation (see SolrCLI.java line 3398). ",
            "author": "Jakob Furrer",
            "id": "comment-16321330"
        },
        {
            "date": "2018-01-27T13:27:05+0000",
            "content": "Man, this is really thorough feedback, and these can/should definitely be addressed.\n\nThe real root of the problem here though, is that we're maintaining two copies of the same logic, between bin/solr and bin/solr.cmd.  We should fix the inconsistencies you brought up here, but it's just a matter of time and entropy before new inconsistencies slip in.  But we should also pursue fixing the root cause, and moving the logic and help-messages to Java-land, where they can be used on both *nix and Windows.\n\nJust a little plug for my pet project over on SOLR-11206 : )\n\nAnyway, I plan to push up a patch for this shortly, if someone is open to reviewing.\n ",
            "author": "Jason Gerlowski",
            "id": "comment-16342129"
        },
        {
            "date": "2018-01-28T19:17:31+0000",
            "content": " SOLR-11840.patch \n\nAttaching patch addressing the inconsistencies Jakob mentioned above. ",
            "author": "Jason Gerlowski",
            "id": "comment-16342683"
        },
        {
            "date": "2018-04-15T12:38:52+0000",
            "content": "Circling back to this now.  Running tests and will commit later today unless there are other issues. ",
            "author": "Jason Gerlowski",
            "id": "comment-16438688"
        },
        {
            "date": "2018-04-17T02:46:15+0000",
            "content": "Commit 7edfd9c41018f16e7b6af1b58e9983e427eff9de in lucene-solr's branch refs/heads/master from Jason Gerlowski\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7edfd9c ]\n\nSOLR-11840: Fix bin/solr help-text inconsistencies ",
            "author": "ASF subversion and git services",
            "id": "comment-16440296"
        },
        {
            "date": "2018-04-17T03:11:24+0000",
            "content": "Commit 0ccd991fa3b878cb23774216b661614d5426c26d in lucene-solr's branch refs/heads/branch_7x from Jason Gerlowski\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0ccd991 ]\n\nSOLR-11840: Fix bin/solr help-text inconsistencies ",
            "author": "ASF subversion and git services",
            "id": "comment-16440320"
        }
    ]
}