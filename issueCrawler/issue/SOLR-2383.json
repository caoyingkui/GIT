{
    "id": "SOLR-2383",
    "title": "Velocity: Generalize range and date facet display",
    "details": {
        "affect_versions": "None",
        "status": "Closed",
        "fix_versions": [
            "3.4",
            "4.0-ALPHA"
        ],
        "components": [
            "Response Writers"
        ],
        "type": "Bug",
        "priority": "Major",
        "labels": "",
        "resolution": "Fixed"
    },
    "description": "Velocity (/browse) GUI has hardcoded price range facet and a hardcoded manufacturedate_dt date facet. Need general solution which work for any facet.range and facet.date.",
    "attachments": {
        "SOLR-2383-branch_32.patch": "https://issues.apache.org/jira/secure/attachment/12479323/SOLR-2383-branch_32.patch",
        "SOLR-2383-branch_3x.patch": "https://issues.apache.org/jira/secure/attachment/12483886/SOLR-2383-branch_3x.patch",
        "SOLR-2383.patch": "https://issues.apache.org/jira/secure/attachment/12472011/SOLR-2383.patch"
    },
    "issue_links": {},
    "comments": [
        {
            "author": "Jan H\u00f8ydahl",
            "id": "comment-12999711",
            "date": "2011-02-26T03:47:44+0000",
            "content": "Attachd patch fixes generalized display of facet.ranges\n\n\tIterate over all available facet.ranges\n\tUse field name as Display value (capitalized)\n\tFixes bug with wrongly quoted range string\n\tFixes bug where the \"More than..\" was always displayed\n\tDisplays the range label as <from> - <to>\n\n "
        },
        {
            "author": "Jan H\u00f8ydahl",
            "id": "comment-12999713",
            "date": "2011-02-26T03:56:03+0000",
            "content": "Revising patch.\n\nAlso, adds a range facet for popularity field "
        },
        {
            "author": "Jan H\u00f8ydahl",
            "id": "comment-12999814",
            "date": "2011-02-26T18:22:47+0000",
            "content": "This last patch adds the following:\n\n\tSame generic treatment of facet.dates as for facet.range\n\tAdded the gap in plain text to the printout, i.e. prints \"Jan 2006 +1YEAR\" instead of only \"Jan 2006\"\n\tReduced font size of the \"toggle parsed query\" and made it stylable instead of hardcoding a <pre> tag\n\n "
        },
        {
            "author": "Jan H\u00f8ydahl",
            "id": "comment-13001970",
            "date": "2011-03-03T12:07:22+0000",
            "content": "Would appreciate if someone could test out this patch on your own data and test various combinations of facet.range and gaps to see if it is water tight "
        },
        {
            "author": "Jan H\u00f8ydahl",
            "id": "comment-13018549",
            "date": "2011-04-11T20:19:04+0000",
            "content": "Updated to trunk "
        },
        {
            "author": "Yonik Seeley",
            "id": "comment-13018657",
            "date": "2011-04-12T01:03:59+0000",
            "content": "I started to take a look at this, but ran into exceptions due to SOLR-1566 "
        },
        {
            "author": "Yonik Seeley",
            "id": "comment-13020510",
            "date": "2011-04-16T01:20:23+0000",
            "content": "Looking good Jan!\n\nI did notice one issue with the example data:\nthe \"popularity 3-6\" link shows 1 match, but when I click it, I get 6 results.\n\nI believe this is because the faceting is finding (3 <= popularity < 6) while the filter generated by clicking on the link is popularity:[3 TO 6]\nSo I guess the generated filters should generally be of the form popularity:[3 TO 6} ? "
        },
        {
            "author": "Jan H\u00f8ydahl",
            "id": "comment-13020939",
            "date": "2011-04-18T08:17:29+0000",
            "content": "Yonik, you're right. With the new default to have the upper range exclusive, we need to adjust the fq.\n\nThis new patch uses '}' as upper boundary for the filters for both range and date, making the counts correct for the example.\n\nNOTE: I have not attempted to make it smart enough to obey facet.range.include. "
        },
        {
            "author": "Jan H\u00f8ydahl",
            "id": "comment-13034001",
            "date": "2011-05-16T12:58:40+0000",
            "content": "Reopening to add patch for branch 3.2 "
        },
        {
            "author": "Jan H\u00f8ydahl",
            "id": "comment-13034002",
            "date": "2011-05-16T13:00:54+0000",
            "content": "This Velocity enhancement should make it to 3.2.\n\nIn this patch I back-port what was committed for 4.0, with these exceptions:\n\n\tNo pivot facets\n\tEnd range uses ] instead of }\n\n "
        },
        {
            "author": "Robert Muir",
            "id": "comment-13043817",
            "date": "2011-06-03T16:47:13+0000",
            "content": "Bulk move 3.2 -> 3.3 "
        },
        {
            "author": "Jan H\u00f8ydahl",
            "id": "comment-13052410",
            "date": "2011-06-21T07:46:24+0000",
            "content": "3.3 will support the [from TO to} syntax, right? Attempt to get this in for 3.3. Grant? "
        },
        {
            "author": "Jan H\u00f8ydahl",
            "id": "comment-13055264",
            "date": "2011-06-27T01:02:44+0000",
            "content": "This patch (SOLR-2383-branch_3x.patch) works with 3x branch. Ready for commit? "
        },
        {
            "author": "Jan H\u00f8ydahl",
            "id": "comment-13055275",
            "date": "2011-06-27T01:26:15+0000",
            "content": "Moved date facet over to range facet. Fixed popularity facet.\n\nOnly problem now is that 3.x does not have support for exclusive range queries [from TO to} so the count when clicking a range facet is wrong. "
        },
        {
            "author": "Grant Ingersoll",
            "id": "comment-13087011",
            "date": "2011-08-18T13:40:35+0000",
            "content": "Jan, you want to take this one? "
        },
        {
            "author": "Jan H\u00f8ydahl",
            "id": "comment-13096414",
            "date": "2011-09-02T22:15:53+0000",
            "content": "New patch against branch_3x\n\nFixed display of date ranges with correct UTC date format. Improved display of float ranges. Removed date facet macro.\n\nThink this is ready for 3.4, could someone take it for a ride? "
        },
        {
            "author": "Jan H\u00f8ydahl",
            "id": "comment-13096633",
            "date": "2011-09-03T11:09:18+0000",
            "content": "Hmm, found some bugs already, will do another one "
        },
        {
            "author": "Jan H\u00f8ydahl",
            "id": "comment-13096635",
            "date": "2011-09-03T11:21:13+0000",
            "content": "Fixed bug in some ranges, which contained whitespace due to Velocity macro. Also, now always displays date range end as a datemath "
        },
        {
            "author": "Jan H\u00f8ydahl",
            "id": "comment-13097109",
            "date": "2011-09-05T10:19:02+0000",
            "content": "Plan to commit this in a day or two, if no objections "
        },
        {
            "author": "Bill Bell",
            "id": "comment-13097197",
            "date": "2011-09-05T16:22:11+0000",
            "content": "Does this mean the [0 TO 8} will not work?\n\npopularity:[3 TO 6} ?\n\nThanks.\n "
        },
        {
            "author": "Jan H\u00f8ydahl",
            "id": "comment-13097315",
            "date": "2011-09-05T20:34:06+0000",
            "content": "@Bill\nYes, the exclusive upper range syntax [x TO y} only works on 4.0, and I haven't found a good way to emulate the same behaviour in 3.x. This means that you'll sometimes see more hits when clicking a facet than the number presented, being the values exactly on the upper bound. Do you have a suggestion? "
        },
        {
            "author": "Jan H\u00f8ydahl",
            "id": "comment-13097990",
            "date": "2011-09-06T13:24:40+0000",
            "content": "Checked in backport to 3.x "
        },
        {
            "author": "David Smiley",
            "id": "comment-13105839",
            "date": "2011-09-16T04:14:03+0000",
            "content": "Jan,\nTo get around the Solr 3x limitation on not being able to say [x TO y}, you can still do: [x TO y] -y    \nI tell readers about this in the 2nd edition of my Solr book due the end of October. "
        },
        {
            "author": "Jan H\u00f8ydahl",
            "id": "comment-13105955",
            "date": "2011-09-16T09:03:28+0000",
            "content": "David. Thanks for your comment. You are welcome to submit a patch which fixes this in the Velocity templates in 3x - would be nice. "
        },
        {
            "author": "Robert Muir",
            "id": "comment-13106207",
            "date": "2011-09-16T14:48:51+0000",
            "content": "bulk close for 3.4 "
        }
    ]
}