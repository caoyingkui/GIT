{
    "id": "LUCENE-8462",
    "title": "New Arabic snowball stemmer",
    "details": {
        "components": [],
        "status": "Resolved",
        "resolution": "Fixed",
        "fix_versions": [
            "7.6",
            "master (8.0)"
        ],
        "affect_versions": "None",
        "labels": "",
        "priority": "Trivial",
        "type": "Improvement"
    },
    "description": "Added a new Arabic snowball stemmer based on\u00a0https://github.com/snowballstem/snowball/blob/master/algorithms/arabic.sbl\n\nAs well an Arabic test dataset in `TestSnowballVocabData.zip` from the snowball-data\u00a0generated from the input file available here\u00a0https://github.com/snowballstem/snowball-data/tree/master/arabic\n\nhttps://github.com/ibnmalik/golden-corpus-arabic/blob/develop/core/words.txt\n\n\u00a0\n\nIt also updates the\u00a0ant patch-snowball\u00a0target to be compatible with\nthe java classes generated by the last snowball version (tree:\n1964ce688cbeca505263c8f77e16ed923296ce7a). The\u00a0ant patch-snowball\u00a0target\nis retro-compatible with the version of snowball stemmers used in\nlucene 7.x and ignores already patched classes.\n\n\u00a0\n\nLink to the corresponding Github PR:\nhttps://github.com/apache/lucene-solr/pull/449\n\n\u00a0Edited: updated the corpus link, PR link and description",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "id": "comment-16588901",
            "author": "Robert Muir",
            "content": "This change looks great, however i'm wondering if we can produce an alternative vocabulary list for test purposes?\n1. This list is huge. I think it may be autogenerated (morph generation or something). It causes our test data to jump from 2MB to 28MB. In general we just want a simple list to catch us if we introduce some bug. All the other languages combined are 2MB compressed, the arabic one is 26MB compressed...\n2. Unlike all the other snowball test data, this arabic vocabulary list is explicitly labeled as GPL. I'm personally not comfortable committing GPL stuff (even test data .txt files) without asking for more guidance first. But maybe we can avoid this problem since I don't think we want such an enormous list. ",
            "date": "2018-08-22T14:10:08+0000"
        },
        {
            "id": "comment-16588940",
            "author": "Uwe Schindler",
            "content": "I just have one question to Ryadh Dahimene: Was producing the snowball Java file still straightforward using the Snowball tools followed by patching with the special ANT task in our repository - or did you patch the source code on your own (manually)? If there were manual corrections needed, it would be good to update the ant target doing the patching. ",
            "date": "2018-08-22T14:43:37+0000"
        },
        {
            "id": "comment-16588947",
            "author": "Uwe Schindler",
            "content": "I was talking about that one - did you use ant patch-snowball or did you do it manually?:\n\n\n  <target name=\"patch-snowball\" description=\"Patches all snowball programs in '${snowball.programs.dir}' to make them work with MethodHandles\">\n      <fileset id=\"snowball.programs\" dir=\"${snowball.programs.dir}\" includes=\"*Stemmer.java\"/>\n      <replaceregexp match=\"^public class \\w+Stemmer\\b\" replace=\"@SuppressWarnings(&quot;unused&quot;) \\0\" flags=\"m\" encoding=\"UTF-8\">\n        <fileset refid=\"snowball.programs\"/>\n      </replaceregexp>\n      <replaceregexp match=\"private final static \\w+Stemmer methodObject\\b.*$\" replace=\"/* patched */ private static final java.lang.invoke.MethodHandles.Lookup methodObject = java.lang.invoke.MethodHandles.lookup();\" flags=\"m\" encoding=\"UTF-8\">\n        <fileset refid=\"snowball.programs\"/>\n      </replaceregexp>\n      <fixcrlf srcdir=\"${snowball.programs.dir}\" includes=\"*Stemmer.java\" tab=\"remove\" tablength=\"2\" encoding=\"UTF-8\" javafiles=\"yes\" fixlast=\"yes\"/>\n  </target>\n\n ",
            "date": "2018-08-22T14:46:24+0000"
        },
        {
            "id": "comment-16588952",
            "author": "Ryadh Dahimene",
            "content": "Thank you for the quick reply Robert Muir. I understand your\u00a0concerns regarding the\u00a0dataset size as well as the GPL licence. I'll try to look for another lighter and non-GPL dataset and bundle it with the change. ",
            "date": "2018-08-22T14:47:50+0000"
        },
        {
            "id": "comment-16588964",
            "author": "Ryadh Dahimene",
            "content": "Uwe Schindler regarding your question, I've patched the generated source code manually (didn't know about the `ant patch-snowball` approach). ",
            "date": "2018-08-22T14:53:11+0000"
        },
        {
            "id": "comment-16589157",
            "author": "Ryadh Dahimene",
            "content": "I've just\u00a0pushed a new `TestSnowballVocabData.zip` file that includes\u00a0a lighter dataset (1165 words) generated from this input file:\nhttps://github.com/ibnmalik/golden-corpus-arabic/blob/develop/core/words.txt\n\nThe source corpus \"Golden Arabic Corpus\" is licensed\u00a0under a BSD-2 license: https://github.com/ibnmalik/golden-corpus-arabic/blob/develop/LICENSE\n\nI've also included the original BSD-2 LICENSE file in the zip archive under the `arabic/` folder.\n\n\u00a0\n\n\u00a0\n\n\u00a0\n\n\u00a0 ",
            "date": "2018-08-22T17:33:26+0000"
        },
        {
            "id": "comment-16610847",
            "author": "Ryadh Dahimene",
            "content": "Hi Robert Muir,\u00a0what do you think of the new dataset for the test vocabulary? Should I look for other alternatives?\n\nUwe Schindler,\u00a0following your comment I've started looking at the ant\u00a0task `ant patch-snowball`\u00a0 and yes it needs to be updated for the new snowball generated java classes. I will try to work on\u00a0that and submit a\u00a0change on a\u00a0separate issue (I have included it in this same change) ",
            "date": "2018-09-11T16:05:17+0000"
        },
        {
            "id": "comment-16610910",
            "author": "Robert Muir",
            "content": "+1 for the BSD-licensed test data, thank you. ",
            "date": "2018-09-11T16:44:39+0000"
        },
        {
            "id": "comment-16613442",
            "author": "Ryadh Dahimene",
            "content": "I had some time to work on the\u00a0`ant patch-snowball`\u00a0target so I have updated the PR link for this change to\u00a0reflect that. This version of the snowball `ArabicStemmer` was generated using the\u00a0`ant patch-snowball` task.\n\nI've updated the ant task so it is now compatible with\u00a0the last version of snowball (https://github.com/snowballstem/snowball/tree/1964ce688cbeca505263c8f77e16ed923296ce7a). Finally, I have also checked the retro-compatibility of the task with the\u00a0revision 502 of the Tartarus Snowball repository currently used by Lucene.\n\nPS. I'm pretty new to ant so I would love to\u00a0hear some feedback, thanks! ",
            "date": "2018-09-13T12:51:44+0000"
        },
        {
            "id": "comment-16646314",
            "author": "Ryadh Dahimene",
            "content": "Hi lucene team,\nJust a quick summary of the state of this change. In this version, the contributed snowball Arabic Stemmer has been generated using the `ant patch-snowball` task. To achieve that, the ant task has been updated and it is now compatible with the last version of snowball (revision 1964ce688cbeca505263c8f77e16ed923296ce7a) and also retro-compatible with the revision\u00a0of the Snowball repository currently used by Lucene) In my opinion, this change is now ready and will allow users to use the new Arabic snowball stemmer.\n\nIn the longer term view, I believe that it will be better if all the lucene snowball stemmers are synced with the last version of the snowball stemmers (https://github.com/snowballstem/snowball). This will allow a smoother integration of newly added languages as well as the updated ones and will reduce the complexity of the `ant patch-snowball` task. The current version used is based on revision 502 of the Tartarus Snowball repository (https://github.com/snowballstem/snowball/tree/e103b5c257383ee94a96e7fc58cab3c567bf079b) and it is now more than 10 years old.\n\nIt is a wider change in the sense that the impacts have yet to be assessed, but if the team believe that it is relevant and see value in it, I'll be happy to invest some time in this task. ",
            "date": "2018-10-11T11:38:22+0000"
        },
        {
            "id": "comment-16659120",
            "author": "Jim Ferenczi",
            "content": "Uwe Schindler Robert Muir\u00a0it seems that the patch is ready to be merged ? What do you think ? Updating snowball seems like a bigger task so I agree with Ryadh Dahimene that it could be done separately. ",
            "date": "2018-10-22T16:14:36+0000"
        },
        {
            "id": "comment-16664927",
            "author": "Jim Ferenczi",
            "content": "I merged in master and 7x.\n\nThanks Ryadh Dahimene !\n\n\u00a0 ",
            "date": "2018-10-26T09:17:08+0000"
        },
        {
            "id": "comment-16665224",
            "author": "ASF subversion and git services",
            "content": "Commit 4fa99c201493b4c689b68911eb97f4e51ecc9afe in lucene-solr's branch refs/heads/master from Jim Ferenczi\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4fa99c2 ]\n\nLUCENE-8462: Revert ant-patch-snowball modifications.\nThis modifications only worked with the latest version of snowball and were specifically applied to handle the new Arabic stemmer.\nThis change reverts these modifications since they are not compatible with the other stemmer which are created from revision 502. ",
            "date": "2018-10-26T14:03:51+0000"
        },
        {
            "id": "comment-16665240",
            "author": "ASF subversion and git services",
            "content": "Commit c5fcae8fbd9d0f41d82cb42eb2cd92a34e0e0a92 in lucene-solr's branch refs/heads/branch_7x from Jim Ferenczi\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c5fcae8 ]\n\nLUCENE-8462: Revert ant-patch-snowball modifications.\nThis modifications only worked with the latest version of snowball and were specifically applied to handle the new Arabic stemmer.\nThis change reverts these modifications since they are not compatible with the other stemmer which are created from revision 502. ",
            "date": "2018-10-26T14:21:17+0000"
        }
    ]
}