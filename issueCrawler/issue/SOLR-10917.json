{
    "id": "SOLR-10917",
    "title": "Port starvation issue in Luke",
    "details": {
        "labels": "",
        "priority": "Major",
        "components": [
            "Admin UI",
            "SolrCloud"
        ],
        "type": "Bug",
        "fix_versions": [],
        "affect_versions": "6.3",
        "resolution": "Unresolved",
        "status": "Open"
    },
    "description": "If a collection replicated in multiple nodes in a cluster is completely down a request to Luke for that collection can sometimes result in a port starvation issue as the request is handed around the cluster and rejected by each node.\nWe experienced an issue in which 10000 requests were made (3300 per node) in under a second, rendering the entire cluster unresponsive - this required a full restart of all nodes in the cluster to restore service.\n\nLogged connections were all similar to:\n2017-06-19 17:54:51.461 ERROR (qtp606548741-15083) [   ] o.a.s.s.HttpSolrCall null:org.apache.solr.common.SolrException: Error trying to proxy request for url: http://redacted/solr/collection/config\n\tat org.apache.solr.servlet.HttpSolrCall.remoteQuery(HttpSolrCall.java:590)\n\tat org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:444)\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:303)\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:254)\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1668)\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:581)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:548)\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:226)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1160)\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:511)\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1092)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213)\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:119)\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)\n\tat org.eclipse.jetty.server.Server.handle(Server.java:518)\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:308)\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:244)\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273)\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)\n\tat org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceAndRun(ExecuteProduceConsume.java:246)\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:156)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:654)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:572)\n\tat java.lang.Thread.run(Thread.java:748)\nCaused by: org.eclipse.jetty.io.EofException\n\tat org.eclipse.jetty.server.HttpConnection$SendCallback.reset(HttpConnection.java:666)\n\tat org.eclipse.jetty.server.HttpConnection$SendCallback.access$300(HttpConnection.java:630)\n\tat org.eclipse.jetty.server.HttpConnection.send(HttpConnection.java:511)\n\tat org.eclipse.jetty.server.HttpChannel.sendResponse(HttpChannel.java:668)\n\tat org.eclipse.jetty.server.HttpChannel.write(HttpChannel.java:722)\n\tat org.eclipse.jetty.server.HttpOutput.write(HttpOutput.java:179)\n\tat org.eclipse.jetty.server.HttpOutput.write(HttpOutput.java:163)\n\tat org.eclipse.jetty.server.HttpOutput.write(HttpOutput.java:415)\n\tat org.apache.commons.io.IOUtils.copyLarge(IOUtils.java:2147)\n\tat org.apache.commons.io.IOUtils.copy(IOUtils.java:2102)\n\tat org.apache.commons.io.IOUtils.copyLarge(IOUtils.java:2123)\n\tat org.apache.solr.servlet.HttpSolrCall.remoteQuery(HttpSolrCall.java:586)\n\t... 27 more",
    "attachments": {},
    "issue_links": {},
    "comments": []
}