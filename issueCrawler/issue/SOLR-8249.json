{
    "id": "SOLR-8249",
    "title": "OverseerTest failures",
    "details": {
        "components": [],
        "type": "Bug",
        "labels": "",
        "fix_versions": [
            "5.4"
        ],
        "affect_versions": "None",
        "status": "Closed",
        "resolution": "Fixed",
        "priority": "Major"
    },
    "description": "http://jenkins.thetaphi.de/job/Lucene-Solr-trunk-Windows/5377/\n\nThis is related to SOLR-7989 . Ishan Chattopadhyaya we need to fix the testcase",
    "attachments": {
        "test.output": "https://issues.apache.org/jira/secure/attachment/12771290/test.output",
        "SOLR-8249.patch": "https://issues.apache.org/jira/secure/attachment/12771112/SOLR-8249.patch"
    },
    "issue_links": {},
    "comments": [
        {
            "date": "2015-11-06T21:04:34+0000",
            "author": "Ishan Chattopadhyaya",
            "content": "The OverseerTest's testOverseerStatsReset() method sets up Zk, overseer, lets an election happen and at the end of it counts the number of STATE messages sent.\n\nIn SOLR-7989, one extra STATE message is passed in if the replica chosen as the leader was not active. This breaks the test at Jenkins. However, I was not able to reproduce it when I was testing before SOLR-7989 was committed; the reason might be either (a) the replica was active, and hence no extra STATE message was sent, or (b) the assert for STATE messages is being done before the leader election is happening (timing issue).\n\nI propose that we change the test in the following two ways: (a) before the asserts, wait a while for leader election to have happened. (b) instead of checking for number of STATE messages, we can check for number of LEADER messages. ",
            "id": "comment-14994425"
        },
        {
            "date": "2015-11-06T21:06:08+0000",
            "author": "Ishan Chattopadhyaya",
            "content": "I'm testing this patch to see if it works. ",
            "id": "comment-14994426"
        },
        {
            "date": "2015-11-06T21:13:52+0000",
            "author": "Hoss Man",
            "content": "these seeds were both failing on trunk pretty reliably for me...\n\n\nant test  -Dtestcase=OverseerTest -Dtests.method=testOverseerStatsReset -Dtests.seed=7771E2C402B621D6 -Dtests.slow=true -Dtests.locale=en_AU -Dtests.timezone=Brazil/DeNoronha -Dtests.asserts=true -Dtests.file.encoding=Cp1252\n\nant test  -Dtestcase=OverseerTest -Dtests.method=testOverseerStatsReset -Dtests.seed=B3178102A7C387E9 -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=cy_GB -Dtests.timezone=ECT -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1\n\n\n\n...with ishan's patch they both passed for me at least once.  beasting 100 random seeds now. ",
            "id": "comment-14994437"
        },
        {
            "date": "2015-11-06T21:58:03+0000",
            "author": "Ishan Chattopadhyaya",
            "content": "Thanks Hoss.\nMy 150 iteration beasting seems to be fine with that patch.\n\nant beast -Dbeast.iters=150 -Dtestcase=OverseerTest -Dtests.method=testOverseerStatsReset\n\n\n\nIf Hoss' beasting passes too, then Noble Paul can you please review / commit this fix?\nSorry for the trouble! ",
            "id": "comment-14994531"
        },
        {
            "date": "2015-11-06T22:17:09+0000",
            "author": "Hoss Man",
            "content": "Ok ... beasting both of those seeds 100 times each + 100 random seeds has passed for me.\n\nBut looking at the actual patch i'm really not a fan of this approach \u2013 a blanket \"sleep 5 seconds\" seems like a really poor solution to the problem.\n\nIf there is no way to \"watch\" the overseer stats then i think a spin loop with an X second timeout would be a far better solution then a single long sleep...\n\n\n// psuedo-code\ncheckForLeaderStatMaxWaitTime = getCurrentTIme() + X;\nwhile (getCurrentTIme() < checkForLeaderStatMaxWaitTime) {\n  if (0 < overseer.getStats().getSuccessCount(OverseerAction.LEADER.toLower())) {\n    break;\n  }\n  sleep(Y); // where Y is much less then X\n}\nassertEquals(1, (overseer.getStats().getSuccessCount(OverseerAction.LEADER.toLower())));\n\n ",
            "id": "comment-14994561"
        },
        {
            "date": "2015-11-07T03:23:22+0000",
            "author": "Ishan Chattopadhyaya",
            "content": "Thanks Hoss. Thanks makes sense, much neater.\nUpdated the patch. ",
            "id": "comment-14994983"
        },
        {
            "date": "2015-11-08T14:42:33+0000",
            "author": "ASF subversion and git services",
            "content": "Commit 1713231 from Noble Paul in branch 'dev/trunk'\n[ https://svn.apache.org/r1713231 ]\n\nSOLR-8249: Addressing the test failures due to Leader election changes ",
            "id": "comment-14995648"
        },
        {
            "date": "2015-11-08T14:43:49+0000",
            "author": "ASF subversion and git services",
            "content": "Commit 1713232 from Noble Paul in branch 'dev/branches/branch_5x'\n[ https://svn.apache.org/r1713232 ]\n\nSOLR-8249: Addressing the test failures due to Leader election changes ",
            "id": "comment-14995650"
        },
        {
            "date": "2015-11-08T15:21:51+0000",
            "author": "ASF subversion and git services",
            "content": "Commit 1713234 from Noble Paul in branch 'dev/trunk'\n[ https://svn.apache.org/r1713234 ]\n\nSOLR-8249: Addressing the test failures due to Leader election changes ",
            "id": "comment-14995672"
        },
        {
            "date": "2015-11-08T15:22:39+0000",
            "author": "ASF subversion and git services",
            "content": "Commit 1713235 from Noble Paul in branch 'dev/branches/branch_5x'\n[ https://svn.apache.org/r1713235 ]\n\nSOLR-8249: Addressing the test failures due to Leader election changes ",
            "id": "comment-14995673"
        },
        {
            "date": "2015-11-08T19:07:26+0000",
            "author": "Ishan Chattopadhyaya",
            "content": "I thought the last patch (which tested for stats on LEADER operation instead of STATE) would fix the failures. However, this is still failing at Steve's jenkins: http://jenkins.sarowe.net/job/Lucene-Solr-tests-trunk/3627/\n\nHere's the relevant log from that test:\n\n   [junit4]   2> 200957 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[6F0C5F964D692279]) [    ] o.a.s.c.OverseerAutoReplicaFailoverThread Starting OverseerAutoReplicaFailoverThread autoReplicaFailoverWorkLoopDelay=10000 autoReplicaFailoverWaitAfterExpiration=30000 autoReplicaFailoverBadNodeExpiration=60000\n   [junit4]   2> 200957 INFO  (zkCallback-279-thread-2) [    ] o.a.s.c.c.ZkStateReader A live node change: WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/live_nodes, has occurred - updating... (live nodes size: 0)\n   [junit4]   2> 200971 INFO  (OverseerCollectionConfigSetProcessor-94830728503164930-127.0.0.1:50527_solr-n_0000000000) [    ] o.a.s.c.OverseerTaskProcessor Process current queue of overseer operations\n   [junit4]   2> 201010 INFO  (OverseerStateUpdate-94830728503164930-127.0.0.1:50527_solr-n_0000000000) [    ] o.a.s.c.Overseer Starting to work on the main queue\n   [junit4]   2> 201012 INFO  (OverseerStateUpdate-94830728503164930-127.0.0.1:50527_solr-n_0000000000) [    ] o.a.s.c.Overseer processMessage: queueSize: 1, message = {\n   [junit4]   2>   \"operation\":\"state\",\n   [junit4]   2>   \"state\":\"recovering\",\n   [junit4]   2>   \"node_name\":\"node1\",\n   [junit4]   2>   \"core\":\"core1\",\n   [junit4]   2>   \"core_node_name\":\"core_node1\",\n   [junit4]   2>   \"collection\":\"collection1\",\n   [junit4]   2>   \"numShards\":\"1\",\n   [junit4]   2>   \"base_url\":\"http://node1/solr/\"} current state version: 0\n   [junit4]   2> 201012 INFO  (OverseerStateUpdate-94830728503164930-127.0.0.1:50527_solr-n_0000000000) [    ] o.a.s.c.o.ReplicaMutator Update state numShards=1 message={\n   [junit4]   2>   \"operation\":\"state\",\n   [junit4]   2>   \"state\":\"recovering\",\n   [junit4]   2>   \"node_name\":\"node1\",\n   [junit4]   2>   \"core\":\"core1\",\n   [junit4]   2>   \"core_node_name\":\"core_node1\",\n   [junit4]   2>   \"collection\":\"collection1\",\n   [junit4]   2>   \"numShards\":\"1\",\n   [junit4]   2>   \"base_url\":\"http://node1/solr/\"}\n   [junit4]   2> 201012 INFO  (OverseerStateUpdate-94830728503164930-127.0.0.1:50527_solr-n_0000000000) [    ] o.a.s.c.o.ClusterStateMutator building a new cName: collection1\n   [junit4]   2> 201013 INFO  (OverseerStateUpdate-94830728503164930-127.0.0.1:50527_solr-n_0000000000) [    ] o.a.s.c.o.ReplicaMutator Assigning new node to shard shard=shard1\n   [junit4]   2> 201013 INFO  (zkCallback-278-thread-1) [    ] o.a.s.c.c.ZkStateReader A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:/clusterstate.json, has occurred - updating... (live nodes size: 1)\n   [junit4]   2> 201013 INFO  (zkCallback-279-thread-2) [    ] o.a.s.c.c.ZkStateReader A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:/clusterstate.json, has occurred - updating... (live nodes size: 1)\n   [junit4]   2> 201481 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[6F0C5F964D692279]) [    ] o.a.s.c.c.SolrZkClient makePath: /collections/collection1/leader_elect/shard1/election\n   [junit4]   2> 201481 INFO  (zkCallback-278-thread-1) [    ] o.a.s.c.c.ZkStateReader A collections change: WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/collections, has occurred - updating...\n   [junit4]   2> 201481 INFO  (zkCallback-279-thread-2) [    ] o.a.s.c.c.ZkStateReader A collections change: WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/collections, has occurred - updating...\n   [junit4]   2> 201483 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[6F0C5F964D692279]) [    ] o.a.s.c.LeaderElector Joined leadership election with path: /collections/collection1/leader_elect/shard1/election/94830728503164931-node1_core1-n_0000000000\n   [junit4]   2> 201483 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[6F0C5F964D692279]) [    ] o.a.s.c.c.SolrZkClient makePath: /collections/collection1/leaders/shard1\n   [junit4]   2> 201484 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[6F0C5F964D692279]) [    ] o.a.s.c.ShardLeaderElectionContextBase Creating leader registration node\n   [junit4]   2> 201486 INFO  (OverseerStateUpdate-94830728503164930-127.0.0.1:50527_solr-n_0000000000) [    ] o.a.s.c.Overseer processMessage: queueSize: 1, message = {\n   [junit4]   2>   \"operation\":\"state\",\n   [junit4]   2>   \"state\":\"active\",\n   [junit4]   2>   \"shard\":\"shard1\",\n   [junit4]   2>   \"collection\":\"collection1\",\n   [junit4]   2>   \"base_url\":\"http://node1/solr/\",\n   [junit4]   2>   \"node_name\":\"node1\",\n   [junit4]   2>   \"core_node_name\":\"core_node1\",\n   [junit4]   2>   \"core\":\"core1\"} current state version: 1\n   [junit4]   2> 201487 INFO  (OverseerStateUpdate-94830728503164930-127.0.0.1:50527_solr-n_0000000000) [    ] o.a.s.c.o.ReplicaMutator Update state numShards=null message={\n   [junit4]   2>   \"operation\":\"state\",\n   [junit4]   2>   \"state\":\"active\",\n   [junit4]   2>   \"shard\":\"shard1\",\n   [junit4]   2>   \"collection\":\"collection1\",\n   [junit4]   2>   \"base_url\":\"http://node1/solr/\",\n   [junit4]   2>   \"node_name\":\"node1\",\n   [junit4]   2>   \"core_node_name\":\"core_node1\",\n   [junit4]   2>   \"core\":\"core1\"}\n   [junit4]   2> 201488 INFO  (OverseerStateUpdate-94830728503164930-127.0.0.1:50527_solr-n_0000000000) [    ] o.a.s.c.Overseer processMessage: queueSize: 1, message = {\n   [junit4]   2>   \"operation\":\"leader\",\n   [junit4]   2>   \"shard\":\"shard1\",\n   [junit4]   2>   \"collection\":\"collection1\",\n   [junit4]   2>   \"base_url\":\"http://node1/solr/\",\n   [junit4]   2>   \"core\":\"core1\"} current state version: 1\n   [junit4]   2> 201489 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[6F0C5F964D692279]) [    ] o.a.s.c.Overseer Overseer (id=94830728503164930-127.0.0.1:50527_solr-n_0000000000) closing\n   [junit4]   2> 201489 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[6F0C5F964D692279]) [    ] o.a.s.c.ElectionContext Canceling election /overseer_elect/election/94830728503164930-127.0.0.1:50527_solr-n_0000000000\n   [junit4]   2> 201490 INFO  (OverseerStateUpdate-94830728503164930-127.0.0.1:50527_solr-n_0000000000) [    ] o.a.s.c.Overseer Overseer Loop exiting : 127.0.0.1:50527_solr\n   [junit4]   2> 201491 INFO  (OverseerExitThread) [    ] o.a.s.c.Overseer I'm exiting , but I'm still the leader\n   [junit4]   2> 201491 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[6F0C5F964D692279]) [    ] o.a.s.c.LeaderElector Joined leadership election with path: /overseer_elect/election/94830728503164930-127.0.0.1:50527_solr-n_0000000001\n   [junit4]   2> 201492 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[6F0C5F964D692279]) [    ] o.a.s.c.OverseerElectionContext I am going to be the leader 127.0.0.1:50527_solr\n   [junit4]   2> 201492 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[6F0C5F964D692279]) [    ] o.a.s.c.c.SolrZkClient makePath: /overseer_elect/leader\n   [junit4]   2> 201492 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[6F0C5F964D692279]) [    ] o.a.s.c.Overseer Overseer (id=94830728503164930-127.0.0.1:50527_solr-n_0000000001) starting\n   [junit4]   2> 201494 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[6F0C5F964D692279]) [    ] o.a.s.c.OverseerAutoReplicaFailoverThread Starting OverseerAutoReplicaFailoverThread autoReplicaFailoverWorkLoopDelay=10000 autoReplicaFailoverWaitAfterExpiration=30000 autoReplicaFailoverBadNodeExpiration=60000\n   [junit4]   2> 201538 INFO  (OverseerStateUpdate-94830728503164930-127.0.0.1:50527_solr-n_0000000001) [    ] o.a.s.c.Overseer Starting to work on the main queue\n   [junit4]   2> 201541 INFO  (OverseerStateUpdate-94830728503164930-127.0.0.1:50527_solr-n_0000000001) [    ] o.a.s.c.Overseer processMessage: workQueueSize: 2, message = {\n   [junit4]   2>   \"operation\":\"state\",\n   [junit4]   2>   \"state\":\"active\",\n   [junit4]   2>   \"shard\":\"shard1\",\n   [junit4]   2>   \"collection\":\"collection1\",\n   [junit4]   2>   \"base_url\":\"http://node1/solr/\",\n   [junit4]   2>   \"node_name\":\"node1\",\n   [junit4]   2>   \"core_node_name\":\"core_node1\",\n   [junit4]   2>   \"core\":\"core1\"}\n   [junit4]   2> 201541 INFO  (OverseerStateUpdate-94830728503164930-127.0.0.1:50527_solr-n_0000000001) [    ] o.a.s.c.o.ReplicaMutator Update state numShards=null message={\n   [junit4]   2>   \"operation\":\"state\",\n   [junit4]   2>   \"state\":\"active\",\n   [junit4]   2>   \"shard\":\"shard1\",\n   [junit4]   2>   \"collection\":\"collection1\",\n   [junit4]   2>   \"base_url\":\"http://node1/solr/\",\n   [junit4]   2>   \"node_name\":\"node1\",\n   [junit4]   2>   \"core_node_name\":\"core_node1\",\n   [junit4]   2>   \"core\":\"core1\"}\n   [junit4]   2> 201541 INFO  (zkCallback-279-thread-2) [    ] o.a.s.c.c.ZkStateReader A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:/clusterstate.json, has occurred - updating... (live nodes size: 1)\n   [junit4]   2> 201541 INFO  (zkCallback-278-thread-1) [    ] o.a.s.c.c.ZkStateReader A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:/clusterstate.json, has occurred - updating... (live nodes size: 1)\n   [junit4]   2> 201542 INFO  (OverseerStateUpdate-94830728503164930-127.0.0.1:50527_solr-n_0000000001) [    ] o.a.s.c.Overseer processMessage: workQueueSize: 2, message = {\n   [junit4]   2>   \"operation\":\"leader\",\n   [junit4]   2>   \"shard\":\"shard1\",\n   [junit4]   2>   \"collection\":\"collection1\",\n   [junit4]   2>   \"base_url\":\"http://node1/solr/\",\n   [junit4]   2>   \"core\":\"core1\"}\n   [junit4]   2> 201542 INFO  (zkCallback-279-thread-2) [    ] o.a.s.c.c.ZkStateReader A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:/clusterstate.json, has occurred - updating... (live nodes size: 1)\n   [junit4]   2> 201542 INFO  (OverseerCollectionConfigSetProcessor-94830728503164930-127.0.0.1:50527_solr-n_0000000001) [    ] o.a.s.c.OverseerTaskProcessor Process current queue of overseer operations\n   [junit4]   2> 201543 INFO  (zkCallback-278-thread-1) [    ] o.a.s.c.c.ZkStateReader A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:/clusterstate.json, has occurred - updating... (live nodes size: 1)\n   [junit4]   2> 201551 INFO  (zkCallback-278-thread-1) [    ] o.a.s.c.c.ZkStateReader A live node change: WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/live_nodes, has occurred - updating... (live nodes size: 1)\n   [junit4]   2> 201551 INFO  (zkCallback-279-thread-2) [    ] o.a.s.c.c.ZkStateReader A live node change: WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/live_nodes, has occurred - updating... (live nodes size: 1)\n\n\n\nThis failed because there was a second leader election (or maybe the overseer queue messages from the first leader election was reprocessed after the overseer was shutdown) between the two asserts. I have not been able to reproduce it myself, but Steve's jenkins is a very fast machine.\n\nNow, I am thinking of changing tack, and switching back to testing for STATE message stats. The problem was initially that because there was a RECOVERING STATE message passed in, the leader election sent in an extra ACTIVE message (owing to SOLR-7989). However, if we send in ACTIVE instead of RECOVERING, there won't be another STATE message sent in during leader election (even if there is a second leader election). This, I think will fix the test. Attaching the patch for this.\n\nI'll seek Steve's help and beast it on his machine to be sure. ",
            "id": "comment-14995755"
        },
        {
            "date": "2015-11-08T19:39:17+0000",
            "author": "Ishan Chattopadhyaya",
            "content": "If someone has any other idea how should I go about changing this test OverseerTest.testOverseerStatsReset() so as to make it work even after the SOLR-7989 fix, it is most welcome. ",
            "id": "comment-14995772"
        },
        {
            "date": "2015-11-09T05:49:04+0000",
            "author": "Steve Rowe",
            "content": "Ishan Chattopadhyaya, I beasted your latest patch against trunk with random seeds, then beasted with the failing seed that was found. I'm attaching test output from a fixed seed - here's the cmdline I used:\n\n\nant beast -Dbeast.iters=100 -Dtests.iters=1 -Dtests.dups=10 -Dtestcase=OverseerTest -Dtests.seed=9D49703E5BEE447B 2>&1 | tee ../../test.output\n\n\n\nThere was a failure on round 6.\n\nI separately beasted unpatched trunk with random seeds and it too had a failure, but that's expected, since my Jenkins has been seeing failures. ",
            "id": "comment-14996065"
        },
        {
            "date": "2015-11-09T06:33:27+0000",
            "author": "Ishan Chattopadhyaya",
            "content": "Thanks Steve! It seems an unrelated test from the same suite failed in your beast.\nThe failing test is testExternalClusterStateChangeBehavior(), which has nothing to do the SOLR-7989 changes. The reason why I think the test failed is because some STATE  messages were sent to the overseer queue and the state of the replica is tested without waiting sufficiently for the messages to have been processed. I'll raise a different patch to fix this.\n\nMeanwhile, Steve, is it please possible to re-run the beast by adding the test method too? -Dtests.method=testOverseerStatsReset ",
            "id": "comment-14996096"
        },
        {
            "date": "2015-11-09T17:49:09+0000",
            "author": "Steve Rowe",
            "content": "I've been running the following, over 5000 iterations each for patched and unpatched trunk, and only had one failure on unpatched - I'll include the log below.  Here's the cmdline I'm using:\n\n\n(for a in {1..1000} ; do ant test -Dtestcase=OverseerTest -Dtests.method=testOverseerStatsReset -Dtests.dups=10 -Dtests.jvms=10 ; done) 2>&1 | tee ../../test.output\n\n\n\nHere's the failure from unpatched trunk:\n\n\n   [junit4] Suite: org.apache.solr.cloud.OverseerTest\n   [junit4]   2> Creating dataDir: /home/sarowe/svn/lucene/dev/trunk/solr/build/solr-core/test/J3/temp/solr.cloud.OverseerTest_D0EFDBDB7BF104A-001/init-core-data-001\n   [junit4]   2> 0    INFO  (SUITE-OverseerTest-seed#[D0EFDBDB7BF104A]-worker) [    ] o.a.s.SolrTestCaseJ4 Randomized ssl (false) and clientAuth (true)\n   [junit4]   2> 69   INFO  (SUITE-OverseerTest-seed#[D0EFDBDB7BF104A]-worker) [    ] o.a.s.SolrTestCaseJ4 ####initCore\n   [junit4]   2> 72   INFO  (SUITE-OverseerTest-seed#[D0EFDBDB7BF104A]-worker) [    ] o.a.s.SolrTestCaseJ4 ####initCore end\n   [junit4]   2> 83   INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.SolrTestCaseJ4 ###Starting testOverseerStatsReset\n   [junit4]   2> 92   INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.ZkTestServer STARTING ZK TEST SERVER\n   [junit4]   2> 105  INFO  (Thread-1) [    ] o.a.s.c.ZkTestServer client port:0.0.0.0/0.0.0.0:0\n   [junit4]   2> 106  INFO  (Thread-1) [    ] o.a.s.c.ZkTestServer Starting server\n   [junit4]   2> 194  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.ZkTestServer start zk server on port:36981\n   [junit4]   2> 213  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient Using default ZkCredentialsProvider\n   [junit4]   2> 245  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.ConnectionManager Waiting for client to connect to ZooKeeper\n   [junit4]   2> 384  INFO  (zkCallback-1-thread-1) [    ] o.a.s.c.c.ConnectionManager Watcher org.apache.solr.common.cloud.ConnectionManager@121063b4 name:ZooKeeperConnection Watcher:127.0.0.1:36981 got event WatchedEvent state:SyncConnected type:None path:null path:null type:None\n   [junit4]   2> 385  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.ConnectionManager Client is connected to ZooKeeper\n   [junit4]   2> 386  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient Using default ZkACLProvider\n   [junit4]   2> 414  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient Using default ZkCredentialsProvider\n   [junit4]   2> 415  WARN  (NIOServerCxn.Factory:0.0.0.0/0.0.0.0:0) [    ] o.a.z.s.NIOServerCnxn caught end of stream exception\n   [junit4]   2> EndOfStreamException: Unable to read additional data from client sessionid 0x150ed0c2d8d0000, likely client has closed socket\n   [junit4]   2> \tat org.apache.zookeeper.server.NIOServerCnxn.doIO(NIOServerCnxn.java:228)\n   [junit4]   2> \tat org.apache.zookeeper.server.NIOServerCnxnFactory.run(NIOServerCnxnFactory.java:208)\n   [junit4]   2> \tat java.lang.Thread.run(Thread.java:745)\n   [junit4]   2> 454  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.ConnectionManager Waiting for client to connect to ZooKeeper\n   [junit4]   2> 457  INFO  (zkCallback-2-thread-1) [    ] o.a.s.c.c.ConnectionManager Watcher org.apache.solr.common.cloud.ConnectionManager@4c1e7367 name:ZooKeeperConnection Watcher:127.0.0.1:36981 got event WatchedEvent state:SyncConnected type:None path:null path:null type:None\n   [junit4]   2> 457  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.ConnectionManager Client is connected to ZooKeeper\n   [junit4]   2> 457  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient Using default ZkACLProvider\n   [junit4]   2> 458  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient makePath: /solr\n   [junit4]   2> 467  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient Using default ZkCredentialsProvider\n   [junit4]   2> 468  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.ConnectionManager Waiting for client to connect to ZooKeeper\n   [junit4]   2> 470  INFO  (zkCallback-3-thread-1) [    ] o.a.s.c.c.ConnectionManager Watcher org.apache.solr.common.cloud.ConnectionManager@485ae506 name:ZooKeeperConnection Watcher:127.0.0.1:36981/solr got event WatchedEvent state:SyncConnected type:None path:null path:null type:None\n   [junit4]   2> 470  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.ConnectionManager Client is connected to ZooKeeper\n   [junit4]   2> 470  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient Using default ZkACLProvider\n   [junit4]   2> 488  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient makePath: /live_nodes\n   [junit4]   2> 496  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient makePath: /collections\n   [junit4]   2> 498  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient makePath: /aliases.json\n   [junit4]   2> 500  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient makePath: /clusterstate.json\n   [junit4]   2> 503  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient makePath: /security.json\n   [junit4]   2> 509  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.ZkStateReader Updating cluster state from ZooKeeper... \n   [junit4]   2> 534  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient Using default ZkCredentialsProvider\n   [junit4]   2> 541  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.ConnectionManager Waiting for client to connect to ZooKeeper\n   [junit4]   2> 545  INFO  (zkCallback-4-thread-1) [    ] o.a.s.c.c.ConnectionManager Watcher org.apache.solr.common.cloud.ConnectionManager@3e920eb0 name:ZooKeeperConnection Watcher:127.0.0.1:36981/solr got event WatchedEvent state:SyncConnected type:None path:null path:null type:None\n   [junit4]   2> 547  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.ConnectionManager Client is connected to ZooKeeper\n   [junit4]   2> 547  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient Using default ZkACLProvider\n   [junit4]   2> 550  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.ZkStateReader Updating cluster state from ZooKeeper... \n   [junit4]   2> 552  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient makePath: /live_nodes/node1\n   [junit4]   2> 557  INFO  (zkCallback-4-thread-1) [    ] o.a.s.c.c.ZkStateReader A live node change: WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/live_nodes, has occurred - updating... (live nodes size: 0)\n   [junit4]   2> 561  INFO  (zkCallback-3-thread-1) [    ] o.a.s.c.c.ZkStateReader A live node change: WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/live_nodes, has occurred - updating... (live nodes size: 0)\n   [junit4]   2> 767  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.u.UpdateShardHandler Creating UpdateShardHandler HTTP client with params: socketTimeout=600000&connTimeout=60000&retry=true\n   [junit4]   2> 846  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient makePath: /overseer_elect\n   [junit4]   2> 850  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient makePath: /overseer_elect/election\n   [junit4]   2> 858  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.Overseer Overseer (id=null) closing\n   [junit4]   2> 862  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.LeaderElector Joined leadership election with path: /overseer_elect/election/94836228734386178-127.0.0.1:36981_solr-n_0000000000\n   [junit4]   2> 877  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.OverseerElectionContext I am going to be the leader 127.0.0.1:36981_solr\n   [junit4]   2> 881  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient makePath: /overseer_elect/leader\n   [junit4]   2> 885  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.Overseer Overseer (id=94836228734386178-127.0.0.1:36981_solr-n_0000000000) starting\n   [junit4]   2> 908  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient makePath: /overseer/queue\n   [junit4]   2> 912  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient makePath: /overseer/queue-work\n   [junit4]   2> 929  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient makePath: /overseer/collection-map-failure\n   [junit4]   2> 932  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient makePath: /overseer/collection-map-running\n   [junit4]   2> 935  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient makePath: /overseer/collection-map-completed\n   [junit4]   2> 944  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient makePath: /overseer/collection-queue-work\n   [junit4]   2> 965  INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.OverseerAutoReplicaFailoverThread Starting OverseerAutoReplicaFailoverThread autoReplicaFailoverWorkLoopDelay=10000 autoReplicaFailoverWaitAfterExpiration=30000 autoReplicaFailoverBadNodeExpiration=60000\n   [junit4]   2> 1062 INFO  (OverseerCollectionConfigSetProcessor-94836228734386178-127.0.0.1:36981_solr-n_0000000000) [    ] o.a.s.c.OverseerTaskProcessor Process current queue of overseer operations\n   [junit4]   2> 1079 INFO  (OverseerStateUpdate-94836228734386178-127.0.0.1:36981_solr-n_0000000000) [    ] o.a.s.c.Overseer Starting to work on the main queue\n   [junit4]   2> 1087 INFO  (OverseerStateUpdate-94836228734386178-127.0.0.1:36981_solr-n_0000000000) [    ] o.a.s.c.Overseer processMessage: queueSize: 1, message = {\n   [junit4]   2>   \"operation\":\"state\",\n   [junit4]   2>   \"state\":\"recovering\",\n   [junit4]   2>   \"node_name\":\"node1\",\n   [junit4]   2>   \"core\":\"core1\",\n   [junit4]   2>   \"core_node_name\":\"core_node1\",\n   [junit4]   2>   \"collection\":\"collection1\",\n   [junit4]   2>   \"numShards\":\"1\",\n   [junit4]   2>   \"base_url\":\"http://node1/solr/\"} current state version: 0\n   [junit4]   2> 1094 INFO  (OverseerStateUpdate-94836228734386178-127.0.0.1:36981_solr-n_0000000000) [    ] o.a.s.c.o.ReplicaMutator Update state numShards=1 message={\n   [junit4]   2>   \"operation\":\"state\",\n   [junit4]   2>   \"state\":\"recovering\",\n   [junit4]   2>   \"node_name\":\"node1\",\n   [junit4]   2>   \"core\":\"core1\",\n   [junit4]   2>   \"core_node_name\":\"core_node1\",\n   [junit4]   2>   \"collection\":\"collection1\",\n   [junit4]   2>   \"numShards\":\"1\",\n   [junit4]   2>   \"base_url\":\"http://node1/solr/\"}\n   [junit4]   2> 1095 INFO  (OverseerStateUpdate-94836228734386178-127.0.0.1:36981_solr-n_0000000000) [    ] o.a.s.c.o.ClusterStateMutator building a new cName: collection1\n   [junit4]   2> 1102 INFO  (OverseerStateUpdate-94836228734386178-127.0.0.1:36981_solr-n_0000000000) [    ] o.a.s.c.o.ReplicaMutator Assigning new node to shard shard=shard1\n   [junit4]   2> 1107 INFO  (zkCallback-4-thread-1) [    ] o.a.s.c.c.ZkStateReader A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:/clusterstate.json, has occurred - updating... (live nodes size: 1)\n   [junit4]   2> 1107 INFO  (zkCallback-3-thread-1) [    ] o.a.s.c.c.ZkStateReader A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:/clusterstate.json, has occurred - updating... (live nodes size: 1)\n   [junit4]   2> 1578 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient makePath: /collections/collection1/leader_elect/shard1/election\n   [junit4]   2> 1599 INFO  (zkCallback-3-thread-1) [    ] o.a.s.c.c.ZkStateReader A collections change: WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/collections, has occurred - updating...\n   [junit4]   2> 1599 INFO  (zkCallback-4-thread-1) [    ] o.a.s.c.c.ZkStateReader A collections change: WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/collections, has occurred - updating...\n   [junit4]   2> 1607 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.LeaderElector Joined leadership election with path: /collections/collection1/leader_elect/shard1/election/94836228734386179-node1_core1-n_0000000000\n   [junit4]   2> 1611 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient makePath: /collections/collection1/leaders/shard1\n   [junit4]   2> 1616 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.ShardLeaderElectionContextBase Creating leader registration node\n   [junit4]   2> 1628 INFO  (OverseerStateUpdate-94836228734386178-127.0.0.1:36981_solr-n_0000000000) [    ] o.a.s.c.Overseer processMessage: queueSize: 1, message = {\n   [junit4]   2>   \"operation\":\"state\",\n   [junit4]   2>   \"state\":\"active\",\n   [junit4]   2>   \"shard\":\"shard1\",\n   [junit4]   2>   \"collection\":\"collection1\",\n   [junit4]   2>   \"base_url\":\"http://node1/solr/\",\n   [junit4]   2>   \"node_name\":\"node1\",\n   [junit4]   2>   \"core_node_name\":\"core_node1\",\n   [junit4]   2>   \"core\":\"core1\"} current state version: 1\n   [junit4]   2> 1629 INFO  (OverseerStateUpdate-94836228734386178-127.0.0.1:36981_solr-n_0000000000) [    ] o.a.s.c.o.ReplicaMutator Update state numShards=null message={\n   [junit4]   2>   \"operation\":\"state\",\n   [junit4]   2>   \"state\":\"active\",\n   [junit4]   2>   \"shard\":\"shard1\",\n   [junit4]   2>   \"collection\":\"collection1\",\n   [junit4]   2>   \"base_url\":\"http://node1/solr/\",\n   [junit4]   2>   \"node_name\":\"node1\",\n   [junit4]   2>   \"core_node_name\":\"core_node1\",\n   [junit4]   2>   \"core\":\"core1\"}\n   [junit4]   2> 1646 INFO  (OverseerStateUpdate-94836228734386178-127.0.0.1:36981_solr-n_0000000000) [    ] o.a.s.c.Overseer processMessage: queueSize: 1, message = {\n   [junit4]   2>   \"operation\":\"leader\",\n   [junit4]   2>   \"shard\":\"shard1\",\n   [junit4]   2>   \"collection\":\"collection1\",\n   [junit4]   2>   \"base_url\":\"http://node1/solr/\",\n   [junit4]   2>   \"core\":\"core1\"} current state version: 1\n   [junit4]   2> 1665 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.Overseer Overseer (id=94836228734386178-127.0.0.1:36981_solr-n_0000000000) closing\n   [junit4]   2> 1666 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.ElectionContext Canceling election /overseer_elect/election/94836228734386178-127.0.0.1:36981_solr-n_0000000000\n   [junit4]   2> 1675 INFO  (OverseerStateUpdate-94836228734386178-127.0.0.1:36981_solr-n_0000000000) [    ] o.a.s.c.Overseer Overseer Loop exiting : 127.0.0.1:36981_solr\n   [junit4]   2> 1676 INFO  (zkCallback-3-thread-1) [    ] o.a.s.c.c.ZkStateReader A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:/clusterstate.json, has occurred - updating... (live nodes size: 1)\n   [junit4]   2> 1677 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.LeaderElector Joined leadership election with path: /overseer_elect/election/94836228734386178-127.0.0.1:36981_solr-n_0000000001\n   [junit4]   2> 1677 INFO  (zkCallback-4-thread-1) [    ] o.a.s.c.c.ZkStateReader A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:/clusterstate.json, has occurred - updating... (live nodes size: 1)\n   [junit4]   2> 1682 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.OverseerElectionContext I am going to be the leader 127.0.0.1:36981_solr\n   [junit4]   2> 1683 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.c.SolrZkClient makePath: /overseer_elect/leader\n   [junit4]   2> 1683 INFO  (OverseerExitThread) [    ] o.a.s.c.Overseer I'm exiting , but I'm still the leader\n   [junit4]   2> 1686 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.Overseer Overseer (id=94836228734386178-127.0.0.1:36981_solr-n_0000000001) starting\n   [junit4]   2> 1705 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.OverseerAutoReplicaFailoverThread Starting OverseerAutoReplicaFailoverThread autoReplicaFailoverWorkLoopDelay=10000 autoReplicaFailoverWaitAfterExpiration=30000 autoReplicaFailoverBadNodeExpiration=60000\n   [junit4]   2> 1705 INFO  (OverseerCollectionConfigSetProcessor-94836228734386178-127.0.0.1:36981_solr-n_0000000001) [    ] o.a.s.c.OverseerTaskProcessor Process current queue of overseer operations\n   [junit4]   2> 1706 INFO  (OverseerStateUpdate-94836228734386178-127.0.0.1:36981_solr-n_0000000001) [    ] o.a.s.c.Overseer Starting to work on the main queue\n   [junit4]   2> 1708 INFO  (OverseerStateUpdate-94836228734386178-127.0.0.1:36981_solr-n_0000000001) [    ] o.a.s.c.Overseer processMessage: workQueueSize: 2, message = {\n   [junit4]   2>   \"operation\":\"state\",\n   [junit4]   2>   \"state\":\"active\",\n   [junit4]   2>   \"shard\":\"shard1\",\n   [junit4]   2>   \"collection\":\"collection1\",\n   [junit4]   2>   \"base_url\":\"http://node1/solr/\",\n   [junit4]   2>   \"node_name\":\"node1\",\n   [junit4]   2>   \"core_node_name\":\"core_node1\",\n   [junit4]   2>   \"core\":\"core1\"}\n   [junit4]   2> 1709 INFO  (OverseerStateUpdate-94836228734386178-127.0.0.1:36981_solr-n_0000000001) [    ] o.a.s.c.o.ReplicaMutator Update state numShards=null message={\n   [junit4]   2>   \"operation\":\"state\",\n   [junit4]   2>   \"state\":\"active\",\n   [junit4]   2>   \"shard\":\"shard1\",\n   [junit4]   2>   \"collection\":\"collection1\",\n   [junit4]   2>   \"base_url\":\"http://node1/solr/\",\n   [junit4]   2>   \"node_name\":\"node1\",\n   [junit4]   2>   \"core_node_name\":\"core_node1\",\n   [junit4]   2>   \"core\":\"core1\"}\n   [junit4]   2> 1709 INFO  (zkCallback-3-thread-1) [    ] o.a.s.c.c.ZkStateReader A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:/clusterstate.json, has occurred - updating... (live nodes size: 1)\n   [junit4]   2> 1709 INFO  (zkCallback-4-thread-1) [    ] o.a.s.c.c.ZkStateReader A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:/clusterstate.json, has occurred - updating... (live nodes size: 1)\n   [junit4]   2> 1711 INFO  (OverseerStateUpdate-94836228734386178-127.0.0.1:36981_solr-n_0000000001) [    ] o.a.s.c.Overseer processMessage: workQueueSize: 2, message = {\n   [junit4]   2>   \"operation\":\"leader\",\n   [junit4]   2>   \"shard\":\"shard1\",\n   [junit4]   2>   \"collection\":\"collection1\",\n   [junit4]   2>   \"base_url\":\"http://node1/solr/\",\n   [junit4]   2>   \"core\":\"core1\"}\n   [junit4]   2> 1712 INFO  (zkCallback-3-thread-1) [    ] o.a.s.c.c.ZkStateReader A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:/clusterstate.json, has occurred - updating... (live nodes size: 1)\n   [junit4]   2> 1747 INFO  (zkCallback-3-thread-1) [    ] o.a.s.c.c.ZkStateReader A live node change: WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/live_nodes, has occurred - updating... (live nodes size: 1)\n   [junit4]   2> 1758 INFO  (zkCallback-4-thread-2) [    ] o.a.s.c.c.ZkStateReader A cluster state change: WatchedEvent state:SyncConnected type:NodeDataChanged path:/clusterstate.json, has occurred - updating... (live nodes size: 1)\n   [junit4]   2> 1759 WARN  (zkCallback-4-thread-2) [    ] o.a.s.c.c.ZkStateReader ZooKeeper watch triggered, but Solr cannot talk to ZK\n   [junit4]   2> 1762 ERROR (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]-EventThread) [    ] o.a.z.ClientCnxn Error while calling watcher \n   [junit4]   2> java.util.concurrent.RejectedExecutionException: Task org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor$1@28ba4cca rejected from org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor@6db8d7b9[Shutting down, pool size = 2, active threads = 0, queued tasks = 0, completed tasks = 7]\n   [junit4]   2> \tat java.util.concurrent.ThreadPoolExecutor$AbortPolicy.rejectedExecution(ThreadPoolExecutor.java:2047)\n   [junit4]   2> \tat java.util.concurrent.ThreadPoolExecutor.reject(ThreadPoolExecutor.java:823)\n   [junit4]   2> \tat java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:1369)\n   [junit4]   2> \tat org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.execute(ExecutorUtil.java:214)\n   [junit4]   2> \tat java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:112)\n   [junit4]   2> \tat org.apache.solr.common.cloud.SolrZkClient$3.process(SolrZkClient.java:266)\n   [junit4]   2> \tat org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:522)\n   [junit4]   2> \tat org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:498)\n   [junit4]   2> 1772 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.ZkTestServer connecting to 127.0.0.1:36981 36981\n   [junit4]   2> 1896 INFO  (Thread-1) [    ] o.a.s.c.ZkTestServer connecting to 127.0.0.1:36981 36981\n   [junit4]   2> 1905 WARN  (Thread-1) [    ] o.a.s.c.ZkTestServer Watch limit violations: \n   [junit4]   2> Maximum concurrent create/delete watches above limit:\n   [junit4]   2> \n   [junit4]   2> \t2\t/solr/aliases.json\n   [junit4]   2> \n   [junit4]   2> Maximum concurrent data watches above limit:\n   [junit4]   2> \n   [junit4]   2> \t2\t/solr/clusterstate.json\n   [junit4]   2> \n   [junit4]   2> Maximum concurrent children watches above limit:\n   [junit4]   2> \n   [junit4]   2> \t2\t/solr/live_nodes\n   [junit4]   2> \t2\t/solr/collections\n   [junit4]   2> \t2\t/solr/overseer/collection-queue-work\n   [junit4]   2> \n   [junit4]   2> 1905 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.SolrTestCaseJ4 ###Ending testOverseerStatsReset\n   [junit4]   2> 1916 INFO  (TEST-OverseerTest.testOverseerStatsReset-seed#[D0EFDBDB7BF104A]) [    ] o.a.s.c.Overseer Overseer (id=94836228734386178-127.0.0.1:36981_solr-n_0000000001) closing\n   [junit4]   2> 1916 INFO  (OverseerStateUpdate-94836228734386178-127.0.0.1:36981_solr-n_0000000001) [    ] o.a.s.c.Overseer Overseer Loop exiting : 127.0.0.1:36981_solr\n   [junit4]   2> 1917 ERROR (OverseerExitThread) [    ] o.a.s.c.Overseer could not read the data\n   [junit4]   2> org.apache.zookeeper.KeeperException$SessionExpiredException: KeeperErrorCode = Session expired for /overseer_elect/leader\n   [junit4]   2> \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:127)\n   [junit4]   2> \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:51)\n   [junit4]   2> \tat org.apache.zookeeper.ZooKeeper.getData(ZooKeeper.java:1155)\n   [junit4]   2> \tat org.apache.solr.common.cloud.SolrZkClient$7.execute(SolrZkClient.java:353)\n   [junit4]   2> \tat org.apache.solr.common.cloud.SolrZkClient$7.execute(SolrZkClient.java:350)\n   [junit4]   2> \tat org.apache.solr.common.cloud.ZkCmdExecutor.retryOperation(ZkCmdExecutor.java:61)\n   [junit4]   2> \tat org.apache.solr.common.cloud.SolrZkClient.getData(SolrZkClient.java:350)\n   [junit4]   2> \tat org.apache.solr.cloud.Overseer$ClusterStateUpdater.checkIfIamStillLeader(Overseer.java:304)\n   [junit4]   2> \tat org.apache.solr.cloud.Overseer$ClusterStateUpdater.access$300(Overseer.java:87)\n   [junit4]   2> \tat org.apache.solr.cloud.Overseer$ClusterStateUpdater$2.run(Overseer.java:265)\n   [junit4]   2> NOTE: download the large Jenkins line-docs file by running 'ant get-jenkins-line-docs' in the lucene directory.\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=OverseerTest -Dtests.method=testOverseerStatsReset -Dtests.seed=D0EFDBDB7BF104A -Dtests.slow=true -Dtests.linedocsfile=/home/jenkins/lucene-data/enwiki.random.lines.txt -Dtests.locale=en_IN -Dtests.timezone=Antarctica/McMurdo -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1\n   [junit4] FAILURE 1.85s J3  | OverseerTest.testOverseerStatsReset <<<\n   [junit4]    > Throwable #1: java.lang.AssertionError: expected:<0> but was:<1>\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([D0EFDBDB7BF104A:A65A1A812265B344]:0)\n   [junit4]    > \tat org.apache.solr.cloud.OverseerTest.testOverseerStatsReset(OverseerTest.java:741)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n   [junit4]   2> 4921 INFO  (SUITE-OverseerTest-seed#[D0EFDBDB7BF104A]-worker) [    ] o.a.s.SolrTestCaseJ4 ###deleteCore\n   [junit4]   2> NOTE: leaving temporary files on disk at: /home/sarowe/svn/lucene/dev/trunk/solr/build/solr-core/test/J3/temp/solr.cloud.OverseerTest_D0EFDBDB7BF104A-001\n   [junit4]   2> NOTE: test params are: codec=DummyCompressingStoredFields(storedFieldsFormat=CompressingStoredFieldsFormat(compressionMode=DUMMY, chunkSize=1, maxDocsPerChunk=860, blockSize=7), termVectorsFormat=CompressingTermVectorsFormat(compressionMode=DUMMY, chunkSize=1, blockSize=7)), sim=RandomSimilarityProvider(queryNorm=false,coord=yes): {}, locale=en_IN, timezone=Antarctica/McMurdo\n   [junit4]   2> NOTE: Linux 4.1.0-custom2-amd64 amd64/Oracle Corporation 1.8.0_45 (64-bit)/cpus=16,threads=1,free=423825696,total=514850816\n   [junit4]   2> NOTE: All tests run in this JVM: [OverseerTest]\n   [junit4] Completed [1/10] on J3 in 6.32s, 1 test, 1 failure <<< FAILURES!\n\n\n\nI don't understand why this test fails so frequently when run with other Solr tests, but then so rarely fails when run in isolation - note that unlike standard Solr tests, only one test is being run per JVM with the way I'm running it. ",
            "id": "comment-14996991"
        },
        {
            "date": "2015-11-10T11:38:20+0000",
            "author": "Ishan Chattopadhyaya",
            "content": "Seems like the test stopped failing at Steve's Jenkins.\nhttp://jenkins.sarowe.net/job/Beast-patched-Solr-core-trunk/12/#showFailuresLink\nI think we're good to commit the last patch.\n\nWill take a look at the testExternalClusterStateChangeBehavior test as to why that is failing. I think it is unrelated to SOLR-7989. ",
            "id": "comment-14998440"
        },
        {
            "date": "2015-11-10T13:55:22+0000",
            "author": "Steve Rowe",
            "content": "I think we're good to commit the last patch.\n\n+1\n\nI ran the whole solr-core test suite (the only scenario where I was regularly seeing failures on my box) 25 times with Ishan's latest patch.  The failure rate without the patch was quite a bit higher even after the r1713235 commit on this issue: 7/13 runs on the 5.x/Java8 job, and 3/11 runs on the trunk job. ",
            "id": "comment-14998611"
        },
        {
            "date": "2015-11-10T15:20:09+0000",
            "author": "Steve Rowe",
            "content": "Reopening to apply Ishan's latest patch. ",
            "id": "comment-14998733"
        },
        {
            "date": "2015-11-10T15:28:31+0000",
            "author": "ASF subversion and git services",
            "content": "Commit 1713669 from Steve Rowe in branch 'dev/trunk'\n[ https://svn.apache.org/r1713669 ]\n\nSOLR-8249: Address OverseerTest.testOverseerStatsReset() failures by switching back from testing for stats on the LEADER operation to testing STATE message stats ",
            "id": "comment-14998741"
        },
        {
            "date": "2015-11-10T15:31:40+0000",
            "author": "ASF subversion and git services",
            "content": "Commit 1713670 from Steve Rowe in branch 'dev/branches/branch_5x'\n[ https://svn.apache.org/r1713670 ]\n\nSOLR-8249: Address OverseerTest.testOverseerStatsReset() failures by switching back from testing for stats on the LEADER operation to testing STATE message stats (merged trunk r1713669) ",
            "id": "comment-14998746"
        }
    ]
}