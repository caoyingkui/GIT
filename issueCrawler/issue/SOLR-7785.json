{
    "id": "SOLR-7785",
    "title": "Segments API returning java.lang.IllegalStateException",
    "details": {
        "components": [],
        "type": "Bug",
        "labels": "",
        "fix_versions": [],
        "affect_versions": "5.2.1",
        "status": "Closed",
        "resolution": "Duplicate",
        "priority": "Minor"
    },
    "description": "A call to this URL: http://localhost:8983/solr/images/admin/segments?_=1436792214599&wt=json\n\nperiodically returns the following exception:\n\nERROR - 2015-07-13 12:57:39.962; [   images] org.apache.solr.common.SolrException; null:java.lang.IllegalStateException: file: MMapDirectory@/.....some-path..../images/data/index lockFactory=org.apache.lucene.store.NativeFSLockFactory@76180de2 appears both in delegate and in cache: cache=[_pst.fdx, _pst.fdt, pending_segments_n82, _pst_Lucene50_0.dvd, _pst.si, _pst_Lucene50_0.doc, _pst_Lucene50_0.tim, _pst.fnm, _pst_Lucene50_0.dvm, _pst_Lucene50_0.tip],delegate=[_9no.fdt, _9no.fdx, _9no.fnm, _9no.si, _9no_Lucene50_0.doc, _9no_Lucene50_0.dvd, _9no_Lucene50_0.dvm, _9no_Lucene50_0.tim, _9no_Lucene50_0.tip, _akr.cfe, _akr.cfs, _akr.si, _bkw.fdt, _bkw.fdx, _bkw.fnm, _bkw.si, _bkw_Lucene50_0.doc, _bkw_Lucene50_0.dvd, _bkw_Lucene50_0.dvm, _bkw_Lucene50_0.tim, _bkw_Lucene50_0.tip, _che.cfe, _che.cfs, _che.si, _dg5.fdt, _dg5.fdx, _dg5.fnm, _dg5.si, _dg5_Lucene50_0.doc, _dg5_Lucene50_0.dvd, _dg5_Lucene50_0.dvm, _dg5_Lucene50_0.tim, _dg5_Lucene50_0.tip, _ebj.cfe, _ebj.cfs, _ebj.si, _f8m.cfe, _f8m.cfs, _f8m.si, _gap.cfe, _gap.cfs, _gap.si, _h5j.cfe, _h5j.cfs, _h5j.si, _iao.cfe, _iao.cfs, _iao.si, _j62.cfe, _j62.cfs, _j62.si, _jlm.cfe, _jlm.cfs, _jlm.si, _kha.fdt, _kha.fdx, _kha_Lucene50_0.doc, _kha_Lucene50_0.tim, _kha_Lucene50_0.tip, _led.cfe, _led.cfs, _led.si, _md3.cfe, _md3.cfs, _md3.si, _n8h.cfe, _n8h.cfs, _n8h.si, _nec.cfe, _nec.cfs, _nec.si, _njm.cfe, _njm.cfs, _njm.si, _o77.cfe, _o77.cfs, _o77.si, _od2.cfe, _od2.cfs, _od2.si, _ot5.cfe, _ot5.cfs, _ot5.si, _ox1.cfe, _ox1.cfs, _ox1.si, _oyz.cfe, _oyz.cfs, _oyz.si, _p4u.cfe, _p4u.cfs, _p4u.si, _pa4.cfe, _pa4.cfs, _pa4.si, _peu.cfe, _peu.cfs, _peu.si, _pj0.cfe, _pj0.cfs, _pj0.si, _pm1.cfe, _pm1.cfs, _pm1.si, _poj.cfe, _poj.cfs, _poj.si, _pqh.cfe, _pqh.cfs, _pqh.si, _psf.cfe, _psf.cfs, _psf.si, _psj.fdt, _psj.fdx, _psj.fnm, _psj.si, _psj_Lucene50_0.doc, _psj_Lucene50_0.dvd, _psj_Lucene50_0.dvm, _psj_Lucene50_0.tim, _psj_Lucene50_0.tip, _psk.fdt, _psk.fdx, _psk.fnm, _psk.si, _psk_Lucene50_0.doc, _psk_Lucene50_0.dvd, _psk_Lucene50_0.dvm, _psk_Lucene50_0.tim, _psk_Lucene50_0.tip, _psp.cfe, _psp.cfs, _psp.si, _psq.fdt, _psq.fdx, _psq.fnm, _psq.si, _psq_Lucene50_0.doc, _psq_Lucene50_0.dvd, _psq_Lucene50_0.dvm, _psq_Lucene50_0.tim, _psq_Lucene50_0.tip, _psr.fdt, _psr.fdx, _psr.fnm, _psr.si, _psr_Lucene50_0.doc, _psr_Lucene50_0.dvd, _psr_Lucene50_0.dvm, _psr_Lucene50_0.tim, _psr_Lucene50_0.tip, _pss.fdt, _pss.fdx, _pss.fnm, _pss.si, _pss_Lucene50_0.doc, _pss_Lucene50_0.dvd, _pss_Lucene50_0.dvm, _pss_Lucene50_0.tim, _pss_Lucene50_0.tip, pending_segments_n82, segments_n81, write.lock]\n        at org.apache.lucene.store.NRTCachingDirectory.listAll(NRTCachingDirectory.java:103)\n        at org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.java:641)\n        at org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.java:612)\n        at org.apache.lucene.index.SegmentInfos.readLatestCommit(SegmentInfos.java:442)\n        at org.apache.solr.handler.admin.SegmentsInfoRequestHandler.getSegmentsInfo(SegmentsInfoRequestHandler.java:60)\n        at org.apache.solr.handler.admin.SegmentsInfoRequestHandler.handleRequestBody(SegmentsInfoRequestHandler.java:52)\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:143)\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:2064)\n        at org.apache.solr.servlet.HttpSolrCall.execute(HttpSolrCall.java:654)\n        at org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:450)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:227)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:196)\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1652)\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:585)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)\n        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:577)\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:223)\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1127)\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:515)\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1061)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n        at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:215)\n        at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:110)\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:97)\n        at org.eclipse.jetty.server.Server.handle(Server.java:497)\n        at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:310)\n        at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:257)\n        at org.eclipse.jetty.io.AbstractConnection$2.run(AbstractConnection.java:540)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:635)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:555)\n        at java.lang.Thread.run(Thread.java:745)",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "date": "2015-07-13T13:07:09+0000",
            "author": "Upayavira",
            "content": "This is used by the admin UI segments pane. The angular UI has an \"auto-refresh\" option which is great for watching segments come and go during a bulk update. However, the API sometimes throws an exception.\n\nTo reproduce this error, push a constant stream of new content to Solr, then call the API every second. Before long, you will see the exception. ",
            "id": "comment-14624622"
        },
        {
            "date": "2016-04-07T15:20:55+0000",
            "author": "David Smiley",
            "content": "I think this is a duplicate of LUCENE-7188 (I just moved it from Solr to Lucene), not just a \"relates to\".  There is nothing to be fixed in the SegmentsInfoRequestHandler if the underlying directory throws this exception. ",
            "id": "comment-15230395"
        }
    ]
}