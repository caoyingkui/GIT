{
    "id": "SOLR-7297",
    "title": "GSSException in SolrCloud / Kerberos",
    "details": {
        "components": [
            "SolrCloud"
        ],
        "type": "Bug",
        "labels": "",
        "fix_versions": [],
        "affect_versions": "None",
        "status": "Resolved",
        "resolution": "Invalid",
        "priority": "Major"
    },
    "description": "Some problem with Kerberos authentications in SolrCloud in CDH 5.3.2.\n\nThe problem was appearing after upgrade from CDH 5.3.1\n\nError easy to reproduce by curl (DO NOT ADD DOMAIN to solr host name)\n\nkinit username\ncurl --negotiate -u : http://solrhostnameonly:8983/solr/collection/select?q=x\n\n\n\nWe have 2 Solr instances and the same error happens even when one instance communicates with another.\n\nPossible, the error is in a way, how Solr saves names of live nodes in zookeeper (it saves only host names with no domain). \nAfter upgrade short names (with no domain) are used with Kerberos authentication and no according entry can be found in Kerberos DC.\n\nSolr server logs are full with following errors\n\n2015-03-23 05:50:19,885 WARN org.apache.hadoop.security.authentication.server.AuthenticationFilter: Authentication exception: GSSException: Failure unspecified\nat GSS-API level (Mechanism level: Invalid argument (400) - Cannot find key of appropriate type to decrypt AP REP - RC4 with HMAC)\norg.apache.hadoop.security.authentication.client.AuthenticationException: GSSException: Failure unspecified at GSS-API level (Mechanism level: Invalid argument\n(400) - Cannot find key of appropriate type to decrypt AP REP - RC4 with HMAC)\n        at org.apache.hadoop.security.authentication.server.KerberosAuthenticationHandler.authenticate(KerberosAuthenticationHandler.java:399)\n        at org.apache.hadoop.security.token.delegation.web.DelegationTokenAuthenticationHandler.authenticate(DelegationTokenAuthenticationHandler.java:348)\n        at org.apache.hadoop.security.authentication.server.AuthenticationFilter.doFilter(AuthenticationFilter.java:520)\n        at org.apache.solr.servlet.SolrHadoopAuthenticationFilter.doFilter(SolrHadoopAuthenticationFilter.java:277)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n        at org.apache.solr.servlet.HostnameFilter.doFilter(HostnameFilter.java:86)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:103)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293)\n        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:861)\n        at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:606)\n        at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: GSSException: Failure unspecified at GSS-API level (Mechanism level: Invalid argument (400) - Cannot find key of appropriate type to decrypt AP REP -\n RC4 with HMAC)\n        at sun.security.jgss.krb5.Krb5Context.acceptSecContext(Krb5Context.java:856)\n        at sun.security.jgss.GSSContextImpl.acceptSecContext(GSSContextImpl.java:342)\n        at sun.security.jgss.GSSContextImpl.acceptSecContext(GSSContextImpl.java:285)\n        at sun.security.jgss.spnego.SpNegoContext.GSS_acceptSecContext(SpNegoContext.java:899)\n        at sun.security.jgss.spnego.SpNegoContext.acceptSecContext(SpNegoContext.java:550)\n        at sun.security.jgss.GSSContextImpl.acceptSecContext(GSSContextImpl.java:342)\n        at sun.security.jgss.GSSContextImpl.acceptSecContext(GSSContextImpl.java:285)\n        at org.apache.hadoop.security.authentication.server.KerberosAuthenticationHandler$2.run(KerberosAuthenticationHandler.java:366)\n        at org.apache.hadoop.security.authentication.server.KerberosAuthenticationHandler$2.run(KerberosAuthenticationHandler.java:348)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.security.auth.Subject.doAs(Subject.java:422)\n        at org.apache.hadoop.security.authentication.server.KerberosAuthenticationHandler.authenticate(KerberosAuthenticationHandler.java:348)\n        ... 18 more\nCaused by: KrbException: Invalid argument (400) - Cannot find key of appropriate type to decrypt AP REP - RC4 with HMAC\n        at sun.security.krb5.KrbApReq.authenticate(KrbApReq.java:288)\n        at sun.security.krb5.KrbApReq.<init>(KrbApReq.java:159)\n        at sun.security.jgss.krb5.InitSecContextToken.<init>(InitSecContextToken.java:108)\n        at sun.security.jgss.krb5.Krb5Context.acceptSecContext(Krb5Context.java:829)\n        ... 29 more",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "date": "2015-03-24T22:22:14+0000",
            "author": "Erick Erickson",
            "content": "CDH is a Cloudera product, please raise this issue with Cloudera support rather than raise a Solr JIRA. ",
            "id": "comment-14378785"
        }
    ]
}