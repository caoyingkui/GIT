{
    "id": "LUCENE-552",
    "title": "NPE during mergeSegments",
    "details": {
        "labels": "",
        "priority": "Minor",
        "components": [
            "core/index"
        ],
        "type": "Bug",
        "fix_versions": [],
        "affect_versions": "2.0.0",
        "resolution": "Incomplete",
        "status": "Resolved"
    },
    "description": "The JVM stops with a NPE after running for about 6-8 hours, indexing about 500.000 articles.\nAfter a restart of the JVM, the problematic merge seems to complete OK.\n\nException in thread \"Thread-4\" java.lang.NullPointerException\nat org.apache.lucene.store.RAMInputStream.<init>(RAMInputStream.java:32)\nat org.apache.lucene.store.RAMDirectory.openInput(RAMDirectory.java:171)\nat org.apache.lucene.index.SegmentReader.initialize(SegmentReader.java:155)\nat org.apache.lucene.index.SegmentReader.get(SegmentReader.java:129)\nat org.apache.lucene.index.SegmentReader.get(SegmentReader.java:110)\nat org.apache.lucene.index.IndexWriter.mergeSegments(IndexWriter.java:700)\nat org.apache.lucene.index.IndexWriter.mergeSegments(IndexWriter.java:684)\nat org.apache.lucene.index.IndexWriter.flushRamSegments(IndexWriter.java:654)\nat org.apache.lucene.index.IndexWriter.close(IndexWriter.java:402)\nat com.magentanews.index.IndexManager.insertDocuments(IndexManager.java:190)\nat com.magentanews.index.SplitIndexManager.insertDocuments(SplitIndexManager.java:152)\nat com.magentanews.index.LuceneFeeder.insertDocuments(LuceneFeeder.java:234)\nat com.magentanews.index.IndexerApplication.insertDocuments(IndexerApplication.java:255)\nat com.magentanews.index.IndexerApplication.run(IndexerApplication.java:160)",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "date": "2006-04-25T02:10:34+0000",
            "content": "Can you write a self-contained unit test that demonstrates the bug?  Please attach it to this issue. ",
            "author": "Otis Gospodnetic",
            "id": "comment-12376081"
        },
        {
            "date": "2006-04-27T13:57:50+0000",
            "content": "Occured once more.  Further log details (SRC = rev 396455)\n     ...\n     [java] [GC 537735K->471821K(769088K), 0.0765670 secs]\n     [java] [GC 541005K->475102K(769088K), 0.0767420 secs]\n     [java] [GC 544286K->478897K(769088K), 0.0757440 secs]\n     [java] [GC 548081K->485157K(769088K), 0.1270930 secs]\n     [java] merging segments _17q8 (1 docs) _17q9 (1 docs) _17qa (1 docs) _17qb (1 docs) _17qc (1 docs) _17qd (1 docs) _17qe (1 docs) _17qf (1 docs) _17qg (1 docs) _17qh (1 docs) _17qi (1 docs) _17qj (1 docs) _17qk (1 docs) _17ql (1 docs) _17qm (1 docs) _17qn (1 docs) _17qo (1 docs) _17qp (1 docs) _17qq (1 docs) _17qr (1 docs) _17qs (1 docs) _17qt (1 docs) _17qu (1 docs) _17qv (1 docs) _17qw (1 docs) _17qx (1 docs) _17qy (1 docs) _17qz (1 docs) _17r0 (1 docs) _17r1 (1 docs) _17r2 (1 docs) _17r3 (1 docs) _17r4 (1 docs) _17r5 (1 docs) _17r6 (1 docs) _17r7 (1 docs) _17r8 (1 docs) _17r9 (1 docs) _17ra (1 docs) _17rb (1 docs) _17rc (1 docs) _17rd (1 docs) _17re (1 docs) _17rf (1 docs) _17rg (1 docs) _17rh (1 docs) _17ri (1 docs) _17rj (1 docs) _17rk (1 docs) _17rl (1 docs) _17rm (1 docs) _17rn (1 docs) _17ro (1 docs) _17rp (1 docs) _17rq (1 docs) _17rr (1 docs) _17rs (1 docs) _17rt (1 docs) _17ru (1 docs) _17rv (1 docs) _17rw (1 docs) _17rx (1 docs) _17ry (1 docs) _17rz (1 docs) _17s0 (1 docs) _17s1 (1 docs) _17s2 (1 docs) _17s3 (1 docs) _17s4 (1 docs) _17s5 (1 docs) _17s6 (1 docs) _17s7 (1 docs) _17s8 (1 docs) _17s9 (1 docs) _17sa (1 docs) _17sb (1 docs) _17sc (1 docs) _17sd (1 docs) _17se (1 docs) _17sf (1 docs) _17sg (1 docs) _17sh (1 docs) _17si (1 docs) _17sj (1 docs) _17sk (1 docs) _17sl (1 docs) _17sm (1 docs) _17sn (1 docs) _17so (1 docs) _17sp (1 docs) _17sq (1 docs) _17sr (1 docs) _17ss (1 docs) _17st (1 docs) _17su (1 docs) _17sv (1 docs) _17sw (1 docs) _17sx (1 docs) _17sy (1 docs) _17sz (1 docs) _17t0 (1 docs) _17t1 (1 docs) _17t2 (1 docs) _17t3 (1 docs) _17t4 (1 docs) _17t5 (1 docs) _17t6 (1 docs) _17t7 (1 docs) _17t8 (1 docs) _17t9 (1 docs) _17ta (1 docs) _17tb (1 docs) _17tc (1 docs) _17td (1 docs) _17te (1 docs) _17tf (1 docs) _17tg (1 docs) _17th (1 docs) _17ti (1 docs) _17tj (1 docs) _17tk (1 docs) _17tl (1 docs) _17tm (1 docs) _17tn (1 docs) _17to (1 docs) _17tp (1 docs) _17tq (1 docs) _17tr (1 docs) _17ts (1 docs) _17tt (1 docs) _17tu (1 docs) _17tv (1 docs) _17tw (1 docs) _17tx (1 docs) _17ty (1 docs) _17tz (1 docs) _17u0 (1 docs) _17u1 (1 docs) _17u2 (1 docs) _17u3 (1 docs) _17u4 (1 docs) _17u5 (1 docs) _17u6 (1 docs) _17u7 (1 docs) _17u8 (1 docs) _17u9 (1 docs) _17ua (1 docs) _17ub (1 docs) _17uc (1 docs) _17ud (1 docs) _17ue (1 docs) _17uf (1 docs) _17ug (1 docs) _17uh (1 docs) _17ui (1 docs) _17uj (1 docs) _17uk (1 docs) _17ul (1 docs) _17um (1 docs) _17un (1 docs) _17uo (1 docs) _17up (1 docs) _17uq (1 docs) _17ur (1 docs) _17us (1 docs) _17ut (1 docs) _17uu (1 docs) _17uv (1 docs) _17uw (1 docs) _17ux (1 docs) _17uy (1 docs) _17uz (1 docs) _17v0 (1 docs) _17v1 (1 docs) _17v2 (1 docs) _17v3 (1 docs) _17v4 (1 docs) _17v5 (1 docs) _17v6 (1 docs) _17v7 (1 docs) _17v8 (1 docs) _17v9 (1 docs) _17va (1 docs) _17vb (1 docs) _17vc (1 docs) _17vd (1 docs) _17ve (1 docs) _17vf (1 docs) _17vg (1 docs) _17vh (1 docs) _17vi (1 docs) _17vj (1 docs) _17vk (1 docs) _17vl (1 docs) _17vm (1 docs) _17vn (1 docs) _17vo (1 docs) _17vp (1 docs) _17vq (1 docs) _17vr (1 docs) _17vs (1 docs) _17vt (1 docs) _17vu (1 docs) _17vv (1 docs) _17vw (1 docs) _17vx (1 docs) _17vy (1 docs) _17vz (1 docs) _17w0 (1 docs) _17w1 (1 docs) _17w2 (1 docs) _17w3 (1 docs) _17w4 (1 docs) _17w5 (1 docs) _17w6 (1 docs) _17w7 (1 docs) _17w8 (1 docs) _17w9 (1 docs) _17wa (1 docs) _17wb (1 docs) _17wc (1 docs) _17wd (1 docs) _17we (1 docs) _17wf (1 docs) _17wg (1 docs) _17wh (1 docs) _17wi (1 docs) _17wj (1 docs) _17wk (1 docs) _17wl (1 docs) _17wm (1 docs) _17wn (1 docs) _17wo (1 docs) _17wp (1 docs) _17wq (1 docs) _17wr (1 docs) _17ws (1 docs) _17wt (1 docs) _17wu (1 docs) _17wv (1 docs) _17ww (1 docs) _17wx (1 docs) _17wy (1 docs) _17wz (1 docs) _17x0 (1 docs) _17x1 (1 docs) _17x2 (1 docs) _17x3 (1 docs) _17x4 (1 docs) _17x5 (1 docs) _17x6 (1 docs) _17x7 (1 docs) _17x8 (1 docs) _17x9 (1 docs) _17xa (1 docs) _17xb (1 docs) _17xc (1 docs) _17xd (1 docs) _17xe (1 docs) _17xf (1 docs) _17xg (1 docs) _17xh (1 docs) _17xi (1 docs) _17xj (1 docs) _17xk (1 docs) _17xl (1 docs) _17xm (1 docs) _17xn (1 docs) _17xo (1 docs) _17xp (1 docs) _17xq (1 docs) _17xr (1 docs) _17xs (1 docs) _17xt (1 docs) _17xu (1 docs) _17xv (1 docs) _17xw (1 docs) _17xx (1 docs) _17xy (1 docs) _17xz (1 docs) _17y0 (1 docs) _17y1 (1 docs) _17y2 (1 docs) _17y3 (1 docs) _17y4 (1 docs) _17y5 (1 docs) _17y6 (1 docs) _17y7 (1 docs) _17y8 (1 docs) _17y9 (1 docs) _17ya (1 docs) _17yb (1 docs) _17yc (1 docs) _17yd (1 docs) _17ye (1 docs) _17yf (1 docs) _17yg (1 docs) _17yh (1 docs) _17yi (1 docs) _17yj (1 docs) _17yk (1 docs) _17yl (1 docs) _17ym (1 docs) _17yn (1 docs) _17yo (1 docs) _17yp (1 docs) _17yq (1 docs) _17yr (1 docs) _17ys (1 docs) _17yt (1 docs) _17yu (1 docs) _17yv (1 docs) _17yw (1 docs) _17yx (1 docs) _17yy (1 docs) _17yz (1 docs) _17z0 (1 docs) _17z1 (1 docs) _17z2 (1 docs) _17z3 (1 docs) _17z4 (1 docs) _17z5 (1 docs) _17z6 (1 docs) _17z7 (1 docs) _17z8 (1 docs) _17z9 (1 docs) _17za (1 docs) _17zb (1 docs) _17zc (1 docs) _17zd (1 docs) _17ze (1 docs) _17zf (1 docs) _17zg (1 docs) _17zh (1 docs) _17zi (1 docs) _17zj (1 docs) _17zk (1 docs) _17zl (1 docs) _17zm (1 docs) _17zn (1 docs) _17zo (1 docs) _17zp (1 docs) _17zq (1 docs) _17zr (1 docs) _17zs (1 docs) _17zt (1 docs) _17zu (1 docs) _17zv (1 docs) _17zw (1 docs) _17zx (1 docs) _17zy (1 docs) _17zz (1 docs) _1800 (1 docs) _1801 (1 docs) _1802 (1 docs) _1803 (1 docs) _1804 (1 docs) _1805 (1 docs) _1806 (1 docs) _1807 (1 docs) _1808 (1 docs) _1809 (1 docs) _180a (1 docs) _180b (1 docs) _180c (1 docs) _180d (1 docs) _180e (1 docs) _180f (1 docs) _180g (1 docs) _180h (1 docs) _180i (1 docs) _180j (1 docs) _180k (1 docs) _180l (1 docs) _180m (1 docs) _180n (1 docs) _180o (1 docs) _180p (1 docs) _180q (1 docs) _180r (1 docs) _180s (1 docs) _180t (1 docs) _180u (1 docs) _180v (1 docs) _180w (1 docs) _180x (1 docs) _180y (1 docs) _180z (1 docs) _1810 (1 docs) _1811 (1 docs) _1812 (1 docs) _1813 (1 docs) _1814 (1 docs) _1815 (1 docs) _1816 (1 docs) _1817 (1 docs) _1818 (1 docs) _1819 (1 docs) _181a (1 docs) _181b (1 docs) _181c (1 docs) _181d (1 docs) _181e (1 docs) _181f (1 docs) _181g (1 docs) _181h (1 docs) _181i (1 docs) _181j (1 docs) _181k (1 docs) _181l (1 docs) _181m (1 docs) _181n (1 docs) _181o (1 docs) _181p (1 docs) _181q (1 docs) _181r (1 docs) _181s (1 docs) _181t (1 docs) _181u (1 docs) _181v (1 docs) _181w (1 docs) _181x (1 docs) _181y (1 docs) _181z (1 docs) _1820 (1 docs) _1821 (1 docs) _1822 (1 docs) _1823 (1 docs) _1824 (1 docs) _1825 (1 docs) _1826 (1 docs) _1827 (1 docs) _1828 (1 docs) _1829 (1 docs) _182a (1 docs) _182b (1 docs) _182c (1 docs) _182d (1 docs) _182e (1 docs) _182f (1 docs) _182g (1 docs) _182h (1 docs) _182i (1 docs) _182j (1 docs) _182k (1 docs) _182l (1 docs) _182m (1 docs) _182n (1 docs) _182o (1 docs) _182p (1 docs) _182q (1 docs) _182r (1 docs) _182s (1 docs) _182t (1 docs) _182u (1 docs) _182v (1 docs) _182w (1 docs) _182x (1 docs) _182y (1 docs) _182z (1 docs) _1830 (1 docs) _1831 (1 docs) _1832 (1 docs) _1833 (1 docs) _1834 (1 docs) _1835 (1 docs) _1836 (1 docs) _1837 (1 docs) _1838 (1 docs) _1839 (1 docs) _183a (1 docs) _183b (1 docs) _183c (1 docs) _183d (1 docs) _183e (1 docs) _183f (1 docs) _183g (1 docs) _183h (1 docs) _183i (1 docs) _183j (1 docs) _183k (1 docs) _183l (1 docs) _183m (1 docs) _183n (1 docs) _183o (1 docs) _183p (1 docs) _183q (1 docs) _183r (1 docs) _183s (1 docs) _183t (1 docs) _183u (1 docs) _183v (1 docs) _183w (1 docs) _183x (1 docs) _183y (1 docs) _183z (1 docs) _1840 (1 docs) _1841 (1 docs) _1842 (1 docs) _1843 (1 docs) into _1844 (500 docs)\n     [java] Exception in thread \"Thread-4\" java.lang.NullPointerException\n     [java]     at org.apache.lucene.store.RAMDirectory.fileExists(RAMDirectory.java:110)\n     [java]     at org.apache.lucene.index.SegmentReader.files(SegmentReader.java:253)\n     [java]     at org.apache.lucene.index.IndexWriter.deleteSegments(IndexWriter.java:764)\n     [java]     at org.apache.lucene.index.IndexWriter.access$200(IndexWriter.java:59)\n     [java]     at org.apache.lucene.index.IndexWriter$4.doBody(IndexWriter.java:725)\n     [java]     at org.apache.lucene.store.Lock$With.run(Lock.java:99)\n     [java]     at org.apache.lucene.index.IndexWriter.mergeSegments(IndexWriter.java:722)\n     [java]     at org.apache.lucene.index.IndexWriter.mergeSegments(IndexWriter.java:684)\n     [java]     at org.apache.lucene.index.IndexWriter.flushRamSegments(IndexWriter.java:654)\n     [java]     at org.apache.lucene.index.IndexWriter.close(IndexWriter.java:402)\n     [java]     at com.magentanews.index.IndexManager.insertDocuments(IndexManager.java:194)\n     [java]     at com.magentanews.index.SplitIndexManager.insertDocuments(SplitIndexManager.java:151)\n     [java]     at com.magentanews.index.LuceneFeeder.insertDocuments(LuceneFeeder.java:259)\n     [java]     at com.magentanews.index.IndexerApplication.insertDocuments(IndexerApplication.java:293)\n     [java]     at com.magentanews.index.IndexerApplication.run(IndexerApplication.java:182) ",
            "author": "Ole Kv\u00e6rn\u00f8",
            "id": "comment-12376656"
        },
        {
            "date": "2006-11-10T11:47:03+0000",
            "content": "\nThat second exception is a bit different from the first: the second hits NPE when calling RAMDirectory.fileExists(). This means that the \"files\" member of the RAMDirectory instance is null (looking up the call stack, the \"name\" can't be null).  But, files should not be null unless you are using a version of RAMDirectory at revision 419723 or newer  on the trunk (where RAMDirectory.close() now nulls out its files member).  But that change was comitted on Jul 6 of this year and your exception was before that.\n\nSo I'm very baffled why you see NPE coming out of RAMDirectory.fileExists().  If you shed any more light on what leads to these exceptions or how to reproduce with a small unit test that would be wonderful ",
            "author": "Michael McCandless",
            "id": "comment-12448712"
        },
        {
            "date": "2008-09-22T18:33:07+0000",
            "content": "Need a test case that shows this, or more details. ",
            "author": "Michael McCandless",
            "id": "comment-12633422"
        }
    ]
}