{
    "id": "SOLR-3764",
    "title": "Upgrading to Solr 4 from Solr 3.x doesn't support \"single core\" mode Solr Home dirs (ie: all 3.x examples)",
    "details": {
        "affect_versions": "4.0-ALPHA,                                            4.0-BETA",
        "status": "Closed",
        "fix_versions": [
            "4.0"
        ],
        "components": [],
        "type": "Bug",
        "priority": "Blocker",
        "labels": "",
        "resolution": "Cannot Reproduce"
    },
    "description": "if users were previously using a \"Solr Home\" based on the solr example, and attempt to upgrade to Solr 4 using their existing Solr Home dir, they will get an error because the implicit behavior when no solr.xml file is found seems to be assuming that a \"./collection1\" instanceDir will exist.",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "author": "Hoss Man",
            "id": "comment-13443691",
            "date": "2012-08-29T00:27:16+0000",
            "content": "Steps to reproduce...\n\n1) run the Solr 3.6.1 example and index some data\n2) checkout the 4x branch, and run \"cd solr && ant example && cd example\"\n3) run 4x, pointed to the existing 3.6.1 solr home...\n\n\nhossman@frisbee:~/lucene/4x_dev/solr/example$ java -Dsolr.solr.home=/home/hossman/lucene-3.6.1_tag/solr/example/solr -jar start.jar\n2012-08-28 17:20:01.656:INFO:oejs.Server:jetty-8.1.2.v20120308\n2012-08-28 17:20:01.668:INFO:oejdp.ScanningAppProvider:Deployment monitor /home/hossman/lucene/4x_dev/solr/example/contexts at interval 0\n2012-08-28 17:20:01.671:INFO:oejd.DeploymentManager:Deployable added: /home/hossman/lucene/4x_dev/solr/example/contexts/solr.xml\n2012-08-28 17:20:02.208:INFO:oejw.StandardDescriptorProcessor:NO JSP Support for /solr, did not find org.apache.jasper.servlet.JspServlet\n2012-08-28 17:20:02.225:INFO:oejsh.ContextHandler:started o.e.j.w.WebAppContext{/solr,file:/home/hossman/lucene/4x_dev/solr/example/solr-webapp/webapp/},/home/hossman/lucene/4x_dev/solr/example/webapps/solr.war\n2012-08-28 17:20:02.225:INFO:oejsh.ContextHandler:started o.e.j.w.WebAppContext{/solr,file:/home/hossman/lucene/4x_dev/solr/example/solr-webapp/webapp/},/home/hossman/lucene/4x_dev/solr/example/webapps/solr.war\nAug 28, 2012 5:20:02 PM org.apache.solr.core.SolrResourceLoader locateSolrHome\nINFO: JNDI not configured for solr (NoInitialContextEx)\nAug 28, 2012 5:20:02 PM org.apache.solr.core.SolrResourceLoader locateSolrHome\nINFO: using system property solr.solr.home: /home/hossman/lucene-3.6.1_tag/solr/example/solr\nAug 28, 2012 5:20:02 PM org.apache.solr.core.SolrResourceLoader <init>\nINFO: new SolrResourceLoader for deduced Solr Home: '/home/hossman/lucene-3.6.1_tag/solr/example/solr/'\nAug 28, 2012 5:20:02 PM org.apache.solr.servlet.SolrDispatchFilter init\nINFO: SolrDispatchFilter.init()\nAug 28, 2012 5:20:02 PM org.apache.solr.core.SolrResourceLoader locateSolrHome\nINFO: JNDI not configured for solr (NoInitialContextEx)\nAug 28, 2012 5:20:02 PM org.apache.solr.core.SolrResourceLoader locateSolrHome\nINFO: using system property solr.solr.home: /home/hossman/lucene-3.6.1_tag/solr/example/solr\nAug 28, 2012 5:20:02 PM org.apache.solr.core.CoreContainer$Initializer initialize\nINFO: looking for solr.xml: /home/hossman/lucene-3.6.1_tag/solr/example/solr/solr.xml\nAug 28, 2012 5:20:02 PM org.apache.solr.core.CoreContainer <init>\nINFO: New CoreContainer 420745445\nAug 28, 2012 5:20:02 PM org.apache.solr.core.CoreContainer$Initializer initialize\nINFO: no solr.xml file found - using default\nAug 28, 2012 5:20:02 PM org.apache.solr.core.CoreContainer load\nINFO: Loading CoreContainer using Solr Home: '/home/hossman/lucene-3.6.1_tag/solr/example/solr/'\nAug 28, 2012 5:20:02 PM org.apache.solr.core.SolrResourceLoader <init>\nINFO: new SolrResourceLoader for directory: '/home/hossman/lucene-3.6.1_tag/solr/example/solr/'\nAug 28, 2012 5:20:02 PM org.apache.solr.core.CoreContainer load\nINFO: Registering Log Listener\nAug 28, 2012 5:20:02 PM org.apache.solr.core.CoreContainer create\nINFO: Creating SolrCore 'collection1' using instanceDir: /home/hossman/lucene-3.6.1_tag/solr/example/solr/collection1\nAug 28, 2012 5:20:02 PM org.apache.solr.core.SolrResourceLoader <init>\nINFO: new SolrResourceLoader for directory: '/home/hossman/lucene-3.6.1_tag/solr/example/solr/collection1/'\nAug 28, 2012 5:20:02 PM org.apache.solr.common.SolrException log\nSEVERE: null:java.io.IOException: Can't find resource 'solrconfig.xml' in classpath or '/home/hossman/lucene-3.6.1_tag/solr/example/solr/collection1/conf/', cwd=/home/hossman/lucene/4x_dev/solr/example\n\tat org.apache.solr.core.SolrResourceLoader.openResource(SolrResourceLoader.java:317)\n\tat org.apache.solr.core.SolrResourceLoader.openConfig(SolrResourceLoader.java:283)\n\tat org.apache.solr.core.Config.<init>(Config.java:111)\n\tat org.apache.solr.core.Config.<init>(Config.java:78)\n\tat org.apache.solr.core.SolrConfig.<init>(SolrConfig.java:117)\n\tat org.apache.solr.core.CoreContainer.create(CoreContainer.java:780)\n\tat org.apache.solr.core.CoreContainer.load(CoreContainer.java:539)\n\tat org.apache.solr.core.CoreContainer$Initializer.initialize(CoreContainer.java:312)\n\tat org.apache.solr.servlet.SolrDispatchFilter.init(SolrDispatchFilter.java:106)\n\tat org.eclipse.jetty.servlet.FilterHolder.doStart(FilterHolder.java:114)\n\tat org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:59)\n\tat org.eclipse.jetty.servlet.ServletHandler.initialize(ServletHandler.java:754)\n\tat org.eclipse.jetty.servlet.ServletContextHandler.startContext(ServletContextHandler.java:258)\n\tat org.eclipse.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1221)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doStart(ContextHandler.java:699)\n\tat org.eclipse.jetty.webapp.WebAppContext.doStart(WebAppContext.java:454)\n\tat org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:59)\n\tat org.eclipse.jetty.deploy.bindings.StandardStarter.processBinding(StandardStarter.java:36)\n\tat org.eclipse.jetty.deploy.AppLifeCycle.runBindings(AppLifeCycle.java:183)\n\tat org.eclipse.jetty.deploy.DeploymentManager.requestAppGoal(DeploymentManager.java:491)\n\tat org.eclipse.jetty.deploy.DeploymentManager.addApp(DeploymentManager.java:138)\n\tat org.eclipse.jetty.deploy.providers.ScanningAppProvider.fileAdded(ScanningAppProvider.java:142)\n\tat org.eclipse.jetty.deploy.providers.ScanningAppProvider$1.fileAdded(ScanningAppProvider.java:53)\n\tat org.eclipse.jetty.util.Scanner.reportAddition(Scanner.java:604)\n\tat org.eclipse.jetty.util.Scanner.reportDifferences(Scanner.java:535)\n\tat org.eclipse.jetty.util.Scanner.scan(Scanner.java:398)\n\tat org.eclipse.jetty.util.Scanner.doStart(Scanner.java:332)\n\tat org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:59)\n\tat org.eclipse.jetty.deploy.providers.ScanningAppProvider.doStart(ScanningAppProvider.java:118)\n\tat org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:59)\n\tat org.eclipse.jetty.deploy.DeploymentManager.startAppProvider(DeploymentManager.java:552)\n\tat org.eclipse.jetty.deploy.DeploymentManager.doStart(DeploymentManager.java:227)\n\tat org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:59)\n\tat org.eclipse.jetty.util.component.AggregateLifeCycle.doStart(AggregateLifeCycle.java:63)\n\tat org.eclipse.jetty.server.handler.AbstractHandler.doStart(AbstractHandler.java:53)\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.doStart(HandlerWrapper.java:91)\n\tat org.eclipse.jetty.server.Server.doStart(Server.java:263)\n\tat org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:59)\n\tat org.eclipse.jetty.xml.XmlConfiguration$1.run(XmlConfiguration.java:1215)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat org.eclipse.jetty.xml.XmlConfiguration.main(XmlConfiguration.java:1138)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:616)\n\tat org.eclipse.jetty.start.Main.invokeMain(Main.java:457)\n\tat org.eclipse.jetty.start.Main.start(Main.java:602)\n\tat org.eclipse.jetty.start.Main.main(Main.java:82)\n\nAug 28, 2012 5:20:02 PM org.apache.solr.servlet.SolrDispatchFilter init\nINFO: user.dir=/home/hossman/lucene/4x_dev/solr/example\nAug 28, 2012 5:20:02 PM org.apache.solr.servlet.SolrDispatchFilter init\nINFO: SolrDispatchFilter.init() done\n2012-08-28 17:20:02.447:INFO:oejs.AbstractConnector:Started SocketConnector@0.0.0.0:8983\n\n\n\nWe should either fix this so it continues to assume that \".\" is the instanceDir for a solr home with no solr.xml file (as 3x did) or \u2013 if this behavior is neccessary for some reason i don't understand \u2013 then heavily document that users who upgrade with existing configs need to add this directory and move their existing files into it.  \n\nBut if we go that route, then it seems like it would just be better to completley remove the support for solr instances w/o a solr.xml files, and just tell people who upgrade \"add this file to your solr home dir\" and it can have instanceDir=\".\" in it for the default core. "
        },
        {
            "author": "Hoss Man",
            "id": "comment-13443701",
            "date": "2012-08-29T00:47:11+0000",
            "content": "user error ... i had a typo in my path (big surprise, i know) "
        },
        {
            "author": "Uwe Schindler",
            "id": "comment-13654037",
            "date": "2013-05-10T10:33:49+0000",
            "content": "Closed after release. "
        }
    ]
}