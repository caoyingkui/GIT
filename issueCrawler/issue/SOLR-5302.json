{
    "id": "SOLR-5302",
    "title": "Analytics Component",
    "details": {
        "affect_versions": "None",
        "status": "Closed",
        "fix_versions": [
            "5.0",
            "6.0"
        ],
        "components": [],
        "type": "New Feature",
        "priority": "Major",
        "labels": "",
        "resolution": "Fixed"
    },
    "description": "This ticket is to track a \"replacement\" for the StatsComponent. The AnalyticsComponent supports the following features:\n\n\n\tAll functionality of StatsComponent (SOLR-4499)\n\tField Faceting (SOLR-3435)\n\t\n\t\tSupport for limit\n\t\tSorting (bucket name or any stat in the bucket\n\t\tSupport for offset\n\t\n\t\n\tRange Faceting\n\t\n\t\tSupports all options of standard range faceting\n\t\n\t\n\tQuery Faceting (SOLR-2925)\n\tAbility to use overall/field facet statistics as input to range/query faceting (ie calc min/max date and then facet over that range\n\tSupport for more complex aggregate/mapping operations (SOLR-1622)\n\t\n\t\tAggregations: min, max, sum, sum-of-square, count, missing, stddev, mean, median, percentiles\n\t\tOperations: negation, abs, add, multiply, divide, power, log, date math, string reversal, string concat\n\t\tEasily pluggable framework to add additional operations\n\t\n\t\n\tNew / cleaner output format\n\n\n\nOutstanding Issues:\n\n\tMulti-value field support for stats (supported for faceting)\n\tMulti-shard support (may not be possible for some operations, eg median)",
    "attachments": {
        "SOLR-5302.patch": "https://issues.apache.org/jira/secure/attachment/12607821/SOLR-5302.patch",
        "Statistical Expressions.pdf": "https://issues.apache.org/jira/secure/attachment/12606794/Statistical%20Expressions.pdf",
        "SOLR-5302_contrib.patch": "https://issues.apache.org/jira/secure/attachment/12668963/SOLR-5302_contrib.patch",
        "solr_analytics-2013.10.04-2.patch": "https://issues.apache.org/jira/secure/attachment/12606874/solr_analytics-2013.10.04-2.patch",
        "Search Analytics Component.pdf": "https://issues.apache.org/jira/secure/attachment/12606793/Search%20Analytics%20Component.pdf"
    },
    "issue_links": {},
    "comments": [
        {
            "author": "Steven Bower",
            "id": "comment-13786162",
            "date": "2013-10-04T14:00:11+0000",
            "content": "Related tickets "
        },
        {
            "author": "Steven Bower",
            "id": "comment-13786165",
            "date": "2013-10-04T14:04:57+0000",
            "content": "Initial patch, please review/comment. Additionally PDF exports of some docs for using the component "
        },
        {
            "author": "Uwe Schindler",
            "id": "comment-13786171",
            "date": "2013-10-04T14:12:14+0000",
            "content": "Hi,\nthanks for the patch! We also got your iCLA.\n\nCould you please remove this from every license header?:\n\n+ * Copyright 2013 Bloomberg Finance L.P.\n+ *\n\n\n\nUwe "
        },
        {
            "author": "Shawn Heisey",
            "id": "comment-13786198",
            "date": "2013-10-04T14:38:23+0000",
            "content": "I love new functionality.  Thank you for all the time and effort!\n\nI was going to suggest that you just replace the existing StatsComponent rather than create a new component, but as I look a little bit into things, it looks like it might not be a new component from the user/admin perspective, just the code perspective.  I haven't looked in-depth, but I do see a new class in the patch, so I'm slightly confused.  That confusion may clear up after I've looked deeper.\n\nSide note, and most likely not your fault at all: Your PDF text is invisible in my in-browser PDF viewer.  Windows 8 Pro, Firefox 24.0.  Everything is fine if downloaded and opened in Adobe Reader.  I think this is probably using the PDF viewer built into Windows 8, which sucks. "
        },
        {
            "author": "Steven Bower",
            "id": "comment-13786200",
            "date": "2013-10-04T14:43:06+0000",
            "content": "We originally had this code integrated into the stats component but we wanted to change the output format which made that a bit more complex.. it easily can go back in and replace it... also the \"olap=true\" i am not wedded to for turning it on, it was just better than a shortened version of analytics  "
        },
        {
            "author": "Robert Muir",
            "id": "comment-13786206",
            "date": "2013-10-04T14:52:20+0000",
            "content": "Can we remove all the class.equals/isassignablefrom stuff?\n\nwe should instead use proper fieldtype methods ... only use instanceof when absolutely necessary, and only instanceof, and please open an issue when it because it means solr is broken. using instanceof, isassignablefrom, class.equals, etc completely breaks solr's pluggability in increasingly bogus ways. "
        },
        {
            "author": "Houston Putman",
            "id": "comment-13786291",
            "date": "2013-10-04T16:24:49+0000",
            "content": "The fieldtype methods should only work when working with fields though. I think we also use the class.equals stuff with ValueSource classes...\n\nYeah, I just checked and we use it to check the type (numeric, string or date) of the value source or function. So we need to make a fix for that. "
        },
        {
            "author": "Steven Bower",
            "id": "comment-13786410",
            "date": "2013-10-04T17:51:05+0000",
            "content": "Uwe Schindler Sent a mail over to our legal folks as this is what they instructed me to do.. will follow up and resolve "
        },
        {
            "author": "Uwe Schindler",
            "id": "comment-13786420",
            "date": "2013-10-04T17:57:48+0000",
            "content": "Hi Steven,\n\nI refer to this one: http://www.apache.org/legal/src-headers.html\n\n\nSource File Headers for Code Developed at the ASF\n\nThis section refers only to works submitted directly to the ASF by the copyright owner or owner's agent.\nIf the source file is submitted with a copyright notice included in it, the copyright owner (or owner's agent) must either:\n\n\tremove such notices, or\n\tmove them to the NOTICE file associated with each applicable project release, or\n\tprovide written permission for the ASF to make such removal or relocation of the notices.\n\n\n\nEach source file should include the following license header \u2013 note that there should be no copyright notice in the header:\n\n       Licensed to the Apache Software Foundation (ASF) under one\n       or more contributor license agreements.  See the NOTICE file\n       distributed with this work for additional information\n       regarding copyright ownership.  The ASF licenses this file\n       to you under the Apache License, Version 2.0 (the\n       \"License\"); you may not use this file except in compliance\n       with the License.  You may obtain a copy of the License at\n\n         http://www.apache.org/licenses/LICENSE-2.0\n\n       Unless required by applicable law or agreed to in writing,\n       software distributed under the License is distributed on an\n       \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n       KIND, either express or implied.  See the License for the\n       specific language governing permissions and limitations\n       under the License.\n\n "
        },
        {
            "author": "Steven Bower",
            "id": "comment-13786551",
            "date": "2013-10-04T19:47:25+0000",
            "content": "Updated patch:\n\n\n\tUpdated license comment to remove copyrights\n\tAdded copyright notice to NOTICE.txt\n\tCleaned up lots of Javadoc warnings\n\tCleaned up some exception handling\n\n "
        },
        {
            "author": "Steven Bower",
            "id": "comment-13786552",
            "date": "2013-10-04T19:47:56+0000",
            "content": "Removed original patch file as it contained incorrect copyright headers "
        },
        {
            "author": "Yonik Seeley",
            "id": "comment-13786579",
            "date": "2013-10-04T20:32:54+0000",
            "content": "Sweet... nice work guys!\n\nImplementation details are just that.  But perhaps we should land this on trunk and let the interface \"bake\" so it doesn't accidentally get released early in a 4x release?\nOn a quick scroll through, it looks like mostly new files, which is great (i.e. it won't complicate the backporting/merging of other solr features from 4x to trunk) "
        },
        {
            "author": "Steven Bower",
            "id": "comment-13786627",
            "date": "2013-10-04T21:09:54+0000",
            "content": "Yup.. we intentionally layed it out so that there is very little (only 2 files) that need to change in order to merge this in. Would love for this to end up on trunk. We are actively working on this as well, adding new functionality, performance tuning, etc.. If I had commit access to trunk I'd gladly keep it up to date, merged with the latest, as well as keep up patch releases for 4.x (as that is what we are deploying it against currently into our production environment) "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13787219",
            "date": "2013-10-05T13:31:11+0000",
            "content": "I've assigned this to myself to commit & etc. I'll need all the help anyone wants to lend as far as the technical details are concerned, this is a lot of code in places I'm not all that familiar with, and like everyone else I have faaaar too many things on my plate \n\nSteven & co:\n\nA couple of procedural details:\n\n1> There's no need at all to remove old patches when you put new ones up, in fact it's preferable to leave the old ones there. Just name them all SOLR-5302.patch. The newest version will be in blue and all the older versions will be gray and they're listed in date order so it's really easy to know the order and look at changes version-to-version should that be necessary.\n\n2> At some point when we're in some agreement (very soon I hope!), I'll commit the patch to trunk where we can bang on it a while before merging into 4x. I'll try to turn any new patches around in a day or less when we get to that point. I'm weaseling here since I'll be traveling for 10 days or so starting this weekend, otherwise I should be faster....\n\nI applied the patch to trunk and there are two issues:\n\n3a> A couple of files have this: \"import org.apache.mahout.math.Arrays;\", and as far as I can tell it only is for the toString operation in error messages. The code compiles if we just use the java.util.Arrays import. I'd rather not introduce a new dependency so how about switching to java.util.Arrays?\n\n3b> Trying to run the tests on trunk at least gives this error: \"dynamicField can not have a default value: *_i. \" (there are a couple of others). See SOLR-5227 which CHANGES.txt claims that setting the default and required options was silently ignored anyway as of 4.5 and emits a new init error... Removing the default assignments gets us past the initialization error, but then several tests fail, stack trace at the end (TRUNK), I haven't pursued it yet:\n\nThanks loads for taking this all no and contributing it back! I'll do my best to get it into the code base as fast as possible. And the patch comes with documentation too! How cool is that!\n\nErick\n\njava.lang.NullPointerException\n\tat __randomizedtesting.SeedInfo.seed([22E0CD041D7B8CF3]:0)\n\tat org.apache.solr.analytics.util.valuesource.MissFieldSource.description(MissFieldSource.java:52)\n\tat org.apache.lucene.queries.function.ValueSource.toString(ValueSource.java:58)\n\tat org.apache.solr.analytics.statistics.StatsCollectorSupplierFactory.create(StatsCollectorSupplierFactory.java:159)\n\tat org.apache.solr.analytics.accumulator.BasicAccumulator.<init>(BasicAccumulator.java:60)\n\tat org.apache.solr.analytics.accumulator.BasicAccumulator.create(BasicAccumulator.java:84)\n\tat org.apache.solr.analytics.request.AnalyticsStats.execute(AnalyticsStats.java:82)\n\tat org.apache.solr.handler.component.AnalyticsComponent.process(AnalyticsComponent.java:44)\n\tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:209)\n\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135)\n\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:1861)\n\tat org.apache.solr.util.TestHarness.query(TestHarness.java:291)\n\tat org.apache.solr.util.TestHarness.query(TestHarness.java:273)\n\tat org.apache.solr.analytics.NoFacetTest.beforeClass(NoFacetTest.java:103)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1559)\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner.access$600(RandomizedRunner.java:79)\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$4.evaluate(RandomizedRunner.java:677)\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:693)\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:53)\n\tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:46)\n\tat org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:42)\n\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:55)\n\tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:39)\n\tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:39)\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n\tat org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:43)\n\tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n\tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:70)\n\tat org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:55)\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:358)\n\tat java.lang.Thread.run(Thread.java:722) "
        },
        {
            "author": "David Arthur",
            "id": "comment-13787221",
            "date": "2013-10-05T14:00:59+0000",
            "content": "Would this support performing analytics on the score? For example, I'd like to roll up results by some fields and sum the scores. \n\nAwesome patch by the way.  "
        },
        {
            "author": "Houston Putman",
            "id": "comment-13787335",
            "date": "2013-10-05T20:42:18+0000",
            "content": "Not currently, but I think it would be very easy to add that functionality. We tried to make adding new features as painless as possible. "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13787367",
            "date": "2013-10-05T21:42:53+0000",
            "content": "BTW, I'd guess we should keep additional enhancements out of this patch and add them in as new JIRAs, perhaps linking them back here unless they're totally painless.... "
        },
        {
            "author": "Steven Bower",
            "id": "comment-13787371",
            "date": "2013-10-05T21:52:08+0000",
            "content": "Erick Erickson Will check out trunk tonight and apply/test.. also will start creating linked sub-tickets for requests here but also the laundry list of things we plan on adding over time. "
        },
        {
            "author": "Steven Bower",
            "id": "comment-13788511",
            "date": "2013-10-07T20:00:30+0000",
            "content": "Erick Erickson per 3a) just eclipse being bad at choosing the right package, will cleanup.. 3b) will require a bit more work as we added quite a bit of code to work around not having missing values for docValues.. the SOLR-5227 fix is a great improvement and will greatly simplify our code "
        },
        {
            "author": "Steven Bower",
            "id": "comment-13791565",
            "date": "2013-10-10T14:58:13+0000",
            "content": "Patch updated to include\n\n\n\tCleaned up imports of Arrays class to use java.util.Arrays\n\tAdded support for \"missing\" numeric doc values\n\tremoved the \"defaultIsMissing\" stuff as its no longer needed\n\tNo words against 4.5.0 (and trunk although I've not explicitly tested)\n\n "
        },
        {
            "author": "Saar Carmi",
            "id": "comment-13797095",
            "date": "2013-10-16T18:36:08+0000",
            "content": "Thanks for that functionality!\n\nIn the attachment \"Search Analytics Component.pdf\" there is a broken link \"This shows how to add the functionality yourself\".\nWhere can I find that one?\n\nAlso the link to power point earlier in that pdf is broken. "
        },
        {
            "author": "Steven Bower",
            "id": "comment-13797253",
            "date": "2013-10-16T21:03:00+0000",
            "content": "That part of the doc is a bit rough... I'll try to post shortly.. the pptx I'll need to have reviewed before I can post as it contained some internal stuff.. hopefully will get this up next week.. "
        },
        {
            "author": "Alexander Koval",
            "id": "comment-13797834",
            "date": "2013-10-17T12:22:14+0000",
            "content": "Do you plan to make support for local params for excluding some tagged filters? See SOLR-3177 "
        },
        {
            "author": "Andrew Psaltis",
            "id": "comment-13802629",
            "date": "2013-10-23T06:13:47+0000",
            "content": "Steven Bower This is great, we have been playing around with this against Solr 4.5. What would it take to implement the pivot faceting so that a stat that is defined could be applied across multiple dimensions? Can you point me in the write direction to do this? "
        },
        {
            "author": "Houston Putman",
            "id": "comment-13803001",
            "date": "2013-10-23T16:28:23+0000",
            "content": "Andrew Psaltis, I would look at FacetingAccumulator and the fieldFacetAccumulator and implement something similar to those. I don't know much about pivot faceting, but from what I can tell it is nested field facets. The FacetingAccumulator acts like a wrapper on the BasicAccumulator to add functionality for Facets; so I would add another BasicAccumulator wrapper that deals with pivoting. \n\nWhen the functionality is there, you will want to make a PivotFacetingRequest class, and look at the AnalyticsRequestFactory, AnalyticsStats and AnalyticsRequest to make sure your pivot params get parsed correctly and computed. "
        },
        {
            "author": "Steven Bower",
            "id": "comment-13804133",
            "date": "2013-10-24T12:46:10+0000",
            "content": "Added sub-task for pivot faceting.. shouldn't be too difficult to add.. "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13811682",
            "date": "2013-11-01T21:31:52+0000",
            "content": "OK, I'm not quite sure how to proceed given the size of this patch. What do people think about this as a way forward?\n\nI'll do all the pre-commit/ant testing stuff, basically the secretarial work involved in committing this to trunk. Since this is a new component, it's at least somewhat isolated from other bits of the code. I'll let it bake for a while in trunk and then merge into 4x. Since we just put 4.5.1 out (well, Mark did), if sometime a week or so after it's committed to trunk I merge it to 4x, there'll be substantial time to bake there before any 4.6 goes out.\n\nOf course I'll look it over, but given the size it'll be mostly a surface level look-over. Anyone who wants to delve into details is more than welcome to...\n\nHow does that sound? "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13811980",
            "date": "2013-11-02T13:28:54+0000",
            "content": "Please apply my updated version of the patch or make the same changes before making a new one or I'll have to re-do some work.\n\nNOTE: This is against trunk!\n\nWorking with pre-commit:\n\n Changes I had to make:\n\nA couple of files were indented with tabs. Since it's a new file, I just reformatted them.\n\nThe forbidden api checks failed on several files. Mostly requiring either Scanners to have \"UTF-8\" specified or String.toLowercase to have Locale.ROOT and such-like.\n\nI did most of this on the plane ride home, and I must admit it's annoying to have precommit fail because I don't have internet connnectivity, there must be a build flag somewhere.\n\nThese files have missing javadocs\n     [exec]   missing: org.apache.solr.analytics.accumulator\n     [exec]   missing: org.apache.solr.analytics.accumulator.facet\n     [exec]   missing: org.apache.solr.analytics.expression\n     [exec]   missing: org.apache.solr.analytics.plugin\n     [exec]   missing: org.apache.solr.analytics.request\n     [exec]   missing: org.apache.solr.analytics.statistics\n     [exec]   missing: org.apache.solr.analytics.util\n     [exec]   missing: org.apache.solr.analytics.util.valuesource\n     [exec] \n     [exec] Missing javadocs were found!\n\n\nTests failing, and a JVM crash to boot. \n\nFieldFacetExrasTest fails with \"unknown field int_id\". There's nothing in schema-docValues.xml that would map to that field, did it get changed? Is this a difference between trunk and 4x?\n\n\n\torg.apache.solr.analytics.NoFacetTest (suite)\n   [junit4]   - org.apache.solr.analytics.facet.FieldFacetExtrasTest (suite)\n   [junit4]   - org.apache.solr.analytics.expression.ExpressionTest (suite)\n   [junit4]   - org.apache.solr.analytics.AbstractAnalyticsStatsTest.initializationError\n   [junit4]   - org.apache.solr.analytics.util.valuesource.FunctionTest (suite)\n   [junit4]   - org.apache.solr.analytics.facet.AbstractAnalyticsFacetTest.initializationError\n   [junit4]   - org.apache.solr.analytics.facet.FieldFacetTest (suite)\n   [junit4]   - org.apache.solr.analytics.facet.QueryFacetTest.queryTest\n   [junit4]   - org.apache.solr.analytics.facet.RangeFacetTest (suite)\n\n "
        },
        {
            "author": "Nelson Gonzalez Gonzalez",
            "id": "comment-13813636",
            "date": "2013-11-05T04:58:59+0000",
            "content": "I apologize if Solr JIRA is not for this kind of questions but I really need help with the Analytics Component. I am working on a project where we need to compute some stats that are impossible using the standard StatsComponent, I applied the patch to Solr 4.5.1 and it worked, but with SolrCloud it didn't,  so I have a question:\n\nDoes Anallytics Component support SolrCloud? I could not see the component working on SolrCloud cluster, but it worked on a single solr instance. "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13815925",
            "date": "2013-11-07T12:57:56+0000",
            "content": "NOTE: I'm pretty sure the JVM crash I'm seeing is unrelated to this patch, it shows up in other places and appears to be a Java problem... "
        },
        {
            "author": "Steven Bower",
            "id": "comment-13816733",
            "date": "2013-11-07T22:39:38+0000",
            "content": "Nelson Gonzalez Gonzalez Can you provide more detail w/regard to your issue. Is your solr cloud setup sharded. If it is sharded the Analytics component will not work currently as some of the statistics (median/percentile) cannot be easily be computed across shards. "
        },
        {
            "author": "Steven Bower",
            "id": "comment-13816741",
            "date": "2013-11-07T22:47:44+0000",
            "content": "been away this last week at Lucene rev so haven't had a chance to look at these issues...\n\nmy guess is a schema change on trunk w/regard to _id fields.. will take a look and adjust..\n\nRest should get fixed up next week when I'm back in the states. "
        },
        {
            "author": "Nelson Gonzalez Gonzalez",
            "id": "comment-13816815",
            "date": "2013-11-07T23:50:56+0000",
            "content": "Yes my solr cloud is sharded, I split the index in two shards. I applied the patch to Solr 4.5.1 and tried to test the Analytics component with the standard solr example (exampledocs folder).\nI have two shards (shard1, shard2) with 32 documets (exampledocs  post.jar). \n\nFor example when I execute the following query in a single solr instance (no shards) it returns stats:\n\nhttp://localhost:8983/solr/select?q=*:*&olap=true&olap.req1.statistic.stat1=sum(price)\n\nResponse:\n\n<lst name=\"stats\">\n<lst name=\"req1\">\n<double name=\"stat1\">5251.270030975342</double>\n</lst>\n</lst>\n\nIf I try to execute the same query in a solr cloud sharded (two shard) it return NO stats result, it does NOT throw any exception, simply does NOT return any stat result.\n\nIf I execute the same query in a sharded environment (solrcloud) with the paramater distrib=false, it  does returns stats:\n\nhttp://localhost:8983/solr/select?q=*:*&olap=true&olap.req1.statistic.stat1=sum(price)&distrib=false\n\nIt is like Analytics Component does not support distributed query (shards solrcloud)\n\nI see there are some methods in the AnalyticsComponent.class that are not implemented:\n\nmodifyRequest, handleResponses, finishStage\n\nI think the not implemented methods is the reason of why the analytics component is not returning data in a solrcloud shard environment, but I am not sure.\n\nPlease I really need help because I am close to the deadline of a project and need to make the decision whether continue with the analytics component or choose another approach to fix a big issue  \u201cstats.facet does not support multivalue fields\u201d, related to this jira ticket https://issues.apache.org/jira/browse/SOLR-1782, we have our index split in many shards using features of solrcloud Solr 4.4.0 "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13824461",
            "date": "2013-11-16T12:40:10+0000",
            "content": "[~smb-solr] Steve:\n\nDon't mean to hassle you on this, just a ping to make sure I'm not dropping the ball here. I know how much stuff stacks up when you're away for a week!\n\nFYI, though, I'll be out of internet range most of December, so I'd like to get this committed to trunk by Thanksgiving if possible, then to 4x before I leave. Otherwise I'll have to hand it off to someone else to commit.\n\nI really appreciate all the work that went into this and your willingness to contribute it!\n\nErick "
        },
        {
            "author": "Steven Bower",
            "id": "comment-13825411",
            "date": "2013-11-18T15:52:36+0000",
            "content": "Been a bit tied up.. should have this gtg by mid-day today "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13825435",
            "date": "2013-11-18T16:16:00+0000",
            "content": "NP, like I said I'm just insuring that I haven't dropped the ball.... "
        },
        {
            "author": "Steven Bower",
            "id": "comment-13825459",
            "date": "2013-11-18T16:43:41+0000",
            "content": "New patch attached addressing the schema and javadoc issues\n\nFor the schema i just added a new one schema-analytics.xml .. must have missed this file in my first pass as I had made changes to schema-docValues.xml but now its a separate file and should avoid any confusion/changes in the future.\n\nadded package.html files for missing javadoc "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13826742",
            "date": "2013-11-19T17:51:19+0000",
            "content": "OK, I'll try this out this evening at latest. If it passes precommit and test I'll put it up on trunk and we can go from there. "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13827112",
            "date": "2013-11-19T23:46:06+0000",
            "content": "Some of the tests were failing because, at least on my Mac, the paths to the various files in test-files weren't correct when I ran \"ant test\" from the shell. Current implementation succeeds both from the shell and IntelliJ.\n\nWe'll see if this breaks on Jenkins.\n\nMeanwhile, committing on trunk. Anyone who wants to give it a whirl, feedback greatly appreciated!\n\nAwesome stuff Steven! Here I thought I had a big patch at 150K or so \n\nThis has considerable documentation, anyone want to volunteer to incorporate it into the Wiki? "
        },
        {
            "author": "ASF subversion and git services",
            "id": "comment-13827113",
            "date": "2013-11-19T23:46:06+0000",
            "content": "Commit 1543651 from Erick Erickson in branch 'dev/trunk'\n[ https://svn.apache.org/r1543651 ]\n\nSOLR-5302 Analytics component. Checking in to trunk, we'll let it back then port to 4x "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13827119",
            "date": "2013-11-19T23:50:27+0000",
            "content": "So I can't type in comments correctly. The SVN comment should be \"we'll let it bake then\"....\n\nI won't be able to do anything with this after 5-Dec for a month or so. How long do people think it needs to bake before putting committing to 4x? We just cut 4.6, so there's some time to bake before the next Solr release I should think, especially with the holidays coming up.\n\nWhat do people think? I'll put a note in my calendar to put it up 1-Dec unless\na> there are problems found\nor\nb> people object\nor \nc> consensus is reached that this should be done sooner. "
        },
        {
            "author": "Steven Bower",
            "id": "comment-13827130",
            "date": "2013-11-19T23:58:24+0000",
            "content": "One thing I'll try to do shortly is to make this fail better and/or add support for multi-shard environments.. Some things can be handled similarly to stats component but some things (median, etc) can't..\n\nIs there a generally accepted approach to handling non multi shard compliant components? "
        },
        {
            "author": "Steven Bower",
            "id": "comment-13827134",
            "date": "2013-11-19T23:58:59+0000",
            "content": "Btw... Erik thanks for putting in all the work you did on this! "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13827175",
            "date": "2013-11-20T00:25:55+0000",
            "content": "bq: thanks for putting in all the work you did on this!\n\nIt's a very small fraction of the work you did!\n\nAbout extending to multi-shard environments, let's open up a new JIRA for that, it'll make tracking and reconciling all this easier.\n\n "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13827560",
            "date": "2013-11-20T11:23:53+0000",
            "content": "Test failure on Jenkins, doesn't reproduce for me though. Noticed one failure was a 32 bit client and thought that might be relevant but it happens on a 64 bit client too.\n\nant test  -Dtestcase=NoFacetTest -Dtests.method=stddevTest -Dtests.seed=8DD436C49013B770 -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=ms_MY -Dtests.timezone=Europe/Sofia -Dtests.file.encoding=UTF-8\n\nand did not reproduce the problem. Tried running the suite with -Dtests.iters=100 and that succeeded too. Also tried one of the other failures for this case, \n\nant test  -Dtestcase=HardAutoCommitTest -Dtests.method=testCommitWithin -Dtests.seed=E7BA795017967CA6 -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=iw -Dtests.timezone=Australia/Tasmania -Dtests.file.encoding=UTF-8\n\nand that succeeds as well.\n\nMaybe an environment issue and/or some kind of precision problem? Here's the tests in question:\n  //Float\n    Double floatResult = (Double)getStatResult(response, \"str\", \"double\", \"float_fd\");\n    Double floatTest = (Double)calculateNumberStat(floatTestStart, \"stddev\");\n    assertTrue(Math.abs(floatResult-floatTest)<.00000000001); "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13827596",
            "date": "2013-11-20T12:12:27+0000",
            "content": "Rats. Forgot to mention this JIRA in the commit I just did. r-1543796\n\nFollowing Dawid's suggestion, I changed the test to:\n\n    assertTrue(\"Oops: (double raws) \" + Double.doubleToRawLongBits(floatResult) + \" - \"\n        + Double.doubleToRawLongBits(floatTest) + \" < \" + Double.doubleToRawLongBits(.00000000001) +\n        \" Calculated diff \" + Double.doubleToRawLongBits(floatResult - floatTest),\n        Math.abs(floatResult - floatTest) < .00000000001);\n\nto give us the raw data to help figure out what's going on. "
        },
        {
            "author": "David Smiley",
            "id": "comment-13827702",
            "date": "2013-11-20T14:33:59+0000",
            "content": "Minor observation: your assertTrue should probably be written as an assertEquals between floatResult, floatTest, and the given delta.  JUnit would have told you the values even without adding a message (I believe). "
        },
        {
            "author": "Otis Gospodnetic",
            "id": "comment-13827784",
            "date": "2013-11-20T15:56:56+0000",
            "content": "This ticket is to track a \"replacement\" for the StatsComponent.\n\nIs there anything StatsComponent does that this Analytics Component does not or cannot/will not do?  If not, should StatsComponent be deprecated?\n\nMulti-shard support (may not be possible for some operations, eg median)\n\nSee https://www.google.com/search?q=qdigest "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13828888",
            "date": "2013-11-21T12:50:14+0000",
            "content": "[~steven bower] I've created a new Solr JIRA for fixing any test errors, I've seen two so far that may well be environment sensitivities. Let's collect any test fixes in SOLR-5448, that'll make it easier to merge into 4.x.\n\nAlso, what do people think about just closing the other JIRAs linked to this one about improvements to stats component? And Otis' question about whether to just deprecate the stats component is a good one. I suppose if we decide to deprecate the old stats component, it answers the question about closing JIRAs related to it. "
        },
        {
            "author": "Nim Lh\u00fbg",
            "id": "comment-13828937",
            "date": "2013-11-21T13:29:47+0000",
            "content": "Erick Erickson  Has this been merged into the 4.6 RCs? If so, I would like to run it through our application tests in place of the StatsComponent. We use the StatsComponent for a lot of our heavy lifting, and having it deprecated (or replaced) makes me a bit nervous. Mostly because this patch is very complex and I haven't had much time to test it. "
        },
        {
            "author": "Nim Lh\u00fbg",
            "id": "comment-13828940",
            "date": "2013-11-21T13:37:43+0000",
            "content": "Additionally, StatsComponent has SolrJ integration (FieldStatsInfo classes etc). Analytics Component doesn't seem to have any SolrJ sugar yet (unless I overlooked a patch somewhere?). Might be a bit too soon to deprecate StatsComponent. "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13828944",
            "date": "2013-11-21T13:41:57+0000",
            "content": "Nim:\n\nGood point about SolrJ, although there's nothing magic about SolrJ integration, you can always use params.\n\nNo, it hasn't been folded into any 4x code yet, we're letting it bake for a while on trunk. If all goes well, I'll back-port into 4x in early Dec. "
        },
        {
            "author": "Nim Lh\u00fbg",
            "id": "comment-13828962",
            "date": "2013-11-21T14:08:07+0000",
            "content": "Ok. Refactoring our application to use the new component (with or without SolrJ sugar) would be a pretty substantial effort, but I'll try to squeeze it in at some point this month so I can give it a bit of a test. "
        },
        {
            "author": "David Smiley",
            "id": "comment-13828972",
            "date": "2013-11-21T14:25:00+0000",
            "content": "Fear not Nim (and others), Solr almost never changes the request/response params/format.  It may have happened before but it is so rare that I simply can't recall the last time it has.  Stuff gets deprecated but sticks around forever.  Backwards compatibility is kept to extremely high standards here (good for you, sucks for us committers).  Instead of removal, I suspect at some point in the future, the Stats' implementation would get replaced by a proxy implementation that uses the new code in this Analytics component.  And that is not an option until this Analytics component does everything Stats does (e.g. distributed-mode). "
        },
        {
            "author": "Steven Bower",
            "id": "comment-13828986",
            "date": "2013-11-21T14:53:39+0000",
            "content": "Erick Erickson will continue looking at the new ticket/test issues... should hopefully get it sorted today...\n\nAlso regarding the interface to the analytics component.. I am not really wedded to the current interface.. it loosely follows some of the structure of the Stats component but obviously had to diverge for new functionality... We also built an XML based format (the code is actually in the patch) for specifying analytics requests.. I'll take a look at the solrj stuff too because internally all the parameters passed in the uri are turned into an object model (AnalyticsRequest and suborniate classes) which could easily be moved into SolrJ side to make things cleaner.. I'll try to look at that this week as well.. but if people have suggestions w/regard to input/output format I'm open to make some changes. "
        },
        {
            "author": "Otis Gospodnetic",
            "id": "comment-13829061",
            "date": "2013-11-21T16:11:36+0000",
            "content": "Steven Bower - just linked MAHOUT-1361 which you may want to look at. "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13829231",
            "date": "2013-11-21T19:11:21+0000",
            "content": "Steven Bower (or anyone else for that matter who likes this kind of thing.\nHere's the bits from the enhanced error output:\n\nYou may want to watch SOLR-5488, let's move over there for the test fixes.\n\n1 tests failed.\nFAILED:  org.apache.solr.analytics.NoFacetTest.stddevTest\n\nError Message:\nOops: (double raws) 4631318898052956160 - 4628496337733101339 < 4442235333156365461 Calculated diff 4625071700926640586\n\nStack Trace:\njava.lang.AssertionError: Oops: (double raws) 4631318898052956160 - 4628496337733101339 < 4442235333156365461 Calculated diff 4625071700926640586\n        at __randomizedtesting.SeedInfo.seed([94AAF7392EB49CCD:916AB78C1ED798C2]:0)\n        at org.junit.Assert.fail(Assert.java:93)\n        at org.junit.Assert.assertTrue(Assert.java:43)\n        at org.apache.solr.analytics.NoFacetTest.stddevTest(NoFacetTest.java:227)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\n "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13836570",
            "date": "2013-12-02T14:55:51+0000",
            "content": "I have a time constraint here. See comments for SOLR-5488. The short form is I have to be done with this no later than tomorrow (Tuesday) night. I've outlined several options at SOLR-5488, let me know what people think the best thing to do is. Please comment on SOLR-5488. "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13837694",
            "date": "2013-12-03T13:44:26+0000",
            "content": "I'm going to commit this to 4x this afternoon unless there are objections. The test that fails isn't a regression, so... I don't like putting code in 4x that has a sporadic test failure, but life isn't always tidy and I have a time limit.\n\nOr a committer can volunteer to take this over until I can work with it again. "
        },
        {
            "author": "Uwe Schindler",
            "id": "comment-13837709",
            "date": "2013-12-03T13:59:46+0000",
            "content": "Hi Erick,\nCan you simply add an @Ignore to the test with a message mentioning the issue? "
        },
        {
            "author": "Robert Muir",
            "id": "comment-13837811",
            "date": "2013-12-03T15:43:45+0000",
            "content": "I dont understand why a JIRA issue can have a time limit. Maybe this wasnt ready for trunk yet and should be iterated on in a branch?\n\nI dont think unstable stuff should be backported to 4.x!!! "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13837836",
            "date": "2013-12-03T16:06:20+0000",
            "content": "The JIRA doesn't have a time limit, I do. All I'm doing here is trying to insure that people don't expect me to do anything with this in the near future and leaving a paper trail that lets someone else pick it up in my absence. And letting folks know the current state in case they do want to pick it up.\n\nI'm fine with leaving it as it is. I've listed the merges that need to happen if someone wants to merge this all in to 4x when appropriate. If there's a fix for the test problem, then there'll be at least one more merge than I've listed of course.\n\nI'm also trying to NOT check things in the night before I leave on vacation... "
        },
        {
            "author": "Elran Dvir",
            "id": "comment-13840002",
            "date": "2013-12-05T10:33:57+0000",
            "content": "I saw in documentation that \"Unique count\" is supported among other statistical expressions.\nwhat about the unique values themselves? (as described in SOLR-5428)\n\nThanks. "
        },
        {
            "author": "Steven Bower",
            "id": "comment-13840101",
            "date": "2013-12-05T14:20:52+0000",
            "content": "Hadn't thought about unique values, but in principal its pretty straightforward as we hold on to all the values as we need them to count things...\n\nMaybe create a new ticket for that...\n\nI will also think a bit more because often what is wanted is not always a stat but the ability to transform/reduce the set of values coming back... as in the case of distinct values... of course you can solve that now with faceting.. "
        },
        {
            "author": "Michel Lemay",
            "id": "comment-13841441",
            "date": "2013-12-06T17:17:37+0000",
            "content": "Few problems found in patch as of 19/Nov/13 18:46\n\n\tSorting on bucket name (asc or desc) does not work\n\tSome functions produces errors. ex: &o.req1.s.value1=int(sum(myfield)) will produce the following error: <str name=\"msg\">int does not have the correct number of arguments.</str>\n\tOutput of not so large values are in scientific notation (StatsComponent output the same value correctly)\n\n "
        },
        {
            "author": "Houston Putman",
            "id": "comment-13841564",
            "date": "2013-12-06T19:05:43+0000",
            "content": "1) I don't think that sorting on bucket name is supported. If you want the buckets sorted, you have to choose a statistic to sort on.\n\n2) int() is not a funciton. It was used in an early implementation, but I don't think that it is still around anywhere in the code. Was the expression \"&o.req1.s.value1=int(sum(myfield))\" in an actual test? "
        },
        {
            "author": "Michel Lemay",
            "id": "comment-13841575",
            "date": "2013-12-06T19:21:39+0000",
            "content": "1) In my opinion, it should be implemented to be parallel with SimpleFacet feature list.  Also, it's mentioned in the documentation of this feature request: \"The AnalyticsComponent supports the following features:\nAll functionality of StatsComponent (...Sorting (bucket name or any stat in the bucket...\"\nHowever, I'm not sure if I misunderstood what 'bucket name' refers to.  Is is the facet display value itself or olap.req.statistics.<name> ?\n\n2) I derived from an example found at the botton of this document: https://issues.apache.org/jira/secure/attachment/12606794/Statistical%20Expressions.pdf\nNote, double() also have the same behavior. \nSurprisingly, add(..,..) returns a double even if both parameters are integers..  Thats why I wanted to cast back to int.\n "
        },
        {
            "author": "Houston Putman",
            "id": "comment-13841593",
            "date": "2013-12-06T19:35:22+0000",
            "content": "1) Bucket name refers to the facet display value. This should be added to the new features ticket, and shouldn't be too hard to implement.\n\n2) Good catch, that should be updated. Every expression or function that operates on numeric values will return a double. This is mainly for simplicity, because it would get ugly pretty quickly otherwise. "
        },
        {
            "author": "Mehmet Erkek",
            "id": "comment-13876405",
            "date": "2014-01-20T12:37:58+0000",
            "content": "\nThis looks like a great feature. Many thanks to those who involved in it. We will try to use it.\nMaybe not the best place to ask, If so, I apologize however I have two questions:\n1-Which release includes this functionality?\n2-How can we use it? the attached pdf has broken links and it does not seem detail info on how to use it. I appreciate if you can share some more info.\nThanks.\n "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13876460",
            "date": "2014-01-20T14:15:14+0000",
            "content": "Right, the user's list is probably a better forum...\n\n1> This functionality is only in trunk (the future 5x). There's an occasional test failure that we want to fix before we fold it in to 4x. 4.7 would be the earliest this would go into a released version.\n\n2> The PDFs are fine as far as I can tell, you need to download them rather than open them in place.\n "
        },
        {
            "author": "Mehmet Erkek",
            "id": "comment-13885357",
            "date": "2014-01-29T13:59:19+0000",
            "content": "Thank you Erick.\n1) Any idea when the future 5x could be  released?\n2) This is link I meant in the pdf: https://cms.prod.bloomberg.com/team/display/fdns/Search+Analytics+Component  "
        },
        {
            "author": "Shawn Heisey",
            "id": "comment-13887541",
            "date": "2014-01-31T07:19:23+0000",
            "content": "This is link I meant in the pdf: https://cms.prod.bloomberg.com/team/display/fdns/Search+Analytics+Component\n\nIf I had to guess, I would say that is an internal website for Bloomberg, something that only employees can get to.  If they intend it for public consumption, they'll need to publish the data on a public website and fix the links in the PDF.\n\nAny idea when the future 5x could be released?\n\nQuick answer: 5.0 is many months away.  It's impossible to give any kind of release date prediction.  Hopefully this particular feature will end up in a 4.x release, once Erick (or another committer) has the time to devote to giving the code a thorough review.\n\nLonger answer:\n\nAt this time, nobody has come up with a timeframe for Solr 5.0.  Once somebody decides we're going to begin the process and agrees to be the release manager, a LOT has to happen, and there's really no way to make it happen quickly.\n\nEven if we began the 5.0 release process tomorrow and everything were to be extremely smooth, I don't think you'd even see a 5.0-ALPHA release for a few months.  We can't begin the release process that soon, so it's going to be even longer.  One of the big items still left to do is to embed the HTTP server layer and make Solr into a standalone application.\n\nI wasn't involved with the development when 4.0 was released, so I don't know how much time passed between the beginning of the 4.0 release process and 4.0-ALPHA, but I can tell you that there were three months between 4.0-ALPHA and 4.0-FINAL. "
        },
        {
            "author": "Mehmet Erkek",
            "id": "comment-13892040",
            "date": "2014-02-05T12:15:26+0000",
            "content": "Thanks Shawn. Nice answer. I think we need this component sooner. In this case, my questions here is : Is there anything we can do to help including this feature in one of 4.X versions ?  "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13892225",
            "date": "2014-02-05T15:27:26+0000",
            "content": "Mehmet:\n\nWe're still trying to track down what's behind the test failures, that effort is being tracked in SOLR-5488. That discussion shows a way to reproduce the test failures we see, albeit intermittently.\n\nYou could certainly help if you can \n1> reproduce the problem. Note the discussion at SOLR-5488 about \nant test -Dtestcase=ExpressionTest -Dtests.iters=10000\n2> figure out why/create a patch.\n\nand/or\n\n3> exercise trunk as much as possible to see that it all works.\n\nLet's move the rest of the discussion over to SOLR-5488 though, this JIRA is gated by that one. "
        },
        {
            "author": "Pete",
            "id": "comment-13910776",
            "date": "2014-02-24T20:32:27+0000",
            "content": "Hi,\n\nI am new to this. Can I apply patch 5302 to Apache Solr Version 4.6.1 ?\n\nWill I be able to replicate the facet.pivot behavior using the analytics component ?\n\nSo example: I would like to get the sum of field \"price\" by each \"manu\" split by \"instock\" of true and false ?\n\nMany thanks "
        },
        {
            "author": "Steven Bower",
            "id": "comment-13911603",
            "date": "2014-02-25T14:18:37+0000",
            "content": "The patch is for trunk.. in general it should apply pretty cleanly as most of the code is in a separate package.. but.. there are a few files/apis that have changed so it's not likely to apply cleanly.. I am going to be working on moving to 4.6.x this week so maybe I'll try and make a clean 4.6.1 patch.. currently pivot facet behavior is not supported, however its totally doable, just need to do the work... "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13960651",
            "date": "2014-04-04T23:14:39+0000",
            "content": "We seem to have stabilized this in trunk, so we need to back port it to 4x when we get any outstanding interface issues resolved. See: SOLR-5963 i "
        },
        {
            "author": "Grant Ingersoll",
            "id": "comment-13968525",
            "date": "2014-04-14T16:58:08+0000",
            "content": "Does this work in SolrCloud mode?  It seems to be the case that it doesn't.  I really don't think we should put in new functionality like this without it supporting SolrCloud. "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13968575",
            "date": "2014-04-14T17:49:07+0000",
            "content": "Well, if it doesn't function in distributed mode, it seems we have two choices:\n1> pull it out of trunk\n2> put it into 4x and iterate.\n\nIf we go with <1>, it seems best if I created an \"uber patch\" that preserves the work so far (including all the test stabilization updates) and attach that to a new JIRA. This would be both SOLR-5302 and SOLR-5488.\n\n "
        },
        {
            "author": "Ryan McKinley",
            "id": "comment-13969187",
            "date": "2014-04-15T03:40:54+0000",
            "content": "option 2 seems better \u2013 it will be easier to improve without dealing with massive patches.  We could mark as experimental and change the format if necessary for distributed search.\n\nI really don't think we should put in new functionality like this without it supporting SolrCloud.\n\nI am all for aiming to have distributed search supported everywhere, but I don't think that should be a blocker. "
        },
        {
            "author": "Steven Bower",
            "id": "comment-13969202",
            "date": "2014-04-15T04:25:52+0000",
            "content": "Grant Ingersoll I agree that the ideal should be to have everything work in distributed mode (makes thins way less confusing for people). However substantial work would be needed to make this functionality work in a multi-shard environment.. We'd essentially need a generic distributed map-reduce implementation that could run inside a query. +1 for that... This is because of some of the stats are not easily computed without knowing all the values in one place (eg median/percentiles).\n\nI believe that there is substantial value in what exists in this patch and that we continue work into the future to design/implement multi-shard support for analytics.  "
        },
        {
            "author": "Grant Ingersoll",
            "id": "comment-13969478",
            "date": "2014-04-15T12:20:50+0000",
            "content": "I don't agree.  Distributed is and should be the default mode we do everything in going forward and if we don't account for it up front, then we end up making all kinds of compromises on it and/or it takes years to get done (just look at MLT).  I can almost guarantee you the first question on the list once this is released is \"how come it doesn't work in distributed\".  This is not a case of the \"perfect being the enemy of the good enough\", but a case of missing the fact that the usage of distributed is the world we live in and so this patch only serves those going backwards and not those going forward.\n\nIt would be one thing if this issue had a plan for what can be distributed and what can't and an approach outlined such that it could be implemented sooner rather than later, but that doesn't appear to be the case, AFAICT.  For instance, some of the stats that can't be easily distributed do have approximations that can be.\n\nWe'd essentially need a generic distributed map-reduce implementation that could run inside a query. +1 for that.\n\nSee https://issues.apache.org/jira/browse/SOLR-5069. "
        },
        {
            "author": "Steven Bower",
            "id": "comment-13969719",
            "date": "2014-04-15T16:47:31+0000",
            "content": "If someone wants to do that work that's great.. I don't have plans to work on multi-shard at the moment (this will change in the future) as I just don't have a use-case for it... we will though.. If someone wants to pick it up I'd gladly assist...\n\nI understand the intention to have everything cloud compatible.. The reality is that many components suffer from inconsistencies when in cloud mode (MLT, All the join work being done and in Solr, FieldCollapsing, etc..) I think it should be the intention to make things work in cloud mode however some use-case don't really make sense in distributed mode when you look at the cost of the implementation.. we can do analytics very quickly in solr with this component but doing this as a map-reduce/distributed implementation may prove to be prohibitively time consuming at query time and thus may not ever get used in distributed configurations..\n\nAnyway I'd like to see this get in prior to supporting multi-node as it will probably be a long while before the infrastructure is in place to support it (ie the map-reduce ticket) "
        },
        {
            "author": "Grant Ingersoll",
            "id": "comment-13973329",
            "date": "2014-04-17T20:00:03+0000",
            "content": "How about as a compromise, we make this a contrib and make it fail fast in the sharded case so that we can move forward?  In the meantime, a couple of engineers here at Lucid are looking at the distributed case.   "
        },
        {
            "author": "Hoss Man",
            "id": "comment-13974294",
            "date": "2014-04-18T17:47:51+0000",
            "content": "How about as a compromise, we make this a contrib and make it fail fast in the sharded case\n\n+1\n\nThis functionality is really cool, and I think for the people ith single node setups who want it and can take advantage of it we should absolutely make it available \u2013 but I share grant's general concerns about adding new \"built-in\" functionality that doesn't work at all in distrib mode.  I'd hate to see people try this out in the example and think it's great and will solve all their problems but then they get confused/disappointed/angry when it does nothing useful in their multi-node setup.\n\nAs an optional contrib, we can make the inform(SolrCore) method check for SolrCloud mode and fail fast (and likewise, for old-school pre-SolrCloud manual managed multi-shard setups we can have distributedProcess fail fast at request time)\n\n(Note: I still have some other concerns about the general user API \u2013 see comments SOLR-5963, where arguably this whole discussion should have taken place) "
        },
        {
            "author": "Pradeep",
            "id": "comment-13992232",
            "date": "2014-05-07T21:15:38+0000",
            "content": "I do see that this issue was fixed in 5.0. Does this supports distributed mode also? "
        },
        {
            "author": "David Arthur",
            "id": "comment-14012822",
            "date": "2014-05-29T20:14:21+0000",
            "content": "Pradeep, see previous discussion - no support for distributed (aka, \"cloud\") yet.\n\n\nChris Hostetter (Unused), Grant Ingersoll, Steven Bower, in distributed mode, would this component work when talking to individual shards directly? If that's the case, then (for some stats) the end user can do a final roll-up themselves. "
        },
        {
            "author": "Anirudha",
            "id": "comment-14050668",
            "date": "2014-07-02T20:27:06+0000",
            "content": "Yes, in solrCloud mode; Currently, you can use this component when talking to individual shards or if you have only one shard. "
        },
        {
            "author": "Shalin Shekhar Mangar",
            "id": "comment-14050796",
            "date": "2014-07-02T22:16:39+0000",
            "content": "Has anybody given a thought about how this might use the new AnalyticsQuery? Is the AnalyticsQuery framework powerful enough to make this component cloud-aware? "
        },
        {
            "author": "Joel Bernstein",
            "id": "comment-14050830",
            "date": "2014-07-02T22:55:19+0000",
            "content": "I'm fairly certain all the functionality in the AnalyticsComponent could be implemented as an AnalyticsQuery. Any functions that could be distributed would have a MergeStrategy implementations as well.  "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-14050839",
            "date": "2014-07-02T23:02:51+0000",
            "content": "Shalin:\n\nIt's actually a somewhat different problem I think. We're thinking of pulling this out of 5.x and going with the analytics framework instead, but haven't quite reached consensus on that. The big consideration here is that making this work distributed is seems like a big task. Using the pluggable framework seems like it would be easier to build up as necessary.\n\nWe really need to figure it out soon.... "
        },
        {
            "author": "Yonik Seeley",
            "id": "comment-14051479",
            "date": "2014-07-03T14:11:58+0000",
            "content": "We're thinking of pulling this out of 5.x and going with the analytics framework instead, but haven't quite reached consensus on that.\n\nI didn't realize that... can you point me at the discussion? "
        },
        {
            "author": "Steven Bower",
            "id": "comment-14051528",
            "date": "2014-07-03T14:50:26+0000",
            "content": "Making the types of expression the analyics framework supports distributed is hard period regardless of what framework.. (eg median, percentiles, etc..) unless you accept some error rate... can someone point me to the \"analytics framework\" that is being talked about..? "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-14051764",
            "date": "2014-07-03T17:52:13+0000",
            "content": "bq: I didn't realize that... can you point me at the discussion?\n\nI mis-stated that severely, my apologies. What I should have said is more along the lines that I don't quite know what to do with back-porting the analytics stuff to 4.x. Or whether we should. It's quite a bit of code, the interface is complex, and it doesn't play nice in distributed mode. I believe there are functions that simply won't work distributed. And maybe can't.\n\nThen there's the pluggable analytics framework that's been recently added. I really wonder whether the right thing to do long-term is to pull this out of 5x and port as much as possible into the pluggable analytics framework piecemeal as necessary, stealing as much as possible and supporting what can be supported in distributed mode. That still leaves the question of what to do with functions that are inherently difficult/impossible to support in sharded environments...\n\nSee SOLR-5963 for some of the other discussion about whether to move this to a  contrib rather than have it be in the mainline code. My concern is that if we move it to a contrib, it'll just be code that languishes, especially given the distributed limitations. Would it just be better to use the pluggable framework? It seems to me that the use-case for single-shard analytics is becoming less compelling, but that may be a misperception on my part.\n\nDon't want it to seem like there's any decision here, more like I don't want to introduce this much code into the mainline tree if it doesn't have wide applicability, and I think the lack of distributed support severely limits how widely it applies.\n\nThat said, I'm not dogmatically opposed either. But I'd like some sense of what others think about it. "
        },
        {
            "author": "Steven Bower",
            "id": "comment-14051799",
            "date": "2014-07-03T18:36:48+0000",
            "content": "I think moving to contrib is probably the right thing at this point... "
        },
        {
            "author": "David Smiley",
            "id": "comment-14051809",
            "date": "2014-07-03T18:50:45+0000",
            "content": "I think moving to contrib is probably the right thing at this point...\n+1 "
        },
        {
            "author": "Joel Bernstein",
            "id": "comment-14053663",
            "date": "2014-07-07T13:49:19+0000",
            "content": "Steven, \n\nErick is talking about the AnalyticsQuery API in Solr 4.9. (http://heliosearch.org/solrs-new-analyticsquery-api/), which is a plugin point for custom analytics. It's design allows developers to plugin custom analytic Collectors inline with the flow of the search.\n\nPorting all the functions from the AnalyticsComponent to be AnalyticsQuery's and then adding distributed support (where possible) would take some serious thought and effort. \n\nFor a near term solution, that makes all the functions available, I think the best option is the contrib approach.\n\n\n\n "
        },
        {
            "author": "Yonik Seeley",
            "id": "comment-14134899",
            "date": "2014-09-16T03:30:52+0000",
            "content": "As the first step of finally getting this into 4x, here's a patch that moves the analytics component to contrib (which seems to be the consensus). "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-14134951",
            "date": "2014-09-16T04:52:03+0000",
            "content": "Man! If you only knew how long this has been on my back burner....\n\nThanks! AFAIK this is certainly the consensus approach, then use the pluggable analytics stuff that Joel put together to support distributed stats.\n "
        },
        {
            "author": "ASF subversion and git services",
            "id": "comment-14135598",
            "date": "2014-09-16T15:29:54+0000",
            "content": "Commit 1625331 from Yonik Seeley in branch 'dev/trunk'\n[ https://svn.apache.org/r1625331 ]\n\nSOLR-5302: move analytics component to contrib "
        },
        {
            "author": "Yonik Seeley",
            "id": "comment-14135609",
            "date": "2014-09-16T15:40:20+0000",
            "content": "committed.\n\nthen use the pluggable analytics stuff that Joel put together to support distributed stats.\n\nIt looks like the main value to AnalyticsQuery is perhaps for custom analytics.  The nice part is that all you do is define another query and you can use that to inject a MergeStrategy during distributed search.  But the analytics component is already has direct access to the distributed search machinery given it's a search component.  In this case, I don't see what AnalytcisQuery brings to the table (and it looks like the associated MergeStrategy would often be to limiting for some analytics).\n\nBottom line - I think whoever tries tackling distributing this stuff should think about what makes the most sense for the analytics component itself and not try to shoehorn it into something else. "
        },
        {
            "author": "ASF subversion and git services",
            "id": "comment-14142035",
            "date": "2014-09-20T15:13:50+0000",
            "content": "Commit 1626457 from Use account \"steve_rowe\" instead in branch 'dev/trunk'\n[ https://svn.apache.org/r1626457 ]\n\nSOLR-5302: Maven config "
        },
        {
            "author": "ASF subversion and git services",
            "id": "comment-14142088",
            "date": "2014-09-20T16:23:21+0000",
            "content": "Commit 1626473 from Use account \"steve_rowe\" instead in branch 'dev/branches/branch_5x'\n[ https://svn.apache.org/r1626473 ]\n\nSOLR-5302: Maven config (merged trunk r1626457) "
        },
        {
            "author": "nabil",
            "id": "comment-14181398",
            "date": "2014-10-23T14:22:54+0000",
            "content": "Hi,\nShall I apply patch 5302 to  branch 'dev/branches/branch_5x' to get analytics component or it's already applied. \nI have built this branch and test sum but not working:\nhttp://localhost:8983/solr/collection1/select?q=*%3A*&wt=json&indent=true&olap=true&olap.req1.statistic.stat1=sum(price)\n\nRegards,\nNKI. "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-14184683",
            "date": "2014-10-26T22:36:22+0000",
            "content": "Should be currently in branch 5x, when did you check this out? Also note it's a contrib, so there may be some setup necessary.\n\nPlease ask questions on the user's list and if we can't work it out there we'll open a new JIRA. You'll have to provide more details than \"it doesn't work\" though. "
        },
        {
            "author": "Jack Krupansky",
            "id": "comment-14191672",
            "date": "2014-10-31T10:36:12+0000",
            "content": "Fix version still says trunk only... but this will be in 5.0 (branch_5x), right? "
        },
        {
            "author": "Yonik Seeley",
            "id": "comment-14205521",
            "date": "2014-11-10T23:14:20+0000",
            "content": "Fix version still says trunk only... but this will be in 5.0 (branch_5x), right?\n\nCorrect, this will be part of 5.0 "
        },
        {
            "author": "sumit jain",
            "id": "comment-14317783",
            "date": "2015-02-12T08:14:42+0000",
            "content": "I am trying to get it working on 5.0 branch but analytics component isn't getting invoked. Here's the user's list post which has the details http://lucene.472066.n3.nabble.com/Analytics-Component-not-working-Solr-5-0-td4185666.html\n\nRegards,\nSumit "
        },
        {
            "author": "Anshum Gupta",
            "id": "comment-14332971",
            "date": "2015-02-23T05:02:52+0000",
            "content": "Bulk close after 5.0 release. "
        },
        {
            "author": "Levi Page",
            "id": "comment-14586504",
            "date": "2015-06-15T19:05:52+0000",
            "content": "Does anyone have copies or access to the extended documentation that is referenced to the PDF? The PDF points to several links on the Bloomberg CMS site that are no longer active. I am trying to use this component and would love to get my hands on it. "
        }
    ]
}