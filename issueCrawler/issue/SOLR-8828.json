{
    "id": "SOLR-8828",
    "title": "SolrJ JDBC - ClassNotFoundException: com.google.common.base.MoreObjects",
    "details": {
        "components": [
            "SolrJ"
        ],
        "type": "Sub-task",
        "labels": "",
        "fix_versions": [],
        "affect_versions": "6.0",
        "status": "Closed",
        "resolution": "Duplicate",
        "priority": "Major"
    },
    "description": "I clicked on rows in the IntelliJ results box and received the following error:\n\njava.sql.SQLException: java.io.IOException: --> http://default.attlocal.net:8983/solr/test_shard1_replica1/: An exception has occurred on the server, refer to server log for details.\n            java.io.IOException: --> http://default.attlocal.net:8983/solr/test_shard1_replica1/: An exception has occurred on the server, refer to server log for details.\n\n\n\nThe resulting server error is:\n\n246341930 ERROR (qtp1173643169-67) [c:test s:shard1 r:core_node1 x:test_shard1_replica1] o.a.s.s.HttpSolrCall null:java.lang.RuntimeException: java.lang.NoClassDefFoundError: com/google/common/base/MoreObjects\n\tat org.apache.solr.servlet.HttpSolrCall.sendError(HttpSolrCall.java:602)\n\tat org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:472)\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:229)\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:184)\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1668)\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:581)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:548)\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:226)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1158)\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:511)\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1090)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213)\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:109)\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:119)\n\tat org.eclipse.jetty.server.Server.handle(Server.java:517)\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:308)\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:242)\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:261)\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)\n\tat org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:75)\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceAndRun(ExecuteProduceConsume.java:213)\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:147)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:654)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:572)\n\tat java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.NoClassDefFoundError: com/google/common/base/MoreObjects\n\tat com.facebook.presto.sql.tree.TableSubquery.toString(TableSubquery.java:42)\n\tat java.lang.String.valueOf(String.java:2994)\n\tat java.lang.StringBuilder.append(StringBuilder.java:131)\n\tat org.apache.solr.handler.SQLHandler$SQLVisitor.visitNode(SQLHandler.java:949)\n\tat org.apache.solr.handler.SQLHandler$SQLVisitor.visitNode(SQLHandler.java:929)\n\tat com.facebook.presto.sql.tree.AstVisitor.visitRelation(AstVisitor.java:177)\n\tat com.facebook.presto.sql.tree.AstVisitor.visitQueryBody(AstVisitor.java:182)\n\tat com.facebook.presto.sql.tree.AstVisitor.visitTableSubquery(AstVisitor.java:372)\n\tat com.facebook.presto.sql.tree.TableSubquery.accept(TableSubquery.java:36)\n\tat com.facebook.presto.sql.tree.AstVisitor.process(AstVisitor.java:22)\n\tat org.apache.solr.handler.SQLHandler$SQLVisitor.visitAliasedRelation(SQLHandler.java:1131)\n\tat org.apache.solr.handler.SQLHandler$SQLVisitor.visitAliasedRelation(SQLHandler.java:929)\n\tat com.facebook.presto.sql.tree.AliasedRelation.accept(AliasedRelation.java:56)\n\tat com.facebook.presto.sql.tree.AstVisitor.process(AstVisitor.java:22)\n\tat org.apache.solr.handler.SQLHandler$SQLVisitor.visitQuerySpecification(SQLHandler.java:1013)\n\tat org.apache.solr.handler.SQLHandler$SQLVisitor.visitQuerySpecification(SQLHandler.java:929)\n\tat com.facebook.presto.sql.tree.QuerySpecification.accept(QuerySpecification.java:98)\n\tat com.facebook.presto.sql.tree.AstVisitor.process(AstVisitor.java:22)\n\tat org.apache.solr.handler.SQLHandler$SQLVisitor.processRelation(SQLHandler.java:1149)\n\tat org.apache.solr.handler.SQLHandler$SQLVisitor.visitQuery(SQLHandler.java:995)\n\tat org.apache.solr.handler.SQLHandler$SQLVisitor.visitQuery(SQLHandler.java:929)\n\tat com.facebook.presto.sql.tree.Query.accept(Query.java:80)\n\tat com.facebook.presto.sql.tree.AstVisitor.process(AstVisitor.java:22)\n\tat org.apache.solr.handler.SQLHandler$SQLTupleStreamParser.parse(SQLHandler.java:163)\n\tat org.apache.solr.handler.SQLHandler.handleRequestBody(SQLHandler.java:118)\n\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:155)\n\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:2036)\n\tat org.apache.solr.servlet.HttpSolrCall.execute(HttpSolrCall.java:649)\n\tat org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:457)\n\t... 26 more\nCaused by: java.lang.ClassNotFoundException: com.google.common.base.MoreObjects\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:381)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:424)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:357)\n\tat org.eclipse.jetty.webapp.WebAppClassLoader.loadClass(WebAppClassLoader.java:487)\n\tat org.eclipse.jetty.webapp.WebAppClassLoader.loadClass(WebAppClassLoader.java:428)\n\t... 55 more\n\n246341932 WARN  (qtp1173643169-67) [c:test s:shard1 r:core_node1 x:test_shard1_replica1] o.e.j.s.ServletHandler Error for /solr/test_shard1_replica1/sql\njava.lang.NoClassDefFoundError: com/google/common/base/MoreObjects\n\tat com.facebook.presto.sql.tree.TableSubquery.toString(TableSubquery.java:42)\n\tat java.lang.String.valueOf(String.java:2994)\n\tat java.lang.StringBuilder.append(StringBuilder.java:131)\n\tat org.apache.solr.handler.SQLHandler$SQLVisitor.visitNode(SQLHandler.java:949)\n\tat org.apache.solr.handler.SQLHandler$SQLVisitor.visitNode(SQLHandler.java:929)\n\tat com.facebook.presto.sql.tree.AstVisitor.visitRelation(AstVisitor.java:177)\n\tat com.facebook.presto.sql.tree.AstVisitor.visitQueryBody(AstVisitor.java:182)\n\tat com.facebook.presto.sql.tree.AstVisitor.visitTableSubquery(AstVisitor.java:372)\n\tat com.facebook.presto.sql.tree.TableSubquery.accept(TableSubquery.java:36)\n\tat com.facebook.presto.sql.tree.AstVisitor.process(AstVisitor.java:22)\n\tat org.apache.solr.handler.SQLHandler$SQLVisitor.visitAliasedRelation(SQLHandler.java:1131)\n\tat org.apache.solr.handler.SQLHandler$SQLVisitor.visitAliasedRelation(SQLHandler.java:929)\n\tat com.facebook.presto.sql.tree.AliasedRelation.accept(AliasedRelation.java:56)\n\tat com.facebook.presto.sql.tree.AstVisitor.process(AstVisitor.java:22)\n\tat org.apache.solr.handler.SQLHandler$SQLVisitor.visitQuerySpecification(SQLHandler.java:1013)\n\tat org.apache.solr.handler.SQLHandler$SQLVisitor.visitQuerySpecification(SQLHandler.java:929)\n\tat com.facebook.presto.sql.tree.QuerySpecification.accept(QuerySpecification.java:98)\n\tat com.facebook.presto.sql.tree.AstVisitor.process(AstVisitor.java:22)\n\tat org.apache.solr.handler.SQLHandler$SQLVisitor.processRelation(SQLHandler.java:1149)\n\tat org.apache.solr.handler.SQLHandler$SQLVisitor.visitQuery(SQLHandler.java:995)\n\tat org.apache.solr.handler.SQLHandler$SQLVisitor.visitQuery(SQLHandler.java:929)\n\tat com.facebook.presto.sql.tree.Query.accept(Query.java:80)\n\tat com.facebook.presto.sql.tree.AstVisitor.process(AstVisitor.java:22)\n\tat org.apache.solr.handler.SQLHandler$SQLTupleStreamParser.parse(SQLHandler.java:163)\n\tat org.apache.solr.handler.SQLHandler.handleRequestBody(SQLHandler.java:118)\n\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:155)\n\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:2036)\n\tat org.apache.solr.servlet.HttpSolrCall.execute(HttpSolrCall.java:649)\n\tat org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:457)\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:229)\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:184)\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1668)\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:581)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:548)\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:226)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1158)\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:511)\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1090)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213)\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:109)\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:119)\n\tat org.eclipse.jetty.server.Server.handle(Server.java:517)\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:308)\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:242)\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:261)\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)\n\tat org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:75)\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceAndRun(ExecuteProduceConsume.java:213)\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:147)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:654)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:572)\n\tat java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.ClassNotFoundException: com.google.common.base.MoreObjects\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:381)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:424)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:357)\n\tat org.eclipse.jetty.webapp.WebAppClassLoader.loadClass(WebAppClassLoader.java:487)\n\tat org.eclipse.jetty.webapp.WebAppClassLoader.loadClass(WebAppClassLoader.java:428)\n\t... 55 more",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "date": "2016-03-10T16:22:51+0000",
            "author": "Kevin Risden",
            "content": "Joel Bernstein - Not sure what code path this is taking to get to this exception yet. It looks like not all the required libraries are pulled in? Presto is relying on Google Common? ",
            "id": "comment-15189490"
        },
        {
            "date": "2016-03-10T16:33:14+0000",
            "author": "Kevin Risden",
            "content": "Here is the SQL statement that IntelliJ is generating:\n\n\nSELECT COUNT(*) FROM (select COUNT(*) from test limit 100) t\n\n\n\nThe line in SQLHandler should throw an UnsupportedOperationException, but the string concatenation causes a node.toString() and the above exception is thrown.\n\n\nthrow new UnsupportedOperationException(\"not yet implemented: \" + node);\n\n ",
            "id": "comment-15189502"
        },
        {
            "date": "2016-03-10T16:41:45+0000",
            "author": "Kevin Risden",
            "content": "This was found previously in SOLR-8661. ",
            "id": "comment-15189515"
        }
    ]
}