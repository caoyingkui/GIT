{
    "id": "SOLR-5393",
    "title": "Solr Cloud Polygon insert over non leader shard produces error",
    "details": {
        "affect_versions": "4.5",
        "status": "Resolved",
        "fix_versions": [],
        "components": [
            "SolrCloud",
            "spatial"
        ],
        "type": "Bug",
        "priority": "Major",
        "labels": "",
        "resolution": "Incomplete"
    },
    "description": "We get the following error when trying to load polygon data into the solr cloud of type solr.SpatialRecursivePrefixTreeFieldType. \n\nWhen we insert the polygon data directly into the leader shard everything (also replication) works fine, but we get the following error whenever we try to insert the data over a non leader shard:\n\nERROR SolrCmdDistributor forwarding update to http://192.168.14.68:7460/geodata/ failed - retrying \n\nWithout polygon we can insert in any shards (leader or replica) without problems.\n\nCode to reproduce:\n\nSolrInputDocument input = new SolrInputDocument();\ninput.setField(\"id\", \"test\");\nString poly = \"POLYGON((13.994591177713277 51.002523790166705, 13.999693765863235 51.002226426778684, 14.001913786758868 51.003267620336686, 14.009460032984512 51.00507616830811, 14.014352741862453 51.005397015805684, 14.015753050939129 51.006165440252694, 14.01713711596325 51.006907316716564, 14.018964454037809 51.006716998902526, 14.021343903143388 51.006464920150016, 14.02502734579799 51.00552477067982, 14.024643222840908 51.00516708013014, 14.023995094883304 51.004529130427706, 14.02693059874708 51.00426911242828, 14.029893872882688 51.00399916991763, 14.03384714224316 51.00248305935758, 14.03569145591514 51.00176950378165, 14.037017581967358 51.00193640923721, 14.039078347499816 51.00218906817236, 14.041385544697533 51.001182106955575, 14.042961142804325 51.00050362709656, 14.045466411981872 51.00171549577248, 14.047436055944628 51.00170955402223, 14.047501462719008 51.000698678987334, 14.05127500005199 51.00113313322361, 14.05199253668852 50.99931867381475, 14.049908557072259 50.99764370517098, 14.048323570941262 50.99633182825351, 14.048756259187261 50.995084559520684, 14.049083460379496 50.9941377646161, 14.048559547400519 50.99251429812778, 14.048031545244314 50.990836907379865, 14.049200640514442 50.988396160957755, 14.048752386129843 50.98645511274733, 14.049899403692196 50.985032920490475, 14.050433093991956 50.982683593518296, 14.049663453585083 50.98008576559324, 14.053447525957514 50.979934262898006, 14.054101699616101 50.979905280314895, 14.054541876032507 50.979504496321006, 14.056883382560684 50.97728906687162, 14.061461001521177 50.977626495499514, 14.065739069155171 50.977036091326006, 14.070237468930674 50.976528847851064, 14.072737969004711 50.9763890539482, 14.073435256940234 50.97580914575129, 14.073656252079921 50.97497361816587, 14.073507842972424 50.97415844208817, 14.073477076544268 50.97357386295706, 14.073497624562199 50.97328497403231, 14.07353309846212 50.973004634793355, 14.073629355769953 50.97258730796079, 14.074031133526418 50.97206150901968, 14.074173161574096 50.9718679773403, 14.074953685738512 50.97125847625354, 14.076318122528281 50.970450862964476, 14.077419495985641 50.968822576119045, 14.07938471092451 50.96785232072157, 14.079935466625953 50.965376163972905, 14.075928740820487 50.965769620044185, 14.076477656611141 50.96493301242208, 14.07715569856788 50.96392127776921, 14.074518652583494 50.96468694014318, 14.070947374058479 50.965733442336116, 14.070067128285528 50.964490320180744, 14.073638108045227 50.962885351295846, 14.074800325552822 50.96204792730229, 14.07578512690655 50.96131503249083, 14.072648032067532 50.96077183886253, 14.069990748256624 50.96108762107119, 14.068779840845313 50.962034585317255, 14.067957389649735 50.96265434173164, 14.067324872520413 50.96203416740502, 14.066893256314694 50.96161501555103, 14.063746581910717 50.96094576617525, 14.060359780703521 50.96104946306251, 14.05747465371602 50.96025493987205, 14.05373788209221 50.960071883898436, 14.048310513394146 50.95997631668494, 14.048472867689442 50.96098025221684, 14.048526758248931 50.96131190166739, 14.047891683599207 50.961214167562254, 14.043110704367722 50.96043205625402, 14.042002681111876 50.96254661748835, 14.039611197301197 50.962610392016906, 14.039496995984026 50.962983189010785, 14.039153009982101 50.96408360520823, 14.036527043440328 50.964253532621974, 14.03671903618213 50.962842471755415, 14.037626765889286 50.962400512989845, 14.039081773666089 50.96165364817774, 14.039871682812647 50.96060271915765, 14.040057039055357 50.95948010265582, 14.037002440491422 50.95888841537619, 14.035134869565928 50.9605846093134, 14.033106236231959 50.96185328415876, 14.03250868364643 50.962997407710056, 14.03011455632278 50.963214199168796, 14.030856865387815 50.96219178096697, 14.0308016783549 50.96188314726897, 14.02902553543847 50.96211457060064, 14.028183254277486 50.961264041726984, 14.025263665203713 50.962073167844004, 14.021542191222775 50.96133914086857, 14.019370767890543 50.960918428660776, 14.019081549682566 50.961242448573024, 14.018885809201 50.96148257060933, 14.018505145643093 50.961917447618205, 14.019999566526804 50.96225056874698, 14.023757741949764 50.96309162817559, 14.022887495264166 50.964216929954226, 14.021769993110823 50.965655971995965, 14.022785052538294 50.96662510581292, 14.024322295268734 50.96808285222214, 14.022615528117854 50.96908935802955, 14.022384482917124 50.96924047645547, 14.02226641614167 50.970315973947805, 14.02251871810301 50.97063261608663, 14.023230212836513 50.971547883637804, 14.021516936022868 50.973410302066775, 14.01988227770836 50.974054267726046, 14.014976470306138 50.9754005725833, 13.991735623626008 50.97598309382076, 13.988777687574578 50.97763011026176, 13.986815668440899 50.978292413401334, 13.985610988520481 50.97840055849822, 13.98493102190627 50.97846595822352, 13.984080217101017 50.978536468146125, 13.982180099665161 50.978314100161235, 13.983259737436114 50.977110814997125, 13.985110405884155 50.977055411199274, 13.98680659954427 50.97665331166701, 13.98865812714381 50.975661039008735, 13.99087505040753 50.974027244375094, 13.991662260226576 50.972544400241844, 13.985110008621225 50.97610062413912, 13.98169899239852 50.97589646388632, 13.980654716332989 50.978521863445465, 13.978305709290277 50.9785920887534, 13.978091909922851 50.97764368360234, 13.975508241019174 50.9780091055488, 13.971110790105218 50.97778004028919, 13.966874293325295 50.97817653604117, 13.965204068969728 50.977974068072385, 13.963533859185091 50.97777157614827, 13.960760299840317 50.980565306946815, 13.958366472599144 50.98290631790464, 13.957780878177811 50.98423879153211, 13.958522298718385 50.985378716412725, 13.953346731632994 50.98773917149262, 13.951589632271098 50.98867400102211, 13.951549872782 50.9890985244173, 13.951499409773435 50.98937924781074, 13.951387779382298 50.98979689453405, 13.951308165342608 50.99006947466847, 13.951200069807673 50.99034289904507, 13.950846625667989 50.9911550282415, 13.950677353685757 50.991565375117105, 13.9505834916944 50.99183837678821, 13.950518779028826 50.99211952174527, 13.950454065579125 50.99240066665752, 13.9503933638802 50.992735736531614, 13.95044419012973 50.99341878657641, 13.950868165909661 50.993937652724696, 13.951637293211249 50.99449132237674, 13.952747758187222 50.99483670424779, 13.955345053208491 50.99559733494901, 13.957187942477647 50.99600200386933, 13.95834204618638 50.99616589165638, 13.95867363462805 50.99621008635768, 13.960384530100425 50.99637542798652, 13.960644911689027 50.99642173342035, 13.961773237911551 50.99662238357361, 13.962729325515243 50.99681013078684, 13.963820599737915 50.996705612176605, 13.964357099403848 50.99662659866766, 13.965769886544898 50.99643142815485, 13.967066580959791 50.99640183060096, 13.968910091035193 50.99604967600127, 13.969777617634575 50.99581665523398, 13.972030163101092 50.99520905844659, 13.973147169001447 50.995067653577024, 13.975170233348612 50.99482713752738, 13.976938865311897 50.99481036356423, 13.976736220250173 50.99567863981759, 13.975938757948022 50.99860534578122, 13.975874189485856 50.99888650458932, 13.971769815727479 50.99859461182636, 13.971321007936325 51.00060764323264, 13.968093037511778 51.0009650433087, 13.966180936848428 51.002120879328196, 13.961961859417555 51.00335429548637, 13.960837137590431 51.0043515154376, 13.962193645108446 51.00531101260347, 13.967466210638493 51.005181162909366, 13.96883406840263 51.00667168689974, 13.970264379003973 51.00823239563803, 13.972188553778778 51.00876052746478, 13.973227145465108 51.0087115439071, 13.974451602597256 51.00866601369441, 13.97841500742906 51.00763795159668, 13.98030408916344 51.006176346896, 13.982267988433168 51.005712302146385, 13.983589002634906 51.00467296101744, 13.984218990525552 51.00298772536637, 13.99254415584592 51.002639248942764, 13.994591177713277 51.002523790166705))\";\ninput.setField(\"geo\", poly);\nsolrServer.add(input); // to non leader shard",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "author": "David Smiley",
            "id": "comment-16322545",
            "date": "2018-01-11T16:53:44+0000",
            "content": "Need more information, like a stack trace or more specific error.  These will be on the Solr servers.\n\nThe problem seems very strange. "
        }
    ]
}