{
    "id": "LUCENE-82",
    "title": "[PATCH] HTMLParser: IOException: Pipe closed",
    "details": {
        "labels": "",
        "priority": "Minor",
        "components": [
            "modules/analysis"
        ],
        "type": "Bug",
        "fix_versions": [],
        "affect_versions": "1.2",
        "resolution": "Won't Fix",
        "status": "Resolved"
    },
    "description": "When indexing some 550 HTML files, the following exception is raised repeatedly \nafter file 500 but index seems to build OK.\n\njava.io.IOException: Pipe closed\n\tat java.io.PipedReader.receive(Unknown Source)\n\tat java.io.PipedReader.receive(Unknown Source)\n\tat java.io.PipedWriter.write(Unknown Source)\n\tat java.io.Writer.write(Unknown Source)\n\tat java.io.Writer.write(Unknown Source)\n\tat org.apache.lucene.demo.html.HTMLParser.addText(HTMLParser.java:99)\n\tat org.apache.lucene.demo.html.HTMLParser.HTMLDocument\n(HTMLParser.java:155)\n\tat org.apache.lucene.demo.html.ParserThread.run(ParserThread.java:70)\na",
    "attachments": {
        "ASF.LICENSE.NOT.GRANTED--HTMLParserPatch.diff": "https://issues.apache.org/jira/secure/attachment/12312208/ASF.LICENSE.NOT.GRANTED--HTMLParserPatch.diff"
    },
    "issue_links": {},
    "comments": [
        {
            "date": "2003-02-04T01:14:27+0000",
            "content": "Judging from the stack trace, this is not a Lucene bug, but this is much too\nlittle information.\nOS? JDK version?  Anything unusual?  HTML files on a local disk? etc.\n\nIf you can provide information please add it to this bug report and reopen the bug. ",
            "author": "Otis Gospodnetic",
            "id": "comment-12321186"
        },
        {
            "date": "2003-02-15T01:16:10+0000",
            "content": "I started seeing this also, it is not being raised as an exception just dumped \nto System.err.\n\nIn DocumentWriter.invertDocument(Document doc) when you exceed maxFieldLength \nit does stream.close which closes the reader used for input to HTMLParser. The \nstack trace is generated by ParserThread.run() when the IOException occurs as \nthe HTMLParser attempts to write to pipeOut which was closed when the reader \nwas closed from the other thread.\n\nI suppose you could have other IO problems that might raise IOException and you \nwould want to see those end up in your log so you wouldn't want to not report \nthese.\n\nI don't know enough about threading to know if there is some solution to this \nthat would allow IndexWriter to wait for the parser to finish or interrupt it \nbefore closing the reader or for the HTMLParser to notice that its input was \nclosed, so I just wanted to share what I found.\n\nmaxFieldLength is set in IndexWriter and passed in when you construct the \nDocumentWriter:\n  /** The maximum number of terms that will be indexed for a single field in a\n    document.  This limits the amount of memory required for indexing, so that\n    collections with very large files will not crash the indexing process by\n    running out of memory.\n\n    <p>By default, no more than 10,000 terms will be indexed for a field. */\n  public int maxFieldLength = 10000; ",
            "author": "Eric Isakson",
            "id": "comment-12321187"
        },
        {
            "date": "2004-03-10T11:27:17+0000",
            "content": "Created an attachment (id=10739)\nHTMLParser modifications for pipe closed problem ",
            "author": "Eric Isakson",
            "id": "comment-12321188"
        },
        {
            "date": "2004-03-10T11:27:59+0000",
            "content": "I've been able to resolve this with some small tweaks to the HTMLParser code. \nMy changes will make the Pipe Closed message be replaced with a message that \nhopefully is a bit more interpretable by folks that are reading their log \noutput. I'm attaching a patch that I hope will find its way into CVS. The \nHTMLParser.jj file will need to be run through JavaCC as I had to use an older \nversion of JavaCC in my tests (had trouble getting the latest JavaCC) and I \ndidn't want to add its output to the diff. ",
            "author": "Eric Isakson",
            "id": "comment-12321189"
        },
        {
            "date": "2008-01-11T14:46:23+0000",
            "content": "Seems like this issue comes up from time to time, but hasn't been heard from in a while.  We've marked similar versions of this as won't fix.   ",
            "author": "Grant Ingersoll",
            "id": "comment-12558000"
        }
    ]
}