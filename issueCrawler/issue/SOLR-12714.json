{
    "id": "SOLR-12714",
    "title": "Facet query is not working solrcloud",
    "details": {
        "labels": "",
        "priority": "Major",
        "components": [
            "Facet Module",
            "faceting",
            "search",
            "SolrCloud"
        ],
        "type": "Improvement",
        "fix_versions": [],
        "affect_versions": "6.6",
        "resolution": "Invalid",
        "status": "Resolved"
    },
    "description": "Environment:\n\nsolrcloud with two nodes ,Each collection two shard and replication factor 2 ,\n\n\u00a0\n\nsimeple Faceting is not working in solrcloud like below query\n\n/solr/qa-res/select?facet.field=tf_toc_search&facet=on&fq=id:dc65t0-insight_platform_content-1029743-1&indent=on&q=:&wt=json\n\nException information :\n\n\"error\":{ \"metadata\":[ \"error-class\",\"org.apache.solr.common.SolrException\", \"root-error-class\",\"org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException\"], \"msg\":\"org.apache.solr.client.solrj.SolrServerException: No live SolrServers available to handle this request:http://172.22.1.56:8983/solr/qa-res_shard2_replica0, http://172.22.1.56:8983/solr/qa-res_shard1_replica0, http://172.22.0.231:8983/solr/qa-res_shard2_replica1\", \"trace\":\"org.apache.solr.common.SolrException: org.apache.solr.client.solrj.SolrServerException: No live SolrServers available to handle this request:http://172.22.1.56:8983/solr/qa-res_shard2_replica0, http://172.22.1.56:8983/solr/qa-res_shard1_replica0, http://172.22.0.231:8983/solr/qa-res_shard2_replica1\\n\\tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:416)\\n\\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:173)\\n\\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:2477)\\n\\tat org.apache.solr.servlet.HttpSolrCall.execute(HttpSolrCall.java:723)\\n\\tat org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:529)\\n\\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:361)\\n\\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:305)\\n\\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1691)\\n\\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:582)\\n\\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)\\n\\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:548)\\n\\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:226)\\n\\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1180)\\n\\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:512)\\n\\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\\n\\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1112)\\n\\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\\n\\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213)\\n\\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:119)\\n\\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)\\n\\tat org.eclipse.jetty.rewrite.handler.RewriteHandler.handle(RewriteHandler.java:335)\\n\\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)\\n\\tat org.eclipse.jetty.server.Server.handle(Server.java:534)\\n\\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:320)\\n\\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:251)\\n\\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273)\\n\\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)\\n\\tat org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)\\n\\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.executeProduceConsume(ExecuteProduceConsume.java:303)\\n\\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:148)\\n\\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:136)\\n\\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:671)\\n\\tat org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:589)\\n\\tat java.lang.Thread.run(Thread.java:748)\\nCaused by: org.apache.solr.client.solrj.SolrServerException: No live SolrServers available to handle this request:http://172.22.1.56:8983/solr/qa-res_shard2_replica0, http://172.22.1.56:8983/solr/qa-res_shard1_replica0, http://172.22.0.231:8983/solr/qa-res_shard2_replica1\\n\\tat org.apache.solr.client.solrj.impl.LBHttpSolrClient.request(LBHttpSolrClient.java:426)\\n\\tat org.apache.solr.handler.component.HttpShardHandlerFactory.makeLoadBalancedRequest(HttpShardHandlerFactory.java:302)\\n\\tat org.apache.solr.handler.component.HttpShardHandler.lambda$submit$0(HttpShardHandler.java:166)\\n\\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\\n\\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\\n\\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\\n\\tat com.codahale.metrics.InstrumentedExecutorService$InstrumentedRunnable.run(InstrumentedExecutorService.java:176)\\n\\tat org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:229)\\n\\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\\n\\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\\n\\t... 1 more\\nCaused by: org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server at http://172.22.0.231:8983/solr/qa-res_shard2_replica1: Exception during facet.field: tf_toc_search\\n\\tat org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:610)\\n\\tat org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:279)\\n\\tat org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:268)\\n\\tat org.apache.solr.client.solrj.impl.LBHttpSolrClient.doRequest(LBHttpSolrClient.java:447)\\n\\tat org.apache.solr.client.solrj.impl.LBHttpSolrClient.request(LBHttpSolrClient.java:388)\\n\\t... 10 more\\n\", \"code\":500}}",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "date": "2018-08-29T15:52:25+0000",
            "content": "It's pretty unlikely that faceting isn't working at all, I strongly suspect this is some other issue.\n\nSo please ask the question here: solr-user@lucene.apache.org, see: http://lucene.apache.org/solr/community.html#mailing-lists-irc\n\nWhen you raise question on the user's list, include pertinent details, including sample data, queries and responses if possible, along with what you expect to see but don't.\n\nIf the consensus there is that there are code issues, we can reopen this JIRA or create a new one. ",
            "author": "Erick Erickson",
            "id": "comment-16596521"
        },
        {
            "date": "2018-08-30T10:34:58+0000",
            "content": "Certainy, it's not right usage of jira. However, it makes a point - SolrCloud exceptions are cryptic. Is there a Jira for exposing slave's errors rather than/beside of No live SolrServers available.\n\nadeppa the deepest cause we can see here is\u00a0Exception during facet.field: tf_toc_search. If there is no logs left, you can sent the same request to\u00a0\u00a0http://172.22.0.231:8983/solr/qa-res_shard2_replica1\u00a0adding distrib=false parameter. I guess there is a problem with this field like indexed=false or so.\u00a0 \u00a0\u00a0\u00a0 ",
            "author": "Mikhail Khludnev",
            "id": "comment-16597303"
        }
    ]
}