{
    "id": "LUCENE-7422",
    "title": "TestAllFilesCheckIndexHeader failures",
    "details": {
        "resolution": "Fixed",
        "affect_versions": "None",
        "components": [],
        "labels": "",
        "fix_versions": [],
        "priority": "Major",
        "status": "Resolved",
        "type": "Bug"
    },
    "description": "From Policeman Jenkins on master - reproduces for me with Java 1.8 on Linux:\n\n\nBuild: http://jenkins.thetaphi.de/job/Lucene-Solr-master-Linux/17644/\nJava: 32bit/jdk-9-ea+132 -server -XX:+UseParallelGC\n[...]\n  [junit4] Suite: org.apache.lucene.index.TestAllFilesCheckIndexHeader\n  [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=TestAllFilesCheckIndexHeader -Dtests.method=test -Dtests.seed=8133F5B315A4BBBA -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=vai-Latn -Dtests.timezone=America/Fortaleza -Dtests.asserts=true -Dtests.file.encoding=UTF-8\n  [junit4] ERROR   0.32s J2 | TestAllFilesCheckIndexHeader.test <<<\n  [junit4]    > Throwable #1: java.io.IOException: file \"_e.tvx\" was already written to\n  [junit4]    > \tat __randomizedtesting.SeedInfo.seed([8133F5B315A4BBBA:967CA69BB58D642]:0)\n  [junit4]    > \tat org.apache.lucene.store.MockDirectoryWrapper.createOutput(MockDirectoryWrapper.java:654)\n  [junit4]    > \tat org.apache.lucene.index.TestAllFilesCheckIndexHeader.checkOneFile(TestAllFilesCheckIndexHeader.java:106)\n  [junit4]    > \tat org.apache.lucene.index.TestAllFilesCheckIndexHeader.checkIndexHeader(TestAllFilesCheckIndexHeader.java:81)\n  [junit4]    > \tat org.apache.lucene.index.TestAllFilesCheckIndexHeader.test(TestAllFilesCheckIndexHeader.java:74)\n  [junit4]    > \tat jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(java.base@9-ea/Native Method)\n  [junit4]    > \tat jdk.internal.reflect.NativeMethodAccessorImpl.invoke(java.base@9-ea/NativeMethodAccessorImpl.java:62)\n  [junit4]    > \tat jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(java.base@9-ea/DelegatingMethodAccessorImpl.java:43)\n  [junit4]    > \tat java.lang.Thread.run(java.base@9-ea/Thread.java:843)\n  [junit4]   2> NOTE: test params are: codec=Asserting(Lucene62): {}, docValues:{}, maxPointsInLeafNode=690, maxMBSortInHeap=6.334662757981386, sim=ClassicSimilarity, locale=vai-Latn, timezone=America/Fortaleza\n  [junit4]   2> NOTE: Linux 4.4.0-31-generic i386/Oracle Corporation 9-ea (32-bit)/cpus=12,threads=1,free=141938112,total=221249536\n  [junit4]   2> NOTE: All tests run in this JVM: [Test2BBinaryDocValues, TestLucene62SegmentInfoFormat, TestDeterminizeLexicon, Test2BPagedBytes, TestLucene53NormsFormat, TestMultiTermsEnum, TestIndexWriterCommit, TestVersion, TestSpanExplanations, TestRamUsageEstimator, TestIndexWriterReader, TestSparseFixedBitSet, LimitedFiniteStringsIteratorTest, TestDirectMonotonic, Test2BPostingsBytes, TestFuzzyQuery, TestFastCompressionMode, TestPerSegmentDeletes, TestLazyProxSkipping, TestSameScoresWithThreads, TestCollectionUtil, TestBinaryDocValuesUpdates, TestAllFilesCheckIndexHeader]\n  [junit4] Completed [76/432 (1!)] on J2 in 0.33s, 1 test, 1 error <<< FAILURES!\n\n\n\nMy Jenkins found this reproducing seed:\n\n\n   [junit4] Suite: org.apache.lucene.index.TestAllFilesCheckIndexHeader\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=TestAllFilesCheckIndexHeader -Dtests.method=test -Dtests.seed=655499E46A442951 -Dtests.slow=true -Dtests.locale=es-UY -Dtests.timezone=Pacific/Fiji -Dtests.asserts=true -Dtests.file.encoding=UTF-8\n   [junit4] ERROR   0.38s J0 | TestAllFilesCheckIndexHeader.test <<<\n   [junit4]    > Throwable #1: java.io.IOException: file \"_d.nvd\" was already written to\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([655499E46A442951:ED00A63EC4B844A9]:0)\n   [junit4]    > \tat org.apache.lucene.store.MockDirectoryWrapper.createOutput(MockDirectoryWrapper.java:654)\n   [junit4]    > \tat org.apache.lucene.index.TestAllFilesCheckIndexHeader.checkOneFile(TestAllFilesCheckIndexHeader.java:106)\n   [junit4]    > \tat org.apache.lucene.index.TestAllFilesCheckIndexHeader.checkIndexHeader(TestAllFilesCheckIndexHeader.java:81)\n   [junit4]    > \tat org.apache.lucene.index.TestAllFilesCheckIndexHeader.test(TestAllFilesCheckIndexHeader.java:74)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n   [junit4]   2> NOTE: test params are: codec=Asserting(Lucene62): {}, docValues:{}, maxPointsInLeafNode=1437, maxMBSortInHeap=5.3144078057420225, sim=RandomSimilarity(queryNorm=false): {titleTokenized=IB LL-D1, body=DFR I(n)B2}, locale=es-UY, timezone=Pacific/Fiji\n   [junit4]   2> NOTE: Linux 4.1.0-custom2-amd64 amd64/Oracle Corporation 1.8.0_77 (64-bit)/cpus=16,threads=1,free=280750384,total=467664896",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "id": "comment-15433793",
            "author": "Steve Rowe",
            "date": "2016-08-23T22:49:18+0000",
            "content": "More failures, all reproduce for me on master on Linux with Oracle Java 1.8:\n\nFrom my Jenkins on branch_6x:\n\n\n  [junit4] Suite: org.apache.lucene.index.TestAllFilesCheckIndexHeader\n  [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=TestAllFilesCheckIndexHeader -Dtests.method=test -Dtests.seed=5A6CC5DA26D3C1A4 -Dtests.slow=true -Dtests.locale=be-BY -Dtests.timezone=Africa/Khartoum -Dtests.asserts=true -Dtests.file.encoding=UTF-8\n  [junit4] ERROR   0.28s J1 | TestAllFilesCheckIndexHeader.test <<<\n  [junit4]    > Throwable #1: java.io.IOException: file \"_b_Lucene50_0.tip\" was already written to\n  [junit4]    > \tat __randomizedtesting.SeedInfo.seed([5A6CC5DA26D3C1A4:D238FA00882FAC5C]:0)\n  [junit4]    > \tat org.apache.lucene.store.MockDirectoryWrapper.createOutput(MockDirectoryWrapper.java:654)\n  [junit4]    > \tat org.apache.lucene.index.TestAllFilesCheckIndexHeader.checkOneFile(TestAllFilesCheckIndexHeader.java:106)\n  [junit4]    > \tat org.apache.lucene.index.TestAllFilesCheckIndexHeader.checkIndexHeader(TestAllFilesCheckIndexHeader.java:81)\n  [junit4]    > \tat org.apache.lucene.index.TestAllFilesCheckIndexHeader.test(TestAllFilesCheckIndexHeader.java:74)\n  [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n  [junit4]   2> NOTE: test params are: codec=Asserting(Lucene62): {}, docValues:{}, maxPointsInLeafNode=1222, maxMBSortInHeap=6.408958882057837, sim=ClassicSimilarity, locale=be-BY, timezone=Africa/Khartoum\n  [junit4]   2> NOTE: Linux 4.1.0-custom2-amd64 amd64/Oracle Corporation 1.8.0_77 (64-bit)/cpus=16,threads=1,free=179210024,total=335544320\n\n\n\nFrom Policeman Jenkins http://jenkins.thetaphi.de/job/Lucene-Solr-6.x-Solaris/305/:\n\n\n  [junit4] Suite: org.apache.lucene.index.TestAllFilesCheckIndexHeader\n  [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=TestAllFilesCheckIndexHeader -Dtests.method=test -Dtests.seed=2E0418A659C57B7A -Dtests.slow=true -Dtests.locale=sr -Dtests.timezone=ART -Dtests.asserts=true -Dtests.file.encoding=US-ASCII\n  [junit4] ERROR   0.21s J0 | TestAllFilesCheckIndexHeader.test <<<\n  [junit4]    > Throwable #1: java.io.IOException: file \"segments_h\" was already written to\n  [junit4]    > \tat __randomizedtesting.SeedInfo.seed([2E0418A659C57B7A:A650277CF7391682]:0)\n  [junit4]    > \tat org.apache.lucene.store.MockDirectoryWrapper.createOutput(MockDirectoryWrapper.java:654)\n  [junit4]    > \tat org.apache.lucene.index.TestAllFilesCheckIndexHeader.checkOneFile(TestAllFilesCheckIndexHeader.java:106)\n  [junit4]    > \tat org.apache.lucene.index.TestAllFilesCheckIndexHeader.checkIndexHeader(TestAllFilesCheckIndexHeader.java:81)\n  [junit4]    > \tat org.apache.lucene.index.TestAllFilesCheckIndexHeader.test(TestAllFilesCheckIndexHeader.java:74)\n  [junit4]    > \tat java.lang.Thread.run(Thread.java:745)\n  [junit4]   2> NOTE: test params are: codec=Asserting(Lucene62): {}, docValues:{}, maxPointsInLeafNode=584, maxMBSortInHeap=7.177520307448994, sim=RandomSimilarity(queryNorm=false,coord=yes): {titleTokenized=DFR I(n)3(800.0), body=DFR I(ne)L2}, locale=sr, timezone=ART\n  [junit4]   2> NOTE: SunOS 5.11 amd64/Oracle Corporation 1.8.0_102 (64-bit)/cpus=3,threads=1,free=158399008,total=341835776\n\n "
        },
        {
            "id": "comment-15436748",
            "author": "ASF subversion and git services",
            "date": "2016-08-25T12:21:25+0000",
            "content": "Commit 18306628a9658fe6b9fcb1e409e63a5876257e84 in lucene-solr's branch refs/heads/master from Robert Muir\n[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1830662 ]\n\nLUCENE-7422: fix bugs in test's retry loop "
        },
        {
            "id": "comment-15436753",
            "author": "Robert Muir",
            "date": "2016-08-25T12:25:58+0000",
            "content": "test bug: this test relied upon the ability to overwrite, if it ever entered its rare retry loop. "
        },
        {
            "id": "comment-15436785",
            "author": "Steve Rowe",
            "date": "2016-08-25T12:55:30+0000",
            "content": "For some reason the branch_6x commit didn't get posted here - from the email notification:\n\n\nLUCENE-7422: fix bugs in test's retry loop\n\nProject: http://git-wip-us.apache.org/repos/asf/lucene-solr/repo\nCommit: http://git-wip-us.apache.org/repos/asf/lucene-solr/commit/e3b08517\nTree: http://git-wip-us.apache.org/repos/asf/lucene-solr/tree/e3b08517\nDiff: http://git-wip-us.apache.org/repos/asf/lucene-solr/diff/e3b08517\n\nBranch: refs/heads/branch_6x\nCommit: e3b08517c56307e75fc2d74c10efd52cd353feef\nParents: 2fcccc0\nAuthor: Robert Muir <rmuir@apache.org>\nAuthored: Thu Aug 25 08:20:53 2016 -0400\nCommitter: Robert Muir <rmuir@apache.org>\nCommitted: Thu Aug 25 08:22:26 2016 -0400 "
        }
    ]
}