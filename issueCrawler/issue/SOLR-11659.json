{
    "id": "SOLR-11659",
    "title": "JMX Metrics ObjectName needs comma escaping for /solr/col1,col2/select scenario",
    "details": {
        "labels": "",
        "priority": "Major",
        "components": [
            "metrics"
        ],
        "type": "Bug",
        "fix_versions": [],
        "affect_versions": "7.2",
        "resolution": "Unresolved",
        "status": "Open"
    },
    "description": "As of SOLR-11444 it's possible to query Solr with /solr/col1,col2/select and query both.  Some of Solr's JMX stuff apparently can't handle this.  I found the following exception during testing in AliasIntegrationTest.test line 240 (when uncommented) and with a particular seed that for whatever reason isn't reproducing for me as I write this.\n\n\n10387 ERROR (qtp547916181-25) [n:127.0.0.1:57605_solr    ] o.a.s.s.HttpSolrCall null:java.lang.RuntimeException: solr_57605:dom1=solr,dom2=node,category=UPDATE,scope=updateShardHandler,name=http_//127.0.0.1_57604/solr/testalias4,testalias5/select.get.requests\n\tat org.apache.solr.metrics.reporters.jmx.JmxObjectNameFactory.createName(JmxObjectNameFactory.java:169)\n\tat org.apache.solr.metrics.reporters.jmx.JmxMetricsReporter$JmxListener.createName(JmxMetricsReporter.java:692)\n\tat org.apache.solr.metrics.reporters.jmx.JmxMetricsReporter$JmxListener.onTimerAdded(JmxMetricsReporter.java:669)\n\tat com.codahale.metrics.MetricRegistry.notifyListenerOfAddedMetric(MetricRegistry.java:462)\n\tat com.codahale.metrics.MetricRegistry.onMetricAdded(MetricRegistry.java:448)\n\tat com.codahale.metrics.MetricRegistry.register(MetricRegistry.java:89)\n\tat com.codahale.metrics.MetricRegistry.getOrAdd(MetricRegistry.java:423)\n\tat com.codahale.metrics.MetricRegistry.timer(MetricRegistry.java:211)\n\tat org.apache.solr.util.stats.InstrumentedHttpRequestExecutor.timer(InstrumentedHttpRequestExecutor.java:127)\n\tat org.apache.solr.util.stats.InstrumentedHttpRequestExecutor.execute(InstrumentedHttpRequestExecutor.java:115)\n\tat org.apache.http.impl.execchain.MainClientExec.execute(MainClientExec.java:272)\n\tat org.apache.http.impl.execchain.ProtocolExec.execute(ProtocolExec.java:185)\n\tat org.apache.http.impl.execchain.RetryExec.execute(RetryExec.java:89)\n\tat org.apache.http.impl.execchain.RedirectExec.execute(RedirectExec.java:111)\n\tat org.apache.http.impl.client.InternalHttpClient.doExecute(InternalHttpClient.java:185)\n\tat org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:83)\n\tat org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:56)\n\tat org.apache.solr.servlet.HttpSolrCall.remoteQuery(HttpSolrCall.java:618)\n\tat org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:500)\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:382)\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:326)\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1759)\n\tat org.apache.solr.client.solrj.embedded.JettySolrRunner$DebugFilter.doFilter(JettySolrRunner.java:139)\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1759)\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:582)\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:224)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1180)\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:512)\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1112)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n\tat org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:493)\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)\n\tat org.eclipse.jetty.server.Server.handle(Server.java:534)\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:320)\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:251)\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:283)\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:108)\n\tat org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.executeProduceConsume(ExecuteProduceConsume.java:303)\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:148)\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:136)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:671)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:589)\n\tat java.lang.Thread.run(Thread.java:745)\nCaused by: javax.management.MalformedObjectNameException: Unterminated key property part\n\tat javax.management.ObjectName.construct(ObjectName.java:556)\n\tat javax.management.ObjectName.<init>(ObjectName.java:1382)\n\tat org.apache.solr.metrics.reporters.jmx.JmxObjectNameFactory.createName(JmxObjectNameFactory.java:167)\n\t... 44 more",
    "attachments": {},
    "issue_links": {},
    "comments": []
}