{
    "id": "SOLR-9162",
    "title": "Connection pool shut down",
    "details": {
        "components": [],
        "type": "Bug",
        "labels": "",
        "fix_versions": [],
        "affect_versions": "None",
        "status": "Open",
        "resolution": "Unresolved",
        "priority": "Major"
    },
    "description": "We get an \"Connection pool shut down\"\"  error  when  upgrading to solr 6.0 ,\nvia  solr JDBC\n\nAnd here's the exception:\n\n  2016-05-26 10:41:30.903 b.s.m.n.Server [INFO] Getting metrics for server on port 6700\n2016-05-26 10:42:13.962 o.a.s.c.S.Request [INFO] [systemTables_shard2_replica1]  webapp=/solr path=/sql params=\n{includeMetadata=true&wt=json&version=2.2&stmt=select+table_name,id+from+systemTables+order+by+id++limit+100&aggregationMode=facet}\n status=0 QTime=1\n2016-05-26 10:42:13.983 o.a.s.c.s.i.s.ExceptionStream [ERROR] java.io.IOException: java.util.concurrent.ExecutionException: java.io.IOException: java.lang.IllegalStateException: Connection pool shut down\n\tat org.apache.solr.client.solrj.io.stream.CloudSolrStream.openStreams(CloudSolrStream.java:361)\n\tat org.apache.solr.client.solrj.io.stream.CloudSolrStream.open(CloudSolrStream.java:243)\n\tat org.apache.solr.handler.SQLHandler$LimitStream.open(SQLHandler.java:1265)\n\tat org.apache.solr.client.solrj.io.stream.SelectStream.open(SelectStream.java:153)\n\tat org.apache.solr.handler.SQLHandler$MetadataStream.open(SQLHandler.java:1511)\n\tat org.apache.solr.client.solrj.io.stream.ExceptionStream.open(ExceptionStream.java:47)\n\tat org.apache.solr.handler.StreamHandler$TimerStream.open(StreamHandler.java:362)\n\tat org.apache.solr.response.TextResponseWriter.writeTupleStream(TextResponseWriter.java:301)\n\tat org.apache.solr.response.TextResponseWriter.writeVal(TextResponseWriter.java:167)\n\tat org.apache.solr.response.JSONWriter.writeNamedListAsMapWithDups(JSONResponseWriter.java:183)\n\tat org.apache.solr.response.JSONWriter.writeNamedList(JSONResponseWriter.java:299)\n\tat org.apache.solr.response.JSONWriter.writeResponse(JSONResponseWriter.java:95)\n\tat org.apache.solr.response.JSONResponseWriter.write(JSONResponseWriter.java:60)\n\tat org.apache.solr.response.QueryResponseWriterUtil.writeQueryResponse(QueryResponseWriterUtil.java:65)\n\tat org.apache.solr.servlet.HttpSolrCall.writeResponse(HttpSolrCall.java:725)\n\tat org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:469)\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:229)\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:184)\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676)\n\tat org.apache.solr.client.solrj.embedded.JettySolrRunner$DebugFilter.doFilter(JettySolrRunner.java:109)\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676)\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:581)\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:224)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1160)\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:511)\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1092)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n\tat org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:399)\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)\n\tat org.eclipse.jetty.server.Server.handle(Server.java:518)\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:308)\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:244)\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273)\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)\n\tat org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceAndRun(ExecuteProduceConsume.java:246)\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:156)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:654)\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:572)\n\tat java.lang.Thread.run(Thread.java:745)\nCaused by: java.util.concurrent.ExecutionException: java.io.IOException: java.lang.IllegalStateException: Connection pool shut down\n\tat java.util.concurrent.FutureTask.report(FutureTask.java:122)\n\tat java.util.concurrent.FutureTask.get(FutureTask.java:192)\n\tat org.apache.solr.client.solrj.io.stream.CloudSolrStream.openStreams(CloudSolrStream.java:355)\n\t... 40 more\nCaused by: java.io.IOException: java.lang.IllegalStateException: Connection pool shut down\n\tat org.apache.solr.client.solrj.io.stream.SolrStream.open(SolrStream.java:97)\n\tat org.apache.solr.client.solrj.io.stream.CloudSolrStream$StreamOpener.call(CloudSolrStream.java:470)\n\tat org.apache.solr.client.solrj.io.stream.CloudSolrStream$StreamOpener.call(CloudSolrStream.java:459)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\n\tat org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$15(ExecutorUtil.java:229)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\t... 1 more\nCaused by: java.lang.IllegalStateException: Connection pool shut down\n\tat org.apache.http.util.Asserts.check(Asserts.java:34)\n\tat org.apache.http.pool.AbstractConnPool.lease(AbstractConnPool.java:184)\n\tat org.apache.http.pool.AbstractConnPool.lease(AbstractConnPool.java:217)\n\tat org.apache.http.impl.conn.PoolingClientConnectionManager.requestConnection(PoolingClientConnectionManager.java:184)\n\tat org.apache.http.impl.client.DefaultRequestDirector.execute(DefaultRequestDirector.java:415)\n\tat org.apache.http.impl.client.AbstractHttpClient.doExecute(AbstractHttpClient.java:882)\n\tat org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:82)\n\tat org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:107)\n\tat org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:55)\n\tat org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:482)\n\tat org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:241)\n\tat org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:230)\n\tat org.apache.solr.client.solrj.SolrClient.request(SolrClient.java:1219)\n\tat org.apache.solr.client.solrj.io.stream.JSONTupleStream.create(JSONTupleStream.java:66)\n\tat org.apache.solr.client.solrj.io.stream.SolrStream.open(SolrStream.java:95)\n\t... 7 more",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "date": "2016-05-26T03:26:53+0000",
            "author": "Erick Erickson",
            "content": "Please bring this kind of question up first on the user's list. There is so little information in this JIRA that there is virtually no chance of figuring out what the issue is. It looks like you're using some of the streaming aggregation. But you haven't provided the SolrJ code you were using, any clue about what you are trying to do etc. You might want to review:\n\nhttp://wiki.apache.org/solr/UsingMailingLists ",
            "id": "comment-15301466"
        }
    ]
}