{
    "id": "SOLR-3461",
    "title": "TestRealTimeGet.testStressRecovery() is sometimes very slow on Windows, using al CPUs",
    "details": {
        "affect_versions": "4.0-ALPHA",
        "status": "Open",
        "fix_versions": [],
        "components": [
            "update"
        ],
        "type": "Bug",
        "priority": "Major",
        "labels": "",
        "resolution": "Unresolved"
    },
    "description": "I already noticed that on my local machine (Thinkpad Laptop with SSD), but\nI was thinking it might be my slow IO system (thanks Robert for this\nrunning-gag). But when reviewing test times on the new Jenkins Windows\nbuild server, this test takes very long (around 30 minutes, which is half\nof the complete time when running with 1 test runner on 2 cores).\n\nThere must be something that makes this test very slow on Windows:\nhttp://goo.gl/irDVw\n\nThe method taking so long is actually \"testStressRecovery\", I would like\nto @Ignore it until it is fixed. It makes running Solr tests in Windows\ntake ages and stops me from running them at all",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "author": "Uwe Schindler",
            "id": "comment-13276777",
            "date": "2012-05-16T14:54:42+0000",
            "content": "I investigated:\nIt is not related to Codecs or something like that, testStressRecovery uses Solr's API and not Lucene's API. It sometimes is very slow, this cannot always reproduced with the seed. So there must be some Windows-only deadlock/starvation-like problem, or maybe related to 2 cores like on the Jenkins Windows machine or my local laptop.\n\nI added an assumeFalse(Constants.WINDOWS) for now. "
        },
        {
            "author": "Uwe Schindler",
            "id": "comment-13276779",
            "date": "2012-05-16T14:55:28+0000",
            "content": "Committed test supression on windows at revision: 1339209 "
        },
        {
            "author": "Jack Krupansky",
            "id": "comment-13277230",
            "date": "2012-05-16T22:53:01+0000",
            "content": "It runs reasonably on my Windows 7 i5-based notebook PC:\n\n   [junit4] Suite: org.apache.solr.search.TestRealTimeGet\n   [junit4] Completed on J1 in 130.37s, 8 tests "
        },
        {
            "author": "Jack Krupansky",
            "id": "comment-13277269",
            "date": "2012-05-16T23:48:00+0000",
            "content": "With the change, the test went from 130 seconds to 20. Even though 130 sec is nowhere near as slow as your 30 minutes, 2 minutes is still a long time. It was taking 10 seconds in the nightly build yesterday.\n\nFrom my latest local test run:\n\n   [junit4] Suite: org.apache.solr.search.TestRealTimeGet\n   [junit4] IGNOR/A 0.04s J1 | TestRealTimeGet.testStressRecovery\n   [junit4]    > Assumption #1: FIXME: This test is horribly slow sometimes on Windows!\n   [junit4] Completed on J1 in 19.24s, 8 tests, 1 skipped "
        },
        {
            "author": "Uwe Schindler",
            "id": "comment-13277687",
            "date": "2012-05-17T09:22:06+0000",
            "content": "It is not always slow, but I have seen the 30 minute runs now on 3 different PCs running:\n\n\n\t64 bit Java 1.6.0_32 or 1.7.0_u4 Server JVM\n\tWindows 7 Professional\n\t>= 2 CPUs\n\n\n\nSo this needs fixing, sorry. Maybe you don't see the issue there is still something wrong. "
        },
        {
            "author": "Uwe Schindler",
            "id": "comment-13277688",
            "date": "2012-05-17T09:23:48+0000",
            "content": "It is slow in 80% of all cases for the following test seed:\n\nant test -Dtests.seed=4877EC7806E56AF3 "
        },
        {
            "author": "Dawid Weiss",
            "id": "comment-13279472",
            "date": "2012-05-19T07:33:44+0000",
            "content": "I ran the above 20 times (windows 7, 64 bit, 4 ht cores (8 logical)).\n\nAll times were sensible:\n\nTotal time: 3 minutes 50 seconds\nTotal time: 3 minutes 43 seconds\nTotal time: 3 minutes 49 seconds\nTotal time: 3 minutes 45 seconds\nTotal time: 3 minutes 27 seconds\nTotal time: 3 minutes 50 seconds\nTotal time: 4 minutes 9 seconds\nTotal time: 3 minutes 42 seconds\nTotal time: 3 minutes 35 seconds\nTotal time: 3 minutes 55 seconds\nTotal time: 3 minutes 36 seconds\nTotal time: 3 minutes 42 seconds\nTotal time: 4 minutes 8 seconds\nTotal time: 3 minutes 54 seconds\nTotal time: 3 minutes 15 seconds\nTotal time: 4 minutes 2 seconds\nTotal time: 3 minutes 48 seconds\nTotal time: 3 minutes 57 seconds\nTotal time: 3 minutes 49 seconds\nTotal time: 3 minutes 44 seconds\n\n\n\nI did encounter two failures though:\n\n\n   [junit4] Suite: org.apache.solr.cloud.OverseerTest\n   [junit4]    > (@BeforeClass output)\n   [junit4]   2> Creating dataDir: c:\\Work\\lucene-solr\\solr\\build\\solr-core\\test\\J2\\.\\solrtest-OverseerTest-1337375903710\n   [junit4]   2> \n   [junit4] FAILURE 16.5s J2 | OverseerTest.testShardLeaderChange\n   [junit4]    > Throwable #1: org.junit.ComparisonFailure: Unexpected shard leader coll:collection1 shard:shard1 expected:<core[1]> but was:<core[4]>\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([4877EC7806E56AF3:96246B8F1C7D9F02]:0)\n   [junit4]    > \tat org.junit.Assert.assertEquals(Assert.java:125)\n   [junit4]    > \tat org.apache.solr.cloud.OverseerTest.verifyShardLeader(OverseerTest.java:550)\n   [junit4]    > \tat org.apache.solr.cloud.OverseerTest.testShardLeaderChange(OverseerTest.java:709)\n   [junit4]    > \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n   [junit4]    > \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n   [junit4]    > \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n   [junit4]    > \tat java.lang.reflect.Method.invoke(Method.java:601)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1969)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner.access$1100(RandomizedRunner.java:132)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:814)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:875)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:889)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:53)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:50)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleFieldCacheSanity$1.evaluate(TestRuleFieldCacheSanity.java:32)\n   [junit4]    > \tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:55)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleReportUncaughtExceptions$1.evaluate(TestRuleReportUncaughtExceptions.java:68)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:48)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:821)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner.access$700(RandomizedRunner.java:132)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner$3$1.run(RandomizedRunner.java:669)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner$3.evaluate(RandomizedRunner.java:695)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner$4.evaluate(RandomizedRunner.java:734)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:745)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:53)\n   [junit4]    > \tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleReportUncaughtExceptions$1.evaluate(TestRuleReportUncaughtExceptions.java:68)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleIcuHack$1.evaluate(TestRuleIcuHack.java:51)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:55)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleNoInstanceHooksOverrides$1.evaluate(TestRuleNoInstanceHooksOverrides.java:53)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleNoStaticHooksShadowing$1.evaluate(TestRuleNoStaticHooksShadowing.java:52)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:36)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:56)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSuite(RandomizedRunner.java:605)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner.access$400(RandomizedRunner.java:132)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner$2.run(RandomizedRunner.java:551)\n   [junit4]    > \n   [junit4]   2> 44476 T3 oasc.CoreContainer.finalize SEVERE CoreContainer was not shutdown prior to finalize(), indicates a bug -- POSSIBLE RESOURCE LEAK!!!  instance=1604799699\n   [junit4]   2> NOTE: reproduce with: ant test -Dtestcase=OverseerTest -Dtests.method=testShardLeaderChange -Dtests.seed=4877EC7806E56AF3 -Dtests.locale=ms -Dtests.timezone=Turkey -Dargs=\"-Dfile.encoding=Cp1252\"\n   [junit4]   2>\n   [junit4]    > (@AfterClass output)\n   [junit4]   2> NOTE: test params are: codec=Lucene40, sim=DefaultSimilarity, locale=ms, timezone=Turkey\n   [junit4]   2> NOTE: Windows 7 6.1 amd64/Oracle Corporation 1.7.0_03 (64-bit)/cpus=8,threads=2,free=205266912,total=237568000\n   [junit4]   2> NOTE: All tests run in this JVM: [LeaderElectionIntegrationTest, ResourceLoaderTest, TestSwedishLightStemFilterFactory, TestNGramFilters, TestElisionFilterFactory, RequestHandlersTest, SpatialFilterTest, JSONWriterTest, TestLFUCache, UniqFieldsUpdateProcessorFactoryTest, DistanceFunctionTest, TestRecovery, TestEnglishMinimalStemFilterFactory, DirectSolrConnectionTest, BadComponentTest, TestIBSimilarityFactory, TestCoreContainer, BinaryUpdateRequestHandlerTest, OverseerTest]\n   [junit4]   2> \n   [junit4] Completed on J2 in 56.89s, 7 tests, 1 failure <<< FAILURES!\n\n\n\nThis one does not reproduce. And another one:\n\n\n   [junit4] Suite: org.apache.solr.spelling.suggest.SuggesterWFSTTest\n   [junit4]    > (@BeforeClass output)\n   [junit4]   2> Creating dataDir: c:\\Work\\lucene-solr\\solr\\build\\solr-core\\test\\J1\\.\\solrtest-SuggesterWFSTTest-1337378283624\n   [junit4]   2> \n   [junit4] ERROR   0.10s J1 | SuggesterWFSTTest.testRebuild\n   [junit4]    > Throwable #1: java.lang.RuntimeException: Exception during query\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([4877EC7806E56AF3:13524E3B32E51069]:0)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:454)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:421)\n   [junit4]    > \tat org.apache.solr.spelling.suggest.SuggesterTest.testRebuild(SuggesterTest.java:105)\n   [junit4]    > \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n   [junit4]    > \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n   [junit4]    > \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n   [junit4]    > \tat java.lang.reflect.Method.invoke(Method.java:601)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1969)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner.access$1100(RandomizedRunner.java:132)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:814)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:875)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:889)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:53)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:50)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleFieldCacheSanity$1.evaluate(TestRuleFieldCacheSanity.java:32)\n   [junit4]    > \tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:55)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleReportUncaughtExceptions$1.evaluate(TestRuleReportUncaughtExceptions.java:68)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:48)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:821)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner.access$700(RandomizedRunner.java:132)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner$3$1.run(RandomizedRunner.java:669)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner$3.evaluate(RandomizedRunner.java:695)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner$4.evaluate(RandomizedRunner.java:734)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:745)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:53)\n   [junit4]    > \tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleReportUncaughtExceptions$1.evaluate(TestRuleReportUncaughtExceptions.java:68)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleIcuHack$1.evaluate(TestRuleIcuHack.java:51)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:55)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleNoInstanceHooksOverrides$1.evaluate(TestRuleNoInstanceHooksOverrides.java:53)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleNoStaticHooksShadowing$1.evaluate(TestRuleNoStaticHooksShadowing.java:52)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:36)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n   [junit4]    > \tat org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:56)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSuite(RandomizedRunner.java:605)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner.access$400(RandomizedRunner.java:132)\n   [junit4]    > \tat com.carrotsearch.randomizedtesting.RandomizedRunner$2.run(RandomizedRunner.java:551)\n   [junit4]    > Caused by: java.lang.NullPointerException\n   [junit4]    > \tat org.apache.lucene.search.suggest.fst.WFSTCompletionLookup.lookupPrefix(WFSTCompletionLookup.java:193)\n   [junit4]    > \tat org.apache.lucene.search.suggest.fst.WFSTCompletionLookup.lookup(WFSTCompletionLookup.java:155)\n   [junit4]    > \tat org.apache.solr.spelling.suggest.Suggester.getSuggestions(Suggester.java:187)\n   [junit4]    > \tat org.apache.solr.handler.component.SpellCheckComponent.process(SpellCheckComponent.java:150)\n   [junit4]    > \tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:204)\n   [junit4]    > \tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:129)\n   [junit4]    > \tat org.apache.solr.core.SolrCore.execute(SolrCore.java:1555)\n   [junit4]    > \tat org.apache.solr.util.TestHarness.query(TestHarness.java:357)\n   [junit4]    > \tat org.apache.solr.util.TestHarness.query(TestHarness.java:340)\n   [junit4]    > \tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:428)\n   [junit4]    > \t... 39 more\n   [junit4]    > \n   [junit4]   2> 110 T581 oashc.SpellCheckComponent$SpellCheckerListener.newSearcher SEVERE Exception in reloading spell check index for spellchecker: suggest java.io.FileNotFoundException: c:\\Work\\lucene-solr\\solr\\build\\solr-core\\test\\J1\\.\\solrtest-SuggesterWFSTTest-1337378283624\\suggest\\jaspell.dat (The system cannot find the file specified)\n   [junit4]   2> \tat java.io.FileInputStream.open(Native Method)\n   [junit4]   2> \tat java.io.FileInputStream.<init>(FileInputStream.java:138)\n   [junit4]   2> \tat org.apache.solr.spelling.suggest.Suggester.reload(Suggester.java:163)\n   [junit4]   2> \tat org.apache.solr.handler.component.SpellCheckComponent$SpellCheckerListener.newSearcher(SpellCheckComponent.java:607)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore$3.call(SolrCore.java:1335)\n   [junit4]   2> \tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\n   [junit4]   2> \tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\n   [junit4]   2> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n   [junit4]   2> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n   [junit4]   2> \tat java.lang.Thread.run(Thread.java:722)\n   [junit4]   2> \n   [junit4]   2> 135 T581 oashc.SpellCheckComponent$SpellCheckerListener.newSearcher SEVERE Exception in reloading spell check index for spellchecker: suggest_tst java.io.FileNotFoundException: c:\\Work\\lucene-solr\\solr\\build\\solr-core\\test\\J1\\.\\solrtest-SuggesterWFSTTest-1337378283624\\suggest_tst\\tst.dat (The system cannot find the file specified)\n   [junit4]   2> \tat java.io.FileInputStream.open(Native Method)\n   [junit4]   2> \tat java.io.FileInputStream.<init>(FileInputStream.java:138)\n   [junit4]   2> \tat org.apache.solr.spelling.suggest.Suggester.reload(Suggester.java:163)\n   [junit4]   2> \tat org.apache.solr.handler.component.SpellCheckComponent$SpellCheckerListener.newSearcher(SpellCheckComponent.java:607)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore$3.call(SolrCore.java:1335)\n   [junit4]   2> \tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\n   [junit4]   2> \tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\n   [junit4]   2> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n   [junit4]   2> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n   [junit4]   2> \tat java.lang.Thread.run(Thread.java:722)\n   [junit4]   2> \n   [junit4]   2> 135 T581 oashc.SpellCheckComponent$SpellCheckerListener.newSearcher SEVERE Exception in reloading spell check index for spellchecker: suggest_fst java.io.FileNotFoundException: c:\\Work\\lucene-solr\\solr\\build\\solr-core\\test\\J1\\.\\solrtest-SuggesterWFSTTest-1337378283624\\suggest_fst\\fst.bin (The system cannot find the file specified)\n   [junit4]   2> \tat java.io.FileInputStream.open(Native Method)\n   [junit4]   2> \tat java.io.FileInputStream.<init>(FileInputStream.java:138)\n   [junit4]   2> \tat org.apache.solr.spelling.suggest.Suggester.reload(Suggester.java:163)\n   [junit4]   2> \tat org.apache.solr.handler.component.SpellCheckComponent$SpellCheckerListener.newSearcher(SpellCheckComponent.java:607)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore$3.call(SolrCore.java:1335)\n   [junit4]   2> \tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\n   [junit4]   2> \tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\n   [junit4]   2> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n   [junit4]   2> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n   [junit4]   2> \tat java.lang.Thread.run(Thread.java:722)\n   [junit4]   2> \n   [junit4]   2> 136 T581 oashc.SpellCheckComponent$SpellCheckerListener.newSearcher SEVERE Exception in reloading spell check index for spellchecker: suggest_wfst java.io.FileNotFoundException: c:\\Work\\lucene-solr\\solr\\build\\solr-core\\test\\J1\\.\\solrtest-SuggesterWFSTTest-1337378283624\\suggest_wfst\\wfst.bin (The system cannot find the file specified)\n   [junit4]   2> \tat java.io.FileInputStream.open(Native Method)\n   [junit4]   2> \tat java.io.FileInputStream.<init>(FileInputStream.java:138)\n   [junit4]   2> \tat org.apache.solr.spelling.suggest.Suggester.reload(Suggester.java:163)\n   [junit4]   2> \tat org.apache.solr.handler.component.SpellCheckComponent$SpellCheckerListener.newSearcher(SpellCheckComponent.java:607)\n   [junit4]   2> \tat org.apache.solr.core.SolrCore$3.call(SolrCore.java:1335)\n   [junit4]   2> \tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\n   [junit4]   2> \tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\n   [junit4]   2> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n   [junit4]   2> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n   [junit4]   2> \tat java.lang.Thread.run(Thread.java:722)\n   [junit4]   2> \n   [junit4]   2> ASYNC  NEW_CORE C1 name=collection1 org.apache.solr.core.SolrCore@f4bae25\n   [junit4]   2> 139 T580 C1 oasc.SolrException.log SEVERE java.lang.NullPointerException\n   [junit4]   2> \t\tat org.apache.lucene.search.suggest.fst.WFSTCompletionLookup.lookupPrefix(WFSTCompletionLookup.java:193)\n   [junit4]   2> \t\tat org.apache.lucene.search.suggest.fst.WFSTCompletionLookup.lookup(WFSTCompletionLookup.java:155)\n   [junit4]   2> \t\tat org.apache.solr.spelling.suggest.Suggester.getSuggestions(Suggester.java:187)\n   [junit4]   2> \t\tat org.apache.solr.handler.component.SpellCheckComponent.process(SpellCheckComponent.java:150)\n   [junit4]   2> \t\tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:204)\n   [junit4]   2> \t\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:129)\n   [junit4]   2> \t\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:1555)\n   [junit4]   2> \t\tat org.apache.solr.util.TestHarness.query(TestHarness.java:357)\n   [junit4]   2> \t\tat org.apache.solr.util.TestHarness.query(TestHarness.java:340)\n   [junit4]   2> \t\tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:428)\n   [junit4]   2> \t\tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:421)\n   [junit4]   2> \t\tat org.apache.solr.spelling.suggest.SuggesterTest.testRebuild(SuggesterTest.java:105)\n   [junit4]   2> \t\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n   [junit4]   2> \t\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n   [junit4]   2> \t\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n   [junit4]   2> \t\tat java.lang.reflect.Method.invoke(Method.java:601)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1969)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner.access$1100(RandomizedRunner.java:132)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:814)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:875)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:889)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:53)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:50)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleFieldCacheSanity$1.evaluate(TestRuleFieldCacheSanity.java:32)\n   [junit4]   2> \t\tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:55)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleReportUncaughtExceptions$1.evaluate(TestRuleReportUncaughtExceptions.java:68)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:48)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:821)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner.access$700(RandomizedRunner.java:132)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner$3$1.run(RandomizedRunner.java:669)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner$3.evaluate(RandomizedRunner.java:695)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner$4.evaluate(RandomizedRunner.java:734)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:745)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:53)\n   [junit4]   2> \t\tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleReportUncaughtExceptions$1.evaluate(TestRuleReportUncaughtExceptions.java:68)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleIcuHack$1.evaluate(TestRuleIcuHack.java:51)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:55)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleNoInstanceHooksOverrides$1.evaluate(TestRuleNoInstanceHooksOverrides.java:53)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleNoStaticHooksShadowing$1.evaluate(TestRuleNoStaticHooksShadowing.java:52)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:36)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:56)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSuite(RandomizedRunner.java:605)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner.access$400(RandomizedRunner.java:132)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner$2.run(RandomizedRunner.java:551)\n   [junit4]   2> \t\n   [junit4]   2> 142 T580 oasc.SolrException.log SEVERE REQUEST FAILED: q=ac&spellcheck.count=2&qt=/suggest_wfst&spellcheck.onlyMorePopular=true:java.lang.NullPointerException\n   [junit4]   2> \t\tat org.apache.lucene.search.suggest.fst.WFSTCompletionLookup.lookupPrefix(WFSTCompletionLookup.java:193)\n   [junit4]   2> \t\tat org.apache.lucene.search.suggest.fst.WFSTCompletionLookup.lookup(WFSTCompletionLookup.java:155)\n   [junit4]   2> \t\tat org.apache.solr.spelling.suggest.Suggester.getSuggestions(Suggester.java:187)\n   [junit4]   2> \t\tat org.apache.solr.handler.component.SpellCheckComponent.process(SpellCheckComponent.java:150)\n   [junit4]   2> \t\tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:204)\n   [junit4]   2> \t\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:129)\n   [junit4]   2> \t\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:1555)\n   [junit4]   2> \t\tat org.apache.solr.util.TestHarness.query(TestHarness.java:357)\n   [junit4]   2> \t\tat org.apache.solr.util.TestHarness.query(TestHarness.java:340)\n   [junit4]   2> \t\tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:428)\n   [junit4]   2> \t\tat org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:421)\n   [junit4]   2> \t\tat org.apache.solr.spelling.suggest.SuggesterTest.testRebuild(SuggesterTest.java:105)\n   [junit4]   2> \t\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n   [junit4]   2> \t\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n   [junit4]   2> \t\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n   [junit4]   2> \t\tat java.lang.reflect.Method.invoke(Method.java:601)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1969)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner.access$1100(RandomizedRunner.java:132)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:814)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:875)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:889)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:53)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:50)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleFieldCacheSanity$1.evaluate(TestRuleFieldCacheSanity.java:32)\n   [junit4]   2> \t\tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:55)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleReportUncaughtExceptions$1.evaluate(TestRuleReportUncaughtExceptions.java:68)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:48)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:821)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner.access$700(RandomizedRunner.java:132)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner$3$1.run(RandomizedRunner.java:669)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner$3.evaluate(RandomizedRunner.java:695)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner$4.evaluate(RandomizedRunner.java:734)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:745)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:53)\n   [junit4]   2> \t\tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleReportUncaughtExceptions$1.evaluate(TestRuleReportUncaughtExceptions.java:68)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:38)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleIcuHack$1.evaluate(TestRuleIcuHack.java:51)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:55)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleNoInstanceHooksOverrides$1.evaluate(TestRuleNoInstanceHooksOverrides.java:53)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleNoStaticHooksShadowing$1.evaluate(TestRuleNoStaticHooksShadowing.java:52)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:36)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n   [junit4]   2> \t\tat org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:56)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSuite(RandomizedRunner.java:605)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner.access$400(RandomizedRunner.java:132)\n   [junit4]   2> \t\tat com.carrotsearch.randomizedtesting.RandomizedRunner$2.run(RandomizedRunner.java:551)\n   [junit4]   2> \t\n   [junit4]   2> NOTE: reproduce with: ant test -Dtestcase=SuggesterWFSTTest -Dtests.method=testRebuild -Dtests.seed=4877EC7806E56AF3 -Dtests.locale=ar_IQ -Dtests.timezone=Asia/Kuwait -Dargs=\"-Dfile.encoding=Cp1252\"\n   [junit4]   2>\n   [junit4]    > (@AfterClass output)\n   [junit4]   2> NOTE: test params are: codec=Lucene40, sim=RandomSimilarityProvider(queryNorm=false,coord=false): {}, locale=ar_IQ, timezone=Asia/Kuwait\n   [junit4]   2> NOTE: Windows 7 6.1 amd64/Oracle Corporation 1.7.0_03 (64-bit)/cpus=8,threads=1,free=176206808,total=260833280\n   [junit4]   2> NOTE: All tests run in this JVM: [ZkSolrClientTest, TestBadConfig, PolyFieldTest, TestPortugueseLightStemFilterFactory, TestGermanMinimalStemFilterFactory, TestArbitraryIndexDir, TestRealTimeGet, TestFiltering, SortByFunctionTest, SolrPluginUtilsTest, SpellCheckCollatorTest, TestDefaultSimilarityFactory, TestGreekLowerCaseFilterFactory, SolrIndexConfigTest, SuggesterFSTTest, XsltUpdateRequestHandlerTest, TestCollationField, DistributedSpellCheckComponentTest, PluginInfoTest, TestKStemFilterFactory, DateMathParserTest, TestQueryTypes, TestSlowSynonymFilter, TestNumberUtils, TestKeywordMarkerFilterFactory, TestQuerySenderNoQuery, TestPersianNormalizationFilterFactory, StatsComponentTest, EchoParamsTest, TestChineseFilterFactory, ShowFileRequestHandlerTest, DirectUpdateHandlerOptimizeTest, MultiTermTest, TestRangeQuery, SolrRequestParserTest, TestBM25SimilarityFactory, DOMUtilTest, RAMDirectoryFactoryTest, SearchHandlerTest, SpellingQueryConverterTest, TestIndonesianStemFilterFactory, TestGermanLightStemFilterFactory, TestHashPartitioner, TestTurkishLowerCaseFilterFactory, TestPHPSerializedResponseWriter, TermVectorComponentTest, NodeStateWatcherTest, DoubleMetaphoneFilterFactoryTest, CommonGramsFilterFactoryTest, TestPortugueseMinimalStemFilterFactory, TestFoldingMultitermQuery, TestDistributedSearch, SimpleFacetsTest, LukeRequestHandlerTest, SuggesterWFSTTest]\n   [junit4]   2> \n   [junit4] Completed on J1 in 0.78s, 4 tests, 1 error <<< FAILURES!\n\n\n\nAlso doesn't reproduce with this seed. I looked in the code but it's weird \u2013 looks like the index was not created at all (file not found when trying to open suggesters). "
        },
        {
            "author": "Uwe Schindler",
            "id": "comment-13279514",
            "date": "2012-05-19T10:14:15+0000",
            "content": "Hi Dawid,\nit looks like this test is slow on Windows (maybe also Linux) systems with 2 CPU cores. This is why I said some starvation or whatever. For me it reproduces to be slow in lots of cases on 3 different Windows 7 machines (2 Laptops and one VirtualBOX), each with 2 CPUs. I can almost always reproduce it here locally.\n\nI dont understand the whole test so that is all I can say!\n\nI will later try to reproduce it in Linux using another VirtualBOX, also with 2 cores! "
        },
        {
            "author": "Uwe Schindler",
            "id": "comment-13279515",
            "date": "2012-05-19T10:15:27+0000",
            "content": "The sugester bugs also happened on the new Jenkins VM. "
        },
        {
            "author": "Dawid Weiss",
            "id": "comment-13279678",
            "date": "2012-05-20T06:34:42+0000",
            "content": "Thanks Uwe. I'll try to dig on a vm in a spare minute to rule out any test framework interference (although I doubt it's the cause). "
        }
    ]
}