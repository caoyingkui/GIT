{
    "id": "SOLR-4194",
    "title": "PingRequestHandler - shards parameter inherited from search handler definition",
    "details": {
        "affect_versions": "4.1",
        "status": "Closed",
        "fix_versions": [],
        "components": [],
        "type": "Bug",
        "priority": "Major",
        "labels": "",
        "resolution": "Not A Problem"
    },
    "description": "Included in all my cores is a PingRequestHandler named /admin/ping, which I use to enable/disable the server from the perspective of a load balancer running haproxy.  The handler includes a qt parameter set to /lbcheck.\n\nI have a special core defined (I call it a broker) that includes the shards parameter in most of its search handler definitions.  This includes /select, /lbcheck, and others.\n\nWhen the /admin/ping handler is called, the query is sent to the /lbcheck parameter as expected, which gets distributed because it includes shards.  If one of those shards happens to be down, the handler will give an error response to the load balancer.\n\nThe problem is that the PingRequestHandler seems to inherit the shards parameter from the search handler it is using, which causes the /admin/ping request itself to be distributed, which is not what I want.  The individual shards are not used by the load balancer, so they always remain disabled.\n\nThis works perfectly in 3.5.0.  The official 4.0.0 release has not been tested.\n\nConfig and log data will follow in the comments.",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "author": "Shawn Heisey",
            "id": "comment-13532739",
            "date": "2012-12-14T22:36:49+0000",
            "content": "Handler definitions:\n\n\n\n<requestHandler name=\"/admin/ping\" class=\"solr.PingRequestHandler\">\n  <lst name=\"invariants\">\n    <str name=\"qt\">/lbcheck</str>\n    <str name=\"q\">*:*</str>\n    <str name=\"df\">catchall</str>\n  </lst>\n  <lst name=\"defaults\">\n     <str name=\"echoParams\">all</str>\n  </lst>\n  <str name=\"healthcheckFile\">server-enabled.txt</str>\n</requestHandler>\n\n<requestHandler name=\"/lbcheck\" class=\"solr.SearchHandler\" default=\"false\">\n  <lst name=\"defaults\">\n    <str name=\"echoParams\">all</str>\n    <int name=\"rows\">1</int>\n    <str name=\"df\">catchall</str>\n    <str name=\"shards.qt\">/lbcheck</str>\n    <str name=\"shards.info\">true</str>\n    <str name=\"shards.tolerant\">true</str>\n    <str name=\"shards\">bigindy5.REDACTED.com:8982/solr/inclive,bigindy5.REDACTED.com:8982/solr/s0live,bigindy5.REDACTED.com:8982/solr/s1live,bigindy5.REDACTED.com:8982/solr/s2live,bigindy5.REDACTED.com:8982/solr/s3live,bigindy5.REDACTED.com:8982/solr/s4live,bigindy5.REDACTED.com:8982/solr/s5live</str>\n  </lst>\n</requestHandler>\n\n "
        },
        {
            "author": "Shawn Heisey",
            "id": "comment-13532740",
            "date": "2012-12-14T22:38:10+0000",
            "content": "Jetty request log.  All of these requests are generated from the one call to /admin/ping.  All of the shards are locally hosted on this dev machine.\n\n\n\n10.100.1.39 -  -  [14/Dec/2012:22:14:01 +0000] \"POST /solr/s1live/lbcheck HTTP/1.1\" 200 395\n10.100.1.39 -  -  [14/Dec/2012:22:14:01 +0000] \"POST /solr/inclive/lbcheck HTTP/1.1\" 200 396\n10.100.1.39 -  -  [14/Dec/2012:22:14:01 +0000] \"POST /solr/s0live/lbcheck HTTP/1.1\" 200 395\n10.100.1.39 -  -  [14/Dec/2012:22:14:01 +0000] \"POST /solr/s2live/lbcheck HTTP/1.1\" 200 395\n10.100.1.39 -  -  [14/Dec/2012:22:14:01 +0000] \"POST /solr/s4live/lbcheck HTTP/1.1\" 200 395\n10.100.1.39 -  -  [14/Dec/2012:22:14:01 +0000] \"POST /solr/s5live/lbcheck HTTP/1.1\" 200 395\n10.100.1.39 -  -  [14/Dec/2012:22:14:01 +0000] \"POST /solr/s3live/lbcheck HTTP/1.1\" 200 391\n10.100.1.39 -  -  [14/Dec/2012:22:14:01 +0000] \"POST /solr/ncmain/lbcheck HTTP/1.1\" 200 902\n10.100.1.39 -  -  [14/Dec/2012:22:14:01 +0000] \"POST /solr/s5live/admin/ping HTTP/1.1\" 503 408\n10.100.1.39 -  -  [14/Dec/2012:22:14:01 +0000] \"POST /solr/s3live/admin/ping HTTP/1.1\" 503 408\n10.100.1.39 -  -  [14/Dec/2012:22:14:01 +0000] \"POST /solr/s1live/admin/ping HTTP/1.1\" 503 408\n10.100.1.39 -  -  [14/Dec/2012:22:14:01 +0000] \"POST /solr/s4live/admin/ping HTTP/1.1\" 503 408\n10.100.1.39 -  -  [14/Dec/2012:22:14:01 +0000] \"POST /solr/inclive/admin/ping HTTP/1.1\" 503 409\n10.100.1.39 -  -  [14/Dec/2012:22:14:01 +0000] \"POST /solr/s0live/admin/ping HTTP/1.1\" 503 408\n10.100.1.39 -  -  [14/Dec/2012:22:14:01 +0000] \"POST /solr/s2live/admin/ping HTTP/1.1\" 503 408\n10.100.1.39 -  -  [14/Dec/2012:22:14:01 +0000] \"GET /solr/ncmain/admin/ping?qt.path=%2Fadmin%2Fping&wt=javabin&version=2 HTTP/1.1\" 200 521\n\n "
        },
        {
            "author": "Shawn Heisey",
            "id": "comment-13532749",
            "date": "2012-12-14T22:42:04+0000",
            "content": "Solr log generated by log4j corresponding to the jetty log.  I have realized that I should not have shards.tolerant=true for this, so I have since removed it from the /lbcheck handler.\n\n\n\nINFO  - 2012-12-14 15:16:01.547; org.apache.solr.core.SolrCore; [s5live] webapp=/solr path=/lbcheck params={shards.qt=/lbcheck&distrib=false&wt=javabin&shards.tolerant=true&rows=0&version=2&qt.path=/lbcheck&fl=tag_id,score&df=catchall&shard.url=bigindy5.REDACTED.com:8982/solr/s5live&NOW=1355523361544&start=0&q=*:*&shards.info=true&isShard=true&qt=/lbcheck&fsv=true} hits=13111698 status=0 QTime=0\nINFO  - 2012-12-14 15:16:01.547; org.apache.solr.core.SolrCore; [s4live] webapp=/solr path=/lbcheck params={shards.qt=/lbcheck&distrib=false&wt=javabin&shards.tolerant=true&rows=0&version=2&qt.path=/lbcheck&fl=tag_id,score&df=catchall&shard.url=bigindy5.REDACTED.com:8982/solr/s4live&NOW=1355523361544&start=0&q=*:*&shards.info=true&isShard=true&qt=/lbcheck&fsv=true} hits=13103219 status=0 QTime=0\nINFO  - 2012-12-14 15:16:01.548; org.apache.solr.core.SolrCore; [s2live] webapp=/solr path=/lbcheck params={shards.qt=/lbcheck&distrib=false&wt=javabin&shards.tolerant=true&rows=0&version=2&qt.path=/lbcheck&fl=tag_id,score&df=catchall&shard.url=bigindy5.REDACTED.com:8982/solr/s2live&NOW=1355523361544&start=0&q=*:*&shards.info=true&isShard=true&qt=/lbcheck&fsv=true} hits=13102554 status=0 QTime=0\nINFO  - 2012-12-14 15:16:01.549; org.apache.solr.core.SolrCore; [s0live] webapp=/solr path=/lbcheck params={shards.qt=/lbcheck&distrib=false&wt=javabin&shards.tolerant=true&rows=0&version=2&qt.path=/lbcheck&fl=tag_id,score&df=catchall&shard.url=bigindy5.REDACTED.com:8982/solr/s0live&NOW=1355523361544&start=0&q=*:*&shards.info=true&isShard=true&qt=/lbcheck&fsv=true} hits=13105096 status=0 QTime=1\nINFO  - 2012-12-14 15:16:01.549; org.apache.solr.core.SolrCore; [s1live] webapp=/solr path=/lbcheck params={shards.qt=/lbcheck&distrib=false&wt=javabin&shards.tolerant=true&rows=0&version=2&qt.path=/lbcheck&fl=tag_id,score&df=catchall&shard.url=bigindy5.REDACTED.com:8982/solr/s1live&NOW=1355523361544&start=0&q=*:*&shards.info=true&isShard=true&qt=/lbcheck&fsv=true} hits=13103459 status=0 QTime=0\nINFO  - 2012-12-14 15:16:01.549; org.apache.solr.core.SolrCore; [inclive] webapp=/solr path=/lbcheck params={shards.qt=/lbcheck&distrib=false&wt=javabin&shards.tolerant=true&rows=0&version=2&qt.path=/lbcheck&fl=tag_id,score&df=catchall&shard.url=bigindy5.REDACTED.com:8982/solr/inclive&NOW=1355523361544&start=0&q=*:*&shards.info=true&isShard=true&qt=/lbcheck&fsv=true} hits=333902 status=0 QTime=0\nINFO  - 2012-12-14 15:16:01.552; org.apache.solr.core.SolrCore; [s3live] webapp=/solr path=/lbcheck params={shards.qt=/lbcheck&distrib=false&wt=javabin&shards.tolerant=true&rows=0&version=2&qt.path=/lbcheck&df=catchall&fl=tag_id,score&shard.url=bigindy5.REDACTED.com:8982/solr/s3live&NOW=1355523361544&start=0&q=*:*&shards.info=true&isShard=true&qt=/lbcheck&fsv=true} hits=13101377 status=0 QTime=0\nINFO  - 2012-12-14 15:16:01.553; org.apache.solr.core.SolrCore; [ncmain] webapp=/solr path=/lbcheck params={qt.path=/lbcheck&wt=javabin&q=*:*&rows=0&version=2} hits=78961305 status=0 QTime=9\nINFO  - 2012-12-14 15:16:01.557; org.apache.solr.core.SolrCore; [s2live] webapp=/solr path=/admin/ping params={shards.qt=/lbcheck&distrib=false&wt=javabin&shards.tolerant=true&rows=1&version=2&qt.path=/admin/ping&fl=tag_id,score&df=catchall&shard.url=bigindy5.REDACTED.com:8982/solr/s2live&NOW=1355523361555&start=0&q=*:*&shards.info=true&qt=/lbcheck&isShard=true&fsv=true} status=503 QTime=0\nINFO  - 2012-12-14 15:16:01.557; org.apache.solr.core.SolrCore; [inclive] webapp=/solr path=/admin/ping params={shards.qt=/lbcheck&distrib=false&wt=javabin&shards.tolerant=true&rows=1&version=2&qt.path=/admin/ping&df=catchall&fl=tag_id,score&shard.url=bigindy5.REDACTED.com:8982/solr/inclive&NOW=1355523361555&start=0&q=*:*&shards.info=true&qt=/lbcheck&isShard=true&fsv=true} status=503 QTime=0\nINFO  - 2012-12-14 15:16:01.558; org.apache.solr.core.SolrCore; [s0live] webapp=/solr path=/admin/ping params={shards.qt=/lbcheck&distrib=false&wt=javabin&shards.tolerant=true&rows=1&version=2&qt.path=/admin/ping&df=catchall&fl=tag_id,score&shard.url=bigindy5.REDACTED.com:8982/solr/s0live&NOW=1355523361555&start=0&q=*:*&shards.info=true&qt=/lbcheck&isShard=true&fsv=true} status=503 QTime=0\nINFO  - 2012-12-14 15:16:01.558; org.apache.solr.core.SolrCore; [s3live] webapp=/solr path=/admin/ping params={shards.qt=/lbcheck&distrib=false&wt=javabin&shards.tolerant=true&rows=1&version=2&qt.path=/admin/ping&df=catchall&fl=tag_id,score&shard.url=bigindy5.REDACTED.com:8982/solr/s3live&NOW=1355523361555&start=0&q=*:*&shards.info=true&qt=/lbcheck&isShard=true&fsv=true} status=503 QTime=0\nINFO  - 2012-12-14 15:16:01.558; org.apache.solr.core.SolrCore; [s4live] webapp=/solr path=/admin/ping params={shards.qt=/lbcheck&distrib=false&wt=javabin&shards.tolerant=true&rows=1&version=2&qt.path=/admin/ping&df=catchall&fl=tag_id,score&shard.url=bigindy5.REDACTED.com:8982/solr/s4live&NOW=1355523361555&start=0&q=*:*&shards.info=true&qt=/lbcheck&isShard=true&fsv=true} status=503 QTime=0\nINFO  - 2012-12-14 15:16:01.559; org.apache.solr.core.SolrCore; [s5live] webapp=/solr path=/admin/ping params={shards.qt=/lbcheck&distrib=false&wt=javabin&shards.tolerant=true&rows=1&version=2&qt.path=/admin/ping&df=catchall&fl=tag_id,score&shard.url=bigindy5.REDACTED.com:8982/solr/s5live&NOW=1355523361555&start=0&q=*:*&shards.info=true&qt=/lbcheck&isShard=true&fsv=true} status=503 QTime=0\nINFO  - 2012-12-14 15:16:01.559; org.apache.solr.core.SolrCore; [s1live] webapp=/solr path=/admin/ping params={shards.qt=/lbcheck&distrib=false&wt=javabin&shards.tolerant=true&rows=1&version=2&qt.path=/admin/ping&df=catchall&fl=tag_id,score&shard.url=bigindy5.REDACTED.com:8982/solr/s1live&NOW=1355523361555&start=0&q=*:*&shards.info=true&qt=/lbcheck&isShard=true&fsv=true} status=503 QTime=0\nINFO  - 2012-12-14 15:16:01.561; org.apache.solr.core.SolrCore; [ncmain] webapp=/solr path=/admin/ping params={qt.path=/admin/ping&wt=javabin&version=2} hits=0 status=0 QTime=6\nINFO  - 2012-12-14 15:16:01.561; org.apache.solr.core.SolrCore; [ncmain] webapp=/solr path=/admin/ping params={qt.path=/admin/ping&wt=javabin&version=2} status=0 QTime=6\n\n "
        },
        {
            "author": "Shawn Heisey",
            "id": "comment-13532760",
            "date": "2012-12-14T22:51:31+0000",
            "content": "The PRH should not be making the distributed requests at all because I did not specify the shards parameter in its definition.  It incorrectly inherited the shards parameter from the search handler that ultimately received the query.  From the Solr log, it appears that it actually inherits all parameters from the search handler.\n\nI don't know if the PRH should support distributed search or not when explicitly given the shards parameter, but if it should, then we have another bug.  If any of the shards return a 503 response, the PRH itself should also return a 503.\n\nYou may notice that there's a \"qt.path\" parameter.  This is because I have the patch for SOLR-4143 applied. "
        },
        {
            "author": "Shawn Heisey",
            "id": "comment-13532771",
            "date": "2012-12-14T23:09:13+0000",
            "content": "It has occurred to me that this new behavior of inheriting search handler parameter is considered correct operation and the 3.5.0 behavior was actually the bug.\n\nIf that's the case, then we can change this issue to making PRH properly support shards and shards.qt and fix the bug where an error response from one of the shards doesn't result in an error response returned to the client.\n\nIt's worth pointing out that things are actually working for me at the moment, despite the extra requests being sent. "
        },
        {
            "author": "Shawn Heisey",
            "id": "comment-13533122",
            "date": "2012-12-15T19:40:32+0000",
            "content": "Now I'm really confused.  I didn't update to a new revision, but I did change swappable to true in solr.xml and restart.  Now I am getting a bunch of exceptions.  I am still getting most of what you see in the previous solr.log provided, but the last two lines have been replaced with this:\n\n\n\n\nERROR - 2012-12-15 12:35:53.112; org.apache.solr.common.SolrException; java.lang.NullPointerException\n        at org.apache.solr.handler.component.QueryComponent.mergeIds(QueryComponent.java:795)\n        at org.apache.solr.handler.component.QueryComponent.handleRegularResponses(QueryComponent.java:625)\n        at org.apache.solr.handler.component.QueryComponent.handleResponses(QueryComponent.java:604)\n        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:311)\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:146)\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1818)\n        at org.apache.solr.handler.PingRequestHandler.handlePing(PingRequestHandler.java:253)\n        at org.apache.solr.handler.PingRequestHandler.handleRequestBody(PingRequestHandler.java:210)\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:146)\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1818)\n        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:458)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:279)\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1307)\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:453)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:560)\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1072)\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:382)\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1006)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n        at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:255)\n        at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154)\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)\n        at org.eclipse.jetty.server.Server.handle(Server.java:365)\n        at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:485)\n        at org.eclipse.jetty.server.AbstractHttpConnection.headerComplete(AbstractHttpConnection.java:926)\n        at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.headerComplete(AbstractHttpConnection.java:988)\n        at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:635)\n        at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:235)\n        at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:82)\n        at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:628)\n        at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:52)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543)\n        at java.lang.Thread.run(Thread.java:722)\n\nINFO  - 2012-12-15 12:35:53.112; org.apache.solr.core.SolrCore; [ncmain] webapp=/solr path=/admin/ping params={qt.path=/admin/ping&wt=javabin&version=2} status=500 QTime=12\nERROR - 2012-12-15 12:35:53.113; org.apache.solr.common.SolrException; org.apache.solr.common.SolrException: Ping query caused exception: null\n        at org.apache.solr.handler.PingRequestHandler.handlePing(PingRequestHandler.java:262)\n        at org.apache.solr.handler.PingRequestHandler.handleRequestBody(PingRequestHandler.java:210)\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:146)\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1818)\n        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:458)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:279)\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1307)\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:453)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:560)\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1072)\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:382)\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1006)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n        at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:255)\n        at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154)\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)\n        at org.eclipse.jetty.server.Server.handle(Server.java:365)\n        at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:485)\n        at org.eclipse.jetty.server.AbstractHttpConnection.headerComplete(AbstractHttpConnection.java:926)\n        at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.headerComplete(AbstractHttpConnection.java:988)\n        at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:635)\n        at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:235)\n        at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:82)\n        at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:628)\n        at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:52)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543)\n        at java.lang.Thread.run(Thread.java:722)\nCaused by: java.lang.NullPointerException\n        at org.apache.solr.handler.component.QueryComponent.mergeIds(QueryComponent.java:795)\n        at org.apache.solr.handler.component.QueryComponent.handleRegularResponses(QueryComponent.java:625)\n        at org.apache.solr.handler.component.QueryComponent.handleResponses(QueryComponent.java:604)\n        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:311)\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:146)\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1818)\n        at org.apache.solr.handler.PingRequestHandler.handlePing(PingRequestHandler.java:253)\n        ... 30 more\n\nINFO  - 2012-12-15 12:35:53.113; org.apache.solr.core.SolrCore; [ncmain] webapp=/solr path=/admin/ping params={qt.path=/admin/ping&wt=javabin&version=2} status=500 QTime=13\nERROR - 2012-12-15 12:35:53.113; org.apache.solr.common.SolrException; null:org.apache.solr.common.SolrException: Ping query caused exception: null\n        at org.apache.solr.handler.PingRequestHandler.handlePing(PingRequestHandler.java:262)\n        at org.apache.solr.handler.PingRequestHandler.handleRequestBody(PingRequestHandler.java:210)\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:146)\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1818)\n        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:458)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:279)\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1307)\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:453)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:560)\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1072)\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:382)\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1006)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n        at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:255)\n        at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154)\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)\n        at org.eclipse.jetty.server.Server.handle(Server.java:365)\n        at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:485)\n        at org.eclipse.jetty.server.AbstractHttpConnection.headerComplete(AbstractHttpConnection.java:926)\n        at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.headerComplete(AbstractHttpConnection.java:988)\n        at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:635)\n        at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:235)\n        at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:82)\n        at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:628)\n        at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:52)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543)\n        at java.lang.Thread.run(Thread.java:722)\nCaused by: java.lang.NullPointerException\n        at org.apache.solr.handler.component.QueryComponent.mergeIds(QueryComponent.java:795)\n        at org.apache.solr.handler.component.QueryComponent.handleRegularResponses(QueryComponent.java:625)\n        at org.apache.solr.handler.component.QueryComponent.handleResponses(QueryComponent.java:604)\n        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:311)\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:146)\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1818)\n        at org.apache.solr.handler.PingRequestHandler.handlePing(PingRequestHandler.java:253)\n        ... 30 more\n\n "
        },
        {
            "author": "Shawn Heisey",
            "id": "comment-13533125",
            "date": "2012-12-15T19:42:18+0000",
            "content": "It now appears as if the PRH is attempting to merge results from the distributed query ... but because PRH is not a regular search handler, I doubt that information is available. "
        },
        {
            "author": "Shawn Heisey",
            "id": "comment-13533206",
            "date": "2012-12-15T23:36:11+0000",
            "content": "I still cannot figure out what happened to break it, but I have some more information.  It appears to be the qt.path parameter introduced by my patch on SOLR-4143 that causes the current explosion.  This patch was included before when it was working, though.\n\nIf I change qt.path to qt, or any other garbage parameter, it works.  This is ironic because SOLR-4143 is designed to fix a problem with talking to the PRH on Solr 3.5.0.  It's also very weird, because only SolrJ is patched to recognize the qt.path parameter.  I didn't think that this would bleed through to Solr, but it looks like I was wrong. "
        },
        {
            "author": "Shawn Heisey",
            "id": "comment-13533525",
            "date": "2012-12-16T21:20:07+0000",
            "content": "Updated patch for SOLR-4143 fixes this problem as well.  Appropriate, since the old patch seems to be what caused it. "
        },
        {
            "author": "Shawn Heisey",
            "id": "comment-13540572",
            "date": "2012-12-28T19:45:02+0000",
            "content": "I never did figure out why my initial patch for SOLR-4143 caused this problem.  Is it enough to simply say that it's not a problem in an unpatched branch_4x and call this issue resolved as not a problem? "
        },
        {
            "author": "Shawn Heisey",
            "id": "comment-13636778",
            "date": "2013-04-19T19:38:32+0000",
            "content": "My testing suggests that this was purely a result of my attempt to patch SolrJ.  When I switched to SolrPing for my ping requests, all my problems went away. "
        }
    ]
}