{
    "id": "SOLR-12079",
    "title": "Reproducable Failure in AutoAddReplicasIntegrationTest.testSimple",
    "details": {
        "labels": "",
        "priority": "Major",
        "components": [],
        "type": "Bug",
        "fix_versions": [],
        "affect_versions": "master (8.0)",
        "resolution": "Unresolved",
        "status": "Open"
    },
    "description": "With the recent focus on bad tests lately, I decided to inspect some failures that occurred in tests unrelated to my present task when I ran the tests preparing for a pull request and found this failure which reproduces:\n\nant test\u00a0 -Dtestcase=AutoAddReplicasIntegrationTest -Dtests.method=testSimple -Dtests.seed=884DCF71D210D14A -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=de-GR -Dtests.timezone=Pacific/Kwajalein -Dtests.asserts=true -Dtests.file.encoding=UTF-8\n\n\u00a0\n\nKey excerpt of the log:\n\n\u00a0\u00a0[junit4]\u00a0\u00a0 2> NOTE: reproduce with: ant test\u00a0 -Dtestcase=AutoAddReplicasIntegrationTest -Dtests.method=testSimple -Dtests.seed=884DCF71D210D14A -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=de-GR -Dtests.timezone=Pacific/Kwajalein -Dtests.asserts=true -Dtests.file.encoding=UTF-8\n\u00a0\u00a0 [junit4] FAILURE\u00a0 101s | AutoAddReplicasIntegrationTest.testSimple <<<\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 > Throwable #1: java.lang.AssertionError: Waiting for collection testSimple1\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 > null\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 > Live Nodes: [127.0.0.1:33823_solr, 127.0.0.1:41047_solr]\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 > Last available state: DocCollection(testSimple1//collections/testSimple1/state.json/7)={\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0 \"pullReplicas\":\"0\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0 \"replicationFactor\":\"2\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0 \"shards\":{\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0 \"shard1\":{\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"range\":\"80000000-ffffffff\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"state\":\"active\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"replicas\":{\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"core_node4\":{\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"core\":\"testSimple1_shard1_replica_n1\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"base_url\":\"https://127.0.0.1:45817/solr\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"node_name\":\"127.0.0.1:45817_solr\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"state\":\"down\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"type\":\"NRT\"},\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"core_node6\":{\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"core\":\"testSimple1_shard1_replica_n2\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"base_url\":\"https://127.0.0.1:33823/solr\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"node_name\":\"127.0.0.1:33823_solr\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"state\":\"active\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"type\":\"NRT\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"leader\":\"true\"}}},\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0 \"shard2\":{\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"range\":\"0-7fffffff\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"state\":\"active\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"replicas\":{\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"core_node7\":{\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"core\":\"testSimple1_shard2_replica_n3\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"base_url\":\"https://127.0.0.1:45817/solr\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"node_name\":\"127.0.0.1:45817_solr\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"state\":\"down\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"type\":\"NRT\"},\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"core_node8\":{\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"core\":\"testSimple1_shard2_replica_n5\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"base_url\":\"https://127.0.0.1:33823/solr\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"node_name\":\"127.0.0.1:33823_solr\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"state\":\"active\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"type\":\"NRT\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \"leader\":\"true\"}}}},\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0 \"router\":{\"name\":\"compositeId\"},\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0 \"maxShardsPerNode\":\"2\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0 \"autoAddReplicas\":\"true\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0 \"nrtReplicas\":\"2\",\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0 \"tlogReplicas\":\"0\"}\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 at __randomizedtesting.SeedInfo.seed([884DCF71D210D14A:B0FEEB8FF5E3059B]:0)\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 at org.apache.solr.cloud.SolrCloudTestCase.waitForState(SolrCloudTestCase.java:269)\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 at org.apache.solr.cloud.autoscaling.AutoAddReplicasIntegrationTest.testSimple(AutoAddReplicasIntegrationTest.java:94)\n\u00a0\u00a0 [junit4]\u00a0\u00a0\u00a0 >\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 at java.lang.Thread.run(Thread.java:748)\n\u00a0\u00a0 [junit4]\u00a0\u00a0 2> 103449 INFO\u00a0 (jetty-closer-2-thread-2) [\u00a0\u00a0\u00a0 ] o.e.j.s.AbstractConnector Stopped ServerConnector@57a6f4e{SSL,[ssl, http/1.1]}{127.0.0.1:0}",
    "attachments": {},
    "issue_links": {},
    "comments": []
}