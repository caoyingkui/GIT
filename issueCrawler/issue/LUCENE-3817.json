{
    "id": "LUCENE-3817",
    "title": "TestThreadedForceMerge failure",
    "details": {
        "labels": "",
        "priority": "Major",
        "components": [],
        "type": "Bug",
        "fix_versions": [],
        "affect_versions": "4.0-ALPHA",
        "resolution": "Unresolved",
        "status": "Open"
    },
    "description": "leaks a file handle....\n\nwas running tests a lot to keep my computer busy while debugging something else.\n\n    [junit] Testsuite: org.apache.lucene.index.TestThreadedForceMerge\n    [junit] Testcase: testThreadedForceMerge(org.apache.lucene.index.TestThreadedForceMerge):\tCaused an ERROR\n    [junit] MockDirectoryWrapper: cannot close: there are still open files: {_58_1.skp=1, _58_1.tib=1, _58_1.tii=1, _58_0.frq=1, _58_0.tim=1, _58.tvf=1, _58.tvd=1, _58_1.doc=1, _58.tvx=1, _58.fdt=1, _58.fdx=1}\n    [junit] java.lang.RuntimeException: MockDirectoryWrapper: cannot close: there are still open files: {_58_1.skp=1, _58_1.tib=1, _58_1.tii=1, _58_0.frq=1, _58_0.tim=1, _58.tvf=1, _58.tvd=1, _58_1.doc=1, _58.tvx=1, _58.fdt=1, _58.fdx=1}\n    [junit] \tat org.apache.lucene.store.MockDirectoryWrapper.close(MockDirectoryWrapper.java:555)\n    [junit] \tat org.apache.lucene.index.TestThreadedForceMerge.testThreadedForceMerge(TestThreadedForceMerge.java:141)\n    [junit] \tat org.apache.lucene.util.LuceneTestCase$SubclassSetupTeardownRule$1.evaluate(LuceneTestCase.java:707)\n    [junit] \tat org.apache.lucene.util.LuceneTestCase$InternalSetupTeardownRule$1.evaluate(LuceneTestCase.java:606)\n    [junit] \tat org.apache.lucene.util.LuceneTestCase$TestResultInterceptorRule$1.evaluate(LuceneTestCase.java:511)\n    [junit] \tat org.apache.lucene.util.LuceneTestCase$RememberThreadRule$1.evaluate(LuceneTestCase.java:569)\n    [junit] \tat org.apache.lucene.util.LuceneTestCaseRunner.runChild(LuceneTestCaseRunner.java:165)\n    [junit] \tat org.apache.lucene.util.LuceneTestCaseRunner.runChild(LuceneTestCaseRunner.java:57)\n    [junit] Caused by: java.lang.RuntimeException: unclosed IndexInput: _58_1.doc\n    [junit] \tat org.apache.lucene.store.MockDirectoryWrapper.addFileHandle(MockDirectoryWrapper.java:479)\n    [junit] \tat org.apache.lucene.store.MockDirectoryWrapper.openInput(MockDirectoryWrapper.java:504)\n    [junit] \tat org.apache.lucene.codecs.mocksep.MockSingleIntIndexInput.<init>(MockSingleIntIndexInput.java:41)\n    [junit] \tat org.apache.lucene.codecs.mocksep.MockSingleIntFactory.openInput(MockSingleIntFactory.java:32)\n    [junit] \tat org.apache.lucene.codecs.sep.SepPostingsReader.<init>(SepPostingsReader.java:68)\n    [junit] \tat org.apache.lucene.codecs.mocksep.MockSepPostingsFormat.fieldsProducer(MockSepPostingsFormat.java:89)\n    [junit] \tat org.apache.lucene.codecs.perfield.PerFieldPostingsFormat$FieldsReader$1.visitOneFormat(PerFieldPostingsFormat.java:189)\n    [junit] \tat org.apache.lucene.codecs.perfield.PerFieldPostingsFormat$VisitPerFieldFile.<init>(PerFieldPostingsFormat.java:280)\n    [junit] \tat org.apache.lucene.codecs.perfield.PerFieldPostingsFormat$FieldsReader$1.<init>(PerFieldPostingsFormat.java:186)\n    [junit] \tat org.apache.lucene.codecs.perfield.PerFieldPostingsFormat$FieldsReader.<init>(PerFieldPostingsFormat.java:186)\n    [junit] \tat org.apache.lucene.codecs.perfield.PerFieldPostingsFormat.fieldsProducer(PerFieldPostingsFormat.java:256)\n    [junit] \tat org.apache.lucene.index.SegmentCoreReaders.<init>(SegmentCoreReaders.java:108)\n    [junit] \tat org.apache.lucene.index.SegmentReader.<init>(SegmentReader.java:51)\n    [junit] \tat org.apache.lucene.index.IndexWriter$ReadersAndLiveDocs.getMergeReader(IndexWriter.java:521)\n    [junit] \tat org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:3586)\n    [junit] \tat org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:3256)\n    [junit] \tat org.apache.lucene.index.ConcurrentMergeScheduler.doMerge(ConcurrentMergeScheduler.java:382)\n    [junit] \tat org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:451)\n    [junit] \n    [junit] \n    [junit] Tests run: 1, Failures: 0, Errors: 1, Time elapsed: 0.704 sec\n    [junit] \n    [junit] ------------- Standard Error -----------------\n    [junit] NOTE: reproduce with: ant test -Dtestcase=TestThreadedForceMerge -Dtestmethod=testThreadedForceMerge -Dtests.seed=-36d98ee49f3f6205:-602830ebcb0e2f6d:9429978db44e64b -Dargs=\"-Dfile.encoding=UTF-8\"\n    [junit] NOTE: test params are: codec=Lucene40: {id=PostingsFormat(name=MockSep), contents=PostingsFormat(name=NestedPulsing)}, sim=RandomSimilarityProvider(queryNorm=false,coord=true): {}, locale=ar_JO, timezone=Asia/Pontianak\n    [junit] NOTE: all tests run in this JVM:\n    [junit] [TestSearchForDuplicates, TestMockAnalyzer, TestToken, TestIntBlockCodec, TestImpersonation, TestBitVector, TestAtomicUpdate, TestBinaryTerms, TestCheckIndex, TestCrashCausesCorruptIndex, TestDirectoryReaderReopen, TestDocCount, TestDocValuesIndexing, TestForTooMuchCloning, TestIndexInput, TestIndexWriter, TestIndexWriterMerging, TestIndexWriterNRTIsCurrent, TestIndexWriterOnDiskFull, TestIndexWriterWithThreads, TestLazyProxSkipping, TestLongPostings, TestOmitTf, TestParallelAtomicReader, TestParallelCompositeReader, TestPayloadProcessorProvider, TestSameTokenSamePosition, TestSegmentTermDocs, TestSnapshotDeletionPolicy, TestSumDocFreq, TestTermVectorsWriter, TestThreadedForceMerge]\n    [junit] NOTE: Linux 3.0.0-14-generic amd64/Sun Microsystems Inc. 1.6.0_24 (64-bit)/cpus=8,threads=1,free=177836920,total=287309824\n    [junit] ------------- ---------------- ---------------",
    "attachments": {},
    "issue_links": {},
    "comments": []
}