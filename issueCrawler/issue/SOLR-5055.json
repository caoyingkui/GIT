{
    "id": "SOLR-5055",
    "title": "Using solr.SearchHandler with Apache Tomcat",
    "details": {
        "affect_versions": "4.3.1",
        "status": "Closed",
        "fix_versions": [],
        "components": [
            "search"
        ],
        "type": "Bug",
        "priority": "Minor",
        "labels": "",
        "resolution": "Won't Fix"
    },
    "description": "I'm trying to deploy Solr with Tomcat (Version 7.0.27 and 6.0.37) as described in http://wiki.apache.org/solr/SolrTomcat and https://cwiki.apache.org/confluence/display/solr/Running+Solr+on+Tomcat\nI deployed only one instance (mentioned in Wiki Documentation as \"Single Solr Instance\"). In solrconfig.xml the library configuration is changed to absolut paths for the jar-Files.\n\nWhen i try to use the /browse Request Handler it states the following error:\nERROR - 2013-07-22 13:04:20.279; org.apache.solr.common.SolrException; null:java.lang.RuntimeException: java.lang.NoClassDefFoundError: org/apache/commons/lang/StringUtils\n        at org.apache.solr.servlet.SolrDispatchFilter.sendError(SolrDispatchFilter.java:670)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:380)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:155)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:225)\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:169)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:168)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:98)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:407)\n        at org.apache.coyote.ajp.AjpProcessor.process(AjpProcessor.java:200)\n        at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:565)\n        at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:307)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n        at java.lang.Thread.run(Thread.java:722)\nCaused by: java.lang.NoClassDefFoundError: org/apache/commons/lang/StringUtils\n        at org.apache.velocity.runtime.resource.ResourceManagerImpl.initialize(ResourceManagerImpl.java:161)\n        at org.apache.velocity.runtime.RuntimeInstance.initializeResourceManager(RuntimeInstance.java:730)\n        at org.apache.velocity.runtime.RuntimeInstance.init(RuntimeInstance.java:263)\n        at org.apache.velocity.app.VelocityEngine.init(VelocityEngine.java:93)\n        at org.apache.solr.response.VelocityResponseWriter.getEngine(VelocityResponseWriter.java:147)\n        at org.apache.solr.response.VelocityResponseWriter.write(VelocityResponseWriter.java:42)\n        at org.apache.solr.core.SolrCore$LazyQueryResponseWriterWrapper.write(SolrCore.java:2278)\n        at org.apache.solr.servlet.SolrDispatchFilter.writeResponse(SolrDispatchFilter.java:644)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:372)\n        ... 15 more\nCaused by: java.lang.ClassNotFoundException: org.apache.commons.lang.StringUtils\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:366)\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:355)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:354)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:423)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:356)\n        ... 24 more\n\nERROR - 2013-07-22 13:04:20.282; org.apache.solr.common.SolrException; null:java.lang.NoClassDefFoundError: org/apache/commons/lang/StringUtils\n        at org.apache.velocity.runtime.resource.ResourceManagerImpl.initialize(ResourceManagerImpl.java:161)\n        at org.apache.velocity.runtime.RuntimeInstance.initializeResourceManager(RuntimeInstance.java:730)\n        at org.apache.velocity.runtime.RuntimeInstance.init(RuntimeInstance.java:263)\n        at org.apache.velocity.app.VelocityEngine.init(VelocityEngine.java:93)\n        at org.apache.solr.response.VelocityResponseWriter.getEngine(VelocityResponseWriter.java:147)\n        at org.apache.solr.response.VelocityResponseWriter.write(VelocityResponseWriter.java:42)\n        at org.apache.solr.core.SolrCore$LazyQueryResponseWriterWrapper.write(SolrCore.java:2278)\n        at org.apache.solr.servlet.SolrDispatchFilter.writeResponse(SolrDispatchFilter.java:644)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:372)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:155)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:225)\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:169)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:168)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:98)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:407)\n        at org.apache.coyote.ajp.AjpProcessor.process(AjpProcessor.java:200)\n        at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:565)\n        at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:307)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n        at java.lang.Thread.run(Thread.java:722)\nCaused by: java.lang.ClassNotFoundException: org.apache.commons.lang.StringUtils\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:366)\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:355)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:354)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:423)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:356)\n        ... 24 more\n\n\nI resolved this error by copying the commons-lang-2.6.jar from the deployed instance (tomcat/webapps/solr/WEB-INF/lib/commons-lang-2.6.jar) to the Tomcat-Library-Directory (tomcat/lib)",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "author": "Erik Hatcher",
            "id": "comment-14273157",
            "date": "2015-01-12T02:20:40+0000",
            "content": "This surely can't still be a problem?   Solr is regularly deployed with Tomcat.  I know it's been a while since this was reported, but if this problem still exists (on the latest release), please post your solrconfig.xml file so we can see the <lib> elements.  Also, anything else unusual/different about your Tomcat install or setup? "
        },
        {
            "author": "Christian Lutz",
            "id": "comment-14274902",
            "date": "2015-01-13T08:24:03+0000",
            "content": "We will try it in our developement environment with a new version. "
        },
        {
            "author": "Jan H\u00f8ydahl",
            "id": "comment-15574952",
            "date": "2016-10-14T10:48:19+0000",
            "content": "Closing as won't fix - we no longer support Tomcat deploy "
        }
    ]
}