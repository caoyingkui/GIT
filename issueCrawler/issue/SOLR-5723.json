{
    "id": "SOLR-5723",
    "title": "ORA-04030: out of process memory when trying to allocate 4032 bytes",
    "details": {
        "affect_versions": "4.6",
        "status": "Resolved",
        "fix_versions": [],
        "components": [
            "contrib - DataImportHandler"
        ],
        "type": "Bug",
        "priority": "Major",
        "labels": "",
        "resolution": "Invalid"
    },
    "description": "Hi,\n\nI have xmltype data in my oracle DB. I am converting xmltype to clob and to xml string using clobtransformer. When I process more than 1 lakh records, I am getting the following error.\n\nERROR - 2014-02-06 16:42:04.957; org.apache.solr.common.SolrException; getNext() failed for query 'select  XMLSERIALIZE(CONTENT object_value AS CLOB NO INDENT) POLICY_DOC,id,rowid from ifp_policy':org.apache.solr.handler.dataimport.DataImportHandlerException: java.sql.SQLException: ORA-04030: out of process memory when trying to allocate 4032 bytes (qmxtgCreateBuf,kghsseg: kolaslCreateCtx)\n\n\tat org.apache.solr.handler.dataimport.DataImportHandlerException.wrapAndThrow(DataImportHandlerException.java:63)\n\tat org.apache.solr.handler.dataimport.JdbcDataSource$ResultSetIterator.hasnext(JdbcDataSource.java:368)\n\tat org.apache.solr.handler.dataimport.JdbcDataSource$ResultSetIterator.access$600(JdbcDataSource.java:254)\n\tat org.apache.solr.handler.dataimport.JdbcDataSource$ResultSetIterator$1.hasNext(JdbcDataSource.java:289)\n\tat org.apache.solr.handler.dataimport.EntityProcessorBase.getNext(EntityProcessorBase.java:116)\n\tat org.apache.solr.handler.dataimport.SqlEntityProcessor.nextRow(SqlEntityProcessor.java:75)\n\tat org.apache.solr.handler.dataimport.EntityProcessorWrapper.nextRow(EntityProcessorWrapper.java:243)\n\tat org.apache.solr.handler.dataimport.DocBuilder.buildDocument(DocBuilder.java:469)\n\tat org.apache.solr.handler.dataimport.DocBuilder.buildDocument(DocBuilder.java:408)\n\tat org.apache.solr.handler.dataimport.DocBuilder.doFullDump(DocBuilder.java:323)\n\tat org.apache.solr.handler.dataimport.DocBuilder.execute(DocBuilder.java:231)\n\tat org.apache.solr.handler.dataimport.DataImporter.doFullImport(DataImporter.java:411)\n\tat org.apache.solr.handler.dataimport.DataImporter.runCmd(DataImporter.java:476)\n\tat org.apache.solr.handler.dataimport.DataImporter$1.run(DataImporter.java:457)\nCaused by: java.sql.SQLException: ORA-04030: out of process memory when trying to allocate 4032 bytes (qmxtgCreateBuf,kghsseg: kolaslCreateCtx)\n\n\tat oracle.jdbc.driver.DatabaseError.throwSqlException(DatabaseError.java:112)\n\tat oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:331)\n\tat oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:288)\n\tat oracle.jdbc.driver.T4C8Oall.receive(T4C8Oall.java:743)\n\tat oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:207)\n\tat oracle.jdbc.driver.T4CStatement.fetch(T4CStatement.java:1018)\n\tat oracle.jdbc.driver.OracleResultSetImpl.close_or_fetch_from_next(OracleResultSetImpl.java:291)\n\tat oracle.jdbc.driver.OracleResultSetImpl.next(OracleResultSetImpl.java:213)\n\tat org.apache.solr.handler.dataimport.JdbcDataSource$ResultSetIterator.hasnext(JdbcDataSource.java:360)\n\t... 12 more\n\n\nMy db-database-config.xml file content is as follows.\n\n<entity name=\"IFPPOLICY\" processor=\"SqlEntityProcessor\" dataSource=\"ds1\" transformer=\"ClobTransformer\"\n\t\tquery=\"select  XMLSERIALIZE(CONTENT object_value AS CLOB NO INDENT) POLICY_DOC,primaryCustomerId,id,rowid, relationshipCode,givenName,lastName from ifp_policy,XMLTABLE(xmlnamespaces('http://www.cigna.com/ifp/domains/policy/2013/05' \n\t\tAS \" pol \", 'http://www.cigna.com/ifp/domains/common/2012/06' AS \" cm \",'http://www.cigna.com/ifp/domains/common/eligibility/2013/05' \n\t\tAS \" cel \",'http://www.cigna.com/ifp/domains/utility/2012/06'   AS util),'/pol:insurancePolicy' PASSING ifp_policy.OBJECT_VALUE \n\t\tcolumns primaryCustomerId VARCHAR2(100) path '@primaryCustomerID',relationshipCode VARCHAR2(50) path 'cel:customers/cel:customer[cel:customerInformation/cel:relationshipCode=\" Primary \"]/cel:name/cm:givenName',\n\t\tgivenName  VARCHAR2(50) path 'cel:customers/cel:customer[1]/cel:name/cm:givenName',\n\t\tlastName VARCHAR2(50) path 'cel:customers/cel:customer[1]/cel:name/cm:surName')\"\n\t\t\t\t\t\t\t\t\t\tpk=\"id\">\n\n\n\n\t\t<entity name=\"IFPPOLICY\" processor=\"SqlEntityProcessor\" dataSource=\"ds1\" transformer=\"ClobTransformer\"\n\t\tquery=\"select  object_value.toStringVal() as POLICY_DOC,id,rowid from ifp_policy\"\n\t\t\t\t\t\t\t\t\t\tpk=\"id\">\n\t\t<field column=\"rowid\" name=\"rowid\"/>\n\t\t<field column=\"id\" name=\"id\"/>\n\n\t\t<field column=\"POLICY_DOC\" name=\"POLICY_DOC\" clob=\"true\"/>\n\t\t\t<field column=\"primaryCustomerId\" name=\"primaryCustomerId\"/>\n\t\t<field column=\"givenName\" name=\"givenName\"/>\n\t\t<field column=\"lastName\" name=\"lastName\"/>\n\t\t<field column=\"relationshipCode\" name=\"relationshipCode\"/>\n\t\t</entity> \n       <field column=\"policy\" clob=\"true\"/>   \n\n\nAny help appreciated.!\n\nThanks",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "author": "Shawn Heisey",
            "id": "comment-13900593",
            "date": "2014-02-13T18:50:52+0000",
            "content": "Most likely a support issue.  It has been brought up on solr-user, will handle it there unless a bug is discovered. "
        }
    ]
}