{
    "id": "SOLR-6052",
    "title": "Too many documents Exception",
    "details": {
        "affect_versions": "4.3,                                            4.4,                                            4.5,                                            4.6,                                            4.7",
        "status": "Resolved",
        "fix_versions": [],
        "components": [],
        "type": "Bug",
        "priority": "Major",
        "labels": "",
        "resolution": "Not A Problem"
    },
    "description": "ERROR org.apache.solr.core.CoreContainer  \u2013 Unable to create core: collection1\norg.apache.solr.common.SolrException: Error opening new searcher\n\tat org.apache.solr.core.SolrCore.<init>(SolrCore.java:821)\n\tat org.apache.solr.core.SolrCore.<init>(SolrCore.java:618)\n\tat org.apache.solr.core.CoreContainer.createFromLocal(CoreContainer.java:949)\n\tat org.apache.solr.core.CoreContainer.create(CoreContainer.java:984)\n\tat org.apache.solr.core.CoreContainer$2.call(CoreContainer.java:597)\n\tat org.apache.solr.core.CoreContainer$2.call(CoreContainer.java:592)\n\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:138)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:439)\n\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:138)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918)\n\tat java.lang.Thread.run(Thread.java:662)\nCaused by: org.apache.solr.common.SolrException: Error opening new searcher\n\tat org.apache.solr.core.SolrCore.openNewSearcher(SolrCore.java:1438)\n\tat org.apache.solr.core.SolrCore.getSearcher(SolrCore.java:1550)\n\tat org.apache.solr.core.SolrCore.<init>(SolrCore.java:796)\n\t... 13 more\nCaused by: org.apache.solr.common.SolrException: Error opening Reader\n\tat org.apache.solr.search.SolrIndexSearcher.getReader(SolrIndexSearcher.java:172)\n\tat org.apache.solr.search.SolrIndexSearcher.<init>(SolrIndexSearcher.java:183)\n\tat org.apache.solr.search.SolrIndexSearcher.<init>(SolrIndexSearcher.java:179)\n\tat org.apache.solr.core.SolrCore.openNewSearcher(SolrCore.java:1414)\n\t... 15 more\nCaused by: java.lang.IllegalArgumentException: Too many documents, composite IndexReaders cannot exceed 2147483647\n\tat org.apache.lucene.index.BaseCompositeReader.<init>(BaseCompositeReader.java:77)\n\tat org.apache.lucene.index.DirectoryReader.<init>(DirectoryReader.java:368)\n\tat org.apache.lucene.index.StandardDirectoryReader.<init>(StandardDirectoryReader.java:42)\n\tat org.apache.lucene.index.StandardDirectoryReader$1.doBody(StandardDirectoryReader.java:71)\n\tat org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.java:783)\n\tat org.apache.lucene.index.StandardDirectoryReader.open(StandardDirectoryReader.java:52)\n\tat org.apache.lucene.index.DirectoryReader.open(DirectoryReader.java:88)\n\tat org.apache.solr.core.StandardIndexReaderFactory.newReader(StandardIndexReaderFactory.java:34)\n\tat org.apache.solr.search.SolrIndexSearcher.getReader(SolrIndexSearcher.java:169)\n\t... 18 more\nERROR org.apache.solr.core.CoreContainer  \u2013 null:org.apache.solr.common.SolrException: Unable to create core: collection1\n\tat org.apache.solr.core.CoreContainer.recordAndThrow(CoreContainer.java:1450)\n\tat org.apache.solr.core.CoreContainer.create(CoreContainer.java:993)\n\tat org.apache.solr.core.CoreContainer$2.call(CoreContainer.java:597)\n\tat org.apache.solr.core.CoreContainer$2.call(CoreContainer.java:592)\n\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:138)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:439)\n\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:138)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918)\n\tat java.lang.Thread.run(Thread.java:662)\nCaused by: org.apache.solr.common.SolrException: Error opening new searcher\n\tat org.apache.solr.core.SolrCore.<init>(SolrCore.java:821)\n\tat org.apache.solr.core.SolrCore.<init>(SolrCore.java:618)\n\tat org.apache.solr.core.CoreContainer.createFromLocal(CoreContainer.java:949)\n\tat org.apache.solr.core.CoreContainer.create(CoreContainer.java:984)\n\t... 10 more\nCaused by: org.apache.solr.common.SolrException: Error opening new searcher\n\tat org.apache.solr.core.SolrCore.openNewSearcher(SolrCore.java:1438)\n\tat org.apache.solr.core.SolrCore.getSearcher(SolrCore.java:1550)\n\tat org.apache.solr.core.SolrCore.<init>(SolrCore.java:796)\n\t... 13 more\nCaused by: org.apache.solr.common.SolrException: Error opening Reader\n\tat org.apache.solr.search.SolrIndexSearcher.getReader(SolrIndexSearcher.java:172)\n\tat org.apache.solr.search.SolrIndexSearcher.<init>(SolrIndexSearcher.java:183)\n\tat org.apache.solr.search.SolrIndexSearcher.<init>(SolrIndexSearcher.java:179)\n\tat org.apache.solr.core.SolrCore.openNewSearcher(SolrCore.java:1414)\n\t... 15 more\nCaused by: java.lang.IllegalArgumentException: Too many documents, composite IndexReaders cannot exceed 2147483647\n\tat org.apache.lucene.index.BaseCompositeReader.<init>(BaseCompositeReader.java:77)\n\tat org.apache.lucene.index.DirectoryReader.<init>(DirectoryReader.java:368)\n\tat org.apache.lucene.index.StandardDirectoryReader.<init>(StandardDirectoryReader.java:42)\n\tat org.apache.lucene.index.StandardDirectoryReader$1.doBody(StandardDirectoryReader.java:71)\n\tat org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.java:783)\n\tat org.apache.lucene.index.StandardDirectoryReader.open(StandardDirectoryReader.java:52)\n\tat org.apache.lucene.index.DirectoryReader.open(DirectoryReader.java:88)\n\tat org.apache.solr.core.StandardIndexReaderFactory.newReader(StandardIndexReaderFactory.java:34)\n\tat org.apache.solr.search.SolrIndexSearcher.getReader(SolrIndexSearcher.java:169)\n\t... 18 more\n\n\nsample solrconfig.xml\n\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<config>\n  <luceneMatchVersion>LUCENE_43</luceneMatchVersion>\n\n  <lib dir=\"/opt/solr/dist\" regex=\"solr-cell-\\d.*\\.jar\" />\n  <lib dir=\"/opt/solr/contrib/extraction/lib\" regex=\".*\\.jar\" />\n\n  <lib dir=\"/opt/solr/dist\" regex=\"solr-clustering-\\d.*\\.jar\" />\n  <lib dir=\"/opt/solr/contrib/clustering/lib\" regex=\".*\\.jar\" />\n\n  <lib dir=\"/opt/solr/dist\" regex=\"solr-langid-\\d.*\\.jar\" />\n  <lib dir=\"/opt/solr/contrib/langid/lib\" regex=\".*\\.jar\" />\n\n  <lib dir=\"/opt/solr/dist\" regex=\"solr-velocity-\\d.*\\.jar\" />\n  <lib dir=\"/opt/solr/contrib/velocity/lib\" regex=\".*\\.jar\" />\n\n  <dataDir>${solr.data.dir:}</dataDir>\n\n  <directoryFactory name=\"DirectoryFactory\"\n                    class=\"${solr.directoryFactory:solr.NRTCachingDirectoryFactory}\"/>\n\n  <codecFactory class=\"solr.SchemaCodecFactory\"/>\n\n  <indexConfig>\n    <ramBufferSizeMB>256</ramBufferSizeMB>\n    <lockType>${solr.lock.type:native}</lockType>\n  </indexConfig>\n\n  <jmx />\n\n  <updateHandler class=\"solr.DirectUpdateHandler2\">\n    <updateLog>\n      <str name=\"dir\">${solr.ulog.dir:}</str>\n    </updateLog>\n    <autoCommit>\n      <maxDocs>10000</maxDocs>\n      <maxTime>60000</maxTime>\n      <openSearcher>false</openSearcher>\n    </autoCommit>\n    <autoSoftCommit>\n      <maxDocs>10</maxDocs>\n      <maxTime>1000</maxTime>\n    </autoSoftCommit>\n  </updateHandler>\n\n  <query>\n    <maxBooleanClauses>1024</maxBooleanClauses>\n    <filterCache class=\"solr.FastLRUCache\"\n                 size=\"16384\"\n                 initialSize=\"4096\"\n                 autowarmCount=\"1024\"/>\n    <queryResultCache class=\"solr.FastLRUCache\"\n                     size=\"16384\"\n                     initialSize=\"4096\"\n                     autowarmCount=\"1024\"/>\n    <documentCache class=\"solr.FastLRUCache\"\n                   size=\"16384\"\n                   initialSize=\"4096\"\n                   autowarmCount=\"1024\"/>\n    <enableLazyFieldLoading>true</enableLazyFieldLoading>\n    <queryResultWindowSize>20</queryResultWindowSize>\n    <queryResultMaxDocsCached>200</queryResultMaxDocsCached>\n    <useColdSearcher>false</useColdSearcher>\n    <maxWarmingSearchers>2</maxWarmingSearchers>\n  </query>\n\n  <requestDispatcher handleSelect=\"false\" >\n    <requestParsers enableRemoteStreaming=\"true\"\n                    multipartUploadLimitInKB=\"2048000\"\n                    formdataUploadLimitInKB=\"2048\"/>\n    <httpCaching never304=\"true\" />\n  </requestDispatcher>\n\n  <requestHandler name=\"/select\" class=\"solr.SearchHandler\">\n    <lst name=\"defaults\">\n       <str name=\"echoParams\">explicit</str>\n       <int name=\"rows\">10</int>\n       <str name=\"df\">text</str>\n    </lst>\n  </requestHandler>\n\n  <requestHandler name=\"/update\" class=\"solr.UpdateRequestHandler\">\n  </requestHandler>\n\n  <requestHandler name=\"/update/json\" class=\"solr.JsonUpdateRequestHandler\">\n    <lst name=\"defaults\">\n      <str name=\"stream.contentType\">application/json</str>\n    </lst>\n  </requestHandler>\n\n  <requestHandler name=\"/admin/\" class=\"solr.admin.AdminHandlers\" />\n\n  <requestHandler name=\"/admin/ping\" class=\"solr.PingRequestHandler\">\n    <lst name=\"invariants\">\n      <str name=\"q\">solrpingquery</str>\n    </lst>\n    <lst name=\"defaults\">\n      <str name=\"echoParams\">all</str>\n    </lst>\n  </requestHandler>\n\n  <queryResponseWriter name=\"json\" class=\"solr.JSONResponseWriter\">\n    <str name=\"content-type\">text/plain; charset=UTF-8</str>\n  </queryResponseWriter>\n</config>\n\n\nsample scheme.xml\n\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<schema name=\"twitter\" version=\"1.5\">\n  <!-- types -->\n  <types>\n    <fieldType name=\"string\" class=\"solr.StrField\" sortMissingLast=\"true\" />\n    <fieldType name=\"long\" class=\"solr.TrieLongField\" precisionStep=\"0\" positionIncrementGap=\"0\"/>\n    <fieldType name=\"tlong\" class=\"solr.TrieLongField\" precisionStep=\"8\" positionIncrementGap=\"0\"/>\n    <fieldType name=\"tdate\" class=\"solr.TrieDateField\" precisionStep=\"6\" positionIncrementGap=\"0\"/>\n    <fieldType name=\"text_cjk\" class=\"solr.TextField\" positionIncrementGap=\"100\">\n      <analyzer>\n        <charFilter class=\"solr.MappingCharFilterFactory\"/>\n        <tokenizer class=\"solr.StandardTokenizerFactory\"/>\n        <filter class=\"solr.CJKWidthFilterFactory\"/>\n        <filter class=\"solr.LowerCaseFilterFactory\"/>\n        <filter class=\"solr.CJKBigramFilterFactory\" outputUnigrams=\"true\"/>\n      </analyzer>\n    </fieldType>\n  </types>\n\n  <!-- fields -->\n  <fields>\n    <field name=\"key\" type=\"string\" indexed=\"true\" stored=\"true\" required=\"true\" />\n    <field name=\"status_id\" type=\"tlong\" indexed=\"true\" stored=\"true\" required=\"true\"/>\n    <field name=\"text\" type=\"text_cjk\" indexed=\"true\" stored=\"true\" required=\"true\"/>\n    <field name=\"from_user_id_str\" type=\"string\" indexed=\"true\" stored=\"true\" required=\"true\"/>\n    <field name=\"created_at\" type=\"tdate\" indexed=\"true\" stored=\"true\" required=\"true\"/>\n    <field name=\"version\" type=\"long\" indexed=\"true\" stored=\"true\" multiValued=\"false\"/>\n  </fields>\n  <uniqueKey>key</uniqueKey>\n  <defaultSearchField>text</defaultSearchField>\n  <solrQueryParser defaultOperator=\"AND\"/>\n</schema>\n\n\n\nsample data add source code, python\n\n#!/usr/bin/env python\n\n\t coding: utf-8 \nimport datetime\n\tuse https://github.com/toastdriven/pysolr\nfrom pysolr import(\n    Solr,\n)\n\n\n\n\ndef main():\n    s_time = datetime.datetime.utcnow()\n    print 'start.: ({})'.format(str(s_time))\n\n    solr = Solr('http://localhost:8983/solr/collection1', timeout=60)\n\n    docs = []\n\n    max_range = 22 * (10 ** 8)  # Java Integer.MAX_VALUE over\n    for x in xrange(1, max_range):\n        docs.append(\n            {\n                'key': '{}'.format,\n                'status_id': x,\n                'text': '{} \u756a\u76ee\u306e\u8a18\u4e8b'.format.decode('utf-8'),\n                'from_user_id_str': '1',\n                'created_at': '2014-05-01T20:06:53Z',\n            }\n        )\n\n        if x % (10 ** 4) == 0:\n            solr.add(docs)\n            solr.commit()\n            docs = []\n\n            e_time = datetime.datetime.utcnow()\n\n            print '{} end.: ({})'.format(x, str(e_time - s_time))\n\n    solr.add(docs)\n    solr.commit()\n    docs = []\n\n    e_time = datetime.datetime.utcnow()\n\n    print 'end.: ({})'.format(str(e_time - s_time))\n\nif _name_ == '_main_':\n    main()",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "author": "Erik Hatcher",
            "id": "comment-14273160",
            "date": "2015-01-12T02:24:32+0000",
            "content": "How is this a Solr bug?  Looks like the script creates \"too many documents\", no? \n\nIf this is an issue that needs to be addressed, please re-open with more elaboration on what is being attempted and what is expected here. "
        }
    ]
}