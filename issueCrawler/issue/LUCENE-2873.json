{
    "id": "LUCENE-2873",
    "title": "TestIndexWriterReader fails: too many open files",
    "details": {
        "labels": "",
        "priority": "Major",
        "components": [],
        "type": "Bug",
        "fix_versions": [],
        "affect_versions": "3.1",
        "resolution": "Unresolved",
        "status": "Open"
    },
    "description": "[junit] Testsuite: org.apache.lucene.index.TestIndexWriterReader\n    [junit] Testcase: testAddIndexesAndDoDeletesThreads(org.apache.lucene.index.TestIndexWriterReader):\tCaused an ERROR\n    [junit] /home/cron/branch_3x/lucene/build/test/6/test7430286492423218781tmp/_90.prx (Too many open files)\n    [junit] java.io.FileNotFoundException: /home/cron/branch_3x/lucene/build/test/6/test7430286492423218781tmp/_90.prx (Too many open files)\n    [junit] \tat java.io.RandomAccessFile.open(Native Method)\n    [junit] \tat java.io.RandomAccessFile.<init>(RandomAccessFile.java:229)\n    [junit] \tat org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexInput$Descriptor.<init>(SimpleFSDirectory.java:69)\n    [junit] \tat org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexInput.<init>(SimpleFSDirectory.java:90)\n    [junit] \tat org.apache.lucene.store.NIOFSDirectory$NIOFSIndexInput.<init>(NIOFSDirectory.java:91)\n    [junit] \tat org.apache.lucene.store.NIOFSDirectory.openInput(NIOFSDirectory.java:78)\n    [junit] \tat org.apache.lucene.store.FSDirectory.openInput(FSDirectory.java:353)\n    [junit] \tat org.apache.lucene.store.MockDirectoryWrapper.openInput(MockDirectoryWrapper.java:358)\n    [junit] \tat org.apache.lucene.store.Directory.openInput(Directory.java:139)\n    [junit] \tat org.apache.lucene.index.SegmentReader$CoreReaders.<init>(SegmentReader.java:135)\n    [junit] \tat org.apache.lucene.index.SegmentReader.get(SegmentReader.java:583)\n    [junit] \tat org.apache.lucene.index.SegmentReader.get(SegmentReader.java:561)\n    [junit] \tat org.apache.lucene.index.DirectoryReader.<init>(DirectoryReader.java:101)\n    [junit] \tat org.apache.lucene.index.ReadOnlyDirectoryReader.<init>(ReadOnlyDirectoryReader.java:27)\n    [junit] \tat org.apache.lucene.index.DirectoryReader$1.doBody(DirectoryReader.java:78)\n    [junit] \tat org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.java:697)\n    [junit] \tat org.apache.lucene.index.DirectoryReader.open(DirectoryReader.java:72)\n    [junit] \tat org.apache.lucene.index.IndexReader.open(IndexReader.java:344)\n    [junit] \tat org.apache.lucene.index.IndexReader.open(IndexReader.java:230)\n    [junit] \tat org.apache.lucene.index.TestIndexWriterReader.testAddIndexesAndDoDeletesThreads(TestIndexWriterReader.java:381)\n    [junit] \tat org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1007)\n    [junit] \tat org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:939)\n    [junit] \n    [junit] \n    [junit] Tests run: 18, Failures: 0, Errors: 1, Time elapsed: 13.56 sec\n    [junit] \n    [junit] ------------- Standard Error -----------------\n    [junit] NOTE: reproduce with: ant test -Dtestcase=TestIndexWriterReader -Dtestmethod=testAddIndexesAndDoDeletesThreads -Dtests.seed=-7781539944268912038:-6865031686554264582\n    [junit] NOTE: test params are: locale=ar_SD, timezone=Asia/Almaty\n    [junit] NOTE: all tests run in this JVM:\n    [junit] [TestMergeSchedulerExternal, TestCharFilter, TestISOLatin1AccentFilter, TestCharTermAttributeImpl, TestDoc, TestFieldsReader, TestFilterIndexReader, TestIndexWriterReader]\n    [junit] NOTE: Linux 2.6.32-24-generic x86/IBM Corporation 1.6.0 (32-bit)/cpus=1,threads=3,free=6495816,total=11920384\n    [junit] ------------- ---------------- ---------------\n    [junit] TEST org.apache.lucene.index.TestIndexWriterReader FAILED",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "date": "2015-08-10T04:45:01+0000",
            "content": "Issue related to very old Lucene as well as Java version. \n\nIf the Lucene version 3.1 is currently not active, recommend to close this issue.\n\nThanks and Regards\nBrijesh Nekkare\nIBM Java team ",
            "author": "Brijesh Nekkare",
            "id": "comment-14679557"
        },
        {
            "date": "2015-10-14T20:34:35+0000",
            "content": "I second Brijesh, this issue is related to a very old Lucene + JDK version. \n\nBesides, it seems like the test case has become invalid. I  ran the test with the latest Lucene/ Solr Trunk version with  IBM Java 8 and branch_5x with Java7 on both Windows and Linux. I also ran it with Oracle 7. In all cases, the test fails with : \u201cjava.lang.IllegalArgumentException: Not a valid seed chain: -7781539944268912038:-686\n5031686554264582\u201d \n\nIf the test case is invalid, can we cancel this defect? \n\n\u2014 \nDetails of the exception below (from a Windows run): \n\n-test:\n    [mkdir] Created dir: C:\\lucene_testing\\win\\src\\trunk\\lucene\\build\\core\\test\n[junit4:pickseed] Seed property 'tests.seed' already defined: -7781539944268912038:-6865031686554264582\n\nBUILD FAILED\nC:\\lucene_testing\\win\\src\\trunk\\build.xml:59: The following error occurred while executing this line:\nC:\\lucene_testing\\win\\src\\trunk\\lucene\\build.xml:50: The following error occurred while executing this line:\nC:\\lucene_testing\\win\\src\\trunk\\lucene\\common-build.xml:1432: The following error occurred while executing this line:\nC:\\lucene_testing\\win\\src\\trunk\\lucene\\common-build.xml:936: java.lang.IllegalArgumentException: Not a valid seed chain: -7781539944268912038:-686\n5031686554264582\n        at com.carrotsearch.ant.tasks.junit4.dependencies.com.carrotsearch.randomizedtesting.SeedUtils.parseSeedChain(SeedUtils.java:47)\n        at com.carrotsearch.ant.tasks.junit4.PickFromListTask.validate(PickFromListTask.java:121)\n        at com.carrotsearch.ant.tasks.junit4.PickFromListTask.execute(PickFromListTask.java:94)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:291)\n        at sun.reflect.GeneratedMethodAccessor6.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:55)\n        at java.lang.reflect.Method.invoke(Method.java:507)\n        at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)\n        at org.apache.tools.ant.Task.perform(Task.java:348)\n        at org.apache.tools.ant.taskdefs.Sequential.execute(Sequential.java:68)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:291)\n        at sun.reflect.GeneratedMethodAccessor6.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:55)\n        at java.lang.reflect.Method.invoke(Method.java:507)\n        at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)\n        at org.apache.tools.ant.Task.perform(Task.java:348)\n        at org.apache.tools.ant.taskdefs.MacroInstance.execute(MacroInstance.java:398)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:291)\n        at sun.reflect.GeneratedMethodAccessor6.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:55)\n        at java.lang.reflect.Method.invoke(Method.java:507)\n        at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)\n        at org.apache.tools.ant.Task.perform(Task.java:348)\n        at org.apache.tools.ant.Target.execute(Target.java:390)\n        at org.apache.tools.ant.Target.performTasks(Target.java:411)\n        at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1399)\n        at org.apache.tools.ant.helper.SingleCheckExecutor.executeTargets(SingleCheckExecutor.java:38)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1251)\n        at org.apache.tools.ant.taskdefs.Ant.execute(Ant.java:442)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:291)\n        at sun.reflect.GeneratedMethodAccessor6.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:55)\n        at java.lang.reflect.Method.invoke(Method.java:507)\n        at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)\n        at org.apache.tools.ant.Task.perform(Task.java:348)\n        at org.apache.tools.ant.Target.execute(Target.java:390)\n        at org.apache.tools.ant.Target.performTasks(Target.java:411)\n        at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1399)\n        at org.apache.tools.ant.helper.SingleCheckExecutor.executeTargets(SingleCheckExecutor.java:38)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1251)\n        at org.apache.tools.ant.taskdefs.Ant.execute(Ant.java:442)\n        at org.apache.tools.ant.taskdefs.SubAnt.execute(SubAnt.java:302)\n        at org.apache.tools.ant.taskdefs.SubAnt.execute(SubAnt.java:221)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:291)\n        at sun.reflect.GeneratedMethodAccessor6.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:55)\n        at java.lang.reflect.Method.invoke(Method.java:507)\n        at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)\n        at org.apache.tools.ant.Task.perform(Task.java:348)\n        at org.apache.tools.ant.Target.execute(Target.java:390)\n        at org.apache.tools.ant.Target.performTasks(Target.java:411)\n        at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1399)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1368)\n        at org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1251)\n        at org.apache.tools.ant.Main.runBuild(Main.java:809)\n        at org.apache.tools.ant.Main.startAnt(Main.java:217)\n        at org.apache.tools.ant.launch.Launcher.run(Launcher.java:280)\n        at org.apache.tools.ant.launch.Launcher.main(Launcher.java:109) ",
            "author": "Mesbah Alam",
            "id": "comment-14957698"
        }
    ]
}