{
    "id": "SOLR-1148",
    "title": "with code generated by the RubyWriter sorted facets are are actually unsorted in Ruby 1.8",
    "details": {
        "affect_versions": "1.3",
        "status": "Closed",
        "fix_versions": [],
        "components": [
            "clients - ruby - flare"
        ],
        "type": "Bug",
        "priority": "Minor",
        "labels": "",
        "resolution": "Cannot Reproduce"
    },
    "description": "Facet counts are returned as ruby Hash, which is unordered in Ruby 1.8. After evaling the hash, the sorting order is lost and the client program needs to re-sort the data.\nA fix would be returning facet counts as array of pairs, instead, e.g. \n\n [['foo', 10], ['bar', 8], ['baz', 6]]",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "author": "Yonik Seeley",
            "id": "comment-12706435",
            "date": "2009-05-06T13:58:53+0000",
            "content": "Are you passing a parameter that is causing Solr to return a hash?  The default for JSON/Python/Ruby is to return an array when order is important.\n\nhttp://localhost:8983/solr/select?q=*:*&facet=on&facet.field=cat&wt=ruby&indent=on\n\n\n  'facet_fields'=>{\n\t'cat'=>[\n\t 'electronics',14,\n\t 'memory',3,\n\t 'card',2,\n\t 'connector',2,\n\t 'drive',2,\n\t 'graphics',2,\n\t 'hard',2,\n\t 'monitor',2,\n\t 'search',2,\n\t 'software',2,\n\t 'camera',1,\n\t 'copier',1,\n\t 'multifunction',1,\n\t 'music',1,\n\t 'printer',1,\n\t 'scanner',1]},\n\n "
        },
        {
            "author": "Erik Hatcher",
            "id": "comment-12706441",
            "date": "2009-05-06T14:26:40+0000",
            "content": "Also of note... if you're using the solr-ruby library, the Standard response has a #field_facets(field_name) method that'll give you back properly sorted facets (from the array Yonik demonstrated) as a nicer to work with data structure: and array of FacetValue (a Ruby Struct) objects. "
        },
        {
            "author": "Max Sch\u00f6fmann",
            "id": "comment-12706456",
            "date": "2009-05-06T15:24:06+0000",
            "content": "Ah, my solrconfig.xml had indeed the json.nl parameter overridden to \"map\". Seems to be a bug in the bundled config of the popular rails plugin for solr.\n\nSorry for the noise. "
        },
        {
            "author": "Erik Hatcher",
            "id": "comment-12706468",
            "date": "2009-05-06T15:59:00+0000",
            "content": "Which rails plugin has json.nl set to \"map\"? "
        },
        {
            "author": "Max Sch\u00f6fmann",
            "id": "comment-12706486",
            "date": "2009-05-06T16:21:14+0000",
            "content": "acts_as_solr  \u2013  still seems to be quite popular (thanks to github...)\nfixed this in my own fork: http://github.com/schoefmax/acts_as_solr "
        }
    ]
}