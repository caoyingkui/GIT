{
    "id": "SOLR-10976",
    "title": "StreamExpressionTest.testParallelTerminatingDaemonUpdateStream() failures: Boolean cannot be cast to Map",
    "details": {
        "labels": "",
        "priority": "Major",
        "components": [],
        "type": "Bug",
        "fix_versions": [],
        "affect_versions": "None",
        "resolution": "Unresolved",
        "status": "Open"
    },
    "description": "Non-reproducing failure from Policeman Jenkins https://jenkins.thetaphi.de/job/Lucene-Solr-master-Windows/6688/:\n\n\nChecking out Revision 85069cacf40e757b3eb4d4d211b1783faf800bc5 (refs/remotes/origin/master)\n[...]\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=StreamExpressionTest -Dtests.method=testParallelTerminatingDaemonUpdateStream -Dtests.seed=340B5BCF2D4B369 -Dtests.slow=true -Dtests.locale=ca -Dtests.timezone=Europe/Kiev -Dtests.asserts=true -Dtests.file.encoding=Cp1252\n   [junit4] ERROR   3.62s J0 | StreamExpressionTest.testParallelTerminatingDaemonUpdateStream <<<\n   [junit4]    > Throwable #1: java.io.IOException: --> http://127.0.0.1:63090/solr/collection1: An exception has occurred on the server, refer to server log for details.\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([340B5BCF2D4B369:F2246DD4A6BE7C77]:0)\n   [junit4]    > \tat org.apache.solr.client.solrj.io.stream.SolrStream.read(SolrStream.java:222)\n   [junit4]    > \tat org.apache.solr.client.solrj.io.stream.StreamExpressionTest.testParallelTerminatingDaemonUpdateStream(StreamExpressionTest.java:4364)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:748)\n   [junit4]    > Caused by: java.lang.ClassCastException: java.lang.Boolean cannot be cast to java.util.Map\n   [junit4]    > \tat org.apache.solr.client.solrj.io.stream.JavabinTupleStreamParser.next(JavabinTupleStreamParser.java:182)\n   [junit4]    > \tat org.apache.solr.client.solrj.io.stream.SolrStream.read(SolrStream.java:191)\n[...]\n   [junit4]   2> NOTE: test params are: codec=FastDecompressionCompressingStoredFields(storedFieldsFormat=CompressingStoredFieldsFormat(compressionMode=FAST_DECOMPRESSION, chunkSize=21931, maxDocsPerChunk=394, blockSize=393), termVectorsFormat=CompressingTermVectorsFormat(compressionMode=FAST_DECOMPRESSION, chunkSize=21931, blockSize=393)), sim=RandomSimilarity(queryNorm=false): {}, locale=ca, timezone=Europe/Kiev\n   [junit4]   2> NOTE: Windows 10 10.0 amd64/Oracle Corporation 1.8.0_131 (64-bit)/cpus=3,threads=6,free=185977552,total=341770240\n   [junit4]   2> NOTE: All tests run in this JVM: [TestPathTrie, SolrExampleEmbeddedTest, CollectionAdminRequestRequiredParamsTest, GreaterThanEqualToEvaluatorTest, ArrayEvaluatorTest, StreamExpressionParserTest, SolrPingTest, TestHash, TestSolrProperties, ConcurrentUpdateSolrClientTest, TestZkConfigManager, StreamExpressionToExplanationTest, NaturalLogEvaluatorTest, ModuloEvaluatorTest, JsonValidatorTest, BasicHttpSolrClientTest, EqualsEvaluatorTest, OrEvaluatorTest, HyperbolicCosineEvaluatorTest, TestBatchUpdate, SolrExampleStreamingTest, SolrDocumentTest, TestXMLEscaping, TermsResponseTest, TestClusteringResponse, SineEvaluatorTest, GraphExpressionTest, HyperbolicTangentEvaluatorTest, TestEmbeddedSolrServer, ArcSineEvaluatorTest, CubedRootEvaluatorTest, JdbcDriverTest, SolrExampleBinaryTest, SolrExampleXMLTest, JettyWebappTest, TestSpellCheckResponse, SolrParamTest, MergeIndexesEmbeddedTest, QueryResponseTest, TestCoreAdmin, TestNamedListCodec, TestJavaBinCodec, TestDocumentObjectBinder, SolrQueryTest, ContentStreamTest, ModifiableSolrParamsTest, DocumentAnalysisResponseTest, TestUpdateRequestCodec, FieldAnalysisResponseTest, NamedListTest, FacetFieldTest, GetByIdTest, SolrSchemalessExampleTest, TestSolrJErrorHandling, CloudSolrClientBuilderTest, CloudSolrClientCacheTest, CloudSolrClientTest, HttpSolrClientBuilderTest, HttpSolrClientConPoolTest, LBHttpSolrClientBuilderTest, TestCloudSolrClientConnections, GraphTest, StreamExpressionTest]",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "date": "2017-06-29T14:06:56+0000",
            "content": "Another Policeman failure https://jenkins.thetaphi.de/job/Lucene-Solr-6.x-Linux/2711/ (from January 22, 2017, so only the email notification is still accessible):\n\n\nFAILED:  org.apache.solr.client.solrj.io.stream.StreamExpressionTest.testParallelTerminatingDaemonUpdateStream\n\nError Message:\n--> http://127.0.0.1:34900/solr/collection1: An exception has occurred on the server, refer to server log for details.\n\nStack Trace:\njava.io.IOException: --> http://127.0.0.1:34900/solr/collection1: An exception has occurred on the server, refer to server log for details.\n\tat __randomizedtesting.SeedInfo.seed([3E0A16E04BD9A583:CF6ECE881FB36A9D]:0)\n\tat org.apache.solr.client.solrj.io.stream.SolrStream.read(SolrStream.java:238)\n\tat org.apache.solr.client.solrj.io.stream.StreamExpressionTest.testParallelTerminatingDaemonUpdateStream(StreamExpressionTest.java:3765)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:543)\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1713)\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:907)\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:943)\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:957)\n\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:57)\n\tat org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:49)\n\tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\n\tat org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:48)\n\tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)\n\tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:367)\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:811)\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:462)\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:916)\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:802)\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:852)\n\tat com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:863)\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:57)\n\tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n\tat org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:41)\n\tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)\n\tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n\tat org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)\n\tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)\n\tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)\n\tat org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:54)\n\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\n\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:367)\n\tat java.base/java.lang.Thread.run(Thread.java:844)\nCaused by: java.lang.ClassCastException: java.base/java.lang.Boolean cannot be cast to java.base/java.util.Map\n\tat org.apache.solr.client.solrj.io.stream.JavabinTupleStreamParser.next(JavabinTupleStreamParser.java:182)\n\tat org.apache.solr.client.solrj.io.stream.SolrStream.read(SolrStream.java:207)\n[...]\n  [junit4]   2> NOTE: test params are: codec=Asserting(Lucene62): {expr_s=PostingsFormat(name=Memory doPackFST= true), name_s=PostingsFormat(name=LuceneVarGapFixedInterval), iteration_i=PostingsFormat(name=Memory doPackFST= true), terms_ss=FST50, join2_s=FST50, field_s=Lucene50(blocksize=128), multiDefault=FST50, subject=FST50, a_f=FST50, intDefault=Lucene50(blocksize=128), join1_i=PostingsFormat(name=Memory doPackFST= true), falseNegative_i=Lucene50(blocksize=128), a_i=PostingsFormat(name=Memory doPackFST= true), join3_i=PostingsFormat(name=LuceneVarGapFixedInterval), falsePositive_i=Lucene50(blocksize=128), field_i=FST50, level1_s=PostingsFormat(name=Memory doPackFST= true), body_t=PostingsFormat(name=LuceneVarGapFixedInterval), s_multi=PostingsFormat(name=LuceneVarGapFixedInterval), level2_s=Lucene50(blocksize=128), a_s=PostingsFormat(name=LuceneVarGapFixedInterval), score_f=PostingsFormat(name=LuceneVarGapFixedInterval), tv_text=Lucene50(blocksize=128), term_s=FST50, text_s=PostingsFormat(name=Memory doPackFST= true), id=PostingsFormat(name=Memory doPackFST= true), text=PostingsFormat(name=LuceneVarGapFixedInterval), timestamp=Lucene50(blocksize=128), idfs_ds=Lucene50(blocksize=128), alpha_d=PostingsFormat(name=LuceneVarGapFixedInterval), i_multi=PostingsFormat(name=Memory doPackFST= true), weights_ds=PostingsFormat(name=LuceneVarGapFixedInterval), featureSet_s=FST50, idf_d=FST50, trueNegative_i=PostingsFormat(name=LuceneVarGapFixedInterval), index_i=FST50, out_i=FST50, checkpoint_ss=PostingsFormat(name=LuceneVarGapFixedInterval), ident_s=FST50, whitetok=PostingsFormat(name=LuceneVarGapFixedInterval), _version_=Lucene50(blocksize=128), error_d=PostingsFormat(name=Memory doPackFST= true), side_s=PostingsFormat(name=LuceneVarGapFixedInterval), truePositive_i=PostingsFormat(name=Memory doPackFST= true)}, docValues:{expr_s=DocValuesFormat(name=Asserting), name_s=DocValuesFormat(name=Memory), iteration_i=DocValuesFormat(name=Asserting), terms_ss=DocValuesFormat(name=Lucene54), join2_s=DocValuesFormat(name=Lucene54), field_s=DocValuesFormat(name=Lucene54), multiDefault=DocValuesFormat(name=Lucene54), a_f=DocValuesFormat(name=Lucene54), intDefault=DocValuesFormat(name=Lucene54), join1_i=DocValuesFormat(name=Asserting), falseNegative_i=DocValuesFormat(name=Lucene54), a_i=DocValuesFormat(name=Asserting), join3_i=DocValuesFormat(name=Memory), falsePositive_i=DocValuesFormat(name=Lucene54), field_i=DocValuesFormat(name=Lucene54), level1_s=DocValuesFormat(name=Asserting), s_multi=DocValuesFormat(name=Memory), level2_s=DocValuesFormat(name=Lucene54), a_s=DocValuesFormat(name=Memory), score_f=DocValuesFormat(name=Memory), term_s=DocValuesFormat(name=Lucene54), text_s=DocValuesFormat(name=Asserting), id=DocValuesFormat(name=Asserting), i_multi=DocValuesFormat(name=Asserting), featureSet_s=DocValuesFormat(name=Lucene54), trueNegative_i=DocValuesFormat(name=Memory), index_i=DocValuesFormat(name=Lucene54), out_i=DocValuesFormat(name=Lucene54), checkpoint_ss=DocValuesFormat(name=Memory), ident_s=DocValuesFormat(name=Lucene54), _version_=DocValuesFormat(name=Lucene54), side_s=DocValuesFormat(name=Memory), truePositive_i=DocValuesFormat(name=Asserting)}, maxPointsInLeafNode=2041, maxMBSortInHeap=5.2485590223910314, sim=RandomSimilarity(queryNorm=false,coord=crazy): {}, locale=en-PW, timezone=Asia/Colombo\n  [junit4]   2> NOTE: Linux 4.4.0-53-generic amd64/Oracle Corporation 9-ea (64-bit)/cpus=12,threads=1,free=189943192,total=522715136\n  [junit4]   2> NOTE: All tests run in this JVM: [BasicHttpSolrClientTest, TestSuggesterResponse, TestHash, GraphExpressionTest, StreamExpressionParserTest, FacetFieldTest, SolrExampleBinaryTest, TestCoreAdmin, TestCollectionStateWatchers, SchemaTest, TestRetryUtil, ConcurrentUpdateSolrClientTest, HttpClientUtilTest, CommonParamsTest, JdbcTest, StreamExpressionTest]\n\n ",
            "author": "Steve Rowe",
            "id": "comment-16068388"
        }
    ]
}