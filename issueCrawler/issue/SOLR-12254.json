{
    "id": "SOLR-12254",
    "title": "TestInPlaceUpdatesDistrib reproducing failures",
    "details": {
        "labels": "",
        "priority": "Major",
        "components": [
            "Tests",
            "update"
        ],
        "type": "Bug",
        "fix_versions": [],
        "affect_versions": "None",
        "resolution": "Unresolved",
        "status": "Open"
    },
    "description": "From https://builds.apache.org/job/Lucene-Solr-NightlyTests-7.x/205/, 100% reproducing (see https://builds.apache.org/job/Lucene-Solr-repro/535/):\n\n\nChecking out Revision 3d21fda4ce1c899f31b8f00e200eb1ac0d23d17b (refs/remotes/origin/branch_7x)\n[...]\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=TestInPlaceUpdatesDistrib -Dtests.method=test -Dtests.seed=9BC71F2BDDB8F28A -Dtests.multiplier=2 -Dtests.nightly=true -Dtests.slow=true -Dtests.linedocsfile=/home/jenkins/jenkins-slave/workspace/Lucene-Solr-NightlyTests-7.x/test-data/enwiki.random.lines.txt -Dtests.locale=ru-RU -Dtests.timezone=Hongkong -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1\n   [junit4] ERROR   23.6s J2 | TestInPlaceUpdatesDistrib.test <<<\n   [junit4]    > Throwable #1: org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server at https://127.0.0.1:56916/collection1: ERROR adding document SolrInputDocument(fields: [id=-216, title_s=title-216, id_i=-216, _version_=1598231319283761152])\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([9BC71F2BDDB8F28A:139320F173449F72]:0)\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:643)\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:255)\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:244)\n   [junit4]    > \tat org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:194)\n   [junit4]    > \tat org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:211)\n   [junit4]    > \tat org.apache.solr.update.TestInPlaceUpdatesDistrib.addDocAndGetVersion(TestInPlaceUpdatesDistrib.java:1105)\n   [junit4]    > \tat org.apache.solr.update.TestInPlaceUpdatesDistrib.buildRandomIndex(TestInPlaceUpdatesDistrib.java:1150)\n   [junit4]    > \tat org.apache.solr.update.TestInPlaceUpdatesDistrib.docValuesUpdateTest(TestInPlaceUpdatesDistrib.java:318)\n   [junit4]    > \tat org.apache.solr.update.TestInPlaceUpdatesDistrib.test(TestInPlaceUpdatesDistrib.java:144)\n   [junit4]    > \tat org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsFixedStatement.callStatement(BaseDistributedSearchTestCase.java:993)\n   [junit4]    > \tat org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsStatement.evaluate(BaseDistributedSearchTestCase.java:968)\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:748)\n[...]\n   [junit4]   2> NOTE: test params are: codec=Asserting(Lucene70): {title_s=PostingsFormat(name=LuceneFixedGap), id=Lucene50(blocksize=128), id_field_copy_that_does_not_support_in_place_update_s=PostingsFormat(name=Memory)}, docValues:{inplace_updatable_float=DocValuesFormat(name=Lucene70), id_i=DocValuesFormat(name=Direct), _version_=DocValuesFormat(name=Asserting), id=DocValuesFormat(name=Memory), inplace_updatable_int_with_default=DocValuesFormat(name=Lucene70), inplace_updatable_float_with_default=DocValuesFormat(name=Direct)}, maxPointsInLeafNode=922, maxMBSortInHeap=5.690194493492291, sim=RandomSimilarity(queryNorm=true): {}, locale=ru-RU, timezone=Hongkong\n   [junit4]   2> NOTE: Linux 3.13.0-88-generic amd64/Oracle Corporation 1.8.0_152 (64-bit)/cpus=4,threads=1,free=127774192,total=523763712",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "date": "2018-10-11T16:30:24+0000",
            "content": "Another reproducing failure, apparently has a different cause though.  From https://jenkins.thetaphi.de/job/Lucene-Solr-master-Linux/23010/ (reproduces for me 5/5 iterations with Java8):\n\n\nChecking out Revision 971a0e3f4afddab4687642834037c52fef0c6758 (refs/remotes/origin/master)\n[...]\n[java-info] java version \"12-ea\"\n[java-info] OpenJDK Runtime Environment (12-ea+12, Oracle Corporation)\n[java-info] OpenJDK 64-Bit Server VM (12-ea+12, Oracle Corporation)\n[java-info] Test args: [-XX:+UseCompressedOops -XX:+UseSerialGC]\n[...]\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=TestInPlaceUpdatesDistrib -Dtests.method=test -Dtests.seed=FC7D71FE8231BFF7 -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=fr-BE -Dtests.timezone=Etc/GMT-9 -Dtests.asserts=true -Dtests.file.encoding=UTF-8\n   [junit4] ERROR   4043s J2 | TestInPlaceUpdatesDistrib.test <<<\n   [junit4]    > Throwable #1: org.apache.solr.client.solrj.SolrServerException: Timeout occured while waiting response from server at: https://127.0.0.1:34187/_qot/o/collection1\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([FC7D71FE8231BFF7:74294E242CCDD20F]:0)\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:654)\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:255)\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:244)\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.LBHttpSolrClient.doRequest(LBHttpSolrClient.java:483)\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.LBHttpSolrClient.request(LBHttpSolrClient.java:413)\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.CloudSolrClient.sendRequest(CloudSolrClient.java:1107)\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:884)\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.CloudSolrClient.request(CloudSolrClient.java:817)\n   [junit4]    > \tat org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:194)\n   [junit4]    > \tat org.apache.solr.client.solrj.SolrClient.commit(SolrClient.java:484)\n   [junit4]    > \tat org.apache.solr.client.solrj.SolrClient.commit(SolrClient.java:463)\n   [junit4]    > \tat org.apache.solr.cloud.AbstractFullDistribZkTestBase.commit(AbstractFullDistribZkTestBase.java:1590)\n   [junit4]    > \tat org.apache.solr.update.TestInPlaceUpdatesDistrib.docValuesUpdateTest(TestInPlaceUpdatesDistrib.java:378)\n   [junit4]    > \tat org.apache.solr.update.TestInPlaceUpdatesDistrib.test(TestInPlaceUpdatesDistrib.java:146)\n   [junit4]    > \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n   [junit4]    > \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n   [junit4]    > \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n   [junit4]    > \tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\n   [junit4]    > \tat org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsFixedStatement.callStatement(BaseDistributedSearchTestCase.java:1010)\n   [junit4]    > \tat org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsStatement.evaluate(BaseDistributedSearchTestCase.java:985)\n   [junit4]    > \tat java.base/java.lang.Thread.run(Thread.java:835)\n   [junit4]    > Caused by: java.net.SocketTimeoutException: Read timed out\n   [junit4]    > \tat java.base/java.net.SocketInputStream.socketRead0(Native Method)\n   [junit4]    > \tat java.base/java.net.SocketInputStream.socketRead(SocketInputStream.java:115)\n   [junit4]    > \tat java.base/java.net.SocketInputStream.read(SocketInputStream.java:168)\n   [junit4]    > \tat java.base/java.net.SocketInputStream.read(SocketInputStream.java:140)\n   [junit4]    > \tat java.base/sun.security.ssl.SSLSocketInputRecord.read(SSLSocketInputRecord.java:448)\n   [junit4]    > \tat java.base/sun.security.ssl.SSLSocketInputRecord.bytesInCompletePacket(SSLSocketInputRecord.java:68)\n   [junit4]    > \tat java.base/sun.security.ssl.SSLSocketImpl.readApplicationRecord(SSLSocketImpl.java:1104)\n   [junit4]    > \tat java.base/sun.security.ssl.SSLSocketImpl$AppInputStream.read(SSLSocketImpl.java:823)\n   [junit4]    > \tat org.apache.http.impl.io.SessionInputBufferImpl.streamRead(SessionInputBufferImpl.java:137)\n   [junit4]    > \tat org.apache.http.impl.io.SessionInputBufferImpl.fillBuffer(SessionInputBufferImpl.java:153)\n   [junit4]    > \tat org.apache.http.impl.io.SessionInputBufferImpl.readLine(SessionInputBufferImpl.java:282)\n   [junit4]    > \tat org.apache.http.impl.conn.DefaultHttpResponseParser.parseHead(DefaultHttpResponseParser.java:138)\n   [junit4]    > \tat org.apache.http.impl.conn.DefaultHttpResponseParser.parseHead(DefaultHttpResponseParser.java:56)\n   [junit4]    > \tat org.apache.http.impl.io.AbstractMessageParser.parse(AbstractMessageParser.java:259)\n   [junit4]    > \tat org.apache.http.impl.DefaultBHttpClientConnection.receiveResponseHeader(DefaultBHttpClientConnection.java:163)\n   [junit4]    > \tat org.apache.http.impl.conn.CPoolProxy.receiveResponseHeader(CPoolProxy.java:165)\n   [junit4]    > \tat org.apache.http.protocol.HttpRequestExecutor.doReceiveResponse(HttpRequestExecutor.java:273)\n   [junit4]    > \tat org.apache.http.protocol.HttpRequestExecutor.execute(HttpRequestExecutor.java:125)\n   [junit4]    > \tat org.apache.http.impl.execchain.MainClientExec.execute(MainClientExec.java:272)\n   [junit4]    > \tat org.apache.http.impl.execchain.ProtocolExec.execute(ProtocolExec.java:185)\n   [junit4]    > \tat org.apache.http.impl.execchain.RetryExec.execute(RetryExec.java:89)\n   [junit4]    > \tat org.apache.http.impl.execchain.RedirectExec.execute(RedirectExec.java:111)\n   [junit4]    > \tat org.apache.http.impl.client.InternalHttpClient.doExecute(InternalHttpClient.java:185)\n   [junit4]    > \tat org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:83)\n   [junit4]    > \tat org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:56)\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:542)\n   [junit4]    > \t... 53 more\n[...]\n   [junit4]   2> NOTE: test params are: codec=Asserting(Lucene80): {title_s=TestBloomFilteredLucenePostings(BloomFilteringPostingsFormat(Lucene50(blocksize=128))), id=FST50, id_field_copy_that_does_not_support_in_place_update_s=PostingsFormat(name=LuceneVarGapFixedInterval)}, docValues:{inplace_updatable_float=DocValuesFormat(name=Direct), id_i=DocValuesFormat(name=Lucene70), _version_=DocValuesFormat(name=Asserting), id=DocValuesFormat(name=Lucene70), inplace_updatable_int_with_default=DocValuesFormat(name=Direct), inplace_updatable_float_with_default=DocValuesFormat(name=Lucene70)}, maxPointsInLeafNode=759, maxMBSortInHeap=5.992878439750896, sim=Asserting(org.apache.lucene.search.similarities.AssertingSimilarity@2f7c9933), locale=fr-BE, timezone=Etc/GMT-9\n   [junit4]   2> NOTE: Linux 4.15.0-36-generic amd64/Oracle Corporation 12-ea (64-bit)/cpus=8,threads=1,free=115586464,total=518979584\n\n ",
            "author": "Steve Rowe",
            "id": "comment-16646729"
        }
    ]
}