{
    "id": "SOLR-2672",
    "title": "EchoParamsTest fails with Java 7 (randomly)",
    "details": {
        "affect_versions": "None",
        "status": "Closed",
        "fix_versions": [
            "3.4",
            "4.0-ALPHA"
        ],
        "components": [],
        "type": "Bug",
        "priority": "Major",
        "labels": "",
        "resolution": "Fixed"
    },
    "description": "This test fails randomly, I have no idea what it does, the test code looks like chinese to me.\n\n\njunit-sequential:\n    [junit] Testsuite: org.apache.solr.EchoParamsTest\n    [junit] Tests run: 4, Failures: 0, Errors: 2, Time elapsed: 1,794 sec\n    [junit]\n    [junit] ------------- Standard Error -----------------\n    [junit] ??? 24, 2011 6:04:37 ? org.apache.solr.SolrTestCaseJ4 assertQ\n    [junit] SEVERE: REQUEST FAILED: xpath=not(//lst[@name='params'])\n    [junit]     xml response was: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n    [junit] <response>\n    [junit] <lst name=\"responseHeader\"><int name=\"status\">0</int><int name=\"QTime\">0</int><str name=\"handler\">org.apache.solr.handle\nr.StandardRequestHandler</str><lst name=\"params\"><str name=\"fl\">implicit</str><str name=\"echoParams\">all</str><str name=\"start\">0</s\ntr><str name=\"q\">foo</str><str name=\"echoHandler\">true</str><str name=\"qt\">crazy_custom_qt</str><str name=\"wt\">xml</str><str name=\"r\nows\">20</str><str name=\"version\">2.2</str></lst></lst><result name=\"response\" numFound=\"0\" start=\"0\"></result>\n    [junit] </response>\n    [junit]\n    [junit]     request was:echoParams=all&start=0&q=foo&echoHandler=true&qt=crazy_custom_qt&wt=xml&rows=20&version=2.2\n    [junit] ??? 24, 2011 6:04:37 ? org.apache.solr.common.SolrException log\n    [junit] SEVERE: REQUEST FAILED: echoParams=all&start=0&q=foo&echoHandler=true&qt=crazy_custom_qt&wt=xml&rows=20&version=2.2:java\n.lang.RuntimeException: REQUEST FAILED: xpath=not(//lst[@name='params'])\n    [junit]     xml response was: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n    [junit] <response>\n    [junit] <lst name=\"responseHeader\"><int name=\"status\">0</int><int name=\"QTime\">0</int><str name=\"handler\">org.apache.solr.handle\nr.StandardRequestHandler</str><lst name=\"params\"><str name=\"fl\">implicit</str><str name=\"echoParams\">all</str><str name=\"start\">0</s\ntr><str name=\"q\">foo</str><str name=\"echoHandler\">true</str><str name=\"qt\">crazy_custom_qt</str><str name=\"wt\">xml</str><str name=\"r\nows\">20</str><str name=\"version\">2.2</str></lst></lst><result name=\"response\" numFound=\"0\" start=\"0\"></result>\n    [junit] </response>\n    [junit]\n    [junit]     request was:echoParams=all&start=0&q=foo&echoHandler=true&qt=crazy_custom_qt&wt=xml&rows=20&version=2.2\n    [junit]     at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:398)\n    [junit]     at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:372)\n    [junit]     at org.apache.solr.EchoParamsTest.testDefaultEchoParams(EchoParamsTest.java:40)\n    [junit]     at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    [junit]     at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n    [junit]     at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    [junit]     at java.lang.reflect.Method.invoke(Method.java:601)\n    [junit]     at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)\n    [junit]     at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)\n    [junit]     at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)\n    [junit]     at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)\n    [junit]     at org.junit.rules.TestWatchman$1.evaluate(TestWatchman.java:48)\n    [junit]     at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)\n    [junit]     at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)\n    [junit]     at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:76)\n    [junit]     at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1486)\n    [junit]     at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1404)\n    [junit]     at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)\n    [junit]     at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)\n    [junit]     at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)\n    [junit]     at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)\n    [junit]     at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)\n    [junit]     at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)\n    [junit]     at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)\n    [junit]     at org.junit.runners.ParentRunner.run(ParentRunner.java:236)\n    [junit]     at junit.framework.JUnit4TestAdapter.run(JUnit4TestAdapter.java:39)\n    [junit]     at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:420)\n    [junit]     at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch(JUnitTestRunner.java:911)\n    [junit]     at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main(JUnitTestRunner.java:768)\n    [junit]\n    [junit] NOTE: reproduce with: ant test -Dtestcase=EchoParamsTest -Dtestmethod=testDefaultEchoParams -Dtests.seed=-38103159553699\n66158:8631717666953616495\n    [junit] ??? 24, 2011 6:04:37 ? org.apache.solr.SolrTestCaseJ4 assertQ\n    [junit] SEVERE: REQUEST FAILED: xpath=not(//lst[@name='params'])\n    [junit]     xml response was: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n    [junit] <response>\n    [junit] <lst name=\"responseHeader\"><int name=\"status\">0</int><int name=\"QTime\">1</int><str name=\"handler\">org.apache.solr.handle\nr.StandardRequestHandler</str><lst name=\"params\"><str name=\"fl\">implicit</str><str name=\"echoParams\">all</str><str name=\"start\">0</s\ntr><str name=\"q\">foo</str><str name=\"echoHandler\">true</str><str name=\"qt\">crazy_custom_qt</str><str name=\"wt\">xml</str><str name=\"r\nows\">20</str></lst></lst><result name=\"response\" numFound=\"0\" start=\"0\"></result>\n    [junit] </response>\n    [junit]\n    [junit]     request was:echoParams=all&start=0&q=foo&echoHandler=true&qt=crazy_custom_qt&wt=xml&rows=20\n    [junit] ??? 24, 2011 6:04:37 ? org.apache.solr.common.SolrException log\n    [junit] SEVERE: REQUEST FAILED: echoParams=all&start=0&q=foo&echoHandler=true&qt=crazy_custom_qt&wt=xml&rows=20:java.lang.Runtim\neException: REQUEST FAILED: xpath=not(//lst[@name='params'])\n    [junit]     xml response was: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n    [junit] <response>\n    [junit] <lst name=\"responseHeader\"><int name=\"status\">0</int><int name=\"QTime\">1</int><str name=\"handler\">org.apache.solr.handle\nr.StandardRequestHandler</str><lst name=\"params\"><str name=\"fl\">implicit</str><str name=\"echoParams\">all</str><str name=\"start\">0</s\ntr><str name=\"q\">foo</str><str name=\"echoHandler\">true</str><str name=\"qt\">crazy_custom_qt</str><str name=\"wt\">xml</str><str name=\"r\nows\">20</str></lst></lst><result name=\"response\" numFound=\"0\" start=\"0\"></result>\n    [junit] </response>\n    [junit]\n    [junit]     request was:echoParams=all&start=0&q=foo&echoHandler=true&qt=crazy_custom_qt&wt=xml&rows=20\n    [junit]     at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:398)\n    [junit]     at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:372)\n    [junit]     at org.apache.solr.EchoParamsTest.testDefaultEchoParamsDefaultVersion(EchoParamsTest.java:48)\n    [junit]     at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    [junit]     at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n    [junit]     at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    [junit]     at java.lang.reflect.Method.invoke(Method.java:601)\n    [junit]     at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)\n    [junit]     at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)\n    [junit]     at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)\n    [junit]     at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)\n    [junit]     at org.junit.rules.TestWatchman$1.evaluate(TestWatchman.java:48)\n    [junit]     at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)\n    [junit]     at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)\n    [junit]     at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:76)\n    [junit]     at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1486)\n    [junit]     at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1404)\n    [junit]     at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)\n    [junit]     at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)\n    [junit]     at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)\n    [junit]     at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)\n    [junit]     at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)\n    [junit]     at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)\n    [junit]     at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)\n    [junit]     at org.junit.runners.ParentRunner.run(ParentRunner.java:236)\n    [junit]     at junit.framework.JUnit4TestAdapter.run(JUnit4TestAdapter.java:39)\n    [junit]     at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:420)\n    [junit]     at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch(JUnitTestRunner.java:911)\n    [junit]     at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main(JUnitTestRunner.java:768)\n    [junit]\n    [junit] NOTE: reproduce with: ant test -Dtestcase=EchoParamsTest -Dtestmethod=testDefaultEchoParamsDefaultVersion -Dtests.seed=-\n3810315955369966158:2288923891937057479\n    [junit] NOTE: test params are: codec=RandomCodecProvider: {}, locale=ar_EG, timezone=America/Inuvik\n    [junit] NOTE: all tests run in this JVM:\n    [junit] [EchoParamsTest]\n    [junit] NOTE: Windows 7 6.1 amd64/Oracle Corporation 1.7.0 (64-bit)/cpus=2,threads=1,free=110754792,total=127008768\n    [junit] ------------- ---------------- ---------------\n    [junit] Testcase: testDefaultEchoParams(org.apache.solr.EchoParamsTest):    Caused an ERROR\n    [junit] Exception during query\n    [junit] java.lang.RuntimeException: Exception during query\n    [junit]     at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:405)\n    [junit]     at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:372)\n    [junit]     at org.apache.solr.EchoParamsTest.testDefaultEchoParams(EchoParamsTest.java:40)\n    [junit]     at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1486)\n    [junit]     at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1404)\n    [junit] Caused by: java.lang.RuntimeException: REQUEST FAILED: xpath=not(//lst[@name='params'])\n    [junit]     xml response was: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n    [junit] <response>\n    [junit] <lst name=\"responseHeader\"><int name=\"status\">0</int><int name=\"QTime\">0</int><str name=\"handler\">org.apache.solr.handle\nr.StandardRequestHandler</str><lst name=\"params\"><str name=\"fl\">implicit</str><str name=\"echoParams\">all</str><str name=\"start\">0</s\ntr><str name=\"q\">foo</str><str name=\"echoHandler\">true</str><str name=\"qt\">crazy_custom_qt</str><str name=\"wt\">xml</str><str name=\"r\nows\">20</str><str name=\"version\">2.2</str></lst></lst><result name=\"response\" numFound=\"0\" start=\"0\"></result>\n    [junit] </response>\n    [junit]\n    [junit]     request was:echoParams=all&start=0&q=foo&echoHandler=true&qt=crazy_custom_qt&wt=xml&rows=20&version=2.2\n    [junit]     at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:398)\n    [junit]\n    [junit]\n    [junit] Testcase: testDefaultEchoParamsDefaultVersion(org.apache.solr.EchoParamsTest):      Caused an ERROR\n    [junit] Exception during query\n    [junit] java.lang.RuntimeException: Exception during query\n    [junit]     at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:405)\n    [junit]     at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:372)\n    [junit]     at org.apache.solr.EchoParamsTest.testDefaultEchoParamsDefaultVersion(EchoParamsTest.java:48)\n    [junit]     at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1486)\n    [junit]     at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1404)\n    [junit] Caused by: java.lang.RuntimeException: REQUEST FAILED: xpath=not(//lst[@name='params'])\n    [junit]     xml response was: <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n    [junit] <response>\n    [junit] <lst name=\"responseHeader\"><int name=\"status\">0</int><int name=\"QTime\">1</int><str name=\"handler\">org.apache.solr.handle\nr.StandardRequestHandler</str><lst name=\"params\"><str name=\"fl\">implicit</str><str name=\"echoParams\">all</str><str name=\"start\">0</s\ntr><str name=\"q\">foo</str><str name=\"echoHandler\">true</str><str name=\"qt\">crazy_custom_qt</str><str name=\"wt\">xml</str><str name=\"r\nows\">20</str></lst></lst><result name=\"response\" numFound=\"0\" start=\"0\"></result>\n    [junit] </response>\n    [junit]\n    [junit]     request was:echoParams=all&start=0&q=foo&echoHandler=true&qt=crazy_custom_qt&wt=xml&rows=20\n    [junit]     at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:398)\n    [junit]\n    [junit]\n    [junit] Test org.apache.solr.EchoParamsTest FAILED",
    "attachments": {
        "SOLR-2672.patch": "https://issues.apache.org/jira/secure/attachment/12487639/SOLR-2672.patch"
    },
    "issue_links": {},
    "comments": [
        {
            "author": "Uwe Schindler",
            "id": "comment-13070152",
            "date": "2011-07-24T12:15:29+0000",
            "content": "It is definitely not a Hotspot issue, as it also happens with -Xint and -Xbatch. "
        },
        {
            "author": "Uwe Schindler",
            "id": "comment-13070168",
            "date": "2011-07-24T13:15:02+0000",
            "content": "This seems to be the same issue like SOLR-2673. The \"lrf\" param changes between the test methods, that may no longer be executed in order. "
        },
        {
            "author": "Uwe Schindler",
            "id": "comment-13070170",
            "date": "2011-07-24T13:24:23+0000",
            "content": "Simple fix. "
        },
        {
            "author": "Uwe Schindler",
            "id": "comment-13070182",
            "date": "2011-07-24T13:47:44+0000",
            "content": "Committed trunk revision: 1150362\nCommitted 3.x revision: 1150367 "
        },
        {
            "author": "Robert Muir",
            "id": "comment-13106196",
            "date": "2011-09-16T14:48:49+0000",
            "content": "bulk close for 3.4 "
        }
    ]
}