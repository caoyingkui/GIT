{
    "id": "SOLR-2997",
    "title": "Defining <uniqueKey> as a \"long\" type throws an error on startup",
    "details": {
        "affect_versions": "4.0-ALPHA",
        "status": "Resolved",
        "fix_versions": [],
        "components": [],
        "type": "Bug",
        "priority": "Blocker",
        "labels": "",
        "resolution": "Not A Problem"
    },
    "description": "I'm looking at a client index that has the <uniqueKey> defined as a long and Solr trunk (updated 31-Dec) blows up with the stack traces below on startup. I insured that multiValued=\"false\" when testing.\n\nI don't quite know anything about other types. \"string\" and \"lowercase\" (both solr.TextField) work so I'm guessing it's really \"anything other than a TextField\" that blows things up.\n\n3.x allows this, so I'm calling it a blocker. It'll certainly mess up this client if/when they go to 4.x.\n\n\nDec 31, 2011 7:59:21 PM org.apache.solr.common.SolrException log\nSEVERE: java.lang.NullPointerException\n\tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:167)\n\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:129)\n\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:1471)\n\tat org.apache.solr.core.QuerySenderListener.newSearcher(QuerySenderListener.java:59)\n\tat org.apache.solr.core.SolrCore$3.call(SolrCore.java:1248)\n\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:138)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\tat java.lang.Thread.run(Thread.java:680)\n\nDec 31, 2011 7:59:21 PM org.apache.solr.core.SolrCore execute\nINFO: [] webapp=null path=null params=\n{event=firstSearcher&q=static+firstSearcher+warming+in+solrconfig.xml}\n status=500 QTime=5 \nDec 31, 2011 7:59:21 PM org.apache.solr.core.SolrCore close\nINFO: []  CLOSING SolrCore org.apache.solr.core.SolrCore@11ae9aaa\nDec 31, 2011 7:59:21 PM org.apache.solr.core.QuerySenderListener newSearcher\nINFO: QuerySenderListener done.\nDec 31, 2011 7:59:21 PM org.apache.solr.handler.component.SpellCheckComponent$SpellCheckerListener newSearcher\nINFO: Loading spell index for spellchecker: default\nDec 31, 2011 7:59:21 PM org.apache.solr.core.SolrCore registerSearcher\nINFO: [] Registered new searcher Searcher@444b0bbb main\n{DirectoryReader(segments_14f:1323299267166 _ya(3.5):C31842780/6262183 _23l(3.5):C15905038/558657 _1ld(3.5):C34968625/9411287 _1oh(3.5):C4743459 _21d(3.5):C5192301 _24q(3.5):C110671/6962 _27a(3.5):C4807349/783 _21x(3.5):C204964/2 _24f(3.5):C697763/2 _26f(3.5):C162725/1 _25i(3.5):C96/1 _26g(3.5):C9881/1 _26i(3.5):C4630/1 _26l(3.5):C9745/4851 _26q(3.5):C5560 _270(3.5):C70889 _271(3.5):C29112/1 _272(3.5):C65536 _273(3.5):C34465/1 _274(3.5):C67683 _275(3.5):C32318/1 _276(3.5):C64460 _277(3.5):C35541/1 _278(3.5):C68546 _279(3.5):C31455 _27b(3.5):C784)}\nDec 31, 2011 7:59:21 PM org.apache.solr.core.SolrCore closeSearcher\nINFO: [] Closing main searcher on request.\nDec 31, 2011 7:59:21 PM org.apache.solr.search.SolrIndexSearcher close\nINFO: Closing Searcher@444b0bbb main\n\tfieldValueCache\n{lookups=0,hits=0,hitratio=0.00,inserts=0,evictions=0,size=0,warmupTime=0,cumulative_lookups=0,cumulative_hits=0,cumulative_hitratio=0.00,cumulative_inserts=0,cumulative_evictions=0}\n\tfilterCache{lookups=0,hits=0,hitratio=0.00,inserts=0,evictions=0,size=0,warmupTime=0,cumulative_lookups=0,cumulative_hits=0,cumulative_hitratio=0.00,cumulative_inserts=0,cumulative_evictions=0}\n\tqueryResultCache\n{lookups=0,hits=0,hitratio=0.00,inserts=0,evictions=0,size=0,warmupTime=0,cumulative_lookups=0,cumulative_hits=0,cumulative_hitratio=0.00,cumulative_inserts=0,cumulative_evictions=0}\n\tdocumentCache{lookups=0,hits=0,hitratio=0.00,inserts=0,evictions=0,size=0,warmupTime=0,cumulative_lookups=0,cumulative_hits=0,cumulative_hitratio=0.00,cumulative_inserts=0,cumulative_evictions=0}\nDec 31, 2011 7:59:21 PM org.apache.solr.update.DirectUpdateHandler2 close\nINFO: closing DirectUpdateHandler2\n{commits=0,autocommits=0,soft autocommits=0,optimizes=0,rollbacks=0,expungeDeletes=0,docsPending=0,adds=0,deletesById=0,deletesByQuery=0,errors=0,cumulative_adds=0,cumulative_deletesById=0,cumulative_deletesByQuery=0,cumulative_errors=0}\nDec 31, 2011 7:59:21 PM org.apache.solr.update.DirectUpdateHandler2 close\nINFO: closed DirectUpdateHandler2{commits=0,autocommits=0,soft autocommits=0,optimizes=0,rollbacks=0,expungeDeletes=0,docsPending=0,adds=0,deletesById=0,deletesByQuery=0,errors=0,cumulative_adds=0,cumulative_deletesById=0,cumulative_deletesByQuery=0,cumulative_errors=0}\nDec 31, 2011 7:59:21 PM org.apache.solr.common.SolrException log\nSEVERE: org.apache.solr.common.SolrException\n\tat org.apache.solr.core.SolrCore.<init>(SolrCore.java:619)\n\tat org.apache.solr.core.SolrCore.<init>(SolrCore.java:504)\n\tat org.apache.solr.core.CoreContainer.create(CoreContainer.java:655)\n\tat org.apache.solr.core.CoreContainer.load(CoreContainer.java:409)\n\tat org.apache.solr.core.CoreContainer.load(CoreContainer.java:294)\n\tat org.apache.solr.core.CoreContainer$Initializer.initialize(CoreContainer.java:240)\n\tat org.apache.solr.servlet.SolrDispatchFilter.init(SolrDispatchFilter.java:93)\n\tat org.mortbay.jetty.servlet.FilterHolder.doStart(FilterHolder.java:97)\n\tat org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)\n\tat org.mortbay.jetty.servlet.ServletHandler.initialize(ServletHandler.java:713)\n\tat org.mortbay.jetty.servlet.Context.startContext(Context.java:140)\n\tat org.mortbay.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1282)\n\tat org.mortbay.jetty.handler.ContextHandler.doStart(ContextHandler.java:518)\n\tat org.mortbay.jetty.webapp.WebAppContext.doStart(WebAppContext.java:499)\n\tat org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)\n\tat org.mortbay.jetty.handler.HandlerCollection.doStart(HandlerCollection.java:152)\n\tat org.mortbay.jetty.handler.ContextHandlerCollection.doStart(ContextHandlerCollection.java:156)\n\tat org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)\n\tat org.mortbay.jetty.handler.HandlerCollection.doStart(HandlerCollection.java:152)\n\tat org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)\n\tat org.mortbay.jetty.handler.HandlerWrapper.doStart(HandlerWrapper.java:130)\n\tat org.mortbay.jetty.Server.doStart(Server.java:224)\n\tat org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)\n\tat org.mortbay.xml.XmlConfiguration.main(XmlConfiguration.java:985)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.mortbay.start.Main.invokeMain(Main.java:194)\n\tat org.mortbay.start.Main.start(Main.java:534)\n\tat org.mortbay.start.Main.start(Main.java:441)\n\tat org.mortbay.start.Main.main(Main.java:119)\nCaused by: org.apache.solr.common.SolrException: Error initializing QueryElevationComponent.\n\tat org.apache.solr.handler.component.QueryElevationComponent.inform(QueryElevationComponent.java:218)\n\tat org.apache.solr.core.SolrResourceLoader.inform(SolrResourceLoader.java:542)\n\tat org.apache.solr.core.SolrCore.<init>(SolrCore.java:614)\n\t... 31 more\nCaused by: java.lang.NumberFormatException: For input string: \"MA147LL/A\"\n\tat java.lang.NumberFormatException.forInputString(NumberFormatException.java:48)\n\tat java.lang.Long.parseLong(Long.java:410)\n\tat java.lang.Long.parseLong(Long.java:468)\n\tat org.apache.solr.schema.TrieField.readableToIndexed(TrieField.java:310)\n\tat org.apache.solr.schema.TrieField.readableToIndexed(TrieField.java:295)\n\tat org.apache.solr.handler.component.QueryElevationComponent$ElevationObj.<init>(QueryElevationComponent.java:116)\n\tat org.apache.solr.handler.component.QueryElevationComponent.loadElevationMap(QueryElevationComponent.java:279)\n\tat org.apache.solr.handler.component.QueryElevationComponent.inform(QueryElevationComponent.java:201)\n\t... 33 more\n\nDec 31, 2011 7:59:21 PM org.apache.solr.servlet.SolrDispatchFilter init\nSEVERE: Could not start Solr. Check solr/home property and the logs\norg.apache.solr.common.SolrException: No cores were created, please check the logs for errors\n\tat org.apache.solr.core.CoreContainer$Initializer.initialize(CoreContainer.java:249)\n\tat org.apache.solr.servlet.SolrDispatchFilter.init(SolrDispatchFilter.java:93)\n\tat org.mortbay.jetty.servlet.FilterHolder.doStart(FilterHolder.java:97)\n\tat org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)\n\tat org.mortbay.jetty.servlet.ServletHandler.initialize(ServletHandler.java:713)\n\tat org.mortbay.jetty.servlet.Context.startContext(Context.java:140)\n\tat org.mortbay.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1282)\n\tat org.mortbay.jetty.handler.ContextHandler.doStart(ContextHandler.java:518)\n\tat org.mortbay.jetty.webapp.WebAppContext.doStart(WebAppContext.java:499)\n\tat org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)\n\tat org.mortbay.jetty.handler.HandlerCollection.doStart(HandlerCollection.java:152)\n\tat org.mortbay.jetty.handler.ContextHandlerCollection.doStart(ContextHandlerCollection.java:156)\n\tat org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)\n\tat org.mortbay.jetty.handler.HandlerCollection.doStart(HandlerCollection.java:152)\n\tat org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)\n\tat org.mortbay.jetty.handler.HandlerWrapper.doStart(HandlerWrapper.java:130)\n\tat org.mortbay.jetty.Server.doStart(Server.java:224)\n\tat org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)\n\tat org.mortbay.xml.XmlConfiguration.main(XmlConfiguration.java:985)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.mortbay.start.Main.invokeMain(Main.java:194)\n\tat org.mortbay.start.Main.start(Main.java:534)\n\tat org.mortbay.start.Main.start(Main.java:441)\n\tat org.mortbay.start.Main.main(Main.java:119)\nDec 31, 2011 7:59:21 PM org.apache.solr.common.SolrException log\nSEVERE: org.apache.solr.common.SolrException: No cores were created, please check the logs for errors\n\tat org.apache.solr.core.CoreContainer$Initializer.initialize(CoreContainer.java:249)\n\tat org.apache.solr.servlet.SolrDispatchFilter.init(SolrDispatchFilter.java:93)\n\tat org.mortbay.jetty.servlet.FilterHolder.doStart(FilterHolder.java:97)\n\tat org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)\n\tat org.mortbay.jetty.servlet.ServletHandler.initialize(ServletHandler.java:713)\n\tat org.mortbay.jetty.servlet.Context.startContext(Context.java:140)\n\tat org.mortbay.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1282)\n\tat org.mortbay.jetty.handler.ContextHandler.doStart(ContextHandler.java:518)\n\tat org.mortbay.jetty.webapp.WebAppContext.doStart(WebAppContext.java:499)\n\tat org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)\n\tat org.mortbay.jetty.handler.HandlerCollection.doStart(HandlerCollection.java:152)\n\tat org.mortbay.jetty.handler.ContextHandlerCollection.doStart(ContextHandlerCollection.java:156)\n\tat org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)\n\tat org.mortbay.jetty.handler.HandlerCollection.doStart(HandlerCollection.java:152)\n\tat org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)\n\tat org.mortbay.jetty.handler.HandlerWrapper.doStart(HandlerWrapper.java:130)\n\tat org.mortbay.jetty.Server.doStart(Server.java:224)\n\tat org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)\n\tat org.mortbay.xml.XmlConfiguration.main(XmlConfiguration.java:985)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.mortbay.start.Main.invokeMain(Main.java:194)\n\tat org.mortbay.start.Main.start(Main.java:534)\n\tat org.mortbay.start.Main.start(Main.java:441)\n\tat org.mortbay.start.Main.main(Main.java:119)",
    "attachments": {},
    "issue_links": {},
    "comments": [
        {
            "author": "Yonik Seeley",
            "id": "comment-13178122",
            "date": "2012-01-01T06:28:34+0000",
            "content": "Caused by: java.lang.NumberFormatException: For input string: \"MA147LL/A\"\n\nQuick guess: the existing elevate config uses string keys which aren't valid if the uniqueKey is a number? "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-13178173",
            "date": "2012-01-01T15:24:22+0000",
            "content": "Thanks Yonik, you nailed it!\n\nProblem was I copied parts of the schema from the customer's 3.5 to a trunk installation (to work with your suggestions for LukeRequestHandler if you must know <G>) but not the solrconfig. And I forgot all about QEV issue. And of course the client's solrconfig.xml had QEV commented out.....\n That'll teach me to try to read through the stack trace more carefully, had I seen the QEV part of the trace it might have jogged my memory. "
        },
        {
            "author": "Mike Lissner",
            "id": "comment-14697647",
            "date": "2015-08-14T19:52:53+0000",
            "content": "This rather old bug bit me today. I suppose I'm heartened that it also bit Erick. I wonder if it's worth considering a change to the default config so that this doesn't happen anymore. \n\nThe file that causes the problem is elevate.xml, which contains:\n\n<elevate>\n <query text=\"foo bar\">\n  <doc id=\"1\" />\n  <doc id=\"2\" />\n  <doc id=\"3\" />\n </query>\n\n <query text=\"ipod\">\n   <doc id=\"MA147LL/A\" />  <!-- put the actual ipod at the top -->\n   <doc id=\"IW-02\" exclude=\"true\" /> <!-- exclude this cable -->\n </query>\n\n</elevate>\n\nIf we just change this so that the id is an int, we'd be all set. \n\nThe alternative is to provide a config that doesn't have elevate.xml enabled, but I suspect that's not something that'd be considered.\n\nI'm not reopening this bug, because I don't want to be a pain, but this feels like the kind of fix I could actually make if it's just a matter of changing the id in the XML file.\n "
        },
        {
            "author": "Erick Erickson",
            "id": "comment-14698059",
            "date": "2015-08-15T02:08:36+0000",
            "content": "bq: The alternative is to provide a config that doesn't have elevate.xml enabled,\n\nNot sure. I'm totally ambivalent to QEV since it's such a blunt hammer. Having it enabled by default seems like one of those things that's not necessary. \n\nI opened SOLR-7930 for comments. "
        }
    ]
}